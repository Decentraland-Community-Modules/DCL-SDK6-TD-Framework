"use strict";const getGlobalThis=function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==this)return this;throw new Error("Unable to locate global `this`")},globalObject=getGlobalThis();var loader;!function(T){let S=0;const v=[],M=[],A={baseUrl:""},E={};function c(T,v,M){let A=null,C={},O=null;"function"==typeof T?C=T:"string"==typeof T?(A=T,"function"==typeof v?C=v:v instanceof Array&&(O=v,C=M)):T instanceof Array&&(O=T,"function"==typeof v&&(C=v)),O=O||["require","exports","module"],null===A&&(A="unnamed-module-"+S++),A=g(A),O=(O||[]).map((T=>function(T,S){return T?b(S,T):S}(A,T))),E[A]||(E[A]={name:A,parent:null,dclamd:1,dependencies:O,handlers:[],exports:{},dependants:new Set}),E[A].dependencies=O,p(O,(function(T){const S=E[A];if(!S)throw new Error("Could not access registered module "+A);let v=S.exports;v="function"==typeof C?C.apply(globalObject,T)||v:C,S.exports=v,d(A)}),(T=>{if("function"!=typeof onerror)throw T;onerror(T)}),A)}function d(T){const S=E[T];if(!S)throw new Error("Could not access registered module "+T);S.dclamd=2;const v=S.handlers;if(v&&v.length)for(let S=0;S<v.length;S++)v[S](E[T])}function u(T,S,v){if(!E[T])return null;if(T===S||50===v)return[T];const M=E[T].dependencies;for(let A=0,E=M.length;A<E;A++){const E=u(M[A],S,v+1);if(null!==E)return E.push(T),E}return null}function a(T,S){const v=E[T];if(!v)return!1;const M={};for(const T in E)M[T]=!1;const A=[];for(A.push(v),M[T]=!0;A.length>0;){const T=A.shift().dependencies;if(T)for(let v=0,C=T.length;v<C;v++){const C=T[v];if(C===S)return!0;const O=E[C];O&&!M[C]&&(M[C]=!0,A.push(O))}}return!1}function p(T,S,v,A){const C=new Array(T.length).fill(null);let O=0,j=!1;if("string"==typeof T){if(E[T]){if(1===E[T].dclamd)throw new Error(`Trying to load ${T} from ${A}. The first module is still loading.`);return E[T]}throw new Error(T+" has not been defined. Please include it as a dependency in "+A+"'s define()")}const R=T.length;for(let V=0;V<R;V++)switch(T[V]){case"require":const h=function(T,S,v){return p(T,S,v,A)};h.toUrl=function(T){return b(T,A)},C[V]=h,O++;break;case"exports":if(!E[A])throw new Error("Parent module "+A+" not registered yet");C[V]=E[A].exports,O++;break;case"module":C[V]={id:A,uri:b(A)},O++;break;default:{const z=T[V],m=()=>{C[V]=E[z].exports,O++,O===R&&S&&(j=!0,S(C))};if(a(z,A)){const T=u(z,A,0);T&&(T.reverse(),T.push(z),M.push(T)),w(z,(()=>{}),v,A),m()}else w(z,m,v,A);break}}!j&&O===R&&S&&S(C)}function h(T,S){return function(){return dcl.callRpc(T,S.name,v.slice.call(arguments,0))}}function w(T,S,v,M){if(E[T])return E[T].dependants.add(M),void(1===E[T].dclamd?S&&E[T].handlers.push(S):S&&S(E[T]));if(E[T]={name:T,parent:M,dclamd:1,handlers:[S],dependencies:[],dependants:new Set([M]),exports:{}},0===T.indexOf("@")){const S=E[T].exports;if("function"!=typeof dcl.loadModule)throw new Error("Asynchronous modules will not work because loadModule function is not present");dcl.loadModule(T,S).then((v=>{for(const T in v.methods){const M=v.methods[T];S[M.name]=h(v.rpcHandle,M)}d(T)})).catch((T=>{v(T)}))}}function g(T){let S,v=T;for(S=/\/\.\//;S.test(v);)v=v.replace(S,"/");for(v=v.replace(/^\.\//g,""),S=/\/(([^\/])|([^\/][^\/\.])|([^\/\.][^\/])|([^\/][^\/][^\/]+))\/\.\.\//;S.test(v);)v=v.replace(S,"/");return v=v.replace(/^(([^\/])|([^\/][^\/\.])|([^\/\.][^\/])|([^\/][^\/][^\/]+))\/\.\.\//,""),v=v.replace(/^\//g,""),v}function b(T,S){switch(T){case"require":case"exports":case"module":return T}return S?function(T,S){let v=T;if(!v.startsWith("@")&&(v.startsWith("./")||v.startsWith("../"))){const T=S.split("/");T.pop(),v=g(T.join("/")+"/"+v)}return v}(T,S):g(T)}T.config=function(T){if("object"==typeof T)for(const S in T)T.hasOwnProperty(S)&&(A[S]=T[S])},T.define=c,function(T){T.amd={},T.modules=E}(c=T.define||(T.define={})),T.require=p,"undefined"!=typeof dcl&&dcl.onStart((()=>{const T=new Set,S=[];for(const v in E)E[v]&&(1===E[v].dclamd&&S.push(E[v]),E[v].dependencies.forEach((S=>{"require"!==S&&"exports"!==S&&"module"!==S&&(E[S]||T.add(S))})));const v=[];if(M.length&&v.push(`\n> Cyclic dependencies: ${M.map((T=>"\n  - "+T.join(" -> "))).join("")}`),T.size&&v.push(`\n> Undeclared/unknown modules: ${Array.from(T).map((T=>"\n  - "+T)).join("")}`),S.length&&v.push(`\n> These modules didn't load: ${S.map((T=>"\n  - "+T.name)).join("")}.\n`),v.length)throw new Error(v.join("\n"))})),p.toUrl=b}(loader||(loader={})),globalObject.define=loader.define,globalObject.dclamd=loader,function(T){var S=function(){function t(){}return t.AVATAR={getEntityRepresentation:function(T){return T.avatarEntity}},t.FIRST_PERSON_CAMERA={getEntityRepresentation:function(T){return T.firstPersonCameraEntity}},t}(),n=function(T,S){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,S){T.__proto__=S}||function(T,S){for(var v in S)Object.prototype.hasOwnProperty.call(S,v)&&(T[v]=S[v])},n(T,S)
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */};function i(T,S){if("function"!=typeof S&&null!==S)throw new TypeError("Class extends value "+String(S)+" is not a constructor or null");function i(){this.constructor=T}n(T,S),T.prototype=null===S?Object.create(S):(i.prototype=S.prototype,new i)}var o=function(){return o=Object.assign||function(T){for(var S,v=1,M=arguments.length;v<M;v++)for(var A in S=arguments[v])Object.prototype.hasOwnProperty.call(S,A)&&(T[A]=S[A]);return T},o.apply(this,arguments)};function r(T,S,v,M){var A,E=arguments.length,C=E<3?S:null===M?M=Object.getOwnPropertyDescriptor(S,v):M;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)C=Reflect.decorate(T,S,v,M);else for(var O=T.length-1;O>=0;O--)(A=T[O])&&(C=(E<3?A(C):E>3?A(S,v,C):A(S,v))||C);return E>3&&C&&Object.defineProperty(S,v,C),C}function s(T,S){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(T,S)}function h(T){var S="function"==typeof Symbol&&Symbol.iterator,v=S&&T[S],M=0;if(v)return v.call(T);if(T&&"number"==typeof T.length)return{next:function(){return T&&M>=T.length&&(T=void 0),{value:T&&T[M++],done:!T}}};throw new TypeError(S?"Object is not iterable.":"Symbol.iterator is not defined.")}function l(T,S){var v="function"==typeof Symbol&&T[Symbol.iterator];if(!v)return T;var M,A,E=v.call(T),C=[];try{for(;(void 0===S||S-- >0)&&!(M=E.next()).done;)C.push(M.value)}catch(T){A={error:T}}finally{try{M&&!M.done&&(v=E.return)&&v.call(E)}finally{if(A)throw A.error}}return C}function p(T,S){for(var v=0,M=S.length,A=T.length;v<M;v++,A++)T[A]=S[v];return T}var v=0;function u(){for(var T=[],S=0;S<arguments.length;S++)T[S]=arguments[S];"undefined"!=typeof dcl?dcl.log.apply(dcl,p([],l(T))):console.log.apply(console,p(["DEBUG:"],l(T)))}function y(T,S){"undefined"!=typeof dcl?dcl.error(T,S):console.error("ERROR:",T,S)}function f(T){if(v++,0===T.length)throw new Error("newId(type: string): type cannot be empty");return T+v.toString(36)}function m(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(T){var S=16*Math.random()|0;return("x"===T?S:3&S|8).toString(16)}))}var M=[];function _(T){if(!("__event_name__"in T)||"string"!=typeof T.__event_name__)throw new Error("The EventConstructor is not registered");return T.__event_name__}var A=function(){function t(){this.listeners={}}return t.prototype.addListener=function(T,S,v){if(!T||"function"!=typeof T)throw new Error("Invalid EventConstructor");var M=_(T),A=this.listeners[M];A||(A=this.listeners[M]=[]);for(var E=0;E<A.length;E++)if(A[E].listener===S)throw new Error("The provided listener is already registered");return A.push({listener:S,fn:v}),this},t.prototype.removeListener=function(T,S){if(!S||"function"!=typeof S)throw new Error("Invalid EventConstructor");var v=_(S),M=this.listeners[v];if(!M)return!1;for(var A=0;A<M.length;A++)if(M[A].listener===T)return M.splice(A,1),!0;return!1},t.prototype.fireEvent=function(T){var S=_(T.constructor),v=this.listeners[S];if(v)for(var M=0;M<v.length;M++)try{var A=v[M];A.fn.call(A.listener,T)}catch(T){y(T)}return this},t}();function x(){var T=f("EV");if(-1!==M.indexOf(T))throw new Error("The event name ".concat(T," is already taken"));return M.push(T),function(S){return S.__event_name__=T,S}}var E,C=r([x(),s("design:paramtypes",[Object,String,Object])],(function(T,S,v){this.entity=T,this.componentName=S,this.component=v})),O=r([x(),s("design:paramtypes",[Object,String,Object])],(function(T,S,v){this.entity=T,this.componentName=S,this.classId=v})),j=r([x(),s("design:paramtypes",[Object,Object])],(function(T,S){this.entity=T,this.parent=S}));T.UIValueType=void 0,(E=T.UIValueType||(T.UIValueType={}))[E.PERCENT=0]="PERCENT",E[E.PIXELS=1]="PIXELS";var R=function(){function e(S){if(this.type=T.UIValueType.PIXELS,"string"==typeof S){var v=S;v.indexOf("px")>-1?this.type=T.UIValueType.PIXELS:v.indexOf("%")>-1&&(this.type=T.UIValueType.PERCENT),this.value=parseFloat(v)}else this.value=S}return e.prototype.toString=function(){var S=this.value.toString();return this.type===T.UIValueType.PERCENT?S+="%":S+="px",S},e}(),V="__name__symbol_",z="__classId__symbol_",B="__component__id_",H=r([x(),s("design:paramtypes",[String,String,Number])],(function(T,S,v){this.componentId=T,this.componentName=S,this.classId=v})),W=r([x(),s("design:paramtypes",[String])],(function(T){this.componentId=T})),q=r([x(),s("design:paramtypes",[String,Object])],(function(T,S){this.componentId=T,this.component=S}));function P(T,S){return function(v){if(v.isComponent)throw new TypeError("You cannot extend a component. Trying to extend ".concat(v.originalClassName," with: ").concat(T));var M=v,o=function(){var v=Array.prototype.slice.call(arguments),A=new(M.bind.apply(M,p([void 0],l(v))));return Object.defineProperty(A,V,{enumerable:!1,writable:!1,configurable:!1,value:T}),void 0!==S&&Object.defineProperty(A,z,{enumerable:!1,writable:!1,configurable:!1,value:S}),A};return void 0!==S&&(o.__classId__symbol_=S),o.__name__symbol_=T,o.isComponent=!0,o.originalClassName=T,(o.prototype=v.prototype).constructor=v,o}}function N(T,S){return function(v){if(v.isComponent)throw new TypeError("You cannot extend a component. Trying to extend ".concat(v.originalClassName," with: ").concat(T));if("number"!=typeof S||isNaN(S))throw new Error("classId: ".concat(S," is an invalid integer"));var M=v,o=function(){if(!N.engine)throw new Error("You need to set a DisposableComponent.engine before creating disposable components");var v=Array.prototype.slice.call(arguments),A=new(M.bind.apply(M,p([void 0],l(v)))),E=f("C");return Object.defineProperty(A,V,{enumerable:!1,writable:!1,configurable:!1,value:T}),Object.defineProperty(A,B,{enumerable:!1,writable:!1,configurable:!1,value:E}),void 0!==S&&Object.defineProperty(A,z,{enumerable:!1,writable:!1,configurable:!1,value:S}),N.engine&&N.engine.registerComponent(A),A};return void 0!==S&&(o.__classId__symbol_=S),o.__name__symbol_=T,o.isComponent=!0,o.isDisposableComponent=!0,o.originalClassName=T,(o.prototype=v.prototype).constructor=v,o}}function F(T){if(!T)throw new TypeError(T+" is not a component.");if(T.__name__symbol_)return T.__name__symbol_;throw new TypeError(T+" is not a registered component.")}function L(T){if(!T)throw new TypeError(T+" is not a component.");if(T.__classId__symbol_)return T.__classId__symbol_;if(!T.__name__symbol_)throw new TypeError(T+" is not a registered component.");return null}function D(T){if(!T)throw new TypeError(T+" is not a component.");if(T.__component__id_)return T.__component__id_;throw new TypeError(T+" is not a registered disposable component.")}!function(T){T.engine=null}(N||(N={}));var X=function(){function t(){this.dirty=!1,this.data={},this.subscriptions=[]}return t.component=function(T,S){if(delete T[S]){var v=S+"_"+Math.random();T[v]=void 0,Object.defineProperty(T,v,o(o({},Object.getOwnPropertyDescriptor(T,v)),{enumerable:!1})),Object.defineProperty(T,S.toString(),{get:function(){return this[v]},set:function(T){var M=this[v];if(this.data[S]=T?D(T):null,this[v]=T,T!==M){this.dirty=!0;for(var A=0;A<this.subscriptions.length;A++)this.subscriptions[A](S,T,M)}},enumerable:!0})}},t.field=function(T,S){delete T[S]&&Object.defineProperty(T,S.toString(),{get:function(){return this.data[S]},set:function(T){var v=this.data[S];if(this.data[S]=T,T!==v){this.dirty=!0;for(var M=0;M<this.subscriptions.length;M++)this.subscriptions[M](S,T,v)}},enumerable:!0})},t.uiValue=function(T,S){delete T[S]&&Object.defineProperty(T,S.toString(),{get:function(){return this.data[S].toString()},set:function(T){var v=this.data[S],M=new R(T);if(this.data[S]=M,M!==v){this.dirty=!0;for(var A=0;A<this.subscriptions.length;A++)this.subscriptions[A](S,M,v)}},enumerable:!0})},t.readonly=function(T,S){delete T[S]&&Object.defineProperty(T,S.toString(),{get:function(){if(S in this.data==0)throw new Error("The field ".concat(S," is uninitialized"));return this.data[S]},set:function(T){if(S in this.data)throw new Error("The field ".concat(S," is readonly"));this.data[S]=T,this.dirty=!0},enumerable:!0,configurable:!1})},t.prototype.onChange=function(T){return this.subscriptions.push(T),this},t.prototype.toJSON=function(){return this.data},t}();function U(T){return B in T}var Q=function(){function t(){for(var T=[],S=0;S<arguments.length;S++)T[S]=arguments[S];if(this.entities=[],this.active=!1,this._requiresNames=[],!T)throw new Error("ComponentGroup: Could not load the requires list");if(!(T instanceof Array))throw new Error("ComponentGroup: requires list is not an Array");Object.defineProperty(this,"requires",{get:function(){return T.slice()}}),Object.defineProperty(this,"requiresNames",{get:function(){return this._requiresNames.slice()}});for(var n=function(S){var M=T[S],A=null;if(!M)throw new Error("ComponentGroup: the required component at location ".concat(S," is invalid"));try{A=F(M)}catch(T){throw new Error("ComponentGroup: the required component at location ".concat(S," is not registered as a @Component. Remember to provide the class of the component, not the name"))}if(v._requiresNames.some((function(T){return T===A})))throw new Error("ComponentGroup: the required component list has a repeated name ".concat(A));v._requiresNames.push(A)},v=this,M=0;M<T.length;M++)n(M)}return t.prototype.hasEntity=function(T){return!!T.isAddedToEngine()&&-1!==this.entities.indexOf(T)},t.prototype.addEntity=function(T){if(!T.isAddedToEngine())throw new TypeError("ComponentGroup: Cannot add a entity that is not added to the engine");-1===this.entities.indexOf(T)&&this.entities.push(T)},t.prototype.removeEntity=function(T){var S=this.entities.indexOf(T);-1!==S&&this.entities.splice(S,1)},t.prototype.componentRemoved=function(T,S){-1!==this._requiresNames.indexOf(S)&&this.removeEntity(T)},t.prototype.meetsRequirements=function(T){for(var S=0;S<this._requiresNames.length;S++)if(!(this._requiresNames[S]in T.components))return!1;return!0},t}(),K=function(){function t(T){this.name=T,this.children={},this.eventManager=null,this.alive=!1,this.uuid=f("E"),this.components={},this.engine=null,this._parent=null}return t.prototype.addComponentOrReplace=function(T){if("function"==typeof T)throw new Error("You passed a function or class as a component, an instance of component is expected");if("object"!=typeof T)throw new Error("You passed a ".concat(typeof T,", an instance of component is expected"));var S=F(T);if(this.components[S]){if(this.components[S]===T)return T;this.removeComponent(this.components[S],!1)}return this.addComponent(T)},t.prototype.hasComponent=function(T){var S=typeof T;if("string"!==S&&"object"!==S&&"function"!==S)throw new Error("Entity#has(component): component is not a class, name or instance");if(null===T)return!1;var v="string"===S?T:F(T),M=this.components[v];return!!M&&("object"===S?M===T:"function"!==S||M instanceof T)},t.prototype.getComponent=function(T){var S=typeof T;if("string"!==S&&"function"!==S)throw new Error("Entity#get(component): component is not a class or name");var v="string"===S?T:F(T),M=this.components[v];if(!M)throw new Error('Can not get component "'.concat(v,'" from entity "').concat(this.identifier,'"'));if("function"===S){if(M instanceof T)return M;throw new Error('Can not get component "'.concat(v,'" from entity "').concat(this.identifier,'" (by instance)'))}return M},t.prototype.getComponentOrNull=function(T){var S=typeof T;if("string"!==S&&"function"!==S)throw new Error("Entity#getOrNull(component): component is not a class or name");var v="string"===S?T:F(T),M=this.components[v];return M?"function"===S?M instanceof T?M:null:M:null},t.prototype.getComponentOrCreate=function(T){if("function"!=typeof T)throw new Error("Entity#getOrCreate(component): component is not a class");var S=this.getComponentOrNull(T);return S||(F(S=new T),this.addComponentOrReplace(S)),S},t.prototype.addComponent=function(T){if("object"!=typeof T)throw new Error("Entity#add(component): You passed a function or class as a component, an instance of component is expected");var S=F(T),v=L(T);if(this.components[S])throw new Error('A component of type "'.concat(S,'" is already present in entity "').concat(this.identifier,'"'));this.components[S]=T,this.eventManager&&this.eventManager.fireEvent(new O(this,S,v));var M=T;return"function"==typeof M.addedToEntity&&M.addedToEntity(this),T},t.prototype.removeComponent=function(T,S){void 0===S&&(S=!0);var v=typeof T;if("string"!==v&&"function"!==v&&"object"!==v)throw new Error("Entity#remove(component): component is not a class, class or name");var M="string"===v?T:F(T),A=this.components[M];if(A){if("function"===v)return A instanceof T?(delete this.components[M],void(A&&(S&&this.eventManager&&this.eventManager.fireEvent(new C(this,M,A)),"function"==typeof A.removedFromEntity&&A.removedFromEntity(this)))):void u('Entity Warning: Trying to remove wrong (by constructor) component "'.concat(M,'" from entity "').concat(this.identifier,'"'));delete this.components[M],A&&(S&&this.eventManager&&this.eventManager.fireEvent(new C(this,M,A)),"function"==typeof A.removedFromEntity&&A.removedFromEntity(this))}else u('Entity Warning: Trying to remove inexisting component "'.concat(M,'" from entity "').concat(this.identifier,'"'))},t.prototype.isAddedToEngine=function(){return!(!this.engine||!(this.uuid in this.engine.entities)&&this.engine.rootEntity!==this)},t.prototype.setParent=function(T){var S;if(T&&"getEntityRepresentation"in T){if(!this.engine)throw new Error("In order to set an attachable as parent, you first need to add the entity to the engine.");S=T.getEntityRepresentation(this.engine)}else S=!T&&this.engine?this.engine.rootEntity:T;var v=this.getParent();if(S===this)throw new Error('Failed to set parent for entity "'.concat(this.identifier,"\": An entity can't set itself as a its own parent"));if(S===v)return this;var M=this.getCircularAncestor(S);if(M)throw new Error('Failed to set parent for entity "'.concat(this.identifier,'": Circular parent references are not allowed (See entity "').concat(M,'")'));return v&&delete v.children[this.uuid],null!==S&&"0"!==S.uuid&&(!S.isAddedToEngine()&&this.isAddedToEngine()&&this.engine.removeEntity(this),S.isAddedToEngine()&&!this.isAddedToEngine()&&S.engine.addEntity(this)),this._parent=S||null,this.registerAsChild(),this.eventManager&&this.engine&&this.eventManager.fireEvent(new j(this,S)),this},t.prototype.getParent=function(){return this._parent},Object.defineProperty(t.prototype,"identifier",{get:function(){return this.name||this.uuid},enumerable:!1,configurable:!0}),t.prototype.getCircularAncestor=function(T){for(var S=this.engine?this.engine.rootEntity:null,v=T;v&&v!==S;){var M=v.getParent();if(M===this)return v.uuid;v=M}return null},t.prototype.registerAsChild=function(){var T=this.getParent();this.uuid&&T&&(T.children[this.uuid]=this)},t}(),Z=function(){function t(T){this.eventManager=new A,this.systems=[],this.entityLists={},this.addedSystems=[],this._entities={},this._disposableComponents={},this._componentGroups={},this.simpleSystems=[],this.eventManager.addListener(O,this,this.componentAddedHandler),this.eventManager.addListener(C,this,this.componentRemovedHandler),this.rootEntity=T,this.firstPersonCameraEntity=new K,this.firstPersonCameraEntity.uuid="FirstPersonCameraEntityReference",this.addEntity(this.firstPersonCameraEntity),this.avatarEntity=new K,this.avatarEntity.uuid="AvatarEntityReference",this.addEntity(this.avatarEntity)}return Object.defineProperty(t.prototype,"entities",{get:function(){return this._entities},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disposableComponents",{get:function(){return this._disposableComponents},enumerable:!1,configurable:!0}),t.prototype.addEntity=function(T){var S=T.getParent();if(T.isAddedToEngine())return T;for(var v in T.eventManager=this.eventManager,T.engine=this,this._entities[T.uuid]=T,this.checkRequirementsAndAdd(T),S?S.isAddedToEngine()||S===this.rootEntity||u("Engine: warning, added an entity with a parent not present in the engine. Parent id: "+S.uuid):T.setParent(this.rootEntity),T.alive=!0,T.children){var M=T.children[v];M&&(M.isAddedToEngine()||this.addEntity(M))}return T},t.prototype.removeEntity=function(T){var S=T.uuid;if(T.isAddedToEngine()){for(var v in T.components){var M=this._componentGroups[v];if(M)for(var A in M)M[A].removeEntity(T);delete this.entityLists[v][S]}for(var E=0;E<this.simpleSystems.length;E++){var C=this.simpleSystems[E];C.onRemoveEntity&&C.onRemoveEntity(T)}for(var E in T.children){var O=T.children[E];O&&this.removeEntity(O)}return T.alive=!1,T.eventManager=null,delete this._entities[S],!0}for(var v in u("Engine: Trying to remove non existent entity from engine."),T.isAddedToEngine()?u("Engine: Entity id: "+S):u('Engine: Entity "'.concat(T.uuid,'" has not been added to any engine yet.')),u("Engine: Entity's components:"),T.components)u(v);return!1},t.prototype.addSystem=function(T,S){if(void 0===S&&(S=0),-1!==this.addedSystems.indexOf(T))return u("Engine: Trying to add a system that is already added. Aborting"),T;if(this.systems.length>0)for(var v=0;v<this.systems.length;v++){var M=this.systems[v],A=v===this.systems.length-1;if(M.priority>S){this.addedSystems.push(T),this.systems.splice(v,0,{system:T,priority:S});break}if(A){this.addedSystems.push(T),this.systems.splice(v+1,0,{system:T,priority:S});break}}else this.addedSystems.push(T),this.systems.splice(1,0,{system:T,priority:S});return this.registerSystem(T),T},t.prototype.removeSystem=function(T){var S=this.addedSystems.indexOf(T);if(-1!==S){T.active=!1,T.deactivate&&T.deactivate(),this.addedSystems.splice(S,1);for(var v=0;v<this.systems.length;v++)this.systems[v].system===T&&this.systems.splice(v,1);return!0}return!1},t.prototype.update=function(T){for(var S in this.systems){var v=this.systems[S].system;if(v.active&&v.update)try{v.update(T)}catch(T){y(T)}}return this},t.prototype.getEntitiesWithComponent=function(T){var S="string"==typeof T?T:F(T);return S in this.entityLists?this.entityLists[S]:this.entityLists[S]={}},t.prototype.registerComponent=function(T){var S=D(T),v=F(T),M=L(T);this._disposableComponents[S]=T,null!==M&&(this.eventManager.fireEvent(new H(S,v,M)),this.eventManager.fireEvent(new q(S,T)))},t.prototype.disposeComponent=function(T){var S=D(T);return delete this._disposableComponents[S]&&(this.eventManager.fireEvent(new W(S)),T.onDispose&&T.onDispose(),!0)},t.prototype.updateComponent=function(T){this.eventManager.fireEvent(new q(D(T),T))},t.prototype.getComponentGroup=function(){for(var T=[],S=0;S<arguments.length;S++)T[S]=arguments[S];var v=void 0;if(T.length>0&&(j=this._componentGroups[F(T[0])]))for(var M=T.slice(),A=0;A<j.length;A++){var E=j[A];if(M.length===E.requires.length){for(var C=0;C<M.length&&-1!==E.requires.indexOf(M[C]);C++)C===M.length-1&&(v=E);if(v)break}}if(v)return v;(v=new(Q.bind.apply(Q,p([void 0],l(T))))).active=!0;var O=v.requiresNames;for(A=0;A<O.length;A++){var j,R=O[A];(j=this._componentGroups[R])||(this._componentGroups[R]=j=[]),-1===j.indexOf(v)&&j.push(v)}for(var V in this._entities)this.checkRequirements(this._entities[V],v);return v},t.prototype.removeComponentGroup=function(T){if(T.active){T.active=!1;for(var S=T.requiresNames,v=0;v<S.length;v++){var M=S[v],A=this._componentGroups[M];if(A){var E=A.indexOf(T);-1!==E&&A.splice(E,1)}}return!0}return!1},t.prototype.registerSystem=function(T){T.active=!0,T.activate&&T.activate(this),this.simpleSystems.push(T)},t.prototype.checkRequirementsAndAdd=function(T){if(T.isAddedToEngine()){for(var S in T.components){S in this.entityLists||(this.entityLists[S]={}),this.entityLists[S][T.uuid]=T;var v=this._componentGroups[S];if(v)for(var M in v)this.checkRequirements(T,v[M])}for(var A=0;A<this.simpleSystems.length;A++){var E=this.simpleSystems[A];E.onAddEntity&&E.onAddEntity(T)}}},t.prototype.checkRequirements=function(T,S){S.meetsRequirements(T)?S.hasEntity(T)||S.addEntity(T):S.hasEntity(T)&&S.removeEntity(T)},t.prototype.componentAddedHandler=function(T){var S,v=T.entity,M=T.componentName;if(v.isAddedToEngine()){this.entityLists[M]?this.entityLists[M][v.uuid]=v:this.entityLists[M]=((S={})[v.uuid]=v,S);var A=this._componentGroups[M];if(A)for(var E in A)this.checkRequirements(v,A[E])}},t.prototype.componentRemovedHandler=function(T){var S=T.entity,v=T.componentName;if(S.isAddedToEngine()){delete this.entityLists[v][S.uuid];var M=this._componentGroups[v];if(M)for(var A in M)this.checkRequirements(S,M[A])}},t}(),J=Promise.resolve().then.bind(Promise.resolve());function G(T){var S=J(T);return S.isComplete=!1,S.then((function(T){S.isComplete=!0,S.result=T,S.didFail=!1})).catch((function(T){S.isComplete=!0,S.error=T,S.didFail=!0,y("executeTask: FAILED "+T.toString(),T)})),S}var $,ee,ne=function(){function t(T,S,v,M){void 0===S&&(S=!1),this.initalize(T,S,v,M)}return t.prototype.initalize=function(T,S,v,M){return void 0===S&&(S=!1),this.mask=T,this.skipNextObservers=S,this.target=v,this.currentTarget=M,this},t}(),Y=function(T,S,v){void 0===v&&(v=null),this.callback=T,this.mask=S,this.scope=v,this.unregisterOnNextCall=!1,this._willBeUnregistered=!1},ie=function(){function t(){this._observers=null,this._observables=null}return t.Watch=function(T,S,v,M){var A,E;void 0===v&&(v=-1),void 0===M&&(M=null);var C=new t;C._observers=new Array,C._observables=T;try{for(var O=h(T),j=O.next();!j.done;j=O.next()){var R=j.value.add(S,v,!1,M);R&&C._observers.push(R)}}catch(T){A={error:T}}finally{try{j&&!j.done&&(E=O.return)&&E.call(O)}finally{if(A)throw A.error}}return C},t.prototype.dispose=function(){if(this._observers&&this._observables)for(var T=0;T<this._observers.length;T++)this._observables[T].remove(this._observers[T]);this._observers=null,this._observables=null},t}(),oe=function(){function t(T){this._observers=new Array,this._onObserverAdded=null,this._eventState=new ne(0),T&&(this._onObserverAdded=T)}return t.prototype.add=function(T,S,v,M,A){if(void 0===S&&(S=-1),void 0===v&&(v=!1),void 0===M&&(M=null),void 0===A&&(A=!1),!T)return null;var E=new Y(T,S,M);return E.unregisterOnNextCall=A,v?this._observers.unshift(E):this._observers.push(E),this._onObserverAdded&&this._onObserverAdded(E),E},t.prototype.addOnce=function(T){return this.add(T,void 0,void 0,void 0,!0)},t.prototype.remove=function(T){return!!T&&-1!==this._observers.indexOf(T)&&(this._deferUnregister(T),!0)},t.prototype.removeCallback=function(T,S){for(var v=0;v<this._observers.length;v++)if(this._observers[v].callback===T&&(!S||S===this._observers[v].scope))return this._deferUnregister(this._observers[v]),!0;return!1},t.prototype.notifyObservers=function(T,S,v,M){var A,E;if(void 0===S&&(S=-1),!this._observers.length)return!0;var C=this._eventState;C.mask=S,C.target=v,C.currentTarget=M,C.skipNextObservers=!1,C.lastReturnValue=T;try{for(var O=h(this._observers),j=O.next();!j.done;j=O.next()){var R=j.value;if(!R._willBeUnregistered&&(R.mask&S&&(R.scope?C.lastReturnValue=R.callback.apply(R.scope,[T,C]):C.lastReturnValue=R.callback(T,C),R.unregisterOnNextCall&&this._deferUnregister(R)),C.skipNextObservers))return!1}}catch(T){A={error:T}}finally{try{j&&!j.done&&(E=O.return)&&E.call(O)}finally{if(A)throw A.error}}return!0},t.prototype.notifyObserversWithPromise=function(T,S,v,M){var A=this;void 0===S&&(S=-1);var E=Promise.resolve(T);if(!this._observers.length)return E;var C=this._eventState;return C.mask=S,C.target=v,C.currentTarget=M,C.skipNextObservers=!1,this._observers.forEach((function(v){C.skipNextObservers||v._willBeUnregistered||v.mask&S&&(E=v.scope?E.then((function(S){return C.lastReturnValue=S,v.callback.apply(v.scope,[T,C])})):E.then((function(S){return C.lastReturnValue=S,v.callback(T,C)})),v.unregisterOnNextCall&&A._deferUnregister(v))})),E.then((function(){return T}))},t.prototype.notifyObserver=function(T,S,v){void 0===v&&(v=-1);var M=this._eventState;M.mask=v,M.skipNextObservers=!1,T.callback(S,M)},t.prototype.hasObservers=function(){return this._observers.length>0},t.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},t.prototype.clone=function(){var T=new t;return T._observers=this._observers.slice(0),T},t.prototype.hasSpecificMask=function(T){var S,v;void 0===T&&(T=-1);try{for(var M=h(this._observers),A=M.next();!A.done;A=M.next()){var E=A.value;if(E.mask&T||E.mask===T)return!0}}catch(T){S={error:T}}finally{try{A&&!A.done&&(v=M.return)&&v.call(M)}finally{if(S)throw S.error}}return!1},t.prototype._deferUnregister=function(T){var S=this;T.unregisterOnNextCall=!1,T._willBeUnregistered=!0,G((function(){return function(T,S,v,M){return new(v||(v=Promise))((function(S,A){function s(T){try{d(M.next(T))}catch(T){A(T)}}function a(T){try{d(M.throw(T))}catch(T){A(T)}}function d(T){var M;T.done?S(T.value):(M=T.value,M instanceof v?M:new v((function(T){T(M)}))).then(s,a)}d((M=M.apply(T,[])).next())}))}(S,0,void 0,(function(){return function(T,S){var v,M,A,E,C={label:0,sent:function(){if(1&A[0])throw A[1];return A[1]},trys:[],ops:[]};return E={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(E[Symbol.iterator]=function(){return this}),E;function a(E){return function(O){return function(E){if(v)throw new TypeError("Generator is already executing.");for(;C;)try{if(v=1,M&&(A=2&E[0]?M.return:E[0]?M.throw||((A=M.return)&&A.call(M),0):M.next)&&!(A=A.call(M,E[1])).done)return A;switch(M=0,A&&(E=[2&E[0],A.value]),E[0]){case 0:case 1:A=E;break;case 4:return C.label++,{value:E[1],done:!1};case 5:C.label++,M=E[1],E=[0];continue;case 7:E=C.ops.pop(),C.trys.pop();continue;default:if(!((A=(A=C.trys).length>0&&A[A.length-1])||6!==E[0]&&2!==E[0])){C=0;continue}if(3===E[0]&&(!A||E[1]>A[0]&&E[1]<A[3])){C.label=E[1];break}if(6===E[0]&&C.label<A[1]){C.label=A[1],A=E;break}if(A&&C.label<A[2]){C.label=A[2],C.ops.push(E);break}A[2]&&C.ops.pop(),C.trys.pop();continue}E=S.call(T,C)}catch(T){E=[6,T],M=0}finally{v=A=0}if(5&E[0])throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}([E,O])}}}(this,(function(S){return[2,this._remove(T)]}))}))}))},t.prototype._remove=function(T){if(!T)return!1;var S=this._observers.indexOf(T);return-1!==S&&(this._observers.splice(S,1),!0)},t}(),ae=r([x(),s("design:paramtypes",[String,Object])],(function(T,S){this.uuid=T,this.payload=S})),se=r([x(),s("design:paramtypes",[Object])],(function(T){this.payload=T})),ue=r([x(),s("design:paramtypes",[Object])],(function(T){this.payload=T}));function tt(T){return function(){ee&&ee.subscribe(T)}}var ce=new oe(tt("cameraModeChanged")),de=new oe(tt("idleStateChanged")),he=new oe(tt("onEnterScene")),le=he,me=new oe(tt("onLeaveScene")),ye=me,fe=new oe(tt("sceneStart")),Te=new oe(tt("playerExpression")),we=new oe(tt("onPointerLock")),be=new oe(tt("videoEvent")),Se=new oe(tt("profileChanged")),ve=new oe(tt("playerConnected")),Ee=new oe(tt("playerDisconnected")),Ge=new oe(tt("onRealmChanged")),Ie=new oe(tt("playerClicked"));function mt(T){(ee=T)&&ee.onEvent((function(T){switch(T.type){case"onEnterScene":return void he.notifyObservers(T.data);case"onLeaveScene":return void me.notifyObservers(T.data);case"cameraModeChanged":return void ce.notifyObservers(T.data);case"idleStateChanged":return void de.notifyObservers(T.data);case"sceneStart":return void fe.notifyObservers(T.data);case"playerExpression":return void Te.notifyObservers(T.data);case"videoEvent":var S=T.data,v=N.engine.disposableComponents[S.componentId];return v&&v.update(S),void be.notifyObservers(S);case"profileChanged":return void Se.notifyObservers(T.data);case"onPointerLock":return void we.notifyObservers(T.data);case"playerConnected":return void ve.notifyObservers(T.data);case"playerDisconnected":return void Ee.notifyObservers(T.data);case"onRealmChanged":return void Ge.notifyObservers(T.data);case"playerClicked":return void Ie.notifyObservers(T.data)}}))}var Ce=function(){function t(T){this.dcl=T,this.cachedComponents={}}return t.prototype.activate=function(T){var S=this;this.engine=T,T.eventManager.addListener(O,this,this.componentAdded),T.eventManager.addListener(C,this,this.componentRemoved),T.eventManager.addListener(H,this,this.disposableComponentCreated),T.eventManager.addListener(W,this,this.disposableComponentRemoved),T.eventManager.addListener(q,this,this.disposableComponentUpdated),T.eventManager.addListener(j,this,this.parentChanged);var v=T.rootEntity.uuid;this.dcl.addEntity(v),this.dcl.onUpdate((function(v){T.update(v),S.presentEntities()})),this.dcl.onEvent((function(S){var v=S.data;switch(S.type){case"uuidEvent":T.eventManager.fireEvent(new ae(v.uuid,v.payload));break;case"raycastResponse":("HitFirst"===v.queryType||"HitAll"===v.queryType)&&T.eventManager.fireEvent(new se(v));break;case"actionButtonEvent":T.eventManager.fireEvent(new ue(v.payload))}}))},t.prototype.onAddEntity=function(T){if(T&&T.isAddedToEngine()){var S=T.uuid,v=T.getParent();for(var M in this.dcl.addEntity(S),v&&this.dcl.setParent(S,v.uuid),this.cachedComponents[S]={},T.components){var A=T.components[M],E=L(A);if(null!==E)if(U(A))this.dcl.attachEntityComponent(T.uuid,M,D(A));else{var C=JSON.stringify(A);this.dcl.updateEntityComponent(S,M,E,C),this.cachedComponents[S][M]=C}}}},t.prototype.onRemoveEntity=function(T){if(T.isAddedToEngine()){var S=T.uuid;this.dcl.removeEntity(S),delete this.cachedComponents[S]}},t.prototype.presentEntities=function(){for(var T in this.engine.entities){var S=this.engine.entities[T];for(var v in S.components){var M=L(C=S.components[v]);if(null!==M&&!U(C)){var A=this.getJsonIfDirty(S.uuid,v,C);A&&(this.dcl.updateEntityComponent(S.uuid,v,M,A),this.clearDirty(S.uuid,v,C,A))}}}for(var E in this.engine.disposableComponents){var C;(C=this.engine.disposableComponents[E])instanceof X&&C.dirty&&(this.dcl.componentUpdated(E,JSON.stringify(C)),C.dirty=!1)}},t.prototype.componentAdded=function(T){if(T.entity.isAddedToEngine()){var S=T.entity.components[T.componentName];if(U(S))this.dcl.attachEntityComponent(T.entity.uuid,T.componentName,D(S));else if(null!==T.classId){var v=JSON.stringify(S);this.dcl.updateEntityComponent(T.entity.uuid,T.componentName,T.classId,v),this.cachedComponents[T.entity.uuid][T.componentName]=v}}},t.prototype.componentRemoved=function(T){T.entity.isAddedToEngine()&&(this.dcl.removeEntityComponent(T.entity.uuid,T.componentName),delete this.cachedComponents[T.entity.uuid][T.componentName])},t.prototype.disposableComponentCreated=function(T){this.dcl.componentCreated(T.componentId,T.componentName,T.classId)},t.prototype.disposableComponentRemoved=function(T){this.dcl.componentDisposed(T.componentId)},t.prototype.disposableComponentUpdated=function(T){this.dcl.componentUpdated(T.componentId,JSON.stringify(T.component))},t.prototype.parentChanged=function(T){this.dcl.setParent(T.entity.uuid,T.parent?T.parent.uuid:"0")},t.prototype.getJsonIfDirty=function(T,S,v){var M=JSON.stringify(v);return M!==this.cachedComponents[T][S]&&M},t.prototype.clearDirty=function(T,S,v,M){this.cachedComponents[T][S]=M},t}(),Oe="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},_e={},Re={};!function(T){var S,v;Object.defineProperty(T,"__esModule",{value:!0}),T.RAD2DEG=T.DEG2RAD=T.Epsilon=T.ToLinearSpace=T.ToGammaSpace=T.Space=T.Orientation=void 0,(S=T.Orientation||(T.Orientation={}))[S.CW=0]="CW",S[S.CCW=1]="CCW",(v=T.Space||(T.Space={}))[v.LOCAL=0]="LOCAL",v[v.WORLD=1]="WORLD",v[v.BONE=2]="BONE",T.ToGammaSpace=1/2.2,T.ToLinearSpace=2.2,T.Epsilon=1e-6,T.DEG2RAD=Math.PI/180,T.RAD2DEG=360/(2*Math.PI)}(Re);var Pe={},Ve={};Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.buildArray=void 0,Ve.buildArray=function(T,S){const v=[];for(let M=0;M<T;++M)v.push(S());return v};var Le={},Fe={},Ne={},ke={},Ue={};Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.Scalar=void 0;class Et{static WithinEpsilon(T,S,v=1401298e-51){const M=T-S;return-v<=M&&M<=v}static ToHex(T){const S=T.toString(16);return T<=15?("0"+S).toUpperCase():S.toUpperCase()}static Sign(T){const S=+T;return 0===S||isNaN(S)?S:S>0?1:-1}static Clamp(T,S=0,v=1){return Math.min(v,Math.max(S,T))}static Log2(T){return Math.log(T)*Math.LOG2E}static Repeat(T,S){return T-Math.floor(T/S)*S}static Normalize(T,S,v){return(T-S)/(v-S)}static Denormalize(T,S,v){return T*(v-S)+S}static DeltaAngle(T,S){let v=Et.Repeat(S-T,360);return v>180&&(v-=360),v}static PingPong(T,S){const v=Et.Repeat(T,2*S);return S-Math.abs(v-S)}static SmoothStep(T,S,v){let M=Et.Clamp(v);return M=-2*M*M*M+3*M*M,S*M+T*(1-M)}static MoveTowards(T,S,v){let M=0;return M=Math.abs(S-T)<=v?S:T+Et.Sign(S-T)*v,M}static MoveTowardsAngle(T,S,v){const M=Et.DeltaAngle(T,S);let A=0;return A=-v<M&&M<v?S:Et.MoveTowards(T,T+M,v),A}static Lerp(T,S,v){return T+(S-T)*v}static LerpAngle(T,S,v){let M=Et.Repeat(S-T,360);return M>180&&(M-=360),T+M*Et.Clamp(v)}static InverseLerp(T,S,v){let M=0;return M=T!==S?Et.Clamp((v-T)/(S-T)):0,M}static Hermite(T,S,v,M,A){const E=A*A,C=A*E;return T*(2*C-3*E+1)+v*(-2*C+3*E)+S*(C-2*E+A)+M*(C-E)}static RandomRange(T,S){return T===S?T:Math.random()*(S-T)+T}static RangeToPercent(T,S,v){return(T-S)/(v-S)}static PercentToRange(T,S,v){return(v-S)*T+S}static NormalizeRadians(T){return T-Et.TwoPi*Math.floor((T+Math.PI)/Et.TwoPi)}}Ue.Scalar=Et,Et.TwoPi=2*Math.PI,Object.defineProperty(ke,"__esModule",{value:!0}),ke.Vector4=void 0;const Be=Re,He=Ue,We=Le;class Mt{constructor(T,S,v,M){this.x=T,this.y=S,this.z=v,this.w=M}static Add(T,S){return new Mt(T.x,T.y,T.z,T.w).addInPlace(S)}static FromArray(T,S=0){return new Mt(T[S],T[S+1],T[S+2],T[S+3])}static FromArrayToRef(T,S,v){v.x=T[S],v.y=T[S+1],v.z=T[S+2],v.w=T[S+3]}static FromFloatArrayToRef(T,S,v){Mt.FromArrayToRef(T,S,v)}static FromFloatsToRef(T,S,v,M,A){A.x=T,A.y=S,A.z=v,A.w=M}static Zero(){return new Mt(0,0,0,0)}static One(){return new Mt(1,1,1,1)}static Normalize(T){const S=Mt.Zero();return Mt.NormalizeToRef(T,S),S}static NormalizeToRef(T,S){S.copyFrom(T),S.normalize()}static Minimize(T,S){const v=new Mt(T.x,T.y,T.z,T.w);return v.minimizeInPlace(S),v}static Maximize(T,S){const v=new Mt(T.x,T.y,T.z,T.w);return v.maximizeInPlace(S),v}static Distance(T,S){return Math.sqrt(Mt.DistanceSquared(T,S))}static DistanceSquared(T,S){const v=T.x-S.x,M=T.y-S.y,A=T.z-S.z,E=T.w-S.w;return v*v+M*M+A*A+E*E}static Center(T,S){const v=Mt.Add(T,S);return v.scaleInPlace(.5),v}static TransformNormal(T,S){const v=Mt.Zero();return Mt.TransformNormalToRef(T,S,v),v}static TransformNormalToRef(T,S,v){const M=S.m,A=T.x*M[0]+T.y*M[4]+T.z*M[8],E=T.x*M[1]+T.y*M[5]+T.z*M[9],C=T.x*M[2]+T.y*M[6]+T.z*M[10];v.x=A,v.y=E,v.z=C,v.w=T.w}static TransformNormalFromFloatsToRef(T,S,v,M,A,E){const C=A.m;E.x=T*C[0]+S*C[4]+v*C[8],E.y=T*C[1]+S*C[5]+v*C[9],E.z=T*C[2]+S*C[6]+v*C[10],E.w=M}toString(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"}getClassName(){return"Vector4"}getHashCode(){let T=this.x||0;return T=397*T^(this.y||0),T=397*T^(this.z||0),T=397*T^(this.w||0),T}asArray(){const T=new Array;return this.toArray(T,0),T}toArray(T,S=0){return T[S]=this.x,T[S+1]=this.y,T[S+2]=this.z,T[S+3]=this.w,this}addInPlace(T){return this.x+=T.x,this.y+=T.y,this.z+=T.z,this.w+=T.w,this}add(T){return new Mt(this.x+T.x,this.y+T.y,this.z+T.z,this.w+T.w)}addToRef(T,S){return S.x=this.x+T.x,S.y=this.y+T.y,S.z=this.z+T.z,S.w=this.w+T.w,this}subtractInPlace(T){return this.x-=T.x,this.y-=T.y,this.z-=T.z,this.w-=T.w,this}subtract(T){return new Mt(this.x-T.x,this.y-T.y,this.z-T.z,this.w-T.w)}subtractToRef(T,S){return S.x=this.x-T.x,S.y=this.y-T.y,S.z=this.z-T.z,S.w=this.w-T.w,this}subtractFromFloats(T,S,v,M){return new Mt(this.x-T,this.y-S,this.z-v,this.w-M)}subtractFromFloatsToRef(T,S,v,M,A){return A.x=this.x-T,A.y=this.y-S,A.z=this.z-v,A.w=this.w-M,this}negate(){return new Mt(-this.x,-this.y,-this.z,-this.w)}scaleInPlace(T){return this.x*=T,this.y*=T,this.z*=T,this.w*=T,this}scale(T){return new Mt(this.x*T,this.y*T,this.z*T,this.w*T)}scaleToRef(T,S){return S.x=this.x*T,S.y=this.y*T,S.z=this.z*T,S.w=this.w*T,this}scaleAndAddToRef(T,S){return S.x+=this.x*T,S.y+=this.y*T,S.z+=this.z*T,S.w+=this.w*T,this}equals(T){return T&&this.x===T.x&&this.y===T.y&&this.z===T.z&&this.w===T.w}equalsWithEpsilon(T,S=Be.Epsilon){return T&&He.Scalar.WithinEpsilon(this.x,T.x,S)&&He.Scalar.WithinEpsilon(this.y,T.y,S)&&He.Scalar.WithinEpsilon(this.z,T.z,S)&&He.Scalar.WithinEpsilon(this.w,T.w,S)}equalsToFloats(T,S,v,M){return this.x===T&&this.y===S&&this.z===v&&this.w===M}multiplyInPlace(T){return this.x*=T.x,this.y*=T.y,this.z*=T.z,this.w*=T.w,this}multiply(T){return new Mt(this.x*T.x,this.y*T.y,this.z*T.z,this.w*T.w)}multiplyToRef(T,S){return S.x=this.x*T.x,S.y=this.y*T.y,S.z=this.z*T.z,S.w=this.w*T.w,this}multiplyByFloats(T,S,v,M){return new Mt(this.x*T,this.y*S,this.z*v,this.w*M)}divide(T){return new Mt(this.x/T.x,this.y/T.y,this.z/T.z,this.w/T.w)}divideToRef(T,S){return S.x=this.x/T.x,S.y=this.y/T.y,S.z=this.z/T.z,S.w=this.w/T.w,this}divideInPlace(T){return this.divideToRef(T,this)}minimizeInPlace(T){return T.x<this.x&&(this.x=T.x),T.y<this.y&&(this.y=T.y),T.z<this.z&&(this.z=T.z),T.w<this.w&&(this.w=T.w),this}maximizeInPlace(T){return T.x>this.x&&(this.x=T.x),T.y>this.y&&(this.y=T.y),T.z>this.z&&(this.z=T.z),T.w>this.w&&(this.w=T.w),this}floor(){return new Mt(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fract(){return new Mt(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}normalize(){const T=this.length();return 0===T?this:this.scaleInPlace(1/T)}toVector3(){return new We.Vector3(this.x,this.y,this.z)}clone(){return new Mt(this.x,this.y,this.z,this.w)}copyFrom(T){return this.x=T.x,this.y=T.y,this.z=T.z,this.w=T.w,this}copyFromFloats(T,S,v,M){return this.x=T,this.y=S,this.z=v,this.w=M,this}set(T,S,v,M){return this.copyFromFloats(T,S,v,M)}setAll(T){return this.x=this.y=this.z=this.w=T,this}}ke.Vector4=Mt,Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.Matrix=void 0;const qe=Le,Ye=Fe,Xe=Pe,Qe=ke;class Dt{constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this._m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this._updateIdentityStatus(!1)}get m(){return this._m}static get IdentityReadOnly(){return Dt._identityReadOnly}static FromArray(T,S=0){const v=new Dt;return Dt.FromArrayToRef(T,S,v),v}static FromArrayToRef(T,S,v){for(let M=0;M<16;M++)v._m[M]=T[M+S];v._markAsUpdated()}static FromFloatArrayToRefScaled(T,S,v,M){for(let A=0;A<16;A++)M._m[A]=T[A+S]*v;M._markAsUpdated()}static FromValuesToRef(T,S,v,M,A,E,C,O,j,R,V,z,B,H,W,q,X){const Q=X._m;Q[0]=T,Q[1]=S,Q[2]=v,Q[3]=M,Q[4]=A,Q[5]=E,Q[6]=C,Q[7]=O,Q[8]=j,Q[9]=R,Q[10]=V,Q[11]=z,Q[12]=B,Q[13]=H,Q[14]=W,Q[15]=q,X._markAsUpdated()}static FromValues(T,S,v,M,A,E,C,O,j,R,V,z,B,H,W,q){const X=new Dt,Q=X._m;return Q[0]=T,Q[1]=S,Q[2]=v,Q[3]=M,Q[4]=A,Q[5]=E,Q[6]=C,Q[7]=O,Q[8]=j,Q[9]=R,Q[10]=V,Q[11]=z,Q[12]=B,Q[13]=H,Q[14]=W,Q[15]=q,X._markAsUpdated(),X}static Compose(T,S,v){const M=new Dt;return Dt.ComposeToRef(T,S,v,M),M}static ComposeToRef(T,S,v,M){Dt.ScalingToRef(T.x,T.y,T.z,Xe.MathTmp.Matrix[1]),S.toRotationMatrix(Xe.MathTmp.Matrix[0]),Xe.MathTmp.Matrix[1].multiplyToRef(Xe.MathTmp.Matrix[0],M),M.setTranslation(v)}static Identity(){const T=Dt.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return T._updateIdentityStatus(!0),T}static IdentityToRef(T){Dt.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,T),T._updateIdentityStatus(!0)}static Zero(){const T=Dt.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return T._updateIdentityStatus(!1),T}static RotationX(T){const S=new Dt;return Dt.RotationXToRef(T,S),S}static Invert(T){const S=new Dt;return T.invertToRef(S),S}static RotationXToRef(T,S){const v=Math.sin(T),M=Math.cos(T);Dt.FromValuesToRef(1,0,0,0,0,M,v,0,0,-v,M,0,0,0,0,1,S),S._updateIdentityStatus(1===M&&0===v)}static RotationY(T){const S=new Dt;return Dt.RotationYToRef(T,S),S}static RotationYToRef(T,S){const v=Math.sin(T),M=Math.cos(T);Dt.FromValuesToRef(M,0,-v,0,0,1,0,0,v,0,M,0,0,0,0,1,S),S._updateIdentityStatus(1===M&&0===v)}static RotationZ(T){const S=new Dt;return Dt.RotationZToRef(T,S),S}static RotationZToRef(T,S){const v=Math.sin(T),M=Math.cos(T);Dt.FromValuesToRef(M,v,0,0,-v,M,0,0,0,0,1,0,0,0,0,1,S),S._updateIdentityStatus(1===M&&0===v)}static RotationAxis(T,S){const v=new Dt;return Dt.RotationAxisToRef(T,S,v),v}static RotationAxisToRef(T,S,v){const M=Math.sin(-S),A=Math.cos(-S),E=1-A;T.normalize();const C=v._m;C[0]=T.x*T.x*E+A,C[1]=T.x*T.y*E-T.z*M,C[2]=T.x*T.z*E+T.y*M,C[3]=0,C[4]=T.y*T.x*E+T.z*M,C[5]=T.y*T.y*E+A,C[6]=T.y*T.z*E-T.x*M,C[7]=0,C[8]=T.z*T.x*E-T.y*M,C[9]=T.z*T.y*E+T.x*M,C[10]=T.z*T.z*E+A,C[11]=0,C[12]=0,C[13]=0,C[14]=0,C[15]=1,v._markAsUpdated()}static RotationYawPitchRoll(T,S,v){const M=new Dt;return Dt.RotationYawPitchRollToRef(T,S,v,M),M}static RotationYawPitchRollToRef(T,S,v,M){Ye.Quaternion.RotationYawPitchRollToRef(T,S,v,Xe.MathTmp.Quaternion[0]),Xe.MathTmp.Quaternion[0].toRotationMatrix(M)}static Scaling(T,S,v){const M=new Dt;return Dt.ScalingToRef(T,S,v,M),M}static ScalingToRef(T,S,v,M){Dt.FromValuesToRef(T,0,0,0,0,S,0,0,0,0,v,0,0,0,0,1,M),M._updateIdentityStatus(1===T&&1===S&&1===v)}static Translation(T,S,v){const M=new Dt;return Dt.TranslationToRef(T,S,v,M),M}static TranslationToRef(T,S,v,M){Dt.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,T,S,v,1,M),M._updateIdentityStatus(0===T&&0===S&&0===v)}static Lerp(T,S,v){const M=new Dt;return Dt.LerpToRef(T,S,v,M),M}static LerpToRef(T,S,v,M){for(let A=0;A<16;A++)M._m[A]=T._m[A]*(1-v)+S._m[A]*v;M._markAsUpdated()}static DecomposeLerp(T,S,v){const M=new Dt;return Dt.DecomposeLerpToRef(T,S,v,M),M}static DecomposeLerpToRef(T,S,v,M){const A=Xe.MathTmp.Vector3[0],E=Xe.MathTmp.Quaternion[0],C=Xe.MathTmp.Vector3[1];T.decompose(A,E,C);const O=Xe.MathTmp.Vector3[2],j=Xe.MathTmp.Quaternion[1],R=Xe.MathTmp.Vector3[3];S.decompose(O,j,R);const V=Xe.MathTmp.Vector3[4];qe.Vector3.LerpToRef(A,O,v,V);const z=Xe.MathTmp.Quaternion[2];Ye.Quaternion.SlerpToRef(E,j,v,z);const B=Xe.MathTmp.Vector3[5];qe.Vector3.LerpToRef(C,R,v,B),Dt.ComposeToRef(V,z,B,M)}static LookAtLH(T,S,v){const M=new Dt;return Dt.LookAtLHToRef(T,S,v,M),M}static LookAtLHToRef(T,S,v,M){const A=Xe.MathTmp.Vector3[0],E=Xe.MathTmp.Vector3[1],C=Xe.MathTmp.Vector3[2];S.subtractToRef(T,C),C.normalize(),qe.Vector3.CrossToRef(v,C,A);const O=A.lengthSquared();0===O?A.x=1:A.normalizeFromLength(Math.sqrt(O)),qe.Vector3.CrossToRef(C,A,E),E.normalize();const j=-qe.Vector3.Dot(A,T),R=-qe.Vector3.Dot(E,T),V=-qe.Vector3.Dot(C,T);Dt.FromValuesToRef(A.x,E.x,C.x,0,A.y,E.y,C.y,0,A.z,E.z,C.z,0,j,R,V,1,M)}static LookAtRH(T,S,v){const M=new Dt;return Dt.LookAtRHToRef(T,S,v,M),M}static LookAtRHToRef(T,S,v,M){const A=Xe.MathTmp.Vector3[0],E=Xe.MathTmp.Vector3[1],C=Xe.MathTmp.Vector3[2];T.subtractToRef(S,C),C.normalize(),qe.Vector3.CrossToRef(v,C,A);const O=A.lengthSquared();0===O?A.x=1:A.normalizeFromLength(Math.sqrt(O)),qe.Vector3.CrossToRef(C,A,E),E.normalize();const j=-qe.Vector3.Dot(A,T),R=-qe.Vector3.Dot(E,T),V=-qe.Vector3.Dot(C,T);Dt.FromValuesToRef(A.x,E.x,C.x,0,A.y,E.y,C.y,0,A.z,E.z,C.z,0,j,R,V,1,M)}static OrthoLH(T,S,v,M){const A=new Dt;return Dt.OrthoLHToRef(T,S,v,M,A),A}static OrthoLHToRef(T,S,v,M,A){const E=2/T,C=2/S,O=2/(M-v),j=-(M+v)/(M-v);Dt.FromValuesToRef(E,0,0,0,0,C,0,0,0,0,O,0,0,0,j,1,A),A._updateIdentityStatus(1===E&&1===C&&1===O&&0===j)}static OrthoOffCenterLH(T,S,v,M,A,E){const C=new Dt;return Dt.OrthoOffCenterLHToRef(T,S,v,M,A,E,C),C}static OrthoOffCenterLHToRef(T,S,v,M,A,E,C){const O=2/(S-T),j=2/(M-v),R=2/(E-A),V=-(E+A)/(E-A),z=(T+S)/(T-S),B=(M+v)/(v-M);Dt.FromValuesToRef(O,0,0,0,0,j,0,0,0,0,R,0,z,B,V,1,C),C._markAsUpdated()}static OrthoOffCenterRH(T,S,v,M,A,E){const C=new Dt;return Dt.OrthoOffCenterRHToRef(T,S,v,M,A,E,C),C}static OrthoOffCenterRHToRef(T,S,v,M,A,E,C){Dt.OrthoOffCenterLHToRef(T,S,v,M,A,E,C),C._m[10]*=-1}static PerspectiveLH(T,S,v,M){const A=new Dt,E=2*v/T,C=2*v/S,O=(M+v)/(M-v),j=-2*M*v/(M-v);return Dt.FromValuesToRef(E,0,0,0,0,C,0,0,0,0,O,1,0,0,j,0,A),A._updateIdentityStatus(!1),A}static PerspectiveFovLH(T,S,v,M){const A=new Dt;return Dt.PerspectiveFovLHToRef(T,S,v,M,A),A}static PerspectiveFovLHToRef(T,S,v,M,A,E=!0){const C=v,O=M,j=1/Math.tan(.5*T),R=E?j/S:j,V=E?j:j*S,z=(O+C)/(O-C),B=-2*O*C/(O-C);Dt.FromValuesToRef(R,0,0,0,0,V,0,0,0,0,z,1,0,0,B,0,A),A._updateIdentityStatus(!1)}static PerspectiveFovRH(T,S,v,M){const A=new Dt;return Dt.PerspectiveFovRHToRef(T,S,v,M,A),A}static PerspectiveFovRHToRef(T,S,v,M,A,E=!0){const C=v,O=M,j=1/Math.tan(.5*T),R=E?j/S:j,V=E?j:j*S,z=-(O+C)/(O-C),B=-2*O*C/(O-C);Dt.FromValuesToRef(R,0,0,0,0,V,0,0,0,0,z,-1,0,0,B,0,A),A._updateIdentityStatus(!1)}static PerspectiveFovWebVRToRef(T,S,v,M,A=!1){const E=A?-1:1,C=Math.tan(T.upDegrees*Math.PI/180),O=Math.tan(T.downDegrees*Math.PI/180),j=Math.tan(T.leftDegrees*Math.PI/180),R=Math.tan(T.rightDegrees*Math.PI/180),V=2/(j+R),z=2/(C+O),B=M._m;B[0]=V,B[1]=B[2]=B[3]=B[4]=0,B[5]=z,B[6]=B[7]=0,B[8]=(j-R)*V*.5,B[9]=-(C-O)*z*.5,B[10]=-v/(S-v),B[11]=1*E,B[12]=B[13]=B[15]=0,B[14]=-2*v*S/(v-S),M._markAsUpdated()}static GetAsMatrix2x2(T){return[T._m[0],T._m[1],T._m[4],T._m[5]]}static GetAsMatrix3x3(T){return[T._m[0],T._m[1],T._m[2],T._m[4],T._m[5],T._m[6],T._m[8],T._m[9],T._m[10]]}static Transpose(T){const S=new Dt;return Dt.TransposeToRef(T,S),S}static TransposeToRef(T,S){const v=S._m,M=T._m;v[0]=M[0],v[1]=M[4],v[2]=M[8],v[3]=M[12],v[4]=M[1],v[5]=M[5],v[6]=M[9],v[7]=M[13],v[8]=M[2],v[9]=M[6],v[10]=M[10],v[11]=M[14],v[12]=M[3],v[13]=M[7],v[14]=M[11],v[15]=M[15],S._updateIdentityStatus(T._isIdentity,T._isIdentityDirty)}static Reflection(T){const S=new Dt;return Dt.ReflectionToRef(T,S),S}static ReflectionToRef(T,S){T.normalize();const v=T.normal.x,M=T.normal.y,A=T.normal.z,E=-2*v,C=-2*M,O=-2*A;Dt.FromValuesToRef(E*v+1,C*v,O*v,0,E*M,C*M+1,O*M,0,E*A,C*A,O*A+1,0,E*T.d,C*T.d,O*T.d,1,S)}static FromXYZAxesToRef(T,S,v,M){Dt.FromValuesToRef(T.x,T.y,T.z,0,S.x,S.y,S.z,0,v.x,v.y,v.z,0,0,0,0,1,M)}static FromQuaternionToRef(T,S){const v=T.x*T.x,M=T.y*T.y,A=T.z*T.z,E=T.x*T.y,C=T.z*T.w,O=T.z*T.x,j=T.y*T.w,R=T.y*T.z,V=T.x*T.w;S._m[0]=1-2*(M+A),S._m[1]=2*(E+C),S._m[2]=2*(O-j),S._m[3]=0,S._m[4]=2*(E-C),S._m[5]=1-2*(A+v),S._m[6]=2*(R+V),S._m[7]=0,S._m[8]=2*(O+j),S._m[9]=2*(R-V),S._m[10]=1-2*(M+v),S._m[11]=0,S._m[12]=0,S._m[13]=0,S._m[14]=0,S._m[15]=1,S._markAsUpdated()}_markAsUpdated(){this.updateFlag=Dt._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const T=this._m;this._isIdentity=1===T[0]&&0===T[1]&&0===T[2]&&0===T[3]&&0===T[4]&&1===T[5]&&0===T[6]&&0===T[7]&&0===T[8]&&0===T[9]&&1===T[10]&&0===T[11]&&0===T[12]&&0===T[13]&&0===T[14]&&1===T[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]||0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const T=this._m,S=T[0],v=T[1],M=T[2],A=T[3],E=T[4],C=T[5],O=T[6],j=T[7],R=T[8],V=T[9],z=T[10],B=T[11],H=T[12],W=T[13],q=T[14],X=T[15],Q=z*X-q*B,K=V*X-W*B,Z=V*q-W*z,J=R*X-H*B,$=R*q-z*H,ee=R*W-H*V;return S*+(C*Q-O*K+j*Z)+v*-(E*Q-O*J+j*$)+M*+(E*K-C*J+j*ee)+A*-(E*Z-C*$+O*ee)}toArray(){return this._m}asArray(){return this._m}invert(){return this.invertToRef(this),this}reset(){return Dt.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(T){const S=new Dt;return this.addToRef(T,S),S}addToRef(T,S){for(let v=0;v<16;v++)S._m[v]=this._m[v]+T._m[v];return S._markAsUpdated(),this}addToSelf(T){for(let S=0;S<16;S++)this._m[S]+=T._m[S];return this._markAsUpdated(),this}invertToRef(T){if(!0===this._isIdentity)return Dt.IdentityToRef(T),this;const S=this._m,v=S[0],M=S[1],A=S[2],E=S[3],C=S[4],O=S[5],j=S[6],R=S[7],V=S[8],z=S[9],B=S[10],H=S[11],W=S[12],q=S[13],X=S[14],Q=S[15],K=B*Q-X*H,Z=z*Q-q*H,J=z*X-q*B,$=V*Q-W*H,ee=V*X-B*W,ne=V*q-W*z,ie=+(O*K-j*Z+R*J),oe=-(C*K-j*$+R*ee),ae=+(C*Z-O*$+R*ne),se=-(C*J-O*ee+j*ne),ue=v*ie+M*oe+A*ae+E*se;if(0===ue)return T.copyFrom(this),this;const ce=1/ue,de=j*Q-X*R,he=O*Q-q*R,le=O*X-q*j,me=C*Q-W*R,ye=C*X-W*j,fe=C*q-W*O,Te=j*H-B*R,we=O*H-z*R,be=O*B-z*j,Se=C*H-V*R,ve=C*B-V*j,Ee=C*z-V*O,Ge=-(M*K-A*Z+E*J),Ie=+(v*K-A*$+E*ee),Ce=-(v*Z-M*$+E*ne),Oe=+(v*J-M*ee+A*ne),_e=+(M*de-A*he+E*le),Re=-(v*de-A*me+E*ye),Pe=+(v*he-M*me+E*fe),Ve=-(v*le-M*ye+A*fe),Le=-(M*Te-A*we+E*be),Fe=+(v*Te-A*Se+E*ve),Ne=-(v*we-M*Se+E*Ee),ke=+(v*be-M*ve+A*Ee);return Dt.FromValuesToRef(ie*ce,Ge*ce,_e*ce,Le*ce,oe*ce,Ie*ce,Re*ce,Fe*ce,ae*ce,Ce*ce,Pe*ce,Ne*ce,se*ce,Oe*ce,Ve*ce,ke*ce,T),this}addAtIndex(T,S){return this._m[T]+=S,this._markAsUpdated(),this}multiplyAtIndex(T,S){return this._m[T]*=S,this._markAsUpdated(),this}setTranslationFromFloats(T,S,v){return this._m[12]=T,this._m[13]=S,this._m[14]=v,this._markAsUpdated(),this}setTranslation(T){return this.setTranslationFromFloats(T.x,T.y,T.z)}getTranslation(){return new qe.Vector3(this._m[12],this._m[13],this._m[14])}getTranslationToRef(T){return T.x=this._m[12],T.y=this._m[13],T.z=this._m[14],this}removeRotationAndScaling(){const T=this.m;return Dt.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,T[12],T[13],T[14],T[15],this),this._updateIdentityStatus(0===T[12]&&0===T[13]&&0===T[14]&&1===T[15]),this}multiply(T){const S=new Dt;return this.multiplyToRef(T,S),S}copyFrom(T){T.copyToArray(this._m);const S=T;return this._updateIdentityStatus(S._isIdentity,S._isIdentityDirty,S._isIdentity3x2,S._isIdentity3x2Dirty),this}copyToArray(T,S=0){for(let v=0;v<16;v++)T[S+v]=this._m[v];return this}multiplyToRef(T,S){return this._isIdentity?(S.copyFrom(T),this):T._isIdentity?(S.copyFrom(this),this):(this.multiplyToArray(T,S._m,0),S._markAsUpdated(),this)}multiplyToArray(T,S,v){const M=this._m,A=T.m,E=M[0],C=M[1],O=M[2],j=M[3],R=M[4],V=M[5],z=M[6],B=M[7],H=M[8],W=M[9],q=M[10],X=M[11],Q=M[12],K=M[13],Z=M[14],J=M[15],$=A[0],ee=A[1],ne=A[2],ie=A[3],oe=A[4],ae=A[5],se=A[6],ue=A[7],ce=A[8],de=A[9],he=A[10],le=A[11],me=A[12],ye=A[13],fe=A[14],Te=A[15];return S[v]=E*$+C*oe+O*ce+j*me,S[v+1]=E*ee+C*ae+O*de+j*ye,S[v+2]=E*ne+C*se+O*he+j*fe,S[v+3]=E*ie+C*ue+O*le+j*Te,S[v+4]=R*$+V*oe+z*ce+B*me,S[v+5]=R*ee+V*ae+z*de+B*ye,S[v+6]=R*ne+V*se+z*he+B*fe,S[v+7]=R*ie+V*ue+z*le+B*Te,S[v+8]=H*$+W*oe+q*ce+X*me,S[v+9]=H*ee+W*ae+q*de+X*ye,S[v+10]=H*ne+W*se+q*he+X*fe,S[v+11]=H*ie+W*ue+q*le+X*Te,S[v+12]=Q*$+K*oe+Z*ce+J*me,S[v+13]=Q*ee+K*ae+Z*de+J*ye,S[v+14]=Q*ne+K*se+Z*he+J*fe,S[v+15]=Q*ie+K*ue+Z*le+J*Te,this}equals(T){const S=T;if(!S)return!1;if((this._isIdentity||S._isIdentity)&&!this._isIdentityDirty&&!S._isIdentityDirty)return this._isIdentity&&S._isIdentity;const v=this.m,M=S.m;return v[0]===M[0]&&v[1]===M[1]&&v[2]===M[2]&&v[3]===M[3]&&v[4]===M[4]&&v[5]===M[5]&&v[6]===M[6]&&v[7]===M[7]&&v[8]===M[8]&&v[9]===M[9]&&v[10]===M[10]&&v[11]===M[11]&&v[12]===M[12]&&v[13]===M[13]&&v[14]===M[14]&&v[15]===M[15]}clone(){const T=new Dt;return T.copyFrom(this),T}getClassName(){return"Matrix"}getHashCode(){let T=this._m[0]||0;for(let S=1;S<16;S++)T=397*T^(this._m[S]||0);return T}decompose(T,S,v){if(this._isIdentity)return v&&v.setAll(0),T&&T.setAll(1),S&&S.copyFromFloats(0,0,0,1),!0;const M=this._m;v&&v.copyFromFloats(M[12],M[13],M[14]);const A=T||Xe.MathTmp.Vector3[0];if(A.x=Math.sqrt(M[0]*M[0]+M[1]*M[1]+M[2]*M[2]),A.y=Math.sqrt(M[4]*M[4]+M[5]*M[5]+M[6]*M[6]),A.z=Math.sqrt(M[8]*M[8]+M[9]*M[9]+M[10]*M[10]),this.determinant()<=0&&(A.y*=-1),0===A.x||0===A.y||0===A.z)return S&&S.copyFromFloats(0,0,0,1),!1;if(S){const T=1/A.x,v=1/A.y,E=1/A.z;Dt.FromValuesToRef(M[0]*T,M[1]*T,M[2]*T,0,M[4]*v,M[5]*v,M[6]*v,0,M[8]*E,M[9]*E,M[10]*E,0,0,0,0,1,Xe.MathTmp.Matrix[0]),Ye.Quaternion.FromRotationMatrixToRef(Xe.MathTmp.Matrix[0],S)}return!0}getRow(T){if(T<0||T>3)return null;const S=4*T;return new Qe.Vector4(this._m[S+0],this._m[S+1],this._m[S+2],this._m[S+3])}setRow(T,S){return this.setRowFromFloats(T,S.x,S.y,S.z,S.w)}transpose(){return Dt.Transpose(this)}transposeToRef(T){return Dt.TransposeToRef(this,T),this}setRowFromFloats(T,S,v,M,A){if(T<0||T>3)return this;const E=4*T;return this._m[E+0]=S,this._m[E+1]=v,this._m[E+2]=M,this._m[E+3]=A,this._markAsUpdated(),this}scale(T){const S=new Dt;return this.scaleToRef(T,S),S}scaleToRef(T,S){for(let v=0;v<16;v++)S._m[v]=this._m[v]*T;return S._markAsUpdated(),this}scaleAndAddToRef(T,S){for(let v=0;v<16;v++)S._m[v]+=this._m[v]*T;return S._markAsUpdated(),this}toNormalMatrix(T){const S=Xe.MathTmp.Matrix[0];this.invertToRef(S),S.transposeToRef(T);const v=T._m;Dt.FromValuesToRef(v[0],v[1],v[2],0,v[4],v[5],v[6],0,v[8],v[9],v[10],0,0,0,0,1,T)}getRotationMatrix(){const T=new Dt;return this.getRotationMatrixToRef(T),T}getRotationMatrixToRef(T){const S=Xe.MathTmp.Vector3[0];if(!this.decompose(S))return Dt.IdentityToRef(T),this;const v=this._m,M=1/S.x,A=1/S.y,E=1/S.z;return Dt.FromValuesToRef(v[0]*M,v[1]*M,v[2]*M,0,v[4]*A,v[5]*A,v[6]*A,0,v[8]*E,v[9]*E,v[10]*E,0,0,0,0,1,T),this}toggleModelMatrixHandInPlace(){const T=this._m;T[2]*=-1,T[6]*=-1,T[8]*=-1,T[9]*=-1,T[14]*=-1,this._markAsUpdated()}toggleProjectionMatrixHandInPlace(){const T=this._m;T[8]*=-1,T[9]*=-1,T[10]*=-1,T[11]*=-1,this._markAsUpdated()}_updateIdentityStatus(T,S=!1,v=!1,M=!0){this.updateFlag=Dt._updateFlagSeed++,this._isIdentity=T,this._isIdentity3x2=T||v,this._isIdentityDirty=!this._isIdentity&&S,this._isIdentity3x2Dirty=!this._isIdentity3x2&&M}}Ne.Matrix=Dt,Dt._updateFlagSeed=0,Dt._identityReadOnly=Dt.Identity(),Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.Quaternion=void 0;const Ze=Ne,Je=Le,$e=Pe,et=Re,nt=Ue;class jt{constructor(T=0,S=0,v=0,M=1){this.x=T,this.y=S,this.z=v,this.w=M}static FromRotationMatrix(T){const S=new jt;return jt.FromRotationMatrixToRef(T,S),S}static FromRotationMatrixToRef(T,S){const v=T.m,M=v[0],A=v[4],E=v[8],C=v[1],O=v[5],j=v[9],R=v[2],V=v[6],z=v[10],B=M+O+z;let H;B>0?(H=.5/Math.sqrt(B+1),S.w=.25/H,S.x=(V-j)*H,S.y=(E-R)*H,S.z=(C-A)*H):M>O&&M>z?(H=2*Math.sqrt(1+M-O-z),S.w=(V-j)/H,S.x=.25*H,S.y=(A+C)/H,S.z=(E+R)/H):O>z?(H=2*Math.sqrt(1+O-M-z),S.w=(E-R)/H,S.x=(A+C)/H,S.y=.25*H,S.z=(j+V)/H):(H=2*Math.sqrt(1+z-M-O),S.w=(C-A)/H,S.x=(E+R)/H,S.y=(j+V)/H,S.z=.25*H)}static Dot(T,S){return T.x*S.x+T.y*S.y+T.z*S.z+T.w*S.w}static AreClose(T,S){return jt.Dot(T,S)>=0}static Zero(){return new jt(0,0,0,0)}static Inverse(T){return new jt(-T.x,-T.y,-T.z,T.w)}static IsIdentity(T){return T&&0===T.x&&0===T.y&&0===T.z&&1===T.w}static RotationAxis(T,S){const v=S*et.DEG2RAD;return jt.RotationAxisToRef(T,v,new jt)}static RotationAxisToRef(T,S,v){const M=S*et.DEG2RAD,A=Math.sin(M/2);return T.normalize(),v.w=Math.cos(M/2),v.x=T.x*A,v.y=T.y*A,v.z=T.z*A,v}static FromArray(T,S=0){return new jt(T[S],T[S+1],T[S+2],T[S+3])}static FromEulerAnglesRef(T,S,v,M){return jt.RotationYawPitchRollToRef(S*et.DEG2RAD,T*et.DEG2RAD,v*et.DEG2RAD,M)}static RotationYawPitchRoll(T,S,v){const M=new jt;return jt.RotationYawPitchRollToRef(T,S,v,M),M}static RotationYawPitchRollToRef(T,S,v,M){const A=.5*S,E=.5*T,C=.5*v,O=Math.cos(A),j=Math.cos(E),R=Math.cos(C),V=Math.sin(A),z=Math.sin(E),B=Math.sin(C);M.x=j*V*R+z*O*B,M.y=z*O*R-j*V*B,M.z=j*O*B-z*V*R,M.w=j*O*R+z*V*B}static RotationAlphaBetaGamma(T,S,v){const M=new jt;return jt.RotationAlphaBetaGammaToRef(T,S,v,M),M}static RotationAlphaBetaGammaToRef(T,S,v,M){const A=.5*(v+T),E=.5*(v-T),C=.5*S;M.x=Math.cos(E)*Math.sin(C),M.y=Math.sin(E)*Math.sin(C),M.z=Math.sin(A)*Math.cos(C),M.w=Math.cos(A)*Math.cos(C)}static RotationQuaternionFromAxis(T,S,v){const M=new jt(0,0,0,0);return jt.RotationQuaternionFromAxisToRef(T,S,v,M),M}static RotationQuaternionFromAxisToRef(T,S,v,M){const A=$e.MathTmp.Matrix[0];Ze.Matrix.FromXYZAxesToRef(T.normalize(),S.normalize(),v.normalize(),A),jt.FromRotationMatrixToRef(A,M)}static Slerp(T,S,v){const M=jt.Identity;return jt.SlerpToRef(T,S,v,M),M}static SlerpToRef(T,S,v,M){let A,E,C=T.x*S.x+T.y*S.y+T.z*S.z+T.w*S.w,O=!1;if(C<0&&(O=!0,C=-C),C>.999999)E=1-v,A=O?-v:v;else{const T=Math.acos(C),S=1/Math.sin(T);E=Math.sin((1-v)*T)*S,A=O?-Math.sin(v*T)*S:Math.sin(v*T)*S}M.x=E*T.x+A*S.x,M.y=E*T.y+A*S.y,M.z=E*T.z+A*S.z,M.w=E*T.w+A*S.w}static Hermite(T,S,v,M,A){const E=A*A,C=A*E,O=2*C-3*E+1,j=-2*C+3*E,R=C-2*E+A,V=C-E,z=T.x*O+v.x*j+S.x*R+M.x*V,B=T.y*O+v.y*j+S.y*R+M.y*V,H=T.z*O+v.z*j+S.z*R+M.z*V,W=T.w*O+v.w*j+S.w*R+M.w*V;return new jt(z,B,H,W)}static get Identity(){return new jt(0,0,0,1)}static Angle(T,S){const v=jt.Dot(T,S);return 2*Math.acos(Math.min(Math.abs(v),1))*et.RAD2DEG}static Euler(T,S,v){return jt.RotationYawPitchRoll(S*et.DEG2RAD,T*et.DEG2RAD,v*et.DEG2RAD)}static LookRotation(T,S=$e.MathTmp.staticUp){const v=Je.Vector3.Normalize(T),M=Je.Vector3.Normalize(Je.Vector3.Cross(S,v)),A=Je.Vector3.Cross(v,M),E=M.x,C=M.y,O=M.z,j=A.x,R=A.y,V=A.z,z=v.x,B=v.y,H=v.z,W=E+R+H,q=new jt;if(W>0){let T=Math.sqrt(W+1);return q.w=.5*T,T=.5/T,q.x=(V-B)*T,q.y=(z-O)*T,q.z=(C-j)*T,q}if(E>=R&&E>=H){const T=Math.sqrt(1+E-R-H),S=.5/T;return q.x=.5*T,q.y=(C+j)*S,q.z=(O+z)*S,q.w=(V-B)*S,q}if(R>H){const T=Math.sqrt(1+R-E-H),S=.5/T;return q.x=(j+C)*S,q.y=.5*T,q.z=(B+V)*S,q.w=(z-O)*S,q}const X=Math.sqrt(1+H-E-R),Q=.5/X;return q.x=(z+O)*Q,q.y=(B+V)*Q,q.z=.5*X,q.w=(C-j)*Q,q}static RotateTowards(T,S,v){const M=jt.Angle(T,S);if(0===M)return S;const A=Math.min(1,v/M);return jt.Slerp(T,S,A)}static FromToRotation(T,S,v=$e.MathTmp.staticUp){const M=T.normalize(),A=S.normalize(),E=Je.Vector3.Cross(M,A),C=Math.sqrt(M.lengthSquared()*A.lengthSquared())+Je.Vector3.Dot(M,A);return E.lengthSquared()<1e-4?Math.abs(C)<1e-4?new jt(v.x,v.y,v.z,0).normalized:jt.Identity:new jt(E.x,E.y,E.z,C).normalized}get normalized(){return this.normalize()}setFromToRotation(T,S,v=$e.MathTmp.staticUp){const M=jt.FromToRotation(T,S,v);this.x=M.x,this.y=M.y,this.z=M.z,this.w=M.w}set eulerAngles(T){this.setEuler(T.x,T.y,T.z)}get eulerAngles(){const T=new Je.Vector3,S=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w,v=this.x*this.w-this.y*this.z;return v>.4995*S?(T.x=Math.PI/2,T.y=2*Math.atan2(this.y,this.x),T.z=0):v<-.4995*S?(T.x=-Math.PI/2,T.y=-2*Math.atan2(this.y,this.x),T.z=0):(T.x=Math.asin(2*(this.w*this.x-this.y*this.z)),T.y=Math.atan2(2*this.w*this.y+2*this.z*this.x,1-2*(this.x*this.x+this.y*this.y)),T.z=Math.atan2(2*this.w*this.z+2*this.x*this.y,1-2*(this.z*this.z+this.x*this.x))),T.x*=et.RAD2DEG,T.y*=et.RAD2DEG,T.z*=et.RAD2DEG,T.x=nt.Scalar.Repeat(T.x,360),T.y=nt.Scalar.Repeat(T.y,360),T.z=nt.Scalar.Repeat(T.z,360),T}toString(){return`(${this.x}, ${this.y}, ${this.z}, ${this.w})`}get length(){return Math.sqrt(this.lengthSquared)}get lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}getClassName(){return"Quaternion"}getHashCode(){let T=this.x||0;return T=397*T^(this.y||0),T=397*T^(this.z||0),T=397*T^(this.w||0),T}asArray(){return[this.x,this.y,this.z,this.w]}equals(T){return T&&this.x===T.x&&this.y===T.y&&this.z===T.z&&this.w===T.w}clone(){return new jt(this.x,this.y,this.z,this.w)}copyFrom(T){return this.x=T.x,this.y=T.y,this.z=T.z,this.w=T.w,this}copyFromFloats(T,S,v,M){return this.x=T,this.y=S,this.z=v,this.w=M,this}set(T,S,v,M){return this.copyFromFloats(T,S,v,M)}setEuler(T,S,v){return jt.RotationYawPitchRollToRef(S*et.DEG2RAD,T*et.DEG2RAD,v*et.DEG2RAD,this),this}add(T){return new jt(this.x+T.x,this.y+T.y,this.z+T.z,this.w+T.w)}addInPlace(T){return this.x+=T.x,this.y+=T.y,this.z+=T.z,this.w+=T.w,this}subtract(T){return new jt(this.x-T.x,this.y-T.y,this.z-T.z,this.w-T.w)}scale(T){return new jt(this.x*T,this.y*T,this.z*T,this.w*T)}scaleToRef(T,S){return S.x=this.x*T,S.y=this.y*T,S.z=this.z*T,S.w=this.w*T,this}scaleInPlace(T){return this.x*=T,this.y*=T,this.z*=T,this.w*=T,this}scaleAndAddToRef(T,S){return S.x+=this.x*T,S.y+=this.y*T,S.z+=this.z*T,S.w+=this.w*T,this}multiply(T){const S=new jt(0,0,0,1);return this.multiplyToRef(T,S),S}multiplyToRef(T,S){const v=this.x*T.w+this.y*T.z-this.z*T.y+this.w*T.x,M=-this.x*T.z+this.y*T.w+this.z*T.x+this.w*T.y,A=this.x*T.y-this.y*T.x+this.z*T.w+this.w*T.z,E=-this.x*T.x-this.y*T.y-this.z*T.z+this.w*T.w;return S.copyFromFloats(v,M,A,E),this}multiplyInPlace(T){return this.multiplyToRef(T,this),this}conjugateToRef(T){return T.copyFromFloats(-this.x,-this.y,-this.z,this.w),this}conjugateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this}conjugate(){return new jt(-this.x,-this.y,-this.z,this.w)}normalize(){const T=1/this.length;return this.x*=T,this.y*=T,this.z*=T,this.w*=T,this}angleAxis(T,S){if(0===S.lengthSquared())return jt.Identity;const v=jt.Identity;let M=T*et.DEG2RAD;M*=.5;let A=S.normalize();return A=S.scaleInPlace(Math.sin(M)),v.x=A.x,v.y=A.y,v.z=A.z,v.w=Math.cos(M),v.normalize()}toRotationMatrix(T){return Ze.Matrix.FromQuaternionToRef(this,T),this}fromRotationMatrix(T){return jt.FromRotationMatrixToRef(T,this),this}}Fe.Quaternion=jt,Object.defineProperty(Le,"__esModule",{value:!0}),Le.Vector3=void 0;const it=Pe,ot=Re,rt=Fe,at=Ue;class Xt{constructor(T=0,S=0,v=0){this.x=T,this.y=S,this.z=v}get isNonUniform(){const T=Math.abs(this.x),S=Math.abs(this.y);if(T!==S)return!0;const v=Math.abs(this.z);return T!==v||S!==v}static Add(T,S){return new Xt(T.x,T.y,T.z).addInPlace(S)}static GetClipFactor(T,S,v,M){const A=Xt.Dot(T,v)-M;return A/(A-(Xt.Dot(S,v)-M))}static GetAngleBetweenVectors(T,S,v){const M=T.normalizeToRef(it.MathTmp.Vector3[1]),A=S.normalizeToRef(it.MathTmp.Vector3[2]),E=Xt.Dot(M,A),C=it.MathTmp.Vector3[3];return Xt.CrossToRef(M,A,C),Xt.Dot(C,v)>0?Math.acos(E):-Math.acos(E)}static FromArray(T,S=0){return new Xt(T[S],T[S+1],T[S+2])}static FromFloatArray(T,S){return Xt.FromArray(T,S)}static FromArrayToRef(T,S,v){v.x=T[S],v.y=T[S+1],v.z=T[S+2]}static FromFloatArrayToRef(T,S,v){return Xt.FromArrayToRef(T,S,v)}static FromFloatsToRef(T,S,v,M){M.copyFromFloats(T,S,v)}static Zero(){return new Xt(0,0,0)}static One(){return new Xt(1,1,1)}static Up(){return new Xt(0,1,0)}static Down(){return new Xt(0,-1,0)}static Forward(){return new Xt(0,0,1)}static Backward(){return new Xt(0,0,-1)}static Right(){return new Xt(1,0,0)}static Left(){return new Xt(-1,0,0)}static TransformCoordinates(T,S){const v=Xt.Zero();return Xt.TransformCoordinatesToRef(T,S,v),v}static TransformCoordinatesToRef(T,S,v){return Xt.TransformCoordinatesFromFloatsToRef(T.x,T.y,T.z,S,v)}static TransformCoordinatesFromFloatsToRef(T,S,v,M,A){const E=M.m,C=T*E[0]+S*E[4]+v*E[8]+E[12],O=T*E[1]+S*E[5]+v*E[9]+E[13],j=T*E[2]+S*E[6]+v*E[10]+E[14],R=1/(T*E[3]+S*E[7]+v*E[11]+E[15]);A.x=C*R,A.y=O*R,A.z=j*R}static TransformNormal(T,S){const v=Xt.Zero();return Xt.TransformNormalToRef(T,S,v),v}static TransformNormalToRef(T,S,v){this.TransformNormalFromFloatsToRef(T.x,T.y,T.z,S,v)}static TransformNormalFromFloatsToRef(T,S,v,M,A){const E=M.m;A.x=T*E[0]+S*E[4]+v*E[8],A.y=T*E[1]+S*E[5]+v*E[9],A.z=T*E[2]+S*E[6]+v*E[10]}static CatmullRom(T,S,v,M,A){const E=A*A,C=A*E,O=.5*(2*S.x+(-T.x+v.x)*A+(2*T.x-5*S.x+4*v.x-M.x)*E+(-T.x+3*S.x-3*v.x+M.x)*C),j=.5*(2*S.y+(-T.y+v.y)*A+(2*T.y-5*S.y+4*v.y-M.y)*E+(-T.y+3*S.y-3*v.y+M.y)*C),R=.5*(2*S.z+(-T.z+v.z)*A+(2*T.z-5*S.z+4*v.z-M.z)*E+(-T.z+3*S.z-3*v.z+M.z)*C);return new Xt(O,j,R)}static Clamp(T,S,v){const M=new Xt;return Xt.ClampToRef(T,S,v,M),M}static ClampToRef(T,S,v,M){let A=T.x;A=A>v.x?v.x:A,A=A<S.x?S.x:A;let E=T.y;E=E>v.y?v.y:E,E=E<S.y?S.y:E;let C=T.z;C=C>v.z?v.z:C,C=C<S.z?S.z:C,M.copyFromFloats(A,E,C)}static Hermite(T,S,v,M,A){const E=A*A,C=A*E,O=2*C-3*E+1,j=-2*C+3*E,R=C-2*E+A,V=C-E,z=T.x*O+v.x*j+S.x*R+M.x*V,B=T.y*O+v.y*j+S.y*R+M.y*V,H=T.z*O+v.z*j+S.z*R+M.z*V;return new Xt(z,B,H)}static Lerp(T,S,v){const M=new Xt(0,0,0);return Xt.LerpToRef(T,S,v,M),M}static LerpToRef(T,S,v,M){M.x=T.x+(S.x-T.x)*v,M.y=T.y+(S.y-T.y)*v,M.z=T.z+(S.z-T.z)*v}static Dot(T,S){return T.x*S.x+T.y*S.y+T.z*S.z}static Cross(T,S){const v=Xt.Zero();return Xt.CrossToRef(T,S,v),v}static CrossToRef(T,S,v){const M=T.y*S.z-T.z*S.y,A=T.z*S.x-T.x*S.z,E=T.x*S.y-T.y*S.x;v.copyFromFloats(M,A,E)}static Normalize(T){const S=Xt.Zero();return Xt.NormalizeToRef(T,S),S}static NormalizeToRef(T,S){T.normalizeToRef(S)}static Minimize(T,S){const v=new Xt(T.x,T.y,T.z);return v.minimizeInPlace(S),v}static Maximize(T,S){const v=new Xt(T.x,T.y,T.z);return v.maximizeInPlace(S),v}static Distance(T,S){return Math.sqrt(Xt.DistanceSquared(T,S))}static DistanceSquared(T,S){const v=T.x-S.x,M=T.y-S.y,A=T.z-S.z;return v*v+M*M+A*A}static Center(T,S){const v=Xt.Add(T,S);return v.scaleInPlace(.5),v}static RotationFromAxis(T,S,v){const M=Xt.Zero();return Xt.RotationFromAxisToRef(T,S,v,M),M}static RotationFromAxisToRef(T,S,v,M){const A=it.MathTmp.Quaternion[0];rt.Quaternion.RotationQuaternionFromAxisToRef(T,S,v,A),M.copyFrom(A.eulerAngles)}toString(){return`(${this.x}, ${this.y}, ${this.z})`}getClassName(){return"Vector3"}getHashCode(){let T=this.x||0;return T=397*T^(this.y||0),T=397*T^(this.z||0),T}asArray(){const T=[];return this.toArray(T,0),T}toArray(T,S=0){return T[S]=this.x,T[S+1]=this.y,T[S+2]=this.z,this}toQuaternion(){return rt.Quaternion.Identity.setEuler(this.y,this.x,this.z)}addInPlace(T){return this.addInPlaceFromFloats(T.x,T.y,T.z)}addInPlaceFromFloats(T,S,v){return this.x+=T,this.y+=S,this.z+=v,this}add(T){return new Xt(this.x+T.x,this.y+T.y,this.z+T.z)}addToRef(T,S){return S.copyFromFloats(this.x+T.x,this.y+T.y,this.z+T.z)}subtractInPlace(T){return this.x-=T.x,this.y-=T.y,this.z-=T.z,this}subtract(T){return new Xt(this.x-T.x,this.y-T.y,this.z-T.z)}subtractToRef(T,S){return this.subtractFromFloatsToRef(T.x,T.y,T.z,S)}subtractFromFloats(T,S,v){return new Xt(this.x-T,this.y-S,this.z-v)}subtractFromFloatsToRef(T,S,v,M){return M.copyFromFloats(this.x-T,this.y-S,this.z-v)}applyMatrix4(T){this.applyMatrix4ToRef(T,this)}applyMatrix4ToRef(T,S){const{x:v,y:M,z:A}=this,{m:E}=T,C=1/(E[3]*v+E[7]*M+E[11]*A+E[15]);return S.x=(E[0]*v+E[4]*M+E[8]*A+E[12])*C,S.y=(E[1]*v+E[5]*M+E[9]*A+E[13])*C,S.z=(E[2]*v+E[6]*M+E[10]*A+E[14])*C,S}rotate(T){return this.rotateToRef(T,this)}rotateToRef(T,S){const{x:v,y:M,z:A}=this,{x:E,y:C,z:O,w:j}=T,R=j*v+C*A-O*M,V=j*M+O*v-E*A,z=j*A+E*M-C*v,B=-E*v-C*M-O*A;return S.x=R*j+B*-E+V*-O-z*-C,S.y=V*j+B*-C+z*-E-R*-O,S.z=z*j+B*-O+R*-C-V*-E,S}negate(){return new Xt(-this.x,-this.y,-this.z)}scaleInPlace(T){return this.x*=T,this.y*=T,this.z*=T,this}scale(T){return new Xt(this.x*T,this.y*T,this.z*T)}scaleToRef(T,S){return S.copyFromFloats(this.x*T,this.y*T,this.z*T)}scaleAndAddToRef(T,S){return S.addInPlaceFromFloats(this.x*T,this.y*T,this.z*T)}equals(T){return T&&this.x===T.x&&this.y===T.y&&this.z===T.z}equalsWithEpsilon(T,S=ot.Epsilon){return T&&at.Scalar.WithinEpsilon(this.x,T.x,S)&&at.Scalar.WithinEpsilon(this.y,T.y,S)&&at.Scalar.WithinEpsilon(this.z,T.z,S)}equalsToFloats(T,S,v){return this.x===T&&this.y===S&&this.z===v}multiplyInPlace(T){return this.x*=T.x,this.y*=T.y,this.z*=T.z,this}multiply(T){return this.multiplyByFloats(T.x,T.y,T.z)}multiplyToRef(T,S){return S.copyFromFloats(this.x*T.x,this.y*T.y,this.z*T.z)}multiplyByFloats(T,S,v){return new Xt(this.x*T,this.y*S,this.z*v)}divide(T){return new Xt(this.x/T.x,this.y/T.y,this.z/T.z)}divideToRef(T,S){return S.copyFromFloats(this.x/T.x,this.y/T.y,this.z/T.z)}divideInPlace(T){return this.divideToRef(T,this)}minimizeInPlace(T){return this.minimizeInPlaceFromFloats(T.x,T.y,T.z)}maximizeInPlace(T){return this.maximizeInPlaceFromFloats(T.x,T.y,T.z)}minimizeInPlaceFromFloats(T,S,v){return T<this.x&&(this.x=T),S<this.y&&(this.y=S),v<this.z&&(this.z=v),this}maximizeInPlaceFromFloats(T,S,v){return T>this.x&&(this.x=T),S>this.y&&(this.y=S),v>this.z&&(this.z=v),this}floor(){return new Xt(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fract(){return new Xt(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(T){return 0===T||1===T?this:this.scaleInPlace(1/T)}normalizeToNew(){const T=new Xt(0,0,0);return this.normalizeToRef(T),T}normalizeToRef(T){const S=this.length();return 0===S||1===S?T.copyFromFloats(this.x,this.y,this.z):this.scaleToRef(1/S,T)}clone(){return new Xt(this.x,this.y,this.z)}copyFrom(T){return this.copyFromFloats(T.x,T.y,T.z)}copyFromFloats(T,S,v){return this.x=T,this.y=S,this.z=v,this}set(T,S,v){return this.copyFromFloats(T,S,v)}setAll(T){return this.x=this.y=this.z=T,this}}Le.Vector3=Xt,Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.MathTmp=void 0;const st=Ve,ut=Le,ct=Fe,dt=Ne;Pe.MathTmp={Vector3:(0,st.buildArray)(6,ut.Vector3.Zero),Matrix:(0,st.buildArray)(2,dt.Matrix.Identity),Quaternion:(0,st.buildArray)(3,ct.Quaternion.Zero),staticUp:ut.Vector3.Up(),tmpMatrix:dt.Matrix.Zero()};var ht={};Object.defineProperty(ht,"__esModule",{value:!0}),ht.Angle=void 0;class te{constructor(T){this._radians=T,this._radians<0&&(this._radians+=2*Math.PI)}static BetweenTwoPoints(T,S){const v=S.subtract(T),M=Math.atan2(v.y,v.x);return new te(M)}static FromRadians(T){return new te(T)}static FromDegrees(T){return new te(T*Math.PI/180)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}}ht.Angle=te;var lt={},pt={};Object.defineProperty(pt,"__esModule",{value:!0}),pt.Vector2=void 0;const gt=Re,yt=Ue;class re{constructor(T=0,S=0){this.x=T,this.y=S}static Zero(){return new re(0,0)}static One(){return new re(1,1)}static Add(T,S){return new re(T.x,T.y).addInPlace(S)}static FromArray(T,S=0){return new re(T[S],T[S+1])}static FromArrayToRef(T,S,v){v.x=T[S],v.y=T[S+1]}static CatmullRom(T,S,v,M,A){const E=A*A,C=A*E,O=.5*(2*S.x+(-T.x+v.x)*A+(2*T.x-5*S.x+4*v.x-M.x)*E+(-T.x+3*S.x-3*v.x+M.x)*C),j=.5*(2*S.y+(-T.y+v.y)*A+(2*T.y-5*S.y+4*v.y-M.y)*E+(-T.y+3*S.y-3*v.y+M.y)*C);return new re(O,j)}static Clamp(T,S,v){let M=T.x;M=M>v.x?v.x:M,M=M<S.x?S.x:M;let A=T.y;return A=A>v.y?v.y:A,A=A<S.y?S.y:A,new re(M,A)}static Hermite(T,S,v,M,A){const E=A*A,C=A*E,O=2*C-3*E+1,j=-2*C+3*E,R=C-2*E+A,V=C-E,z=T.x*O+v.x*j+S.x*R+M.x*V,B=T.y*O+v.y*j+S.y*R+M.y*V;return new re(z,B)}static Lerp(T,S,v){const M=T.x+(S.x-T.x)*v,A=T.y+(S.y-T.y)*v;return new re(M,A)}static Dot(T,S){return T.x*S.x+T.y*S.y}static Normalize(T){const S=new re(T.x,T.y);return S.normalize(),S}static Minimize(T,S){const v=T.x<S.x?T.x:S.x,M=T.y<S.y?T.y:S.y;return new re(v,M)}static Maximize(T,S){const v=T.x>S.x?T.x:S.x,M=T.y>S.y?T.y:S.y;return new re(v,M)}static Transform(T,S){const v=re.Zero();return re.TransformToRef(T,S,v),v}static TransformToRef(T,S,v){const M=S.m,A=T.x*M[0]+T.y*M[4]+M[12],E=T.x*M[1]+T.y*M[5]+M[13];v.x=A,v.y=E}static PointInTriangle(T,S,v,M){const A=.5*(-v.y*M.x+S.y*(-v.x+M.x)+S.x*(v.y-M.y)+v.x*M.y),E=A<0?-1:1,C=(S.y*M.x-S.x*M.y+(M.y-S.y)*T.x+(S.x-M.x)*T.y)*E,O=(S.x*v.y-S.y*v.x+(S.y-v.y)*T.x+(v.x-S.x)*T.y)*E;return C>0&&O>0&&C+O<2*A*E}static Distance(T,S){return Math.sqrt(re.DistanceSquared(T,S))}static DistanceSquared(T,S){const v=T.x-S.x,M=T.y-S.y;return v*v+M*M}static Center(T,S){const v=re.Add(T,S);return v.scaleInPlace(.5),v}static DistanceOfPointFromSegment(T,S,v){const M=re.DistanceSquared(S,v);if(0===M)return re.Distance(T,S);const A=v.subtract(S),E=Math.max(0,Math.min(1,re.Dot(T.subtract(S),A)/M)),C=S.add(A.multiplyByFloats(E,E));return re.Distance(T,C)}toString(){return"{X: "+this.x+" Y:"+this.y+"}"}getClassName(){return"Vector2"}getHashCode(){let T=this.x||0;return T=397*T^(this.y||0),T}toArray(T,S=0){return T[S]=this.x,T[S+1]=this.y,this}asArray(){const T=new Array;return this.toArray(T,0),T}copyFrom(T){return this.x=T.x,this.y=T.y,this}copyFromFloats(T,S){return this.x=T,this.y=S,this}set(T,S){return this.copyFromFloats(T,S)}add(T){return new re(this.x+T.x,this.y+T.y)}addToRef(T,S){return S.x=this.x+T.x,S.y=this.y+T.y,this}addInPlace(T){return this.x+=T.x,this.y+=T.y,this}addVector3(T){return new re(this.x+T.x,this.y+T.y)}subtract(T){return new re(this.x-T.x,this.y-T.y)}subtractToRef(T,S){return S.x=this.x-T.x,S.y=this.y-T.y,this}subtractInPlace(T){return this.x-=T.x,this.y-=T.y,this}multiplyInPlace(T){return this.x*=T.x,this.y*=T.y,this}multiply(T){return new re(this.x*T.x,this.y*T.y)}multiplyToRef(T,S){return S.x=this.x*T.x,S.y=this.y*T.y,this}multiplyByFloats(T,S){return new re(this.x*T,this.y*S)}divide(T){return new re(this.x/T.x,this.y/T.y)}divideToRef(T,S){return S.x=this.x/T.x,S.y=this.y/T.y,this}divideInPlace(T){return this.divideToRef(T,this)}negate(){return new re(-this.x,-this.y)}scaleInPlace(T){return this.x*=T,this.y*=T,this}scale(T){const S=new re(0,0);return this.scaleToRef(T,S),S}scaleToRef(T,S){return S.x=this.x*T,S.y=this.y*T,this}scaleAndAddToRef(T,S){return S.x+=this.x*T,S.y+=this.y*T,this}equals(T){return T&&this.x===T.x&&this.y===T.y}equalsWithEpsilon(T,S=gt.Epsilon){return T&&yt.Scalar.WithinEpsilon(this.x,T.x,S)&&yt.Scalar.WithinEpsilon(this.y,T.y,S)}floor(){return new re(Math.floor(this.x),Math.floor(this.y))}fract(){return new re(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){const T=this.length();if(0===T)return this;const S=1/T;return this.x*=S,this.y*=S,this}clone(){return new re(this.x,this.y)}}pt.Vector2=re,Object.defineProperty(lt,"__esModule",{value:!0}),lt.Arc2=void 0;const ft=ht,Tt=pt,wt=Re;lt.Arc2=class{constructor(T,S,v){this.startPoint=T,this.midPoint=S,this.endPoint=v;const M=Math.pow(S.x,2)+Math.pow(S.y,2),A=(Math.pow(T.x,2)+Math.pow(T.y,2)-M)/2,E=(M-Math.pow(v.x,2)-Math.pow(v.y,2))/2,C=(T.x-S.x)*(S.y-v.y)-(S.x-v.x)*(T.y-S.y);this.centerPoint=new Tt.Vector2((A*(S.y-v.y)-E*(T.y-S.y))/C,((T.x-S.x)*E-(S.x-v.x)*A)/C),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=ft.Angle.BetweenTwoPoints(this.centerPoint,this.startPoint);const O=this.startAngle.degrees();let j=ft.Angle.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),R=ft.Angle.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();j-O>180&&(j-=360),j-O<-180&&(j+=360),R-j>180&&(R-=360),R-j<-180&&(R+=360),this.orientation=j-O<0?wt.Orientation.CW:wt.Orientation.CCW,this.angle=ft.Angle.FromDegrees(this.orientation===wt.Orientation.CW?O-R:R-O)}};var bt={};Object.defineProperty(bt,"__esModule",{value:!0}),bt.Axis=void 0;const St=Le;class pe{}bt.Axis=pe,pe.X=new St.Vector3(1,0,0),pe.Y=new St.Vector3(0,1,0),pe.Z=new St.Vector3(0,0,1);var vt={};Object.defineProperty(vt,"__esModule",{value:!0}),vt.BezierCurve=void 0,vt.BezierCurve=class{static Interpolate(T,S,v,M,A){const E=1-3*M+3*S,C=3*M-6*S,O=3*S;let j=T;for(let S=0;S<5;S++){const S=j*j;j-=1/(3*E*S+2*C*j+O)*(E*(S*j)+C*S+O*j-T),j=Math.min(1,Math.max(0,j))}return 3*Math.pow(1-j,2)*j*v+3*(1-j)*Math.pow(j,2)*A+Math.pow(j,3)}};var At={},xt={};Object.defineProperty(xt,"__esModule",{value:!0}),xt.Color4=void 0;const Gt=Ue,It=Re;class ge{constructor(T=0,S=0,v=0,M=1){this.r=T,this.g=S,this.b=v,this.a=M}static FromHexString(T){if("#"!==T.substring(0,1)||9!==T.length)return new ge(0,0,0,0);const S=parseInt(T.substring(1,3),16),v=parseInt(T.substring(3,5),16),M=parseInt(T.substring(5,7),16),A=parseInt(T.substring(7,9),16);return ge.FromInts(S,v,M,A)}static Lerp(T,S,v){const M=new ge(0,0,0,0);return ge.LerpToRef(T,S,v,M),M}static LerpToRef(T,S,v,M){M.r=T.r+(S.r-T.r)*v,M.g=T.g+(S.g-T.g)*v,M.b=T.b+(S.b-T.b)*v,M.a=T.a+(S.a-T.a)*v}static Red(){return new ge(1,0,0,1)}static Green(){return new ge(0,1,0,1)}static Blue(){return new ge(0,0,1,1)}static Black(){return new ge(0,0,0,1)}static White(){return new ge(1,1,1,1)}static Purple(){return new ge(.5,0,.5,1)}static Magenta(){return new ge(1,0,1,1)}static Yellow(){return new ge(1,1,0,1)}static Gray(){return new ge(.5,.5,.5,1)}static Teal(){return new ge(0,1,1,1)}static Clear(){return new ge(0,0,0,0)}static FromColor3(T,S=1){return new ge(T.r,T.g,T.b,S)}static FromArray(T,S=0){return new ge(T[S],T[S+1],T[S+2],T[S+3])}static FromInts(T,S,v,M){return new ge(T/255,S/255,v/255,M/255)}static CheckColors4(T,S){if(T.length===3*S){const S=[];for(let v=0;v<T.length;v+=3){const M=v/3*4;S[M]=T[v],S[M+1]=T[v+1],S[M+2]=T[v+2],S[M+3]=1}return S}return T}addInPlace(T){return this.r+=T.r,this.g+=T.g,this.b+=T.b,this.a+=T.a,this}asArray(){const T=new Array;return this.toArray(T,0),T}toArray(T,S=0){return T[S]=this.r,T[S+1]=this.g,T[S+2]=this.b,T[S+3]=this.a,this}add(T){return new ge(this.r+T.r,this.g+T.g,this.b+T.b,this.a+T.a)}subtract(T){return new ge(this.r-T.r,this.g-T.g,this.b-T.b,this.a-T.a)}subtractToRef(T,S){return S.r=this.r-T.r,S.g=this.g-T.g,S.b=this.b-T.b,S.a=this.a-T.a,this}scale(T){return new ge(this.r*T,this.g*T,this.b*T,this.a*T)}scaleToRef(T,S){return S.r=this.r*T,S.g=this.g*T,S.b=this.b*T,S.a=this.a*T,this}scaleAndAddToRef(T,S){return S.r+=this.r*T,S.g+=this.g*T,S.b+=this.b*T,S.a+=this.a*T,this}clampToRef(T=0,S=1,v){return v.r=Gt.Scalar.Clamp(this.r,T,S),v.g=Gt.Scalar.Clamp(this.g,T,S),v.b=Gt.Scalar.Clamp(this.b,T,S),v.a=Gt.Scalar.Clamp(this.a,T,S),this}multiply(T){return new ge(this.r*T.r,this.g*T.g,this.b*T.b,this.a*T.a)}multiplyToRef(T,S){return S.r=this.r*T.r,S.g=this.g*T.g,S.b=this.b*T.b,S.a=this.a*T.a,S}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"Color4"}getHashCode(){let T=this.r||0;return T=397*T^(this.g||0),T=397*T^(this.b||0),T=397*T^(this.a||0),T}clone(){return new ge(this.r,this.g,this.b,this.a)}copyFrom(T){return this.r=T.r,this.g=T.g,this.b=T.b,this.a=T.a,this}copyFromFloats(T,S,v,M){return this.r=T,this.g=S,this.b=v,this.a=M,this}set(T,S,v,M){return this.copyFromFloats(T,S,v,M)}toHexString(){const T=255*this.r|0,S=255*this.g|0,v=255*this.b|0,M=255*this.a|0;return"#"+Gt.Scalar.ToHex(T)+Gt.Scalar.ToHex(S)+Gt.Scalar.ToHex(v)+Gt.Scalar.ToHex(M)}toLinearSpace(){const T=new ge;return this.toLinearSpaceToRef(T),T}toLinearSpaceToRef(T){return T.r=Math.pow(this.r,It.ToLinearSpace),T.g=Math.pow(this.g,It.ToLinearSpace),T.b=Math.pow(this.b,It.ToLinearSpace),T.a=this.a,this}toGammaSpace(){const T=new ge;return this.toGammaSpaceToRef(T),T}toGammaSpaceToRef(T){return T.r=Math.pow(this.r,It.ToGammaSpace),T.g=Math.pow(this.g,It.ToGammaSpace),T.b=Math.pow(this.b,It.ToGammaSpace),T.a=this.a,this}}xt.Color4=ge,Object.defineProperty(At,"__esModule",{value:!0}),At.Color3=void 0;const Ct=Re,Ot=xt,_t=Ue;class xe{constructor(T=0,S=0,v=0){this.r=T,this.g=S,this.b=v}static FromHexString(T){if("#"!==T.substring(0,1)||7!==T.length)return new xe(0,0,0);const S=parseInt(T.substring(1,3),16),v=parseInt(T.substring(3,5),16),M=parseInt(T.substring(5,7),16);return xe.FromInts(S,v,M)}static FromArray(T,S=0){return new xe(T[S],T[S+1],T[S+2])}static FromInts(T,S,v){return new xe(T/255,S/255,v/255)}static Lerp(T,S,v){const M=new xe(0,0,0);return xe.LerpToRef(T,S,v,M),M}static LerpToRef(T,S,v,M){M.r=T.r+(S.r-T.r)*v,M.g=T.g+(S.g-T.g)*v,M.b=T.b+(S.b-T.b)*v}static Red(){return new xe(1,0,0)}static Green(){return new xe(0,1,0)}static Blue(){return new xe(0,0,1)}static Black(){return new xe(0,0,0)}static White(){return new xe(1,1,1)}static Purple(){return new xe(.5,0,.5)}static Magenta(){return new xe(1,0,1)}static Yellow(){return new xe(1,1,0)}static Gray(){return new xe(.5,.5,.5)}static Teal(){return new xe(0,1,1)}static Random(){return new xe(Math.random(),Math.random(),Math.random())}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"Color3"}getHashCode(){let T=this.r||0;return T=397*T^(this.g||0),T=397*T^(this.b||0),T}toArray(T,S=0){return T[S]=this.r,T[S+1]=this.g,T[S+2]=this.b,this}toColor4(T=1){return new Ot.Color4(this.r,this.g,this.b,T)}asArray(){const T=new Array;return this.toArray(T,0),T}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(T){return new xe(this.r*T.r,this.g*T.g,this.b*T.b)}multiplyToRef(T,S){return S.r=this.r*T.r,S.g=this.g*T.g,S.b=this.b*T.b,this}equals(T){return T&&this.r===T.r&&this.g===T.g&&this.b===T.b}equalsFloats(T,S,v){return this.r===T&&this.g===S&&this.b===v}scale(T){return new xe(this.r*T,this.g*T,this.b*T)}scaleToRef(T,S){return S.r=this.r*T,S.g=this.g*T,S.b=this.b*T,this}scaleAndAddToRef(T,S){return S.r+=this.r*T,S.g+=this.g*T,S.b+=this.b*T,this}clampToRef(T=0,S=1,v){return v.r=_t.Scalar.Clamp(this.r,T,S),v.g=_t.Scalar.Clamp(this.g,T,S),v.b=_t.Scalar.Clamp(this.b,T,S),this}add(T){return new xe(this.r+T.r,this.g+T.g,this.b+T.b)}addToRef(T,S){return S.r=this.r+T.r,S.g=this.g+T.g,S.b=this.b+T.b,this}subtract(T){return new xe(this.r-T.r,this.g-T.g,this.b-T.b)}subtractToRef(T,S){return S.r=this.r-T.r,S.g=this.g-T.g,S.b=this.b-T.b,this}clone(){return new xe(this.r,this.g,this.b)}copyFrom(T){return this.r=T.r,this.g=T.g,this.b=T.b,this}copyFromFloats(T,S,v){return this.r=T,this.g=S,this.b=v,this}set(T,S,v){return this.copyFromFloats(T,S,v)}toHexString(){const T=255*this.r|0,S=255*this.g|0,v=255*this.b|0;return"#"+_t.Scalar.ToHex(T)+_t.Scalar.ToHex(S)+_t.Scalar.ToHex(v)}toLinearSpace(){const T=new xe;return this.toLinearSpaceToRef(T),T}toLinearSpaceToRef(T){return T.r=Math.pow(this.r,Ct.ToLinearSpace),T.g=Math.pow(this.g,Ct.ToLinearSpace),T.b=Math.pow(this.b,Ct.ToLinearSpace),this}toGammaSpace(){const T=new xe;return this.toGammaSpaceToRef(T),T}toGammaSpaceToRef(T){return T.r=Math.pow(this.r,Ct.ToGammaSpace),T.g=Math.pow(this.g,Ct.ToGammaSpace),T.b=Math.pow(this.b,Ct.ToGammaSpace),this}toJSON(){return{r:this.r,g:this.g,b:this.b}}}At.Color3=xe;var Rt={};Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.Curve3=void 0;const Pt=Le;class Ae{constructor(T){this._length=0,this._points=T,this._length=this._computeLength(T)}static CreateQuadraticBezier(T,S,v,M){M=M>2?M:3;const A=new Array,r=(T,S,v,M)=>(1-T)*(1-T)*S+2*T*(1-T)*v+T*T*M;for(let E=0;E<=M;E++)A.push(new Pt.Vector3(r(E/M,T.x,S.x,v.x),r(E/M,T.y,S.y,v.y),r(E/M,T.z,S.z,v.z)));return new Ae(A)}static CreateCubicBezier(T,S,v,M,A){A=A>3?A:4;const E=new Array,s=(T,S,v,M,A)=>(1-T)*(1-T)*(1-T)*S+3*T*(1-T)*(1-T)*v+3*T*T*(1-T)*M+T*T*T*A;for(let C=0;C<=A;C++)E.push(new Pt.Vector3(s(C/A,T.x,S.x,v.x,M.x),s(C/A,T.y,S.y,v.y,M.y),s(C/A,T.z,S.z,v.z,M.z)));return new Ae(E)}static CreateHermiteSpline(T,S,v,M,A){const E=new Array,C=1/A;for(let O=0;O<=A;O++)E.push(Pt.Vector3.Hermite(T,S,v,M,O*C));return new Ae(E)}static CreateCatmullRomSpline(T,S,v){const M=new Array,A=1/S;let E=0;if(v){const v=T.length;for(let C=0;C<v;C++){E=0;for(let O=0;O<S;O++)M.push(Pt.Vector3.CatmullRom(T[C%v],T[(C+1)%v],T[(C+2)%v],T[(C+3)%v],E)),E+=A}M.push(M[0])}else{const v=new Array;v.push(T[0].clone()),Array.prototype.push.apply(v,T),v.push(T[T.length-1].clone());let C=0;for(C=0;C<v.length-3;C++){E=0;for(let T=0;T<S;T++)M.push(Pt.Vector3.CatmullRom(v[C],v[C+1],v[C+2],v[C+3],E)),E+=A}C--,M.push(Pt.Vector3.CatmullRom(v[C],v[C+1],v[C+2],v[C+3],E))}return new Ae(M)}getPoints(){return this._points}length(){return this._length}continue(T){const S=this._points[this._points.length-1],v=this._points.slice(),M=T.getPoints();for(let T=1;T<M.length;T++)v.push(M[T].subtract(M[0]).add(S));return new Ae(v)}_computeLength(T){let S=0;for(let v=1;v<T.length;v++)S+=T[v].subtract(T[v-1]).length();return S}}Rt.Curve3=Ae;var Vt={},Lt={};Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.Plane=void 0;const Ft=Le,Nt=Ne,kt=Pe;class ze{constructor(T,S,v,M){this.normal=new Ft.Vector3(T,S,v),this.d=M}static FromArray(T){return new ze(T[0],T[1],T[2],T[3])}static FromPoints(T,S,v){const M=new ze(0,0,0,0);return M.copyFromPoints(T,S,v),M}static FromPositionAndNormal(T,S){const v=new ze(0,0,0,0);return S.normalize(),v.normal=S,v.d=-(S.x*T.x+S.y*T.y+S.z*T.z),v}static SignedDistanceToPlaneFromPositionAndNormal(T,S,v){const M=-(S.x*T.x+S.y*T.y+S.z*T.z);return Ft.Vector3.Dot(v,S)+M}asArray(){return[this.normal.x,this.normal.y,this.normal.z,this.d]}clone(){return new ze(this.normal.x,this.normal.y,this.normal.z,this.d)}getClassName(){return"Plane"}getHashCode(){let T=this.normal.getHashCode();return T=397*T^(this.d||0),T}normalize(){const T=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z);let S=0;return 0!==T&&(S=1/T),this.normal.x*=S,this.normal.y*=S,this.normal.z*=S,this.d*=S,this}transform(T){const S=kt.MathTmp.Matrix[0];Nt.Matrix.TransposeToRef(T,S);const v=S.m,M=this.normal.x,A=this.normal.y,E=this.normal.z,C=this.d,O=M*v[0]+A*v[1]+E*v[2]+C*v[3],j=M*v[4]+A*v[5]+E*v[6]+C*v[7],R=M*v[8]+A*v[9]+E*v[10]+C*v[11],V=M*v[12]+A*v[13]+E*v[14]+C*v[15];return new ze(O,j,R,V)}dotCoordinate(T){return this.normal.x*T.x+this.normal.y*T.y+this.normal.z*T.z+this.d}copyFromPoints(T,S,v){const M=S.x-T.x,A=S.y-T.y,E=S.z-T.z,C=v.x-T.x,O=v.y-T.y,j=v.z-T.z,R=A*j-E*O,V=E*C-M*j,z=M*O-A*C,B=Math.sqrt(R*R+V*V+z*z);let H;return H=0!==B?1/B:0,this.normal.x=R*H,this.normal.y=V*H,this.normal.z=z*H,this.d=-(this.normal.x*T.x+this.normal.y*T.y+this.normal.z*T.z),this}isFrontFacingTo(T,S){return Ft.Vector3.Dot(this.normal,T)<=S}signedDistanceTo(T){return Ft.Vector3.Dot(T,this.normal)+this.d}}Lt.Plane=ze,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.Frustum=void 0;const Ut=Lt;class Me{static GetPlanes(T){const S=[];for(let T=0;T<6;T++)S.push(new Ut.Plane(0,0,0,0));return Me.GetPlanesToRef(T,S),S}static GetNearPlaneToRef(T,S){const v=T.m;S.normal.x=v[3]+v[2],S.normal.y=v[7]+v[6],S.normal.z=v[11]+v[10],S.d=v[15]+v[14],S.normalize()}static GetFarPlaneToRef(T,S){const v=T.m;S.normal.x=v[3]-v[2],S.normal.y=v[7]-v[6],S.normal.z=v[11]-v[10],S.d=v[15]-v[14],S.normalize()}static GetLeftPlaneToRef(T,S){const v=T.m;S.normal.x=v[3]+v[0],S.normal.y=v[7]+v[4],S.normal.z=v[11]+v[8],S.d=v[15]+v[12],S.normalize()}static GetRightPlaneToRef(T,S){const v=T.m;S.normal.x=v[3]-v[0],S.normal.y=v[7]-v[4],S.normal.z=v[11]-v[8],S.d=v[15]-v[12],S.normalize()}static GetTopPlaneToRef(T,S){const v=T.m;S.normal.x=v[3]-v[1],S.normal.y=v[7]-v[5],S.normal.z=v[11]-v[9],S.d=v[15]-v[13],S.normalize()}static GetBottomPlaneToRef(T,S){const v=T.m;S.normal.x=v[3]+v[1],S.normal.y=v[7]+v[5],S.normal.z=v[11]+v[9],S.d=v[15]+v[13],S.normalize()}static GetPlanesToRef(T,S){Me.GetNearPlaneToRef(T,S[0]),Me.GetFarPlaneToRef(T,S[1]),Me.GetLeftPlaneToRef(T,S[2]),Me.GetRightPlaneToRef(T,S[3]),Me.GetTopPlaneToRef(T,S[4]),Me.GetBottomPlaneToRef(T,S[5])}}Vt.Frustum=Me;var zt={};Object.defineProperty(zt,"__esModule",{value:!0}),zt.Path2=void 0;const Bt=pt,Ht=lt,Wt=Re;class De{constructor(T,S){this.closed=!1,this._points=new Array,this._length=0,this._points.push(new Bt.Vector2(T,S))}static StartingAt(T,S){return new De(T,S)}addLineTo(T,S){if(this.closed)return this;const v=new Bt.Vector2(T,S),M=this._points[this._points.length-1];return this._points.push(v),this._length+=v.subtract(M).length(),this}addArcTo(T,S,v,M,A=36){if(this.closed)return this;const E=this._points[this._points.length-1],C=new Bt.Vector2(T,S),O=new Bt.Vector2(v,M),j=new Ht.Arc2(E,C,O);let R=j.angle.radians()/A;j.orientation===Wt.Orientation.CW&&(R*=-1);let V=j.startAngle.radians()+R;for(let T=0;T<A;T++){const T=Math.cos(V)*j.radius+j.centerPoint.x,S=Math.sin(V)*j.radius+j.centerPoint.y;this.addLineTo(T,S),V+=R}return this}close(){return this.closed=!0,this}length(){let T=this._length;if(!this.closed){const S=this._points[this._points.length-1];T+=this._points[0].subtract(S).length()}return T}getPoints(){return this._points}getPointAtLengthPosition(T){if(T<0||T>1)return Bt.Vector2.Zero();const S=T*this.length();let v=0;for(let T=0;T<this._points.length;T++){const M=(T+1)%this._points.length,A=this._points[T],E=this._points[M].subtract(A),C=E.length()+v;if(S>=v&&S<=C){const T=E.normalize(),M=S-v;return new Bt.Vector2(A.x+T.x*M,A.y+T.y*M)}v=C}return Bt.Vector2.Zero()}}zt.Path2=De;var qt={};Object.defineProperty(qt,"__esModule",{value:!0}),qt.Path3D=void 0;const Yt=Le,Qt=Re,Kt=Ue;qt.Path3D=class{constructor(T,S=null,v){this.path=T,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(let S=0;S<T.length;S++)this._curve[S]=T[S].clone();this._raw=v||!1,this._compute(S)}getCurve(){return this._curve}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}update(T,S=null){for(let S=0;S<T.length;S++)this._curve[S].x=T[S].x,this._curve[S].y=T[S].y,this._curve[S].z=T[S].z;return this._compute(S),this}_compute(T){const S=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[S-1]=this._curve[S-1].subtract(this._curve[S-2]),this._raw||this._tangents[S-1].normalize();const v=this._tangents[0],M=this._normalVector(this._curve[0],v,T);let A,E,C,O;this._normals[0]=M,this._raw||this._normals[0].normalize(),this._binormals[0]=Yt.Vector3.Cross(v,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let T=1;T<S;T++)A=this._getLastNonNullVector(T),T<S-1&&(E=this._getFirstNonNullVector(T),this._tangents[T]=A.add(E),this._tangents[T].normalize()),this._distances[T]=this._distances[T-1]+A.length(),C=this._tangents[T],O=this._binormals[T-1],this._normals[T]=Yt.Vector3.Cross(O,C),this._raw||this._normals[T].normalize(),this._binormals[T]=Yt.Vector3.Cross(C,this._normals[T]),this._raw||this._binormals[T].normalize()}_getFirstNonNullVector(T){let S=1,v=this._curve[T+S].subtract(this._curve[T]);for(;0===v.length()&&T+S+1<this._curve.length;)S++,v=this._curve[T+S].subtract(this._curve[T]);return v}_getLastNonNullVector(T){let S=1,v=this._curve[T].subtract(this._curve[T-S]);for(;0===v.length()&&T>S+1;)S++,v=this._curve[T].subtract(this._curve[T-S]);return v}_normalVector(T,S,v){let M,A=S.length();if(0===A&&(A=1),null==v){let T;T=Kt.Scalar.WithinEpsilon(Math.abs(S.y)/A,1,Qt.Epsilon)?Kt.Scalar.WithinEpsilon(Math.abs(S.x)/A,1,Qt.Epsilon)?Kt.Scalar.WithinEpsilon(Math.abs(S.z)/A,1,Qt.Epsilon)?Yt.Vector3.Zero():new Yt.Vector3(0,0,1):new Yt.Vector3(1,0,0):new Yt.Vector3(0,-1,0),M=Yt.Vector3.Cross(S,T)}else M=Yt.Vector3.Cross(S,v),Yt.Vector3.CrossToRef(M,S,M);return M.normalize(),M}};var Zt={};Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.Size=void 0;class je{constructor(T,S){this.width=T,this.height=S}get surface(){return this.width*this.height}static Zero(){return new je(0,0)}static Lerp(T,S,v){const M=T.width+(S.width-T.width)*v,A=T.height+(S.height-T.height)*v;return new je(M,A)}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let T=this.width||0;return T=397*T^(this.height||0),T}copyFrom(T){this.width=T.width,this.height=T.height}copyFromFloats(T,S){return this.width=T,this.height=S,this}set(T,S){return this.copyFromFloats(T,S)}multiplyByFloats(T,S){return new je(this.width*T,this.height*S)}clone(){return new je(this.width,this.height)}equals(T){return!!T&&this.width===T.width&&this.height===T.height}add(T){return new je(this.width+T.width,this.height+T.height)}subtract(T){return new je(this.width-T.width,this.height-T.height)}}Zt.Size=je,function(T){var S=Oe&&Oe.__createBinding||(Object.create?function(T,S,v,M){void 0===M&&(M=v),Object.defineProperty(T,M,{enumerable:!0,get:function(){return S[v]}})}:function(T,S,v,M){void 0===M&&(M=v),T[M]=S[v]}),v=Oe&&Oe.__exportStar||function(T,v){for(var M in T)"default"===M||Object.prototype.hasOwnProperty.call(v,M)||S(v,T,M)};Object.defineProperty(T,"__esModule",{value:!0}),v(Re,T),v(Pe,T),v(ht,T),v(lt,T),v(bt,T),v(vt,T),v(At,T),v(xt,T),v(Rt,T),v(Vt,T),v(Ne,T),v(zt,T),v(qt,T),v(Lt,T),v(Fe,T),v(Ue,T),v(Zt,T),v(pt,T),v(Le,T),v(ke,T),v(_e,T)}(_e);var Jt,$t,tn,nn,on={looping:!0,speed:1,weight:1,layer:0},rn=function(T){function e(S,v){void 0===v&&(v=on);var M=T.call(this)||this;return M.isAnimationClip=!0,M.looping=on.looping,M.weight=on.weight,M.playing=!1,M.shouldReset=!1,M.speed=on.speed,M.name=f("AnimClip"),M.layer=on.layer,M.clip=S,M.setParams(o({},v)),M}return i(e,T),e.prototype.setParams=function(T){return this.looping=void 0!==T.looping?T.looping:this.looping,this.speed=T.speed||this.speed,this.weight=T.weight||this.weight,this.layer=T.layer||this.layer,this},e.prototype.toJSON=function(){var S=JSON.parse(JSON.stringify(T.prototype.toJSON.call(this)));return this.shouldReset&&(this.shouldReset=!1),S},e.prototype.play=function(T){var S;void 0===T&&(T=!1),null===(S=this.owner)||void 0===S||S.play(this,T)},e.prototype.pause=function(){var T;null===(T=this.owner)||void 0===T||T.pause(this)},e.prototype.reset=function(){this.shouldReset=!0},e.prototype.stop=function(){var T;null===(T=this.owner)||void 0===T||T.stop(this)},r([X.readonly,s("design:type",String)],e.prototype,"clip",void 0),r([X.field,s("design:type",Boolean)],e.prototype,"looping",void 0),r([X.field,s("design:type",Number)],e.prototype,"weight",void 0),r([X.field,s("design:type",Boolean)],e.prototype,"playing",void 0),r([X.field,s("design:type",Boolean)],e.prototype,"shouldReset",void 0),r([X.field,s("design:type",Number)],e.prototype,"speed",void 0),r([X.readonly,s("design:type",String)],e.prototype,"name",void 0),e}(X);T.InputEventType=void 0,(Jt=T.InputEventType||(T.InputEventType={}))[Jt.DOWN=0]="DOWN",Jt[Jt.UP=1]="UP",T.CameraMode=void 0,($t=T.CameraMode||(T.CameraMode={}))[$t.FirstPerson=0]="FirstPerson",$t[$t.ThirdPerson=1]="ThirdPerson",$t[$t.BuildingToolGodMode=2]="BuildingToolGodMode",T.LandRole=void 0,(tn=T.LandRole||(T.LandRole={})).OWNER="owner",tn.OPERATOR="operator",T.ActionButton=void 0,(nn=T.ActionButton||(T.ActionButton={})).POINTER="POINTER",nn.PRIMARY="PRIMARY",nn.SECONDARY="SECONDARY",nn.ANY="ANY",nn.FORWARD="FORWARD",nn.BACKWARD="BACKWARD",nn.RIGHT="RIGHT",nn.LEFT="LEFT",nn.JUMP="JUMP",nn.WALK="WALK",nn.ACTION_3="ACTION_3",nn.ACTION_4="ACTION_4",nn.ACTION_5="ACTION_5",nn.ACTION_6="ACTION_6";var an,sn,Ke=function(T){if(this.callback=T,!T||!("apply"in T)||!("call"in T))throw new Error("Callback is not a function");dn.ensureInstance()},un=function(T){function e(){return null!==T&&T.apply(this,arguments)||this}return i(e,T),r([P("pointerDown")],e)}(Ke),cn=function(T){function e(){return null!==T&&T.apply(this,arguments)||this}return i(e,T),r([P("pointerUp")],e)}(Ke),en=function(T,S){this.fn=T,this.useRaycast=S},dn=function(){function e(){this.buttonIdMapping=[T.ActionButton.POINTER,T.ActionButton.PRIMARY,T.ActionButton.SECONDARY,T.ActionButton.ANY,T.ActionButton.FORWARD,T.ActionButton.BACKWARD,T.ActionButton.RIGHT,T.ActionButton.LEFT,T.ActionButton.JUMP,T.ActionButton.WALK,T.ActionButton.ACTION_3,T.ActionButton.ACTION_4,T.ActionButton.ACTION_5,T.ActionButton.ACTION_6],this.subscriptions=this.buttonIdMapping.reduce((function(T,S){var v;return o(o({},T),((v={})[S]={BUTTON_DOWN:[],BUTTON_UP:[]},v))}),{}),this.internalState=this.buttonIdMapping.reduce((function(T,S){var v;return o(o({},T),((v={})[S]={BUTTON_DOWN:!1},v))}),{})}return Object.defineProperty(e,"instance",{get:function(){return e.ensureInstance(),e._instance},enumerable:!1,configurable:!0}),e.ensureInstance=function(){e._instance||(e._instance=new e)},e.prototype.isButtonPressed=function(T){return this.internalState[T]},e.prototype.subscribe=function(T,S,v,M){var A=this;return this.subscriptions[S][T].push(new en(M,v)),function(){A.unsubscribe(T,S,M)}},e.prototype.unsubscribe=function(T,S,v){var M=this.getSubscriptionId(T,S,v);return M>-1&&this.subscriptions[S][T].splice(M,1)},e.prototype.handlePointerEvent=function(S){var v=this.getPointerById(S.buttonId);if(v){var M=o(o({},S),{button:v,direction:(new _e.Vector3).copyFrom(S.direction),origin:(new _e.Vector3).copyFrom(S.origin),hit:void 0}),A=S.hit?o(o({},S.hit),{hitPoint:(new _e.Vector3).copyFrom(S.hit.hitPoint),normal:(new _e.Vector3).copyFrom(S.hit.normal),worldNormal:(new _e.Vector3).copyFrom(S.hit.worldNormal)}):void 0;if(S.type===T.InputEventType.DOWN){this.internalState[v].BUTTON_DOWN=!0;for(var E=0;E<this.subscriptions[v].BUTTON_DOWN.length;E++)(C=this.subscriptions[v].BUTTON_DOWN[E]).useRaycast?M.hit=A:M.hit=void 0,C.fn(M);A&&A.entityId&&N.engine&&(j=(O=N.engine.entities[A.entityId])&&O.getComponentOrNull(un))&&(M.hit=A,j.callback(M))}else{for(this.internalState[v].BUTTON_DOWN=!1,E=0;E<this.subscriptions[v].BUTTON_UP.length;E++){var C;(C=this.subscriptions[v].BUTTON_UP[E]).useRaycast?M.hit=A:M.hit=void 0,C.fn(M)}var O,j;A&&A.entityId&&N.engine&&(j=(O=N.engine.entities[A.entityId])&&O.getComponentOrNull(cn))&&(M.hit=A,j.callback(M))}}},e.prototype.getSubscriptionId=function(T,S,v){for(var M=0;M<this.subscriptions[S][T].length;M++)if(this.subscriptions[S][T][M].fn===v)return M;return-1},e.prototype.getPointerById=function(S){if(S<0||S>=this.buttonIdMapping.length)return null;var v=this.buttonIdMapping[S];return v===T.ActionButton.ANY?null:v},e}();T.CLASS_ID=void 0,(an=T.CLASS_ID||(T.CLASS_ID={}))[an.TRANSFORM=1]="TRANSFORM",an[an.UUID_CALLBACK=8]="UUID_CALLBACK",an[an.BOX_SHAPE=16]="BOX_SHAPE",an[an.SPHERE_SHAPE=17]="SPHERE_SHAPE",an[an.PLANE_SHAPE=18]="PLANE_SHAPE",an[an.CONE_SHAPE=19]="CONE_SHAPE",an[an.CYLINDER_SHAPE=20]="CYLINDER_SHAPE",an[an.TEXT_SHAPE=21]="TEXT_SHAPE",an[an.NFT_SHAPE=22]="NFT_SHAPE",an[an.UI_WORLD_SPACE_SHAPE=23]="UI_WORLD_SPACE_SHAPE",an[an.UI_SCREEN_SPACE_SHAPE=24]="UI_SCREEN_SPACE_SHAPE",an[an.UI_CONTAINER_RECT=25]="UI_CONTAINER_RECT",an[an.UI_CONTAINER_STACK=26]="UI_CONTAINER_STACK",an[an.UI_TEXT_SHAPE=27]="UI_TEXT_SHAPE",an[an.UI_INPUT_TEXT_SHAPE=28]="UI_INPUT_TEXT_SHAPE",an[an.UI_IMAGE_SHAPE=29]="UI_IMAGE_SHAPE",an[an.UI_SLIDER_SHAPE=30]="UI_SLIDER_SHAPE",an[an.CIRCLE_SHAPE=31]="CIRCLE_SHAPE",an[an.BILLBOARD=32]="BILLBOARD",an[an.ANIMATION=33]="ANIMATION",an[an.FONT=34]="FONT",an[an.UI_FULLSCREEN_SHAPE=40]="UI_FULLSCREEN_SHAPE",an[an.UI_BUTTON_SHAPE=41]="UI_BUTTON_SHAPE",an[an.GLTF_SHAPE=54]="GLTF_SHAPE",an[an.OBJ_SHAPE=55]="OBJ_SHAPE",an[an.AVATAR_SHAPE=56]="AVATAR_SHAPE",an[an.BASIC_MATERIAL=64]="BASIC_MATERIAL",an[an.PBR_MATERIAL=65]="PBR_MATERIAL",an[an.HIGHLIGHT_ENTITY=66]="HIGHLIGHT_ENTITY",an[an.SOUND=67]="SOUND",an[an.TEXTURE=68]="TEXTURE",an[an.VIDEO_CLIP=70]="VIDEO_CLIP",an[an.VIDEO_TEXTURE=71]="VIDEO_TEXTURE",an[an.AVATAR_TEXTURE=72]="AVATAR_TEXTURE",an[an.AUDIO_CLIP=200]="AUDIO_CLIP",an[an.AUDIO_SOURCE=201]="AUDIO_SOURCE",an[an.AUDIO_STREAM=202]="AUDIO_STREAM",an[an.GIZMOS=203]="GIZMOS",an[an.SMART_ITEM=204]="SMART_ITEM",an[an.AVATAR_MODIFIER_AREA=205]="AVATAR_MODIFIER_AREA",an[an.AVATAR_ATTACH=206]="AVATAR_ATTACH",an[an.CAMERA_MODE_AREA=207]="CAMERA_MODE_AREA",an[an.NAME=300]="NAME",an[an.LOCKED_ON_EDIT=301]="LOCKED_ON_EDIT",an[an.VISIBLE_ON_EDIT=302]="VISIBLE_ON_EDIT",T.AvatarModifiers=void 0,(sn=T.AvatarModifiers||(T.AvatarModifiers={})).HIDE_AVATARS="HIDE_AVATARS",sn.DISABLE_PASSPORTS="DISABLE_PASSPORTS";var hn,ln=function(S){function n(T){var v=S.call(this)||this;return v.area=T.area,v.modifiers=T.modifiers,v.excludeIds=T.excludeIds,v}return i(n,S),r([X.field,s("design:type",Object)],n.prototype,"area",void 0),r([X.field,s("design:type",Array)],n.prototype,"modifiers",void 0),r([X.field,s("design:type",Array)],n.prototype,"excludeIds",void 0),r([P("engine.avatarModifierArea",T.CLASS_ID.AVATAR_MODIFIER_AREA),s("design:paramtypes",[Object])],n)}(X),pn=function(S){function n(T){void 0===T&&(T={});var v=S.call(this)||this;return v.position=T.position||_e.Vector3.Zero(),v.rotation=T.rotation||_e.Quaternion.Identity,v.scale=T.scale||new _e.Vector3(1,1,1),v}return i(n,S),Object.defineProperty(n.prototype,"eulerAngles",{get:function(){return this.rotation.eulerAngles},enumerable:!1,configurable:!0}),n.prototype.lookAt=function(T,S){void 0===S&&(S=_e.MathTmp.staticUp);var v=new _e.Matrix;return _e.Matrix.LookAtLHToRef(this.position,T,S,v),v.invert(),_e.Quaternion.FromRotationMatrixToRef(v,this.rotation),this},n.prototype.rotate=function(T,S){return this.rotation.multiplyInPlace(this.rotation.angleAxis(S,T)),this},n.prototype.translate=function(T){return this.position.addInPlace(T),this},r([X.field,s("design:type",_e.Vector3)],n.prototype,"position",void 0),r([X.field,s("design:type",_e.Quaternion)],n.prototype,"rotation",void 0),r([X.field,s("design:type",_e.Vector3)],n.prototype,"scale",void 0),r([P("engine.transform",T.CLASS_ID.TRANSFORM),s("design:paramtypes",[Object])],n)}(X);T.AttachToAvatarAnchorPointId=void 0,(hn=T.AttachToAvatarAnchorPointId||(T.AttachToAvatarAnchorPointId={}))[hn.Position=0]="Position",hn[hn.NameTag=1]="NameTag",hn[hn.LeftHand=2]="LeftHand",hn[hn.RightHand=3]="RightHand";var mn,gn=function(S){function n(v){void 0===v&&(v={});var M=S.call(this)||this;return M.avatarId=v.avatarId||"",M.anchorPointId=v.anchorPointId||T.AttachToAvatarAnchorPointId.Position,M}return i(n,S),r([X.field,s("design:type",String)],n.prototype,"avatarId",void 0),r([X.field,s("design:type",Number)],n.prototype,"anchorPointId",void 0),r([X.field,s("design:type",String)],n.prototype,"avatarSceneId",void 0),r([P("engine.transform",T.CLASS_ID.AVATAR_ATTACH),s("design:paramtypes",[Object])],n)}(X),yn=function(S){function n(T,v,M){void 0===T&&(T=!0),void 0===v&&(v=!0),void 0===M&&(M=!0);var A=S.call(this)||this;return A.x=!0,A.y=!0,A.z=!0,A.x=T,A.y=v,A.z=M,A}return i(n,S),r([X.field,s("design:type",Boolean)],n.prototype,"x",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"y",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"z",void 0),r([P("engine.billboard",T.CLASS_ID.BILLBOARD),s("design:paramtypes",[Boolean,Boolean,Boolean])],n)}(X),fn=function(T){function e(){var S=null!==T&&T.apply(this,arguments)||this;return S.withCollisions=!0,S.isPointerBlocker=!0,S.visible=!0,S}return i(e,T),r([X.field,s("design:type",Boolean)],e.prototype,"withCollisions",void 0),r([X.field,s("design:type",Boolean)],e.prototype,"isPointerBlocker",void 0),r([X.field,s("design:type",Boolean)],e.prototype,"visible",void 0),e}(X),Tn=function(S){function n(){return null!==S&&S.apply(this,arguments)||this}return i(n,S),r([X.field,s("design:type",Array)],n.prototype,"uvs",void 0),r([N("engine.shape",T.CLASS_ID.BOX_SHAPE)],n)}(fn),wn=function(S){function n(){return null!==S&&S.apply(this,arguments)||this}return i(n,S),r([N("engine.shape",T.CLASS_ID.SPHERE_SHAPE)],n)}(fn),bn=function(S){function n(){return null!==S&&S.apply(this,arguments)||this}return i(n,S),r([X.field,s("design:type",Number)],n.prototype,"segments",void 0),r([X.field,s("design:type",Number)],n.prototype,"arc",void 0),r([N("engine.shape",T.CLASS_ID.CIRCLE_SHAPE)],n)}(fn),Sn=function(S){function n(){var T=null!==S&&S.apply(this,arguments)||this;return T.width=1,T.height=1,T}return i(n,S),r([X.field,s("design:type",Number)],n.prototype,"width",void 0),r([X.field,s("design:type",Number)],n.prototype,"height",void 0),r([X.field,s("design:type",Array)],n.prototype,"uvs",void 0),r([N("engine.shape",T.CLASS_ID.PLANE_SHAPE)],n)}(fn),vn=function(S){function n(){var T=null!==S&&S.apply(this,arguments)||this;return T.radiusTop=0,T.radiusBottom=1,T.segmentsHeight=1,T.segmentsRadial=36,T.openEnded=!1,T.radius=null,T.arc=360,T}return i(n,S),r([X.field,s("design:type",Number)],n.prototype,"radiusTop",void 0),r([X.field,s("design:type",Number)],n.prototype,"radiusBottom",void 0),r([X.field,s("design:type",Number)],n.prototype,"segmentsHeight",void 0),r([X.field,s("design:type",Number)],n.prototype,"segmentsRadial",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"openEnded",void 0),r([X.field,s("design:type",Object)],n.prototype,"radius",void 0),r([X.field,s("design:type",Number)],n.prototype,"arc",void 0),r([N("engine.shape",T.CLASS_ID.CONE_SHAPE)],n)}(fn),Mn=function(S){function n(){var T=null!==S&&S.apply(this,arguments)||this;return T.radiusTop=1,T.radiusBottom=1,T.segmentsHeight=1,T.segmentsRadial=36,T.openEnded=!1,T.radius=null,T.arc=360,T}return i(n,S),r([X.field,s("design:type",Number)],n.prototype,"radiusTop",void 0),r([X.field,s("design:type",Number)],n.prototype,"radiusBottom",void 0),r([X.field,s("design:type",Number)],n.prototype,"segmentsHeight",void 0),r([X.field,s("design:type",Number)],n.prototype,"segmentsRadial",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"openEnded",void 0),r([X.field,s("design:type",Object)],n.prototype,"radius",void 0),r([X.field,s("design:type",Number)],n.prototype,"arc",void 0),r([N("engine.shape",T.CLASS_ID.CYLINDER_SHAPE)],n)}(fn),An=function(S){function n(T){var v=S.call(this)||this;return v.src=T,v}return i(n,S),r([fn.readonly,s("design:type",String)],n.prototype,"src",void 0),r([N("engine.shape",T.CLASS_ID.GLTF_SHAPE),s("design:paramtypes",[String])],n)}(fn);T.PictureFrameStyle=void 0,(mn=T.PictureFrameStyle||(T.PictureFrameStyle={}))[mn.Classic=0]="Classic",mn[mn.Baroque_Ornament=1]="Baroque_Ornament",mn[mn.Diamond_Ornament=2]="Diamond_Ornament",mn[mn.Minimal_Wide=3]="Minimal_Wide",mn[mn.Minimal_Grey=4]="Minimal_Grey",mn[mn.Blocky=5]="Blocky",mn[mn.Gold_Edges=6]="Gold_Edges",mn[mn.Gold_Carved=7]="Gold_Carved",mn[mn.Gold_Wide=8]="Gold_Wide",mn[mn.Gold_Rounded=9]="Gold_Rounded",mn[mn.Metal_Medium=10]="Metal_Medium",mn[mn.Metal_Wide=11]="Metal_Wide",mn[mn.Metal_Slim=12]="Metal_Slim",mn[mn.Metal_Rounded=13]="Metal_Rounded",mn[mn.Pins=14]="Pins",mn[mn.Minimal_Black=15]="Minimal_Black",mn[mn.Minimal_White=16]="Minimal_White",mn[mn.Tape=17]="Tape",mn[mn.Wood_Slim=18]="Wood_Slim",mn[mn.Wood_Wide=19]="Wood_Wide",mn[mn.Wood_Twigs=20]="Wood_Twigs",mn[mn.Canvas=21]="Canvas",mn[mn.None=22]="None";var xn,En=function(S){function n(v,M){void 0===M&&(M={});var A=S.call(this)||this;A.src=v;var E=new _e.Color3(.6404918,.611472,.8584906),C=T.PictureFrameStyle.Classic;return"r"in M?E=M:null!==M&&(M.color&&(E=M.color),M.style&&(C=M.style)),A.color=E,A.style=C,A}return i(n,S),r([fn.readonly,s("design:type",String)],n.prototype,"src",void 0),r([fn.readonly,s("design:type",Number)],n.prototype,"style",void 0),r([X.field,s("design:type",_e.Color3)],n.prototype,"color",void 0),r([N("engine.shape",T.CLASS_ID.NFT_SHAPE),s("design:paramtypes",[String,Object])],n)}(fn),Gn=function(S){function n(T,v){var M=S.call(this)||this,A=new RegExp("data:[a-z-]+/[a-z-]+;base64");if((T.length>2048||A.test(T))&&u("⚠️🚨 Base64 textures will be deprecated in version 7 of decentraland-ecs"),M.src=T,v)for(var E in v)M[E]=v[E];return M}return i(n,S),r([X.readonly,s("design:type",String)],n.prototype,"src",void 0),r([X.readonly,s("design:type",Number)],n.prototype,"samplingMode",void 0),r([X.readonly,s("design:type",Number)],n.prototype,"wrap",void 0),r([X.readonly,s("design:type",Boolean)],n.prototype,"hasAlpha",void 0),r([N("engine.texture",T.CLASS_ID.TEXTURE),s("design:paramtypes",[String,Object])],n)}(X),In=function(S){function n(){var T=null!==S&&S.apply(this,arguments)||this;return T.states=[],T}return i(n,S),n.prototype.addClip=function(T){var S=this;return this.states.push(T),T.onChange((function(){S.dirty=!0})),T.owner=this,this},n.prototype.getClip=function(T){for(var S=0;S<this.states.length;S++){var v=this.states[S];if(v.clip===T)return v}var M=new rn(T);return this.addClip(M),M},n.prototype.stop=function(T){if(T)T.playing=!1,T.shouldReset=!0;else for(var S=0;S<this.states.length;S++){var v=this.states[S];this.stop(v)}},n.prototype.play=function(T,S){void 0===S&&(S=!1);for(var v=0;v<this.states.length;v++){var M=this.states[v];M.layer===T.layer&&T!==M&&this.pause(M)}S&&(T.shouldReset=!0),T.playing=!0,T.dirty=!0,T.data.nonce=Math.random()},n.prototype.pause=function(T){if(T)T.playing=!1;else for(var S=0;S<this.states.length;S++){var v=this.states[S];this.pause(v)}},r([X.readonly,s("design:type",Array)],n.prototype,"states",void 0),r([P("engine.animator",T.CLASS_ID.ANIMATION)],n)}(fn),Cn=function(S){function n(T){var v=S.call(this)||this;return v.src=T,v}return i(n,S),r([X.readonly,s("design:type",String)],n.prototype,"src",void 0),r([N("engine.shape",T.CLASS_ID.OBJ_SHAPE),s("design:paramtypes",[String])],n)}(fn),Dn=function(S){function n(T){void 0===T&&(T="");var v=S.call(this)||this;return v.src=T,v}return i(n,S),r([X.readonly,s("design:type",String)],n.prototype,"src",void 0),r([N("engine.font",T.CLASS_ID.FONT),s("design:paramtypes",[String])],n)}(X);T.Fonts=void 0,(xn=T.Fonts||(T.Fonts={})).SanFrancisco="builtin:SF-UI-Text-Regular SDF",xn.SanFrancisco_Heavy="builtin:SF-UI-Text-Heavy SDF",xn.SanFrancisco_Semibold="builtin:SF-UI-Text-Semibold SDF",xn.LiberationSans="builtin:LiberationSans SDF",xn.SansSerif="SansSerif",xn.SansSerif_Heavy="SansSerif_Heavy",xn.SansSerif_Bold="SansSerif_Bold",xn.SansSerif_SemiBold="SansSerif_SemiBold";var On,jn=function(S){function n(T){var v=S.call(this)||this;return v.outlineWidth=0,v.outlineColor=new _e.Color3(1,1,1),v.color=new _e.Color3(1,1,1),v.fontSize=10,v.opacity=1,v.value="",v.lineSpacing="0px",v.lineCount=0,v.textWrapping=!1,v.shadowBlur=0,v.shadowOffsetX=0,v.shadowOffsetY=0,v.shadowColor=new _e.Color3(1,1,1),v.hTextAlign="center",v.vTextAlign="center",v.width=1,v.height=1,v.paddingTop=0,v.paddingRight=0,v.paddingBottom=0,v.paddingLeft=0,v.billboard=!1,v.visible=!0,T&&(v.value=T),v}return i(n,S),r([X.field,s("design:type",Number)],n.prototype,"outlineWidth",void 0),r([X.field,s("design:type",_e.Color3)],n.prototype,"outlineColor",void 0),r([X.field,s("design:type",_e.Color3)],n.prototype,"color",void 0),r([X.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([X.component,s("design:type",Dn)],n.prototype,"font",void 0),r([X.field,s("design:type",Number)],n.prototype,"opacity",void 0),r([X.field,s("design:type",String)],n.prototype,"value",void 0),r([X.field,s("design:type",String)],n.prototype,"lineSpacing",void 0),r([X.field,s("design:type",Number)],n.prototype,"lineCount",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"textWrapping",void 0),r([X.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([X.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([X.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([X.field,s("design:type",_e.Color3)],n.prototype,"shadowColor",void 0),r([X.field,s("design:type",String)],n.prototype,"hTextAlign",void 0),r([X.field,s("design:type",String)],n.prototype,"vTextAlign",void 0),r([X.field,s("design:type",Number)],n.prototype,"width",void 0),r([X.field,s("design:type",Number)],n.prototype,"height",void 0),r([X.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([X.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([X.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([X.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"billboard",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"visible",void 0),r([P("engine.text",T.CLASS_ID.TEXT_SHAPE),s("design:paramtypes",[String])],n)}(X);T.TransparencyMode=void 0,(On=T.TransparencyMode||(T.TransparencyMode={}))[On.OPAQUE=0]="OPAQUE",On[On.ALPHA_TEST=1]="ALPHA_TEST",On[On.ALPHA_BLEND=2]="ALPHA_BLEND",On[On.ALPHA_TEST_AND_BLEND=3]="ALPHA_TEST_AND_BLEND",On[On.AUTO=4]="AUTO";var _n,Rn=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.alphaTest=.5,v.castShadows=!0,v.transparencyMode=T.TransparencyMode.AUTO,v}return i(n,S),r([X.field,s("design:type",Number)],n.prototype,"alphaTest",void 0),r([X.field,s("design:type",Object)],n.prototype,"albedoColor",void 0),r([X.field,s("design:type",_e.Color3)],n.prototype,"emissiveColor",void 0),r([X.field,s("design:type",Number)],n.prototype,"metallic",void 0),r([X.field,s("design:type",Number)],n.prototype,"roughness",void 0),r([X.field,s("design:type",_e.Color3)],n.prototype,"reflectivityColor",void 0),r([X.field,s("design:type",Number)],n.prototype,"directIntensity",void 0),r([X.field,s("design:type",Number)],n.prototype,"microSurface",void 0),r([X.field,s("design:type",Number)],n.prototype,"emissiveIntensity",void 0),r([X.field,s("design:type",Number)],n.prototype,"specularIntensity",void 0),r([X.component,s("design:type",Object)],n.prototype,"albedoTexture",void 0),r([X.component,s("design:type",Object)],n.prototype,"alphaTexture",void 0),r([X.component,s("design:type",Object)],n.prototype,"emissiveTexture",void 0),r([X.component,s("design:type",Object)],n.prototype,"bumpTexture",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"castShadows",void 0),r([X.field,s("design:type",Number)],n.prototype,"transparencyMode",void 0),r([N("engine.material",T.CLASS_ID.PBR_MATERIAL)],n)}(X),Pn=function(S){function n(){var T=null!==S&&S.apply(this,arguments)||this;return T.alphaTest=.5,T.castShadows=!0,T}return i(n,S),r([X.component,s("design:type",Object)],n.prototype,"texture",void 0),r([X.field,s("design:type",Number)],n.prototype,"alphaTest",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"castShadows",void 0),r([N("engine.material",T.CLASS_ID.BASIC_MATERIAL)],n)}(X),Vn=function(T){function e(S){var v=T.call(this)||this;if(v.uuid=f("UUID"),!S||!("apply"in S)||!("call"in S))throw new Error("Callback is not a function");return v.callback=S,v}return i(e,T),e.uuidEvent=function(T,S){if(delete T[S]){var v=S+"_"+Math.random();T[v]=void 0,Object.defineProperty(T,v,o(o({},Object.getOwnPropertyDescriptor(T,v)),{enumerable:!1})),Object.defineProperty(T,S.toString(),{get:function(){return this[v]},set:function(T){var M=this[v];if(T){if(!(T instanceof e))throw new Error("value is not an OnUUIDEvent");this.data[S]=T.uuid}else this.data[S]=null;if(this[v]=T,T!==M){this.dirty=!0;for(var A=0;A<this.subscriptions.length;A++)this.subscriptions[A](S,T,M)}},enumerable:!0})}},e.prototype.toJSON=function(){return{uuid:this.uuid,type:this.type}},r([X.field,s("design:type",Function)],e.prototype,"callback",void 0),e}(X),Ln=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.button=T.ActionButton.ANY,v.hoverText="Interact",v.distance=10,v.showFeedback=!0,v}return i(n,S),n.prototype.toJSON=function(){return{uuid:this.uuid,type:this.type,button:this.button,hoverText:this.hoverText,distance:this.distance,showFeedback:this.showFeedback}},r([X.field,s("design:type",String)],n.prototype,"button",void 0),r([X.field,s("design:type",String)],n.prototype,"hoverText",void 0),r([X.field,s("design:type",Number)],n.prototype,"distance",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"showFeedback",void 0),n}(Vn),Fn=function(S){function n(){var T=null!==S&&S.apply(this,arguments)||this;return T.type="onPointerLock",T}return i(n,S),r([X.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onPointerLock",T.CLASS_ID.UUID_CALLBACK)],n)}(Vn),Nn=function(S){function n(){var T=null!==S&&S.apply(this,arguments)||this;return T.type="onAnimationEnd",T}return i(n,S),r([X.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onAnimationEnd",T.CLASS_ID.UUID_CALLBACK)],n)}(Vn),kn=function(S){function n(){return null!==S&&S.apply(this,arguments)||this}return i(n,S),r([P("engine.smartItem",T.CLASS_ID.SMART_ITEM)],n)}(X),Un=function(S){function n(T){var v=S.call(this)||this;return v.url=T,v}return i(n,S),r([X.readonly,s("design:type",String)],n.prototype,"url",void 0),r([N("engine.VideoClip",T.CLASS_ID.VIDEO_CLIP),s("design:paramtypes",[String])],n)}(X);T.VideoStatus=void 0,(_n=T.VideoStatus||(T.VideoStatus={}))[_n.NONE=0]="NONE",_n[_n.ERROR=1]="ERROR",_n[_n.LOADING=2]="LOADING",_n[_n.READY=3]="READY",_n[_n.PLAYING=4]="PLAYING",_n[_n.BUFFERING=5]="BUFFERING";var zn,Bn=function(S){function n(v,M){var A=S.call(this)||this;if(A.volume=1,A.playbackRate=1,A.loop=!1,A.seek=-1,A._position=-1,A._videoLength=-1,A._status=T.VideoStatus.NONE,A.playing=!1,!(v instanceof Un))throw new Error("Trying to create VideoTexture(VideoClip) with an invalid VideoClip");if(A.videoClipId=D(v),M)for(var E in M)A[E]=M[E];return A}return i(n,S),n.prototype.play=function(){this.playing=!0},n.prototype.pause=function(){this.playing=!1},n.prototype.reset=function(){this.seekTime(0),this.pause()},n.prototype.seekTime=function(T){this.seek=T,this.dirty=!0,this.data.nonce=Math.random()},n.prototype.toJSON=function(){if(this.seek>=0){var T=JSON.parse(JSON.stringify(S.prototype.toJSON.call(this)));return this.seek=-1,T}return S.prototype.toJSON.call(this)},n.prototype.update=function(S){S.videoClipId===this.videoClipId&&(this._status=S.videoStatus||T.VideoStatus.NONE,this._videoLength=S.totalVideoLength,this._position=S.currentOffset)},Object.defineProperty(n.prototype,"position",{get:function(){return this._position},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"videoLength",{get:function(){return this._videoLength},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),r([X.readonly,s("design:type",String)],n.prototype,"videoClipId",void 0),r([X.readonly,s("design:type",Number)],n.prototype,"samplingMode",void 0),r([X.readonly,s("design:type",Number)],n.prototype,"wrap",void 0),r([X.field,s("design:type",Number)],n.prototype,"volume",void 0),r([X.field,s("design:type",Number)],n.prototype,"playbackRate",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"loop",void 0),r([X.field,s("design:type",Number)],n.prototype,"seek",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"playing",void 0),r([N("engine.VideoTexture",T.CLASS_ID.VIDEO_TEXTURE),s("design:paramtypes",[Un,Object])],n)}(X),Hn=function(S){function n(T){var v=S.call(this)||this;return v.area=T.area,v.cameraMode=T.cameraMode,v}return i(n,S),r([X.field,s("design:type",Object)],n.prototype,"area",void 0),r([X.field,s("design:type",Number)],n.prototype,"cameraMode",void 0),r([P("engine.cameraModeArea",T.CLASS_ID.CAMERA_MODE_AREA),s("design:paramtypes",[Object])],n)}(X),Wn=function(S){function n(T,v){var M=S.call(this)||this;if(M.userId=T,v)for(var A in v)M[A]=v[A];return M}return i(n,S),r([X.readonly,s("design:type",String)],n.prototype,"userId",void 0),r([X.readonly,s("design:type",Number)],n.prototype,"samplingMode",void 0),r([X.readonly,s("design:type",Number)],n.prototype,"wrap",void 0),r([X.readonly,s("design:type",Boolean)],n.prototype,"hasAlpha",void 0),r([N("engine.texture",T.CLASS_ID.AVATAR_TEXTURE),s("design:paramtypes",[String,Object])],n)}(X),qn=function(){function e(){var S=this;this.position=new _e.Vector3,this.rotation=new _e.Quaternion,this.feetPosition=new _e.Vector3,this.worldPosition=new _e.Vector3,this.lastEventPosition={x:0,y:0,z:0},this.lastEventWorldPosition={x:0,y:0,z:0},this.lastEventRotation={x:0,y:0,z:0,w:1},this._playerHeight=1.6,this._cameraMode=T.CameraMode.ThirdPerson,"undefined"!=typeof dcl&&(dcl.subscribe("positionChanged"),dcl.subscribe("rotationChanged"),dcl.subscribe("cameraModeChanged"),dcl.onEvent((function(T){switch(T.type){case"positionChanged":S.positionChanged(T.data);break;case"rotationChanged":S.rotationChanged(T.data);break;case"cameraModeChanged":S.cameraModeChanged(T.data)}}))),Object.defineProperty(this.position,"x",{get:function(){return S.lastEventPosition.x}}),Object.defineProperty(this.position,"y",{get:function(){return S.lastEventPosition.y}}),Object.defineProperty(this.position,"z",{get:function(){return S.lastEventPosition.z}}),Object.defineProperty(this.worldPosition,"x",{get:function(){return S.lastEventWorldPosition.x}}),Object.defineProperty(this.worldPosition,"y",{get:function(){return S.lastEventWorldPosition.y}}),Object.defineProperty(this.worldPosition,"z",{get:function(){return S.lastEventWorldPosition.z}}),Object.defineProperty(this.feetPosition,"x",{get:function(){return S.lastEventPosition.x}}),Object.defineProperty(this.feetPosition,"y",{get:function(){return S.lastEventPosition.y-S.playerHeight}}),Object.defineProperty(this.feetPosition,"z",{get:function(){return S.lastEventPosition.z}}),Object.defineProperty(this.rotation,"x",{get:function(){return S.lastEventRotation.x}}),Object.defineProperty(this.rotation,"y",{get:function(){return S.lastEventRotation.y}}),Object.defineProperty(this.rotation,"z",{get:function(){return S.lastEventRotation.z}}),Object.defineProperty(this.rotation,"w",{get:function(){return S.lastEventRotation.w}})}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playerHeight",{get:function(){return this._playerHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraMode",{get:function(){return this._cameraMode},enumerable:!1,configurable:!0}),e.prototype.positionChanged=function(T){this.lastEventPosition=T.position,this.lastEventWorldPosition=T.cameraPosition,this._playerHeight=T.playerHeight},e.prototype.rotationChanged=function(T){this.lastEventRotation=T.quaternion},e.prototype.cameraModeChanged=function(T){this._cameraMode=T.cameraMode},e}();!function(T){T.HitFirst="rqhf",T.HitAll="rqha"}(zn||(zn={}));var Yn,Xn=function(){function t(){this.queries={}}return Object.defineProperty(t,"instance",{get:function(){return t.ensureInstance(),t._instance},enumerable:!1,configurable:!0}),t.ensureInstance=function(){t._instance||(t._instance=new t)},t.prototype.getRayFromCamera=function(T){var S=qn.instance.rotation,v=_e.Matrix.Identity();S.toRotationMatrix(v);var M=_e.Vector3.TransformCoordinates(_e.Vector3.Forward(),v);return{origin:qn.instance.position,direction:M,distance:T}},t.prototype.getRayFromPositions=function(T,S){var v=S.subtract(T),M=v.length();return{origin:T,direction:v.normalize(),distance:M}},t.prototype.hitFirst=function(T,S,v){var M="number"==typeof v?zn.HitFirst+v:m();this.queries[M]=S,"undefined"!=typeof dcl&&dcl.query("raycast",{queryId:M,queryType:"HitFirst",ray:T})},t.prototype.hitAll=function(T,S,v){var M="number"==typeof v?zn.HitAll+v:m();this.queries[M]=S,"undefined"!=typeof dcl&&dcl.query("raycast",{queryId:M,queryType:"HitAll",ray:T})},t.prototype.hitFirstAvatar=function(T,S){u("not implemented yet")},t.prototype.hitAllAvatars=function(T,S){u("not implemented yet")},t.prototype.handleRaycastHitFirstResponse=function(T){this.queries[T.payload.queryId](T.payload.payload),delete this.queries[T.payload.queryId]},t.prototype.handleRaycastHitAllResponse=function(T){this.queries[T.payload.queryId](T.payload.payload),delete this.queries[T.payload.queryId]},t}(),Qn=function(){function t(){}return t.prototype.activate=function(T){T.eventManager.addListener(se,this,(function(T){"HitFirst"===T.payload.queryType?Xn.instance.handleRaycastHitFirstResponse(T):"HitAll"===T.payload.queryType&&Xn.instance.handleRaycastHitAllResponse(T)})),"undefined"!=typeof dcl&&dcl.subscribe("raycastResponse")},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&dcl.unsubscribe("raycastResponse")},t}(),Kn=function(){function t(){}return t.prototype.activate=function(T){T.eventManager.addListener(ue,this,(function(T){dn.instance.handlePointerEvent(T.payload)})),"undefined"!=typeof dcl&&(dcl.subscribe("pointerUp"),dcl.subscribe("pointerDown"),dcl.subscribe("actionButtonEvent"))},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&(dcl.unsubscribe("pointerUp"),dcl.unsubscribe("pointerDown"),dcl.unsubscribe("actionButtonEvent"))},t}(),Zn=function(){function t(){this.handlerMap={}}return t.prototype.activate=function(T){T.eventManager.addListener(ae,this,this.handleEvent),T.eventManager.addListener(O,this,this.componentAdded),T.eventManager.addListener(C,this,this.componentRemoved),"undefined"!=typeof dcl&&dcl.subscribe("uuidEvent")},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&dcl.unsubscribe("uuidEvent")},t.prototype.onAddEntity=function(T){for(var S in T.components){var v=T.components[S];v instanceof Vn&&(this.handlerMap[v.uuid]=v)}},t.prototype.onRemoveEntity=function(T){for(var S in T.components){var v=T.components[S];v instanceof Vn&&delete this.handlerMap[v.uuid]}},t.prototype.componentAdded=function(T){if(T.entity.isAddedToEngine()){var S=T.entity.components[T.componentName];S instanceof Vn&&(this.handlerMap[S.uuid]=S)}},t.prototype.componentRemoved=function(T){T.entity.isAddedToEngine()&&T.component instanceof Vn&&delete this.handlerMap[T.component.uuid]},t.prototype.handleEvent=function(T){if(T.uuid in this.handlerMap){var S=this.handlerMap[T.uuid];S&&S.callback&&"call"in S.callback&&S.callback(T.payload)}},t}(),Jn=new Qn,$n=new Kn,ei=new Zn,ti=function(S){function n(T){var v=S.call(this)||this;return v.loop=!1,v.volume=1,v.url=T,v}return i(n,S),r([X.readonly,s("design:type",String)],n.prototype,"url",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"loop",void 0),r([X.field,s("design:type",String)],n.prototype,"loadingCompleteEventId",void 0),r([X.field,s("design:type",Number)],n.prototype,"volume",void 0),r([N("engine.AudioClip",T.CLASS_ID.AUDIO_CLIP),s("design:paramtypes",[String])],n)}(X),ni=function(S){function n(T){var v=S.call(this)||this;if(v.audioClip=T,v.loop=!1,v.volume=1,v.playing=!1,v.pitch=1,v.playedAtTimestamp=Date.now(),!(T instanceof ti))throw new Error("Trying to create AudioSource(AudioClip) with an invalid AudioClip");return v.audioClipId=D(T),v}return i(n,S),n.prototype.playOnce=function(){return this.playing=!0,this.dirty=!0,this.playedAtTimestamp=Date.now(),this.data.nonce=Math.random(),this},r([X.readonly,s("design:type",String)],n.prototype,"audioClipId",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"loop",void 0),r([X.field,s("design:type",Number)],n.prototype,"volume",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"playing",void 0),r([X.field,s("design:type",Number)],n.prototype,"pitch",void 0),r([X.field,s("design:type",Number)],n.prototype,"playedAtTimestamp",void 0),r([P("engine.AudioSource",T.CLASS_ID.AUDIO_SOURCE),s("design:paramtypes",[ti])],n)}(X),ii=function(S){function n(T){var v=S.call(this)||this;return v.playing=!1,v.volume=1,v.url=T,v.playing=!0,v}return i(n,S),r([X.readonly,s("design:type",String)],n.prototype,"url",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"playing",void 0),r([X.field,s("design:type",Number)],n.prototype,"volume",void 0),r([P("engine.AudioStream",T.CLASS_ID.AUDIO_STREAM),s("design:paramtypes",[String])],n)}(X);T.Gizmo=void 0,(Yn=T.Gizmo||(T.Gizmo={})).MOVE="MOVE",Yn.ROTATE="ROTATE",Yn.SCALE="SCALE",Yn.NONE="NONE";var oi,ri=function(S){function n(){var T=null!==S&&S.apply(this,arguments)||this;return T.type="gizmoEvent",T}return i(n,S),r([X.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.gizmoEvent",T.CLASS_ID.UUID_CALLBACK)],n)}(Vn),ai=function(S){function n(){var T=null!==S&&S.apply(this,arguments)||this;return T.position=!0,T.rotation=!0,T.scale=!0,T.cycle=!0,T.localReference=!1,T}return i(n,S),r([X.field,s("design:type",Boolean)],n.prototype,"position",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"rotation",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"scale",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"cycle",void 0),r([X.field,s("design:type",String)],n.prototype,"selectedGizmo",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"localReference",void 0),r([P("engine.gizmos",T.CLASS_ID.GIZMOS)],n)}(X),si=function(S){function n(T){var v=S.call(this,T)||this;return v.type="onFocus",ei.handlerMap[v.uuid]=v,v}return i(n,S),r([X.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onFocus",T.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Vn),ui=function(S){function n(T){var v=S.call(this,T)||this;return v.type="onTextSubmit",ei.handlerMap[v.uuid]=v,v}return i(n,S),r([X.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onTextSubmit",T.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Vn),ci=function(S){function n(T){var v=S.call(this,T)||this;return v.type="onBlur",ei.handlerMap[v.uuid]=v,v}return i(n,S),r([X.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onBlur",T.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Vn),di=function(S){function n(T){var v=S.call(this,T)||this;return v.type="onEnter",ei.handlerMap[v.uuid]=v,v}return i(n,S),r([X.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onEnter",T.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Vn),hi=function(S){function n(T){var v=S.call(this,T)||this;return v.type="onChange",ei.handlerMap[v.uuid]=v,v}return i(n,S),r([X.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onChange",T.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Vn),li=function(S){function n(T,v){var M=S.call(this,T)||this;return M.type="onClick",ei.handlerMap[M.uuid]=M,v&&(M.showFeedback=!(!1===v.showFeedback),v.button&&(M.button=v.button),v.hoverText&&(M.hoverText=v.hoverText),v.distance&&(M.distance=v.distance)),M}return i(n,S),r([X.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onClick",T.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(Ln),pi=function(S){function n(T,v){var M=S.call(this,T)||this;return M.type="pointerDown",ei.handlerMap[M.uuid]=M,v&&(M.showFeedback=!(!1===v.showFeedback),v.button&&(M.button=v.button),v.hoverText&&(M.hoverText=v.hoverText),v.distance&&(M.distance=v.distance)),M}return i(n,S),r([X.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerDown",T.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(Ln),mi=function(S){function n(T,v){var M=S.call(this,T)||this;return M.type="pointerUp",ei.handlerMap[M.uuid]=M,v&&(M.showFeedback=!(!1===v.showFeedback),v.button&&(M.button=v.button),v.hoverText&&(M.hoverText=v.hoverText),v.distance&&(M.distance=v.distance)),M}return i(n,S),r([X.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerUp",T.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(Ln),gi=function(S){function n(T,v){var M=S.call(this,T)||this;return M.type="pointerHoverEnter",ei.handlerMap[M.uuid]=M,v&&v.distance&&(M.distance=v.distance),M}return i(n,S),r([X.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerHoverEnter",T.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(Ln),yi=function(S){function n(T){var v=S.call(this,T)||this;return v.type="pointerHoverExit",ei.handlerMap[v.uuid]=v,v.distance=160,v}return i(n,S),r([X.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerHoverExit",T.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Ln),fi=function(T){function e(S){var v=T.call(this)||this;return v.name=null,v.visible=!0,v.opacity=1,v.hAlign="center",v.vAlign="center",v.width="100px",v.height="50px",v.positionX="0px",v.positionY="0px",v.isPointerBlocker=!0,S&&(v._parent=S,v.data.parentComponent=D(S)),v}return i(e,T),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parentComponent",{get:function(){return this.data.parentComponent},enumerable:!1,configurable:!0}),r([X.field,s("design:type",Object)],e.prototype,"name",void 0),r([X.field,s("design:type",Boolean)],e.prototype,"visible",void 0),r([X.field,s("design:type",Number)],e.prototype,"opacity",void 0),r([X.field,s("design:type",String)],e.prototype,"hAlign",void 0),r([X.field,s("design:type",String)],e.prototype,"vAlign",void 0),r([X.uiValue,s("design:type",Object)],e.prototype,"width",void 0),r([X.uiValue,s("design:type",Object)],e.prototype,"height",void 0),r([X.uiValue,s("design:type",Object)],e.prototype,"positionX",void 0),r([X.uiValue,s("design:type",Object)],e.prototype,"positionY",void 0),r([X.field,s("design:type",Boolean)],e.prototype,"isPointerBlocker",void 0),e}(X),Ti=function(S){function n(){return S.call(this,null)||this}return i(n,S),r([N("engine.shape",T.CLASS_ID.UI_FULLSCREEN_SHAPE),s("design:paramtypes",[])],n)}(fi),wi=function(S){function n(){return S.call(this,null)||this}return i(n,S),r([N("engine.shape",T.CLASS_ID.UI_WORLD_SPACE_SHAPE),s("design:paramtypes",[])],n)}(fi),bi=function(S){function n(){return S.call(this,null)||this}return i(n,S),r([N("engine.shape",T.CLASS_ID.UI_SCREEN_SPACE_SHAPE),s("design:paramtypes",[])],n)}(fi),Si=function(S){function n(){var T=null!==S&&S.apply(this,arguments)||this;return T.thickness=0,T.color=_e.Color4.Clear(),T.alignmentUsesSize=!0,T}return i(n,S),r([X.field,s("design:type",Number)],n.prototype,"thickness",void 0),r([X.field,s("design:type",_e.Color4)],n.prototype,"color",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"alignmentUsesSize",void 0),r([N("engine.shape",T.CLASS_ID.UI_CONTAINER_RECT)],n)}(fi);T.UIStackOrientation=void 0,(oi=T.UIStackOrientation||(T.UIStackOrientation={}))[oi.VERTICAL=0]="VERTICAL",oi[oi.HORIZONTAL=1]="HORIZONTAL";var vi=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.adaptWidth=!0,v.adaptHeight=!0,v.color=_e.Color4.Clear(),v.stackOrientation=T.UIStackOrientation.VERTICAL,v.spacing=0,v}return i(n,S),r([X.field,s("design:type",Boolean)],n.prototype,"adaptWidth",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"adaptHeight",void 0),r([X.field,s("design:type",_e.Color4)],n.prototype,"color",void 0),r([X.field,s("design:type",Number)],n.prototype,"stackOrientation",void 0),r([X.field,s("design:type",Number)],n.prototype,"spacing",void 0),r([N("engine.shape",T.CLASS_ID.UI_CONTAINER_STACK)],n)}(fi),Mi=function(S){function n(){var T=null!==S&&S.apply(this,arguments)||this;return T.fontSize=10,T.fontWeight="normal",T.thickness=0,T.cornerRadius=0,T.color=_e.Color4.White(),T.background=_e.Color4.White(),T.paddingTop=0,T.paddingRight=0,T.paddingBottom=0,T.paddingLeft=0,T.shadowBlur=0,T.shadowOffsetX=0,T.shadowOffsetY=0,T.shadowColor=_e.Color4.Black(),T.text="button",T}return i(n,S),r([X.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([X.field,s("design:type",String)],n.prototype,"fontWeight",void 0),r([X.field,s("design:type",Number)],n.prototype,"thickness",void 0),r([X.field,s("design:type",Number)],n.prototype,"cornerRadius",void 0),r([X.field,s("design:type",_e.Color4)],n.prototype,"color",void 0),r([X.field,s("design:type",_e.Color4)],n.prototype,"background",void 0),r([X.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([X.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([X.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([X.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([X.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([X.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([X.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([X.field,s("design:type",_e.Color4)],n.prototype,"shadowColor",void 0),r([X.field,s("design:type",String)],n.prototype,"text",void 0),r([N("engine.shape",T.CLASS_ID.UI_BUTTON_SHAPE)],n)}(fi),Ai=function(S){function n(){var T=null!==S&&S.apply(this,arguments)||this;return T.outlineWidth=0,T.outlineColor=_e.Color4.White(),T.color=_e.Color4.White(),T.fontSize=10,T.fontAutoSize=!1,T.value="",T.lineSpacing=0,T.lineCount=0,T.adaptWidth=!1,T.adaptHeight=!1,T.textWrapping=!1,T.shadowBlur=0,T.shadowOffsetX=0,T.shadowOffsetY=0,T.shadowColor=_e.Color4.Black(),T.hTextAlign="left",T.vTextAlign="bottom",T.paddingTop=0,T.paddingRight=0,T.paddingBottom=0,T.paddingLeft=0,T}return i(n,S),r([X.field,s("design:type",Number)],n.prototype,"outlineWidth",void 0),r([X.field,s("design:type",_e.Color4)],n.prototype,"outlineColor",void 0),r([X.field,s("design:type",_e.Color4)],n.prototype,"color",void 0),r([X.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"fontAutoSize",void 0),r([X.component,s("design:type",Dn)],n.prototype,"font",void 0),r([X.field,s("design:type",String)],n.prototype,"value",void 0),r([X.field,s("design:type",Number)],n.prototype,"lineSpacing",void 0),r([X.field,s("design:type",Number)],n.prototype,"lineCount",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"adaptWidth",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"adaptHeight",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"textWrapping",void 0),r([X.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([X.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([X.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([X.field,s("design:type",_e.Color4)],n.prototype,"shadowColor",void 0),r([X.field,s("design:type",String)],n.prototype,"hTextAlign",void 0),r([X.field,s("design:type",String)],n.prototype,"vTextAlign",void 0),r([X.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([X.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([X.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([X.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([N("engine.shape",T.CLASS_ID.UI_TEXT_SHAPE)],n)}(fi),xi=function(S){function n(T){var v=S.call(this,T)||this;return v.outlineWidth=0,v.outlineColor=_e.Color4.Black(),v.color=_e.Color4.Clear(),v.fontSize=10,v.value="",v.placeholder="",v.margin=10,v.hTextAlign="left",v.vTextAlign="bottom",v.focusedBackground=_e.Color4.Black(),v.textWrapping=!1,v.shadowBlur=0,v.shadowOffsetX=0,v.shadowOffsetY=0,v.shadowColor=_e.Color4.White(),v.paddingTop=0,v.paddingRight=0,v.paddingBottom=0,v.paddingLeft=0,v.onTextSubmit=null,v.onChanged=null,v.onFocus=null,v.onBlur=null,v.onTextChanged=new hi((function(T){var S=T.value,M=S.value,A=S.isSubmit,E=v.dirty;if(v.value=M,v.dirty=E,A&&v.onTextSubmit){var C={text:M};v.onTextSubmit.callback(C)}else if(!A&&v.onChanged){var O={value:M,pointerId:T.pointerId};v.onChanged.callback(O)}})),v}return i(n,S),r([X.field,s("design:type",Number)],n.prototype,"outlineWidth",void 0),r([X.field,s("design:type",_e.Color4)],n.prototype,"outlineColor",void 0),r([X.field,s("design:type",_e.Color4)],n.prototype,"color",void 0),r([X.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([X.component,s("design:type",Dn)],n.prototype,"font",void 0),r([X.field,s("design:type",String)],n.prototype,"value",void 0),r([X.field,s("design:type",String)],n.prototype,"placeholder",void 0),r([X.field,s("design:type",Number)],n.prototype,"margin",void 0),r([X.field,s("design:type",String)],n.prototype,"hTextAlign",void 0),r([X.field,s("design:type",String)],n.prototype,"vTextAlign",void 0),r([X.field,s("design:type",_e.Color4)],n.prototype,"focusedBackground",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"textWrapping",void 0),r([X.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([X.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([X.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([X.field,s("design:type",_e.Color4)],n.prototype,"shadowColor",void 0),r([X.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([X.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([X.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([X.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([Vn.uuidEvent,s("design:type",hi)],n.prototype,"onTextChanged",void 0),r([Vn.uuidEvent,s("design:type",Object)],n.prototype,"onFocus",void 0),r([Vn.uuidEvent,s("design:type",Object)],n.prototype,"onBlur",void 0),r([N("engine.shape",T.CLASS_ID.UI_INPUT_TEXT_SHAPE),s("design:paramtypes",[Object])],n)}(fi),Ei=function(S){function n(T,v){var M=S.call(this,T)||this;return M.sourceLeft=0,M.sourceTop=0,M.sourceWidth=1,M.sourceHeight=1,M.paddingTop=0,M.paddingRight=0,M.paddingBottom=0,M.paddingLeft=0,M.sizeInPixels=!0,M.onClick=null,M.source=v,M}return i(n,S),r([X.field,s("design:type",Number)],n.prototype,"sourceLeft",void 0),r([X.field,s("design:type",Number)],n.prototype,"sourceTop",void 0),r([X.field,s("design:type",Number)],n.prototype,"sourceWidth",void 0),r([X.field,s("design:type",Number)],n.prototype,"sourceHeight",void 0),r([X.component,s("design:type",Object)],n.prototype,"source",void 0),r([X.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([X.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([X.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([X.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"sizeInPixels",void 0),r([Vn.uuidEvent,s("design:type",Object)],n.prototype,"onClick",void 0),r([N("engine.shape",T.CLASS_ID.UI_IMAGE_SHAPE),s("design:paramtypes",[fi,Object])],n)}(fi),Gi=function(S){function n(){var T=null!==S&&S.apply(this,arguments)||this;return T.valueX=0,T.valueY=0,T.backgroundColor=_e.Color4.Clear(),T.isHorizontal=!1,T.isVertical=!1,T.paddingTop=0,T.paddingRight=0,T.paddingBottom=0,T.paddingLeft=0,T.onChanged=null,T}return i(n,S),r([X.field,s("design:type",Number)],n.prototype,"valueX",void 0),r([X.field,s("design:type",Number)],n.prototype,"valueY",void 0),r([X.field,s("design:type",_e.Color4)],n.prototype,"backgroundColor",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"isHorizontal",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"isVertical",void 0),r([X.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([X.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([X.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([X.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([Vn.uuidEvent,s("design:type",Object)],n.prototype,"onChanged",void 0),r([N("engine.shape",T.CLASS_ID.UI_SLIDER_SHAPE)],n)}(fi),Ii=function(S){function n(){var T=null!==S&&S.apply(this,arguments)||this;return T.useDummyModel=!1,T.talking=!1,T}var v;return i(n,S),v=n,n.Dummy=function(){var T=new v;return T.useDummyModel=!0,T},r([X.field,s("design:type",String)],n.prototype,"id",void 0),r([X.field,s("design:type",String)],n.prototype,"name",void 0),r([X.field,s("design:type",String)],n.prototype,"expressionTriggerId",void 0),r([X.field,s("design:type",Number)],n.prototype,"expressionTriggerTimestamp",void 0),r([X.field,s("design:type",String)],n.prototype,"bodyShape",void 0),r([X.field,s("design:type",Array)],n.prototype,"wearables",void 0),r([X.field,s("design:type",Array)],n.prototype,"emotes",void 0),r([X.field,s("design:type",Object)],n.prototype,"skinColor",void 0),r([X.field,s("design:type",Object)],n.prototype,"hairColor",void 0),r([X.field,s("design:type",Object)],n.prototype,"eyeColor",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"useDummyModel",void 0),r([X.field,s("design:type",Boolean)],n.prototype,"talking",void 0),v=r([P("engine.avatarShape",T.CLASS_ID.AVATAR_SHAPE)],n)}(X),Ci=null,Di=null,Oi=null;function Ri(){return Oi||(Oi=new oe),Oi}var ji=function(){function t(){var T=this;this.messageQueue=[],this.connected=!1,this.flushing=!1,function(){if(!Di){(Di=dcl.loadModule("@decentraland/CommunicationsController",{})).then((function(T){Ci=T}));var T=Ri();dcl.subscribe("comms"),dcl.onEvent((function(S){"comms"===S.type&&T.notifyObservers(S.data)}))}return Di}().then((function(){T.connected=!0,T.flush()}))}return t.prototype.on=function(T,S){return Ri().add((function(v){try{var M=JSON.parse(v.message);M.message===T&&S(M.payload,v.sender)}catch(v){dcl.error("Error parsing comms message "+(v.message||""),v)}}))},t.prototype.sendRaw=function(T){this.messageQueue.push(T),this.connected&&this.flush()},t.prototype.emit=function(T,S){var v=JSON.stringify({message:T,payload:S});this.sendRaw(v),Ri().notifyObservers({message:v,sender:"self"})},t.prototype.flush=function(){var T=this;if(0!==this.messageQueue.length&&this.connected&&Ci&&!this.flushing){var S=this.messageQueue.shift();this.flushing=!0,dcl.callRpc(Ci.rpcHandle,"send",[S]).then((function(S){T.flushing=!1,T.flush()}),(function(S){T.flushing=!1,y("Error flushing MessageBus",S)}))}},t}(),_i=new K("scene");_i.uuid="0";var Pi=new Z(_i);N.engine=Pi,"undefined"!=typeof dcl&&(Pi.addSystem(new Ce(dcl),1/0),mt(dcl)),Pi.addSystem(ei),Pi.addSystem($n),Pi.addSystem(Jn),T.AVATAR_OBSERVABLE="AVATAR_OBSERVABLE",T.Angle=_e.Angle,T.AnimationState=rn,T.Animator=In,T.Arc2=_e.Arc2,T.AttachToAvatar=gn,T.Attachable=S,T.AudioClip=ti,T.AudioSource=ni,T.AudioStream=ii,T.AvatarModifierArea=ln,T.AvatarShape=Ii,T.AvatarTexture=Wn,T.Axis=_e.Axis,T.BasicMaterial=Pn,T.BezierCurve=_e.BezierCurve,T.Billboard=yn,T.BoxShape=Tn,T.Camera=qn,T.CameraModeArea=Hn,T.CircleShape=bn,T.Color3=_e.Color3,T.Color4=_e.Color4,T.Component=P,T.ComponentAdded=O,T.ComponentGroup=Q,T.ComponentRemoved=C,T.ConeShape=vn,T.Curve3=_e.Curve3,T.CylinderShape=Mn,T.DEG2RAD=_e.DEG2RAD,T.DisposableComponent=N,T.DisposableComponentCreated=H,T.DisposableComponentRemoved=W,T.DisposableComponentUpdated=q,T.Engine=Z,T.Entity=K,T.Epsilon=_e.Epsilon,T.EventConstructor=x,T.EventManager=A,T.Font=Dn,T.Frustum=_e.Frustum,T.GLTFShape=An,T.Gizmos=ai,T.GlobalPointerDown=un,T.GlobalPointerUp=cn,T.Input=dn,T.Material=Rn,T.Matrix=_e.Matrix,T.MessageBus=ji,T.MultiObserver=ie,T.NFTShape=En,T.OBJShape=Cn,T.Observable=oe,T.ObservableComponent=X,T.Observer=Y,T.ObserverEventState=ne,T.OnAnimationEnd=Nn,T.OnBlur=ci,T.OnChanged=hi,T.OnClick=li,T.OnEnter=di,T.OnFocus=si,T.OnGizmoEvent=ri,T.OnPointerDown=pi,T.OnPointerHoverEnter=gi,T.OnPointerHoverExit=yi,T.OnPointerLock=Fn,T.OnPointerUUIDEvent=Ln,T.OnPointerUp=mi,T.OnTextSubmit=ui,T.OnUUIDEvent=Vn,T.Orientation=_e.Orientation,T.ParentChanged=j,T.Path2=_e.Path2,T.Path3D=_e.Path3D,T.PhysicsCast=Xn,T.Plane=_e.Plane,T.PlaneShape=Sn,T.PointerEvent=ue,T.PointerEventComponent=Ke,T.PointerEventSystem=Kn,T.Quaternion=_e.Quaternion,T.RAD2DEG=_e.RAD2DEG,T.RaycastEventSystem=Qn,T.RaycastResponse=se,T.Scalar=_e.Scalar,T.Shape=fn,T.Size=_e.Size,T.SmartItem=kn,T.Space=_e.Space,T.SphereShape=wn,T.Subscription=en,T.TextShape=jn,T.Texture=Gn,T.ToGammaSpace=_e.ToGammaSpace,T.ToLinearSpace=_e.ToLinearSpace,T.Transform=pn,T.UIButton=Mi,T.UICanvas=bi,T.UIContainerRect=Si,T.UIContainerStack=vi,T.UIFullScreen=Ti,T.UIImage=Ei,T.UIInputText=xi,T.UIScrollRect=Gi,T.UIShape=fi,T.UIText=Ai,T.UIValue=R,T.UIWorldSpace=wi,T.UUIDEvent=ae,T.UUIDEventSystem=Zn,T.Vector2=_e.Vector2,T.Vector3=_e.Vector3,T.Vector4=_e.Vector4,T.VideoClip=Un,T.VideoTexture=Bn,T._initEventObservables=mt,T.buildArray=function(T,S){for(var v=[],M=0;M<T;++M)v.push(S());return v},T.engine=Pi,T.error=y,T.executeTask=G,T.getComponentClassId=L,T.getComponentId=D,T.getComponentName=F,T.getMessageObserver=Ri,T.isDisposableComponent=U,T.log=u,T.newId=f,T.onCameraModeChangedObservable=ce,T.onEnterScene=le,T.onEnterSceneObservable=he,T.onIdleStateChangedObservable=de,T.onLeaveScene=ye,T.onLeaveSceneObservable=me,T.onPlayerClickedObservable=Ie,T.onPlayerConnectedObservable=ve,T.onPlayerDisconnectedObservable=Ee,T.onPlayerExpressionObservable=Te,T.onPointerLockedStateChange=we,T.onProfileChanged=Se,T.onRealmChangedObservable=Ge,T.onSceneReadyObservable=fe,T.onVideoEvent=be,T.openExternalURL=function(T){"undefined"!=typeof dcl?dcl.openExternalUrl(T):y("ERROR: openExternalURL dcl is undefined")},T.openNFTDialog=function(T,S){if(void 0===S&&(S=null),"undefined"!=typeof dcl){var v=T.match(/ethereum:\/\/(.+)\/(.+)/);if(!v||v.length<3)return;dcl.openNFTDialog(v[1],v[2],S)}else y("ERROR: openNFTDialog dcl is undefined")},T.pointerEventSystem=$n,T.raycastEventSystem=Jn,T.teleportTo=function(T){var S;S=[T],void 0===$&&"undefined"!=typeof dcl&&($=dcl.loadModule("@decentraland/UserActionModule",{})),void 0!==$&&"undefined"!=typeof dcl&&$.then((function(T){dcl.callRpc(T.rpcHandle,"requestTeleport",S)}))},T.uuid=m,T.uuidEventSystem=ei,Object.defineProperty(T,"__esModule",{value:!0})}(this.self=this.self||{}),define("@dcl/ecs-scene-utils",["exports","@decentraland/EnvironmentAPI"],(function(T,S){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var n=function(T,S){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,S){T.__proto__=S}||function(T,S){for(var v in S)Object.prototype.hasOwnProperty.call(S,v)&&(T[v]=S[v])})(T,S)};function i(T,S){function i(){this.constructor=T}n(T,S),T.prototype=null===S?Object.create(S):(i.prototype=S.prototype,new i)}function r(T,S,v,M){var A,E=arguments.length,C=E<3?S:null===M?M=Object.getOwnPropertyDescriptor(S,v):M;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)C=Reflect.decorate(T,S,v,M);else for(var O=T.length-1;O>=0;O--)(A=T[O])&&(C=(E<3?A(C):E>3?A(S,v,C):A(S,v))||C);return E>3&&C&&Object.defineProperty(S,v,C),C}function o(T,S,v,M){return new(v||(v=Promise))((function(A,E){function a(T){try{u(M.next(T))}catch(T){E(T)}}function s(T){try{u(M.throw(T))}catch(T){E(T)}}function u(T){var S;T.done?A(T.value):(S=T.value,S instanceof v?S:new v((function(T){T(S)}))).then(a,s)}u((M=M.apply(T,S||[])).next())}))}function a(T,S){var v,M,A,E,C={label:0,sent:function(){if(1&A[0])throw A[1];return A[1]},trys:[],ops:[]};return E={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(E[Symbol.iterator]=function(){return this}),E;function s(E){return function(O){return function(E){if(v)throw new TypeError("Generator is already executing.");for(;C;)try{if(v=1,M&&(A=2&E[0]?M.return:E[0]?M.throw||((A=M.return)&&A.call(M),0):M.next)&&!(A=A.call(M,E[1])).done)return A;switch(M=0,A&&(E=[2&E[0],A.value]),E[0]){case 0:case 1:A=E;break;case 4:return C.label++,{value:E[1],done:!1};case 5:C.label++,M=E[1],E=[0];continue;case 7:E=C.ops.pop(),C.trys.pop();continue;default:if(!((A=(A=C.trys).length>0&&A[A.length-1])||6!==E[0]&&2!==E[0])){C=0;continue}if(3===E[0]&&(!A||E[1]>A[0]&&E[1]<A[3])){C.label=E[1];break}if(6===E[0]&&C.label<A[1]){C.label=A[1],A=E;break}if(A&&C.label<A[2]){C.label=A[2],C.ops.push(E);break}A[2]&&C.ops.pop(),C.trys.pop();continue}E=S.call(T,C)}catch(T){E=[6,T],M=0}finally{v=A=0}if(5&E[0])throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}([E,O])}}}function s(T){var S="function"==typeof Symbol&&Symbol.iterator,v=S&&T[S],M=0;if(v)return v.call(T);if(T&&"number"==typeof T.length)return{next:function(){return T&&M>=T.length&&(T=void 0),{value:T&&T[M++],done:!T}}};throw new TypeError(S?"Object is not iterable.":"Symbol.iterator is not defined.")}var v,M=function(){function e(){this._components=[],this._componentGroups=[],e._instance=this}return e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e.registerCustomComponent=function(T){this.createAndAddToEngine()._components.push(T)},e.prototype.addComponentType=function(T){var S,v;try{for(var M=s(this._components),A=M.next();!A.done;A=M.next())if(T==A.value)return}catch(T){S={error:T}}finally{try{A&&!A.done&&(v=M.return)&&v.call(M)}finally{if(S)throw S.error}}this._components.push(T),this._componentGroups.push(engine.getComponentGroup(T,Transform))},e.prototype.update=function(T){for(var S=0;S<this._components.length;S++)this.updateComponent(T,this._components[S],this._componentGroups[S])},e.prototype.updateComponent=function(T,S,v){v.entities.forEach((function(v){var M=v.getComponent(Transform),A=v.getComponent(S);A.update(T),A.assignValueToTransform(M),A.hasFinished()&&(v.removeComponent(A),null!=A.onFinishCallback&&A.onFinishCallback())}))},e._instance=null,e}();function h(S,v){switch(S){case T.InterpolationType.LINEAR:return v;case T.InterpolationType.EASEINQUAD:return function(T){return T*T}(v);case T.InterpolationType.EASEOUTQUAD:return function(T){return T*(2-T)}(v);case T.InterpolationType.EASEQUAD:return function(T){return T*T/(2*(T*T-T)+1)}(v);case T.InterpolationType.EASEINSINE:return function(T){return 1-Math.cos(T*Math.PI/2)}(v);case T.InterpolationType.EASEOUTSINE:return function(T){return Math.sin(T*Math.PI/2)}(v);case T.InterpolationType.EASESINE:return function(T){return-(Math.cos(Math.PI*T)-1)/2}(v);case T.InterpolationType.EASEINEXPO:return function(T){return 0===T?0:Math.pow(2,10*T-10)}(v);case T.InterpolationType.EASEOUTEXPO:return function(T){return 1===T?1:1-Math.pow(2,-10*T)}(v);case T.InterpolationType.EASEEXPO:return function(T){return 0===T?0:1===T?1:T<.5?Math.pow(2,20*T-10)/2:(2-Math.pow(2,-20*T+10))/2}(v);case T.InterpolationType.EASEINELASTIC:return function(T){var S=2*Math.PI/3;return 0===T?0:1===T?1:-Math.pow(2,10*T-10)*Math.sin((10*T-10.75)*S)}(v);case T.InterpolationType.EASEOUTELASTIC:return function(T){var S=2*Math.PI/3;return 0===T?0:1===T?1:Math.pow(2,-10*T)*Math.sin((10*T-.75)*S)+1}(v);case T.InterpolationType.EASEELASTIC:return function(T){var S=2*Math.PI/4.5;return 0===T?0:1===T?1:T<.5?-Math.pow(2,20*T-10)*Math.sin((20*T-11.125)*S)/2:Math.pow(2,-20*T+10)*Math.sin((20*T-11.125)*S)/2+1}(v);case T.InterpolationType.EASEINBOUNCE:return function(T){return 1-l(1-T)}(v);case T.InterpolationType.EASEOUTEBOUNCE:return function(T){return l(T)}(v);case T.InterpolationType.EASEBOUNCE:return function(T){return T<.5?(1-l(1-2*T))/2:(1+l(2*T-1))/2}(v);default:return v}}function l(T){var S=7.5625,v=2.75;return T<1/v?S*T*T:T<2/v?S*(T-=1.5/v)*T+.75:T<2.5/v?S*(T-=2.25/v)*T+.9375:S*(T-=2.625/v)*T+.984375}T.InterpolationType=void 0,(v=T.InterpolationType||(T.InterpolationType={}))[v.LINEAR=0]="LINEAR",v[v.EASEINQUAD=1]="EASEINQUAD",v[v.EASEOUTQUAD=2]="EASEOUTQUAD",v[v.EASEQUAD=3]="EASEQUAD",v.EASEINSINE="easeinsine",v.EASEOUTSINE="easeoutsine",v.EASESINE="easeinoutsine",v.EASEINEXPO="easeinexpo",v.EASEOUTEXPO="easeoutexpo",v.EASEEXPO="easeinoutexpo",v.EASEINELASTIC="easeinelastic",v.EASEOUTELASTIC="easeoutelastic",v.EASEELASTIC="easeinoutelastic",v.EASEINBOUNCE="easeinbounce",v.EASEOUTEBOUNCE="easeoutbounce",v.EASEBOUNCE="easeinoutbounce";var A,E=function(){function t(v,A,E,C,O){void 0===O&&(O=T.InterpolationType.LINEAR),this.start=v,this.end=A,this.normalizedTime=0,this.lerpTime=0,this.onFinishCallback=C,this.interpolationType=O,0!=E?this.speed=1/E:(this.speed=0,this.normalizedTime=1,this.lerpTime=1),M.createAndAddToEngine().addComponentType(S)}var S;return S=t,t.prototype.update=function(T){this.normalizedTime=Scalar.Clamp(this.normalizedTime+T*this.speed,0,1),this.lerpTime=h(this.interpolationType,this.normalizedTime)},t.prototype.hasFinished=function(){return this.normalizedTime>=1},t.prototype.assignValueToTransform=function(T){T.position=Vector3.Lerp(this.start,this.end,this.lerpTime)},S=r([Component("moveTransformComponent")],t)}(),C=function(){function t(v,A,E,C,O){void 0===O&&(O=T.InterpolationType.LINEAR),this.start=v,this.end=A,this.normalizedTime=0,this.lerpTime=0,this.onFinishCallback=C,this.interpolationType=O,0!=E?this.speed=1/E:(this.speed=0,this.normalizedTime=1,this.lerpTime=1),M.createAndAddToEngine().addComponentType(S)}var S;return S=t,t.prototype.update=function(T){this.normalizedTime=Scalar.Clamp(this.normalizedTime+T*this.speed,0,1),this.lerpTime=h(this.interpolationType,this.normalizedTime)},t.prototype.hasFinished=function(){return this.normalizedTime>=1},t.prototype.assignValueToTransform=function(T){T.rotation=Quaternion.Slerp(this.start,this.end,this.lerpTime)},S=r([Component("rotateTransformComponent")],t)}(),O=function(){function t(v,A,E,C,O){void 0===O&&(O=T.InterpolationType.LINEAR),this.start=v,this.end=A,this.normalizedTime=0,this.lerpTime=0,this.onFinishCallback=C,this.interpolationType=O,0!=E?this.speed=1/E:(this.speed=0,this.normalizedTime=1,this.lerpTime=1),M.createAndAddToEngine().addComponentType(S)}var S;return S=t,t.prototype.update=function(T){this.normalizedTime=Scalar.Clamp(this.normalizedTime+T*this.speed,0,1),this.lerpTime=h(this.interpolationType,this.normalizedTime)},t.prototype.hasFinished=function(){return this.normalizedTime>=1},t.prototype.assignValueToTransform=function(T){T.scale=Vector3.Lerp(this.start,this.end,this.lerpTime)},S=r([Component("scaleTransformComponent")],t)}(),j=function(){function e(S,v,A,E){if(this.speed=[],this.normalizedTime=0,this.currentIndex=0,this.points=S,this.onFinishCallback=A,this.onPointReachedCallback=E,S.length<2)throw new Error("At least 2 points are needed for FollowPathComponent.");if(v>0){for(var C=0,O=[],j=0;j<S.length-1;j++){var R=Vector3.Distance(S[j],S[j+1]);C+=R,O.push(R)}for(j=0;j<O.length;j++)this.speed.push(1/(O[j]/C*v))}else this.normalizedTime=1,this.currentIndex=S.length-2;M.createAndAddToEngine().addComponentType(T)}var T;return T=e,e.prototype.update=function(T){this.normalizedTime=Scalar.Clamp(this.normalizedTime+T*this.speed[this.currentIndex],0,1),this.normalizedTime>=1&&this.currentIndex<this.points.length-2&&(this.currentIndex++,this.normalizedTime=0,this.onPointReachedCallback&&this.currentIndex<this.points.length-1&&this.onPointReachedCallback(this.points[this.currentIndex],this.points[this.currentIndex+1]))},e.prototype.hasFinished=function(){return this.currentIndex>=this.points.length-2&&this.normalizedTime>=1},e.prototype.assignValueToTransform=function(T){T.position=Vector3.Lerp(this.points[this.currentIndex],this.points[this.currentIndex+1],this.normalizedTime)},T=r([Component("followPathComponent")],e)}(),R=function(){function e(S,v,A,E,C,O){if(this.speed=[],this.turnToFaceNext=!1,this.facingNext=!1,this.normalizedTime=0,this.currentIndex=0,this.points=Curve3.CreateCatmullRomSpline(S,A,!!C).getPoints(),this.onFinishCallback=O,this.turnToFaceNext=E||!1,this.points.length<2)throw new Error("At least 2 points are needed for FollowPathComponent.");if(v>0){for(var j=0,R=[],V=0;V<this.points.length-1;V++){var z=Vector3.Distance(this.points[V],this.points[V+1]);j+=z,R.push(z)}for(V=0;V<R.length;V++)this.speed.push(1/(R[V]/j*v))}else this.normalizedTime=1,this.currentIndex=S.length-2;M.createAndAddToEngine().addComponentType(T)}var T;return T=e,e.prototype.update=function(T){this.normalizedTime=Scalar.Clamp(this.normalizedTime+T*this.speed[this.currentIndex],0,1),this.normalizedTime>=1&&this.currentIndex<this.points.length-2&&(this.currentIndex++,this.normalizedTime=0,1==this.turnToFaceNext&&(this.facingNext=!1))},e.prototype.hasFinished=function(){return this.currentIndex>=this.points.length-2&&this.normalizedTime>=1},e.prototype.assignValueToTransform=function(T){T.position=Vector3.Lerp(this.points[this.currentIndex],this.points[this.currentIndex+1],this.normalizedTime),this.facingNext||(this.facingNext=!0,this.currentIndex<this.points.length-1?T.lookAt(this.points[this.currentIndex+1]):T.lookAt(this.points[0]))},T=r([Component("followCurvedPathComponent")],e)}(),V=function(){function e(S,v){this.rotationVelocity=S,this.onFinishCallback=v,this.rotation=Quaternion.Identity,this.finished=!1,M.createAndAddToEngine().addComponentType(T)}var T;return T=e,e.prototype.update=function(T){this.rotation=Quaternion.Slerp(Quaternion.Identity,this.rotationVelocity,T)},e.prototype.hasFinished=function(){return this.finished},e.prototype.assignValueToTransform=function(T){T.rotation=T.rotation.multiply(this.rotation)},e.prototype.stop=function(){this.finished=!0},T=r([Component("keepRotatingComponent")],e)}();T.ToggleState=void 0,(A=T.ToggleState||(T.ToggleState={}))[A.Off=0]="Off",A[A.On=1]="On";var z=function(){function t(S,v){void 0===S&&(S=T.ToggleState.On),this.enabled=!0,this.state=T.ToggleState.Off,this.set(S),v&&this.setCallback(v)}return t.prototype.set=function(T){this.state=T,this.onValueChangedCallback&&this.onValueChangedCallback(T)},t.prototype.toggle=function(){this.enabled&&this.set(1-this.state)},t.prototype.isOn=function(){return this.state==T.ToggleState.On},t.prototype.setCallback=function(T){this.onValueChangedCallback=T},r([Component("toggle")],t)}(),B=function(){function e(){this._components=[],e._instance=this}return e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e.registerCustomComponent=function(T){this.createAndAddToEngine()._components.push(T)},e.prototype.addComponentType=function(T){var S,v;try{for(var M=s(this._components),A=M.next();!A.done;A=M.next())if(T==A.value)return}catch(T){S={error:T}}finally{try{A&&!A.done&&(v=M.return)&&v.call(M)}finally{if(S)throw S.error}}this._components.push(T)},e.prototype.update=function(T){var S=this;this._components.forEach((function(v){S.updateComponent(T,v)}))},e.prototype.updateComponent=function(T,S){var v=engine.getEntitiesWithComponent(S);for(var M in v)if(v.hasOwnProperty(M)){var A=v[M],E=A.getComponent(S);E.elapsedTime+=T,E.elapsedTime>=E.targetTime&&E.onTargetTimeReached(A)}},e._instance=null,e}(),H=function(){function e(S,v){var M=this;B.createAndAddToEngine().addComponentType(T),this.elapsedTime=0,this.targetTime=S/1e3,this.onTimeReachedCallback=v,this.onTargetTimeReached=function(T){M.onTimeReachedCallback&&M.onTimeReachedCallback(),T.removeComponent(M)}}var T;return T=e,e.prototype.setCallback=function(T){this.onTimeReachedCallback=T},T=r([Component("timerDelay")],e)}(),W=function(){function e(S,v){var M=this;B.createAndAddToEngine().addComponentType(T),this.elapsedTime=0,this.targetTime=S/1e3,this.onTimeReachedCallback=v,this.onTargetTimeReached=function(T){M.onTimeReachedCallback&&M.onTimeReachedCallback(),T.removeComponent(M),engine.removeEntity(T)}}var T;return T=e,e.prototype.setCallback=function(T){this.onTimeReachedCallback=T},T=r([Component("timerExpireIn")],e)}(),q=function(){function e(S,v){var M=this;B.createAndAddToEngine().addComponentType(T),this.elapsedTime=0,this.targetTime=S/1e3,this.onTimeReachedCallback=v,this.onTargetTimeReached=function(){M.elapsedTime=0,M.onTimeReachedCallback&&M.onTimeReachedCallback()}}var T;return T=e,e.prototype.setCallback=function(T){this.onTimeReachedCallback=T},T=r([Component("timerInterval")],e)}();function I(T,S,v,M,A,E){var C=new Entity;C.addComponent(new Transform(E||{position:new Vector3(0,1.5,0)})),C.setParent(S);var O=new TextShape(T);return O.fontSize=A||3,O.color=M||Color3.Black(),C.addComponent(O),v&&C.addComponent(new Billboard),engine.addEntity(C),C}var X,Q,K=function(){function e(){this._triggers={},e._instance=this,this._cameraTriggerWrapper=new J(new P(new Vector3(.5,1.8,.5),new Vector3(0,.91,0))),this._componentGroup=engine.getComponentGroup($)}return Object.defineProperty(e,"instance",{get:function(){return this.createAndAddToEngine()},enumerable:!1,configurable:!0}),e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e.prototype.setCameraTriggerShape=function(T){this._cameraTriggerWrapper.setShape(T)},e.prototype.update=function(){var T=this,S=this._componentGroup.entities;for(var v in S.forEach((function(S){T.shouldWrapTriggerEntity(S)&&T.wrapTriggerEntity(S)})),this._triggers)if(this._triggers.hasOwnProperty(v)){var M=this._triggers[v];M.isDebugging()&&M.updateDebugEntity(),M.isInEngine()?null!=M.trigger&&M.trigger.enabled?(M.wasEnabled||M.isDebugging()&&M.addDebugEntity(),M.wasEnabled=!0,(M.trigger.onCameraEnter||M.trigger.onCameraExit)&&this.checkCollisionAgainstCamera(M),(M.trigger.onTriggerEnter||M.trigger.onTriggerExit)&&this.checkCollisionAgainstOtherTriggers(M)):M.wasEnabled&&(M.wasEnabled=!1,M.isDebugging()&&M.removeDebugEntity(),e.removeTriggerFromSystem(M)):(M.isDebugging()&&M.removeDebugEntity(),e.removeTriggerFromSystem(M),delete this._triggers[v])}},e.prototype.shouldWrapTriggerEntity=function(T){return null==this._triggers[T.uuid]||null==this._triggers[T.uuid]},e.prototype.wrapTriggerEntity=function(T){this._triggers[T.uuid]=new Z(T)},e.removeTriggerFromSystem=function(T){for(var S,v=T.getActiveCollisions(),M=0;M<v.length;M++)!(v[M]===(null===(S=e._instance)||void 0===S?void 0:S._cameraTriggerWrapper)||null==v[M].trigger)&&v[M].trigger.onTriggerExit&&T.entity&&v[M].trigger.onTriggerExit(T.entity),v[M].disengageActiveCollision(T),T.disengageActiveCollision(v[M])},e.disengageCollision=function(T,S){T.disengageActiveCollision(S),S.disengageActiveCollision(T),T.trigger.onTriggerExit&&S.entity&&T.trigger.onTriggerExit(S.entity),S.trigger.onTriggerExit&&T.entity&&S.trigger.onTriggerExit(T.entity)},e.engageCollision=function(T,S){T.engageCollision(S),S.engageCollision(T),T.trigger.onTriggerEnter&&S.entity&&T.trigger.onTriggerEnter(S.entity),S.trigger.onTriggerEnter&&T.entity&&S.trigger.onTriggerEnter(T.entity)},e.prototype.checkCollisionAgainstCamera=function(T){var S=T.hasActiveCollision(this._cameraTriggerWrapper),v=e.areColliding(T,this._cameraTriggerWrapper);S&&!v?(T.disengageActiveCollision(this._cameraTriggerWrapper),T.trigger.onCameraExit&&T.trigger.onCameraExit()):!S&&v&&(T.engageCollision(this._cameraTriggerWrapper),T.trigger.onCameraEnter&&T.trigger.onCameraEnter())},e.prototype.checkCollisionAgainstOtherTriggers=function(T){for(var S in this._triggers)if(this._triggers.hasOwnProperty(S)&&S!=T.uuid&&this._triggers[S].trigger.enabled&&e.canTriggersCollide(T,this._triggers[S])){var v=T.hasActiveCollision(this._triggers[S]),M=e.areColliding(T,this._triggers[S]);v&&!M?e.disengageCollision(T,this._triggers[S]):!v&&M&&e.engageCollision(T,this._triggers[S])}},e.canTriggersCollide=function(T,S){return 0==T.trigger.triggeredByLayer||0!=(S.trigger.layer&T.trigger.triggeredByLayer)},e.areColliding=function(T,S){return T.getShape()instanceof P&&S.getShape()instanceof P?e.areCollidingAABB(T.getGlobalPosition(),T.getShape(),S.getGlobalPosition(),S.getShape()):T.getShape()instanceof k&&S.getShape()instanceof k?e.areCollidingSphere(T.getGlobalPosition(),T.getShape(),S.getGlobalPosition(),S.getShape()):T.getShape()instanceof P&&S.getShape()instanceof k?e.areCollidingAABBSphere(T.getGlobalPosition(),T.getShape(),S.getGlobalPosition(),S.getShape()):T.getShape()instanceof k&&S.getShape()instanceof P&&e.areCollidingAABBSphere(S.getGlobalPosition(),S.getShape(),T.getGlobalPosition(),T.getShape())},e.areCollidingAABB=function(T,S,v,M){var A=e.getBoxShapeValues(T,S),E=e.getBoxShapeValues(v,M);return A.min.x<=E.max.x&&A.max.x>=E.min.x&&A.min.y<=E.max.y&&A.max.y>=E.min.y&&A.min.z<=E.max.z&&A.max.z>=E.min.z},e.areCollidingSphere=function(T,S,v,M){return Vector3.DistanceSquared(T.add(S.position),v.add(M.position))<S.radius*S.radius+M.radius*M.radius},e.areCollidingAABBSphere=function(T,S,v,M){var A=e.getBoxShapeValues(T,S),E=v.add(M.position),C=M.radius,O=0;return E.x<A.min.x&&(O+=(A.min.x-E.x)*(A.min.x-E.x)),E.x>A.max.x&&(O+=(E.x-A.max.x)*(E.x-A.max.x)),E.y<A.min.y&&(O+=(A.min.y-E.y)*(A.min.y-E.y)),E.y>A.max.y&&(O+=(E.y-A.max.y)*(E.y-A.max.y)),E.z<A.min.z&&(O+=(A.min.z-E.z)*(A.min.z-E.z)),E.z>A.max.z&&(O+=(E.z-A.max.z)*(E.z-A.max.z)),O<C*C},e.getBoxShapeValues=function(T,S){var v=T.add(S.position);return{center:v,min:v.subtract(S.size.scale(.5)),max:v.add(S.size.scale(.5))}},e._instance=null,e}(),Z=function(){function e(T){this.wasEnabled=!0,this._uuid="",this._collidingWith={},this._isDebug=!1,this._debugEntity=null,this._entity=T,T&&(this._trigger=T.getComponent($),this._uuid=T.uuid,this._isDebug=this._trigger.debugEnabled,this._isDebug&&this.addDebugEntity())}return Object.defineProperty(e.prototype,"entity",{get:function(){return this._entity},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trigger",{get:function(){return this._trigger},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uuid",{get:function(){return this._uuid},enumerable:!1,configurable:!0}),e.prototype.getGlobalPosition=function(){return this._entity?e.getEntityWorldPosition(this._entity):Vector3.Zero()},e.prototype.getShape=function(){return this._trigger.shape},e.prototype.isInEngine=function(){return null!=this._entity&&this._entity.isAddedToEngine()},e.prototype.getActiveCollisions=function(){var T=[];for(var S in this._collidingWith)this._collidingWith.hasOwnProperty(S)&&T.push(this._collidingWith[S]);return T},e.prototype.hasActiveCollision=function(T){return null!=this._collidingWith[T.uuid]&&null!=this._collidingWith[T.uuid]},e.prototype.disengageActiveCollision=function(T){delete this._collidingWith[T.uuid]},e.prototype.engageCollision=function(T){this._collidingWith[T.uuid]=T},e.prototype.isDebugging=function(){return this._isDebug},e.prototype.addDebugEntity=function(){return o(this,void 0,void 0,(function(){var T,v,M;return a(this,(function(A){switch(A.label){case 0:return[4,!S.isPreviewMode()];case 1:return A.sent()||(e._debugMaterial||(e._debugMaterial=new Material,e._debugMaterial.alphaTest=.5),null==this._debugEntity&&(this._debugEntity=new Entity,T=new Transform,this._debugEntity.addComponent(T),this._debugEntity.addComponent(e._debugMaterial),this.getShape()instanceof P&&((v=new BoxShape).withCollisions=!1,this._debugEntity.addComponent(v),T.scale=this.getShape().size),this.getShape()instanceof k&&((v=new SphereShape).withCollisions=!1,this._debugEntity.addComponent(v),M=this.getShape().radius,T.scale=new Vector3(M,M,M))),engine.addEntity(this._debugEntity)),[2]}}))}))},e.prototype.removeDebugEntity=function(){null!=this._debugEntity&&engine.removeEntity(this._debugEntity)},e.prototype.updateDebugEntity=function(){this._debugEntity&&(this._debugEntity.getComponent(Transform).position=this.getGlobalPosition().add(this.getShape().position))},e.getEntityWorldPosition=function(T){var S=T.hasComponent(Transform)?T.getComponent(Transform).position.clone():Vector3.Zero(),v=T.getParent();if(null!=v){var M=v.hasComponent(Transform)?v.getComponent(Transform).rotation:Quaternion.Identity;return this.getEntityWorldPosition(v).add(S.rotate(M))}return S},e._debugMaterial=null,e}(),J=function(T){function t(S){var v=T.call(this)||this;return v._shape=S,v._uuid="cameraTrigger",v}return i(t,T),t.prototype.getGlobalPosition=function(){return Camera.instance.position},t.prototype.getShape=function(){return this._shape},t.prototype.setShape=function(T){this._shape=T},t.prototype.isInEngine=function(){return!1},t.prototype.hasActiveCollision=function(T){return!1},t.prototype.disengageActiveCollision=function(T){},t.prototype.engageCollision=function(T){},t.prototype.isDebugging=function(){return!1},t}(Z),$=function(){function e(T,S){this.enabled=!0,this.layer=0,this.triggeredByLayer=0,this._debugEnabled=!1,K.createAndAddToEngine(),this.shape=T,S&&(S.layer&&(this.layer=S.layer),S.triggeredByLayer&&(this.triggeredByLayer=S.triggeredByLayer),S.onTriggerEnter&&(this.onTriggerEnter=S.onTriggerEnter),S.onTriggerExit&&(this.onTriggerExit=S.onTriggerExit),S.onCameraEnter&&(this.onCameraEnter=S.onCameraEnter),S.onCameraExit&&(this.onCameraExit=S.onCameraExit),S.enableDebug&&(this._debugEnabled=S.enableDebug))}return Object.defineProperty(e.prototype,"debugEnabled",{get:function(){return this._debugEnabled},enumerable:!1,configurable:!0}),r([Component("triggerComponent")],e)}(),P=function(T,S){void 0===T&&(T=Vector3.One().scale(2)),void 0===S&&(S=Vector3.Zero()),this.size=T,this.position=S},k=function(T,S){void 0===T&&(T=2),void 0===S&&(S=Vector3.Zero()),this.radius=T,this.position=S};T.ActionsSequenceSystem=function(){function e(T){this.beginSequenceNode=null,this.currentSequenceNode=null,this.running=!1,this.started=!1,T&&this.startSequence(T)}return e.prototype.startSequence=function(T){this.beginSequenceNode=T.beginSequenceNode,this.currentSequenceNode=this.beginSequenceNode,this.running=!0,this.started=!1},e.prototype.setOnFinishCallback=function(T){this.onFinishCallback=T},e.prototype.isRunning=function(){return this.running},e.prototype.stop=function(){this.running=!1},e.prototype.resume=function(){null!=this.beginSequenceNode&&(this.running=!0)},e.prototype.reset=function(){this.currentSequenceNode=this.beginSequenceNode,this.running=!0,this.started=!1},e.prototype.getRunningAction=function(){var T=this.currentSequenceNode;if(this.currentSequenceNode instanceof ne)do{T=T.currentInnerSequence}while(T instanceof ne);return T.action},e.prototype.update=function(T){this.running&&(this.started?this.currentSequenceNode.hasFinish()?(this.currentSequenceNode.onFinish(),this.currentSequenceNode=this.currentSequenceNode.next,this.currentSequenceNode?this.currentSequenceNode.onStart():(this.running=!1,this.onFinishCallback&&this.onFinishCallback())):this.currentSequenceNode.update(T):(this.currentSequenceNode.onStart(),this.started=!0))},e}(),X=T.ActionsSequenceSystem||(T.ActionsSequenceSystem={}),Q=function(){function e(){this.currentSequenceNode=null,this.beginSequenceNode=null,this.whileNodeStack=[]}return e.prototype.then=function(T){if(null==this.currentSequenceNode)this.currentSequenceNode=new ee,this.currentSequenceNode.action=T,this.beginSequenceNode=this.currentSequenceNode;else{var S=new ee;S.action=T,this.currentSequenceNode=this.currentSequenceNode.then(S)}return this},e.prototype.if=function(T){var S=new ie(T);return null==this.currentSequenceNode?(this.currentSequenceNode=S,this.beginSequenceNode=S):this.currentSequenceNode=this.currentSequenceNode.then(S),this},e.prototype.else=function(){var T=this.currentSequenceNode.getSequence();if(!(T instanceof ie))throw new Error("IF statement is needed to be called before ELSE statement.");T.closed=!0;var S=new oe(T);return this.currentSequenceNode=this.currentSequenceNode.then(S),this},e.prototype.endIf=function(){var T=this.currentSequenceNode.getSequence();if(!(T instanceof ie||T instanceof oe))throw new Error("IF statement is needed to be called before ENDIF statement.");return T.closed=!0,this},e.prototype.while=function(T){var S=new ae(T);return null==this.currentSequenceNode?(this.currentSequenceNode=S,this.beginSequenceNode=S):this.currentSequenceNode=this.currentSequenceNode.then(S),this.whileNodeStack.push(S),this},e.prototype.endWhile=function(){var T=this.currentSequenceNode.getSequence();if(!(T instanceof ae))throw new Error("WHILE statement is needed to be called before ENDWHILE statement.");return T.closed=!0,this.whileNodeStack.length>0&&this.whileNodeStack.splice(this.whileNodeStack.length-1,1),this},e.prototype.breakWhile=function(){if(!(this.whileNodeStack.length>0))throw new Error("WHILE statement is needed to be called before BREAKWHILE statement.");return this.currentSequenceNode=this.currentSequenceNode.then(new se(this.whileNodeStack[this.whileNodeStack.length-1])),this},e}(),X.SequenceBuilder=Q;var ee=function(){function e(){this.action=null,this.next=null}return e.prototype.then=function(T){return this.next=T,T},e.prototype.onStart=function(){this.action&&this.action.onStart()},e.prototype.update=function(T){this.action&&this.action.update(T)},e.prototype.onFinish=function(){this.action&&this.action.onFinish()},e.prototype.hasFinish=function(){return!this.action||this.action.hasFinished},e.prototype.getSequence=function(){return this},e}(),ne=function(T){function t(){var S=null!==T&&T.apply(this,arguments)||this;return S.currentInnerSequence=null,S.startingInnerSequence=null,S.closed=!1,S}return i(t,T),t.prototype.then=function(T){if(null==this.currentInnerSequence)this.currentInnerSequence=T,this.startingInnerSequence=T;else{if(this.closed)return this.next=T,T;this.currentInnerSequence=this.currentInnerSequence.then(T)}return this},t.prototype.onStart=function(){this.currentInnerSequence=this.startingInnerSequence,this.currentInnerSequence&&this.currentInnerSequence.onStart()},t.prototype.update=function(T){this.currentInnerSequence&&(this.currentInnerSequence.hasFinish()?(this.currentInnerSequence.onFinish(),this.currentInnerSequence=this.currentInnerSequence.next,this.currentInnerSequence&&this.currentInnerSequence.onStart()):this.currentInnerSequence.update(T))},t.prototype.onFinish=function(){this.currentInnerSequence&&this.currentInnerSequence.onFinish()},t.prototype.hasFinish=function(){return null==this.currentInnerSequence},t.prototype.getSequence=function(){if(this.currentInnerSequence){var T=this.currentInnerSequence.getSequence();if(T instanceof t&&!T.closed)return T}return this},t}(ee),ie=function(T){function t(S){var v=T.call(this)||this;return v.result=!1,v.condition=S,v}return i(t,T),t.prototype.onStart=function(){this.result=this.condition(),this.result?T.prototype.onStart.call(this):this.currentInnerSequence=null},t}(ne),oe=function(T){function t(S){var v=T.call(this)||this;return v.ifSequence=null,v.ifSequence=S,v}return i(t,T),t.prototype.onStart=function(){this.ifSequence&&!this.ifSequence.result?T.prototype.onStart.call(this):this.currentInnerSequence=null},t}(ne),ae=function(T){function t(S){var v=T.call(this)||this;return v.breakWhile=!1,v.condition=S,v}return i(t,T),t.prototype.onStart=function(){this.breakWhile=!1,this.condition()?T.prototype.onStart.call(this):this.currentInnerSequence=null},t.prototype.update=function(T){this.currentInnerSequence&&(this.currentInnerSequence.hasFinish()?(this.currentInnerSequence.onFinish(),this.currentInnerSequence=this.currentInnerSequence.next,null==this.currentInnerSequence&&(this.currentInnerSequence=this.startingInnerSequence),this.currentInnerSequence&&this.currentInnerSequence.onStart()):this.currentInnerSequence.update(T))},t.prototype.hasFinish=function(){return this.breakWhile||!this.condition()},t}(ne),se=function(T){function t(S){var v=T.call(this)||this;return v.whileNode=S,v}return i(t,T),t.prototype.onStart=function(){this.whileNode.breakWhile=!0},t}(ee);T.Delay=H,T.ExpireIn=W,T.FollowCurvedPathComponent=R,T.FollowPathComponent=j,T.Interpolate=h,T.Interval=q,T.KeepRotatingComponent=V,T.MoveTransformComponent=E,T.RotateTransformComponent=C,T.ScaleTransformComponent=O,T.SequenceNode=ee,T.ToggleComponent=z,T.TransformSystem=M,T.TriggerBoxShape=P,T.TriggerComponent=$,T.TriggerSphereShape=k,T.TriggerSystem=K,T.addLabel=I,T.addOneTimeTrigger=function(T,S,v){var M=!1,A=!1,E=new Entity;E.addComponent(new Transform({}));var C={};return S.layer&&(C.layer=S.layer),S.triggeredByLayer&&(C.triggeredByLayer=S.triggeredByLayer),S.onCameraEnter&&(C.onCameraEnter=function(){M||(M=!0,S.onCameraEnter()),!M&&S.onCameraEnter||!A&&S.onCameraExit||engine.removeEntity(E)}),S.onCameraExit&&(C.onCameraExit=function(){A||(A=!0,S.onCameraExit()),!M&&S.onCameraEnter||!A&&S.onCameraExit||engine.removeEntity(E)}),S.enableDebug&&(C.enableDebug=S.enableDebug),E.addComponent(new $(T,C)),v&&E.setParent(v),engine.addEntity(E),E},T.addTestCube=function(T,v,M,A,E,C,O){return o(this,void 0,void 0,(function(){var j,R,V;return a(this,(function(z){switch(z.label){case 0:return(j=!O)?[4,!S.isPreviewMode()]:[3,2];case 1:j=z.sent(),z.label=2;case 2:return j?[2]:((R=new Entity).addComponent(new Transform(T)),E?(R.addComponent(new SphereShape),R.getComponent(Transform).scale.setAll(.5)):R.addComponent(new BoxShape),engine.addEntity(R),R.addComponent(new OnPointerDown(v,{hoverText:M||"click",button:ActionButton.POINTER})),A&&((V=new Material).albedoColor=A,R.addComponent(V)),C&&(R.getComponent(BoxShape).withCollisions=!1),M&&I(M,R,!0),[2,R])}}))}))},T.clamp=function(T,S,v){var M=T;return T>v?M=v:T<S&&(M=S),M},T.getEntityWorldPosition=function e(T){var S=T.hasComponent(Transform)?T.getComponent(Transform).position.clone():Vector3.Zero(),v=T.getParent();if(null!=v&&"0"!=v.uuid){if("FirstPersonCameraEntityReference"==v.uuid){var M=Camera.instance.rotation.clone();return Camera.instance.position.clone().add(S.rotate(M))}if("AvatarEntityReference"==v.uuid){var A=Camera.instance.rotation;return M=Quaternion.Euler(0,A.eulerAngles.y,0),Camera.instance.position.clone().add(S.rotate(M)).add(new Vector3(0,-.875,0))}return M=v.hasComponent(Transform)?v.getComponent(Transform).rotation:Quaternion.Identity,e(v).add(S.rotate(M))}return S},T.getEntityWorldRotation=function e(T){var S=T.hasComponent(Transform)?T.getComponent(Transform).rotation.clone():Quaternion.Zero(),v=T.getParent();if(null!=v&&"0"!=v.uuid){if("FirstPersonCameraEntityReference"==v.uuid){var M=Camera.instance.rotation.clone();return S.multiply(M)}return"AvatarEntityReference"==v.uuid?(M=Quaternion.Euler(0,Camera.instance.rotation.eulerAngles.y,0),S.multiply(M)):(M=e(v),S.multiply(M))}return S},T.map=function(T,S,v,M,A){return(T-S)/(v-S)*(A-M)+M},T.sendRequest=function(T,S,v,M){return o(this,void 0,void 0,(function(){var A,E,C;return a(this,(function(O){switch(O.label){case 0:return O.trys.push([0,6,,7]),A={method:S||"GET"},v&&(A.headers=v),M&&(A.body=JSON.stringify(M)),[4,fetch(T,A)];case 1:E=O.sent(),O.label=2;case 2:return O.trys.push([2,4,,5]),[4,E.json()];case 3:return[2,O.sent()];case 4:return O.sent(),[2,E];case 5:return[3,7];case 6:return C=O.sent(),log("error fetching from ",T," : ",C),[3,7];case 7:return[2]}}))}))},T.setTimeout=function(T,S){var v=new Entity;return v.addComponent(new H(T,(function(){S(),engine.removeEntity(v)}))),engine.addEntity(v),v},Object.defineProperty(T,"__esModule",{value:!0})}));var __extends=this&&this.__extends||function(){var extendStatics=function(T,S){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,S){T.__proto__=S}||function(T,S){for(var v in S)Object.prototype.hasOwnProperty.call(S,v)&&(T[v]=S[v])},extendStatics(T,S)};return function(T,S){if("function"!=typeof S&&null!==S)throw new TypeError("Class extends value "+String(S)+" is not a constructor or null");function __(){this.constructor=T}extendStatics(T,S),T.prototype=null===S?Object.create(S):(__.prototype=S.prototype,new __)}}(),__decorate=this&&this.__decorate||function(T,S,v,M){var A,E=arguments.length,C=E<3?S:null===M?M=Object.getOwnPropertyDescriptor(S,v):M;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)C=Reflect.decorate(T,S,v,M);else for(var O=T.length-1;O>=0;O--)(A=T[O])&&(C=(E<3?A(C):E>3?A(S,v,C):A(S,v))||C);return E>3&&C&&Object.defineProperty(S,v,C),C};define("td-core/data/difficulty-data",["require","exports"],(function(T,S){Object.defineProperty(S,"__esModule",{value:!0}),S.DifficultyData=void 0,S.DifficultyData=[{DisplayName:"Very Easy",PlayerHealth:50,EnemyHealthPercent:70,EnemyArmorPercent:70,EnemySpeedPercent:70,PointGainPercent:120},{DisplayName:"Easy",PlayerHealth:40,EnemyHealthPercent:85,EnemyArmorPercent:85,EnemySpeedPercent:85,PointGainPercent:110},{DisplayName:"Standard",PlayerHealth:30,EnemyHealthPercent:100,EnemyArmorPercent:100,EnemySpeedPercent:100,PointGainPercent:100},{DisplayName:"Hard",PlayerHealth:25,EnemyHealthPercent:120,EnemyArmorPercent:120,EnemySpeedPercent:105,PointGainPercent:90},{DisplayName:"Very Hard",PlayerHealth:20,EnemyHealthPercent:140,EnemyArmorPercent:140,EnemySpeedPercent:110,PointGainPercent:80}]})),define("td-core/data/tower-data",["require","exports"],(function(T,S){Object.defineProperty(S,"__esModule",{value:!0}),S.dataTowers=void 0,S.dataTowers=[{Path:"ProjectileStandard",Offset:[0,.3,0],Scale:[2,2,2],ValueAttackIntervalFull:1,ValueAttackIntervalDamage:.3,DisplayName:"Bullet Tower",DisplayDesc:"Balanced capabilities between power, speed, and range",ValueCost:80,ValueAttackDamage:40,ValueAttackPenetration:2,ValueAttackRend:0,ValueAttackRange:2.2,ValueAttackSpeed:.8,Upgrades:[["ValueAttackDamage",10,5,4],["ValueAttackSpeed",20,6,.05],["ValueAttackPenetration",15,5,1]],Attributes:[]},{Path:"ProjectileGatling",Offset:[0,.3,0],Scale:[2,2,2],ValueAttackIntervalFull:1,ValueAttackIntervalDamage:.3,DisplayName:"Gatling Tower",DisplayDesc:"Extremely fast rate of fire and decent armor rend, but lower damage",ValueCost:95,ValueAttackDamage:18,ValueAttackPenetration:0,ValueAttackRend:1,ValueAttackRange:1.5,ValueAttackSpeed:1.5,Upgrades:[["ValueAttackSpeed",20,5,.15],["ValueAttackPenetration",15,5,1],["ValueAttackRend",30,5,1]],Attributes:[]},{Path:"ProjectileSniper",Offset:[0,.3,0],Scale:[2,2,2],ValueAttackIntervalFull:1,ValueAttackIntervalDamage:.3,DisplayName:"Sniper Tower",DisplayDesc:"High damage, range, and armor penetration, but a slow rate of fire",ValueCost:140,ValueAttackDamage:120,ValueAttackPenetration:10,ValueAttackRend:4,ValueAttackRange:3,ValueAttackSpeed:.225,Upgrades:[["ValueAttackDamage",10,5,15],["ValueAttackPenetration",15,5,4],["ValueAttackRange",30,5,.2]],Attributes:[]},{Path:"ElementalFire",Offset:[0,.3,0],Scale:[2,2,2],ValueAttackIntervalFull:1,ValueAttackIntervalDamage:.3,DisplayName:"Flamethrower Tower",DisplayDesc:"Applies a burning effect that deals damage over time",ValueCost:120,ValueAttackDamage:12,ValueAttackPenetration:0,ValueAttackRend:0,ValueAttackRange:1.4,ValueAttackSpeed:1.2,Upgrades:[["ValueAttackDamage",10,5,2],["ValueAttackSpeed",30,6,.1]],Attributes:[[1,2,12]]},{Path:"ElementalAcid",Offset:[0,.3,0],Scale:[2,2,2],ValueAttackIntervalFull:1,ValueAttackIntervalDamage:.3,DisplayName:"Corrosion Tower",DisplayDesc:"Most effective at removing enemy armour",ValueCost:90,ValueAttackDamage:13,ValueAttackPenetration:4,ValueAttackRend:6,ValueAttackRange:1.4,ValueAttackSpeed:.8,Upgrades:[["ValueAttackSpeed",30,5,.02],["ValueAttackRend",30,5,3]],Attributes:[[2,1,8]]},{Path:"ElementalLightning",Offset:[0,.3,0],Scale:[2,2,2],ValueAttackIntervalFull:1,ValueAttackIntervalDamage:.3,DisplayName:"Lightning Tower",DisplayDesc:"Applies a disruptive shock that slows enemies",ValueCost:100,ValueAttackDamage:14,ValueAttackPenetration:0,ValueAttackRend:0,ValueAttackRange:1.6,ValueAttackSpeed:.6,Upgrades:[["ValueAttackDamage",15,5,2],["ValueAttackPenetration",20,5,1]],Attributes:[[0,30,40]]}]})),define("utilities/collections",["require","exports"],(function(T,S){Object.defineProperty(S,"__esModule",{value:!0}),S.Dictionary=S.List=void 0;var v=function(){function List(){this.items=[]}return List.prototype.size=function(){return this.items.length},List.prototype.addItem=function(T){this.items.push(T)},List.prototype.getItem=function(T){return this.items[T]},List.prototype.assignItem=function(T,S){this.items[T]=S},List.prototype.removeItem=function(T){for(var S,v=0;v<this.items.length;){if(v==this.items.length-1)return void this.items.pop();this.items[v]==T&&(S=this.items[v],this.items[v]=this.items[v+1],this.items[v+1]=S),v++}},List}();S.List=v;var M=function(){function Dictionary(){this.items={},this.count=0}return Dictionary.prototype.size=function(){return this.count},Dictionary.prototype.getKeys=function(){var T=[];for(var S in this.items)this.items.hasOwnProperty(S)&&T.push(S);return T},Dictionary.prototype.containsKey=function(T){return this.items.hasOwnProperty(T)},Dictionary.prototype.addItem=function(T,S){this.items.hasOwnProperty(T)||this.count++,this.items[T]=S},Dictionary.prototype.getItem=function(T){return this.items[T]},Dictionary.prototype.removeItem=function(T){var S=this.items[T];return delete this.items[T],this.count--,S},Dictionary.prototype.values=function(){var T=[];for(var S in this.items)this.items.hasOwnProperty(S)&&T.push(this.items[S]);return T},Dictionary}();S.Dictionary=M,S.default=M})),define("td-core/data/enemy-data",["require","exports"],(function(T,S){Object.defineProperty(S,"__esModule",{value:!0}),S.EnemyData=void 0,S.EnemyData=[{ObjectPath:"enemyCrawler",ObjectOffset:[0,.1,0],ObjectScale:[.05,.05,.05],HealthPos:[0,.5,0],HealthScale:[.25,.25,.25],ValueAttackIntervalFull:2,ValueAttackIntervalDamage:1,ValueDeathLength:1.4,ValueDeathLengthScale:2,DisplayName:"Crawler",DisplayDesc:"Small, fast moving unit that travels in large groups",SpawnType:0,SpawnCost:.45,ValueSpeed:.8,ValueHealthBase:10,ValueHealthGrowth:.25,ValueArmourBase:10,ValueArmourGrowth:.25,ValueRewards:1,Attributes:[""]},{ObjectPath:"enemyDrone",ObjectOffset:[0,.5,0],ObjectScale:[.25,.25,.25],HealthPos:[0,1,0],HealthScale:[.25,.25,.25],ValueAttackIntervalFull:2,ValueAttackIntervalDamage:1,ValueDeathLength:1.4,ValueDeathLengthScale:2,DisplayName:"Drone",DisplayDesc:"Agile flying unit",SpawnType:0,SpawnCost:.45,ValueSpeed:.85,ValueHealthBase:30,ValueHealthGrowth:1,ValueArmourBase:0,ValueArmourGrowth:0,ValueRewards:1,Attributes:[""]},{ObjectPath:"enemyStandard",ObjectOffset:[0,.525,0],ObjectScale:[.2,.2,.2],HealthPos:[0,1,0],HealthScale:[.25,.25,.25],ValueAttackIntervalFull:2,ValueAttackIntervalDamage:1,ValueDeathLength:1.4,ValueDeathLengthScale:2,DisplayName:"Defender",DisplayDesc:"Standard unit",SpawnType:1,SpawnCost:1,ValueSpeed:.65,ValueHealthBase:50,ValueHealthGrowth:2.25,ValueArmourBase:5,ValueArmourGrowth:0,ValueRewards:2,Attributes:[""]},{ObjectPath:"enemyBruiser",ObjectOffset:[0,.15,0],ObjectScale:[.25,.25,.25],HealthPos:[0,.75,0],HealthScale:[.25,.25,.25],ValueAttackIntervalFull:2,ValueAttackIntervalDamage:1,ValueDeathLength:1.4,ValueDeathLengthScale:2,DisplayName:"Bruiser",DisplayDesc:"Tanky unit",SpawnType:2,SpawnCost:3,ValueSpeed:.45,ValueHealthBase:120,ValueHealthGrowth:4,ValueArmourBase:14,ValueArmourGrowth:1,ValueRewards:4,Attributes:[""]},{ObjectPath:"enemyBruiser",ObjectOffset:[0,.5,0],ObjectScale:[.25,.25,.25],HealthPos:[0,1,0],HealthScale:[.25,.25,.25],ValueAttackIntervalFull:2,ValueAttackIntervalDamage:1,ValueDeathLength:1.4,ValueDeathLengthScale:2,DisplayName:"Champion",DisplayDesc:"Massive tank unit",SpawnType:3,SpawnCost:30,ValueSpeed:.25,ValueHealthBase:300,ValueHealthGrowth:8,ValueArmourBase:30,ValueArmourGrowth:2.5,ValueRewards:25,Attributes:[""]},{ObjectPath:"enemyBruiser",ObjectOffset:[0,.5,0],ObjectScale:[.25,.25,.25],HealthPos:[0,1,0],HealthScale:[.25,.25,.25],ValueAttackIntervalFull:2,ValueAttackIntervalDamage:1,ValueDeathLength:1.4,ValueDeathLengthScale:2,DisplayName:"Mobile Spawner",DisplayDesc:"Periodically spawns enemies around the unit",SpawnType:3,SpawnCost:50,ValueSpeed:.25,ValueHealthBase:250,ValueHealthGrowth:12,ValueArmourBase:50,ValueArmourGrowth:1,ValueRewards:35,Attributes:[""]}]})),define("td-core/game-states",["require","exports","td-core/data/difficulty-data"],(function(T,S,v){Object.defineProperty(S,"__esModule",{value:!0}),S.GameState=void 0;var M=function(){function GameState(){}return Object.defineProperty(GameState,"MoneyStart",{get:function(){return GameState.moneyStart*v.DifficultyData[GameState.DifficultyCur].PointGainPercent/100},enumerable:!1,configurable:!0}),GameState.debuggingManager=!1,GameState.debuggingPath=!1,GameState.debuggingTower=!1,GameState.debuggingEnemy=!1,GameState.debuggingWave=!1,GameState.stateCur=0,GameState.stateStrings=["Idle","Game Active:\nStart Wave","Game Active:Wave Active","Game Active:\nWave Over","Game Over:\nVictory","Game Over:\nDefeat"],GameState.DifficultyCur=2,GameState.WaveCur=0,GameState.WaveMax=30,GameState.PlayerHealth=0,GameState.PlayerMoney=0,GameState.moneyStart=150,GameState.MoneyRewardWave=50,GameState}();S.GameState=M})),define("td-core/config/pathing-config",["require","exports"],(function(T,S){Object.defineProperty(S,"__esModule",{value:!0}),S.configPathing=S.configSpawners=void 0,S.configSpawners=[{wave:0,actions:[{index:7,state:1},{index:9,state:1}]},{wave:1,actions:[{index:7,state:1},{index:9,state:0}]},{wave:2,actions:[{index:7,state:1},{index:9,state:1}]}],S.configPathing=[{Index:0,Type:2,Target:[],Scale:[1,1,1],Position:[29,0,23],Rotation:[0,0,0]},{Index:1,Type:0,Target:[0],Scale:[1,1,1],Position:[41,0,23],Rotation:[0,0,0]},{Index:2,Type:0,Target:[1],Scale:[1,1,1],Position:[41,0,29],Rotation:[0,0,0]},{Index:3,Type:0,Target:[2],Scale:[1,1,1],Position:[29,0,29],Rotation:[0,0,0]},{Index:4,Type:0,Target:[3],Scale:[1,1,1],Position:[29,0,35],Rotation:[0,0,0]},{Index:5,Type:0,Target:[4],Scale:[1,1,1],Position:[35,0,35],Rotation:[0,0,0]},{Index:6,Type:0,Target:[5],Scale:[1,1,1],Position:[41,0,35],Rotation:[0,0,0]},{Index:7,Type:1,Target:[6],Scale:[1,1,1],Position:[41,0,41],Rotation:[0,0,0]},{Index:8,Type:0,Target:[5],Scale:[1,1,1],Position:[35,0,41],Rotation:[0,0,0]},{Index:9,Type:1,Target:[8],Scale:[1,1,1],Position:[29,0,41],Rotation:[0,0,0]}]})),define("td-core/map-pathing",["require","exports","utilities/collections","td-core/config/pathing-config","td-core/game-states"],(function(T,S,v,M,A){Object.defineProperty(S,"__esModule",{value:!0}),S.Waypoint=S.WaypointManager=void 0;var E=function(T){function WaypointManager(){var S=T.call(this)||this;return S.animKeys=[],S.WaypointList=new v.List,S.WaypointDict=new v.Dictionary,S.SpawnPoints=new v.List,S.spawnPointIndex=0,S.spawnPointIndexCheck=0,S.configIndex=-1,S.distance=0,S.addComponent(new Transform({position:new Vector3(0,0,0),scale:new Vector3(1,1,1),rotation:(new Quaternion).setEuler(0,0,0)})),S}return __extends(WaypointManager,T),Object.defineProperty(WaypointManager,"Instance",{get:function(){return void 0===WaypointManager.instance&&(WaypointManager.instance=new WaypointManager),WaypointManager.instance},enumerable:!1,configurable:!0}),WaypointManager.prototype.GenerateWaypoints=function(){A.GameState.debuggingPath&&log("MAP PATHING: generating waypoint objects...");for(var T=0;T<M.configPathing.length;T++){var S=new C(M.configPathing[T].Index);S.setParent(this),this.WaypointList.addItem(S),this.WaypointDict.addItem(S.Index.toString(),S),1==M.configPathing[T].Type&&this.SpawnPoints.addItem(S)}A.GameState.debuggingPath&&log("MAP PATHING: generated waypoint objects, count: "+this.WaypointList.size())},WaypointManager.prototype.GetSpawnPoint=function(){for(this.spawnPointIndexCheck=this.spawnPointIndex,this.spawnPointIndex++,this.spawnPointIndex>=this.SpawnPoints.size()&&(this.spawnPointIndex=0);this.spawnPointIndex!=this.spawnPointIndexCheck&&1!=this.SpawnPoints.getItem(this.spawnPointIndex).State;)this.spawnPointIndex++,this.spawnPointIndex>=this.SpawnPoints.size()&&(this.spawnPointIndex=0);return this.SpawnPoints.getItem(this.spawnPointIndex)},WaypointManager.prototype.GetNextWaypoint=function(T,S){if(0!=this.WaypointDict.getItem(T.toString()).Target.length){var v=(S+T)%this.WaypointDict.getItem(T.toString()).Target.length;return this.WaypointDict.getItem(this.WaypointDict.getItem(T.toString()).Target[v])}},WaypointManager.prototype.ResetSpawner=function(){for(var T=0;T<this.SpawnPoints.size();T++)this.SpawnPoints.getItem(T).SetSpawnerState(1)},WaypointManager.prototype.ParseSpawnerConfig=function(){this.configIndex=-1;for(var T=0;T<M.configSpawners.length;T++)if(A.GameState.WaveCur==M.configSpawners[T].wave){this.configIndex=T;break}if(-1!=this.configIndex)for(T=0;T<M.configSpawners[this.configIndex].actions.length;T++)this.WaypointDict.getItem(M.configSpawners[this.configIndex].actions[T].index.toString()).SetSpawnerState(M.configSpawners[this.configIndex].actions[T].state)},WaypointManager.prototype.GetRouteDistance=function(T,S){for(this.distance=0,this.waypointPrev=void 0,this.waypointCur=this.WaypointDict.getItem(T.toString());;){if(null==this.waypointCur)return-1;if(this.waypointPrev=this.waypointCur,this.waypointCur=this.GetNextWaypoint(this.waypointPrev.Index,S),null==this.waypointCur)return this.distance;this.distance+=Math.abs(Vector3.Distance(this.waypointPrev.getComponent(Transform).position,this.waypointCur.getComponent(Transform).position))}},WaypointManager}(Entity);S.WaypointManager=E;var C=function(T){function Waypoint(S){var v=T.call(this)||this;v.Index=S,v.State=1,v.Target=[];for(var E=0;E<M.configPathing[v.Index].Target.length;E++)v.Target.push(M.configPathing[v.Index].Target[E].toString());return v.addComponent(new Transform({position:new Vector3(M.configPathing[v.Index].Position[0],M.configPathing[v.Index].Position[1],M.configPathing[v.Index].Position[2]),scale:new Vector3(M.configPathing[v.Index].Scale[0],M.configPathing[v.Index].Scale[1],M.configPathing[v.Index].Scale[2]),rotation:(new Quaternion).setEuler(M.configPathing[v.Index].Rotation[0],M.configPathing[v.Index].Rotation[1],M.configPathing[v.Index].Rotation[2])})),A.GameState.debuggingPath&&(v.addComponent(new BoxShape),v.getComponent(BoxShape).withCollisions=!1),1==M.configPathing[v.Index].Type&&(v.DisplayObject=new Entity,v.DisplayObject.setParent(v),v.DisplayObject.addComponent(new GLTFShape("models/pathingSpawner.glb")),v.animator=v.DisplayObject.addComponent(new Animator),v.animations=[],v.animations.push(new AnimationState("anim_SpawnDisabled",{looping:!0,speed:1})),v.animations.push(new AnimationState("anim_SpawnEnabled",{looping:!0,speed:1})),v.animations.push(new AnimationState("anim_SpawnEndpoint",{looping:!0,speed:1})),v.animator.addClip(v.animations[0]),v.animator.addClip(v.animations[1]),v.animator.addClip(v.animations[2]),v.SetAnimationState(1)),2==M.configPathing[v.Index].Type&&(v.DisplayObject=new Entity,v.DisplayObject.setParent(v),v.DisplayObject.addComponent(new GLTFShape("models/pathingSpawner.glb")),v.animator=v.DisplayObject.addComponent(new Animator),v.animations=[],v.animations.push(new AnimationState("anim_SpawnDisabled",{looping:!0,speed:1})),v.animations.push(new AnimationState("anim_SpawnEnabled",{looping:!0,speed:1})),v.animations.push(new AnimationState("anim_SpawnEndpoint",{looping:!0,speed:1})),v.animator.addClip(v.animations[0]),v.animator.addClip(v.animations[1]),v.animator.addClip(v.animations[2]),v.SetAnimationState(2)),v}return __extends(Waypoint,T),Waypoint.prototype.SetAnimationState=function(T){null!=this.animator&&null!=this.animations&&(this.animations[0].stop(),this.animations[1].stop(),this.animations[2].stop(),this.animations[T].play())},Waypoint.prototype.SetSpawnerState=function(T){this.State=T,this.SetAnimationState(T)},Waypoint}(Entity);S.Waypoint=C})),define("td-core/config/tower-config",["require","exports"],(function(T,S){Object.defineProperty(S,"__esModule",{value:!0}),S.configTower=S.settingTower=void 0,S.settingTower=[{foundationSpacing:[1,1],foundationOffset:[0,0,0],foundationScale:[.5,.5,.5],structureOffset:[0,0,0],structureScale:[1,1,1],gimbalOffset:[0,0,0],gimbalScale:[1,1,1]}],S.configTower=[{GridLocation:[29.5,0,36.5],GridSize:[5,4]},{GridLocation:[36.5,0,36.5],GridSize:[4,4]},{GridLocation:[30.5,0,30.5],GridSize:[10,4]},{GridLocation:[30.5,0,24.5],GridSize:[10,4]}]})),define("td-core/tower-entity",["require","exports","utilities/collections","td-core/config/tower-config","td-core/data/tower-data","@dcl/ecs-scene-utils","td-core/enemy-manager","td-core/game-states"],(function(T,S,v,M,A,E,C,O){Object.defineProperty(S,"__esModule",{value:!0}),S.TowerStructureSystem=S.TowerFrame=S.TowerFoundation=void 0;var j=function(T){function TowerFoundation(S,v,M,A,C){var j=T.call(this)||this;return j.index=S,j.getSelectedTower=v,j.getTowerShape=M,j.addComponent(j.getTowerShape(0,0)),j.addComponent(new Transform({position:new Vector3(0,0,0),scale:new Vector3(0,0,0),rotation:(new Quaternion).setEuler(0,0,0)})),j.triggerShape=new E.TriggerSphereShape,j.triggerComponent=j.addComponent(new E.TriggerComponent(j.triggerShape,{triggeredByLayer:2,onTriggerEnter:function(T){O.GameState.debuggingTower&&log("TOWER FOUNDATION: enemy entity:"+T.Index+" entered foundation trigger, ID:"+S.toString()),A(S,T.Index)},onTriggerExit:function(T){O.GameState.debuggingTower&&log("TOWER FOUNDATION: enemy entity:"+T.Index+" exited foundation trigger, ID:"+S.toString()),C(S,T.Index)}})),j.TowerFrame=new R(j.triggerShape,v,M),j.SetTowerFrame(j.TowerFrame),j}return __extends(TowerFoundation,T),Object.defineProperty(TowerFoundation.prototype,"Index",{get:function(){return this.index},enumerable:!1,configurable:!0}),TowerFoundation.prototype.SetTowerFrame=function(T){this.TowerFrame=T,this.TowerFrame.setParent(this),this.TowerFrame.SetTriggerShape(this.triggerShape),this.TowerFrame.TowerSystem.TowerAnchorTransform=this.getComponent(Transform)},TowerFoundation}(Entity);S.TowerFoundation=j;var R=function(T){function TowerFrame(S,v,A){var E=T.call(this)||this;return E.TowerDef=-1,E.TowerUpgrades=[],E.getSelectedTower=v,E.getTowerShape=A,E.triggerShape=S,E.addComponent(new Transform({position:new Vector3(0,0,0),scale:new Vector3(1,1,1),rotation:(new Quaternion).setEuler(0,0,0)})),E.towerObjStructure=new Entity,E.towerObjStructure.addComponent(E.getTowerShape(0,1)),E.towerObjStructure.addComponent(new Transform({position:new Vector3(M.settingTower[0].structureOffset[0],M.settingTower[0].structureOffset[1],M.settingTower[0].structureOffset[2]),scale:new Vector3(M.settingTower[0].structureScale[0],M.settingTower[0].structureScale[1],M.settingTower[0].structureScale[2]),rotation:(new Quaternion).setEuler(0,0,0)})),E.towerObjStructure.setParent(E),engine.removeEntity(E.towerObjStructure),E.towerObjGimbal=new Entity,E.towerObjGimbal.addComponent(E.getTowerShape(0,2)),E.towerObjGimbal.addComponent(new Transform({position:new Vector3(M.settingTower[0].gimbalOffset[0],M.settingTower[0].gimbalOffset[1],M.settingTower[0].gimbalOffset[2]),scale:new Vector3(M.settingTower[0].gimbalScale[0],M.settingTower[0].gimbalScale[1],M.settingTower[0].gimbalScale[2]),rotation:(new Quaternion).setEuler(0,0,0)})),E.towerObjGimbal.setParent(E),engine.removeEntity(E.towerObjGimbal),E.towerObjFrame=new Entity,E.towerObjFrame.addComponent(new Transform({position:new Vector3(0,0,0),scale:new Vector3(1,1,1),rotation:(new Quaternion).setEuler(0,0,0)})),E.towerObjFrame.setParent(E.towerObjGimbal),engine.removeEntity(E.towerObjFrame),E.rangeIndicator=new Entity,E.rangeIndicator.addComponent(E.getTowerShape(0,3)),E.rangeIndicator.addComponent(new Transform({position:new Vector3(0,.21,0),scale:new Vector3(0,0,0),rotation:(new Quaternion).setEuler(0,0,0)})),E.rangeIndicator.setParent(E),E.TowerSystem=new V(E.getComponent(Transform),E.towerObjGimbal.getComponent(Transform),E.towerObjFrame),E}return __extends(TowerFrame,T),TowerFrame.prototype.ToggleRangeIndicator=function(){this.rangeIndicator.isAddedToEngine()?this.SetRangeIndicator(!1):this.SetRangeIndicator(!0)},TowerFrame.prototype.SetRangeIndicator=function(T){T?this.rangeIndicator.isAddedToEngine()||engine.addEntity(this.rangeIndicator):this.rangeIndicator.isAddedToEngine()&&engine.removeEntity(this.rangeIndicator)},TowerFrame.prototype.SetTriggerShape=function(T){this.triggerShape.radius=0,-1!=this.TowerDef&&(this.triggerShape=T,this.triggerShape.radius=A.dataTowers[this.TowerDef].ValueAttackRange)},TowerFrame.prototype.Initialize=function(){for(this.SetDisplayState(!1),this.TowerDef=-1,engine.removeSystem(this.TowerSystem),this.triggerShape.radius=0,this.rangeIndicator.getComponent(Transform).scale=new Vector3(0,0,0),this.TowerSystem.TowerTarget=void 0;this.TowerSystem.TowerTargets.size()>0;)this.TowerSystem.TowerTargets.removeItem(this.TowerSystem.TowerTargets.getItem(0))},TowerFrame.prototype.SetDisplayState=function(T){T?(this.towerObjStructure.isAddedToEngine()||engine.addEntity(this.towerObjStructure),this.towerObjGimbal.isAddedToEngine()||engine.addEntity(this.towerObjGimbal),this.towerObjFrame.isAddedToEngine()||engine.addEntity(this.towerObjFrame)):(this.towerObjStructure.isAddedToEngine()&&engine.removeEntity(this.towerObjStructure),this.towerObjGimbal.isAddedToEngine()&&engine.removeEntity(this.towerObjGimbal),this.towerObjFrame.isAddedToEngine()&&engine.removeEntity(this.towerObjFrame))},TowerFrame.prototype.SetTower=function(T,S){for(this.TowerDef=T,this.TowerSystem.TowerDef=T,this.SetDisplayState(!0),this.TowerUpgrades=[];this.TowerUpgrades.length<A.dataTowers[this.TowerDef].Upgrades.length;)this.TowerUpgrades.push(0);null!=this.towerObjFrame.hasComponent(GLTFShape)&&this.towerObjFrame.removeComponent(GLTFShape),this.towerObjFrame.addComponent(S),this.towerObjFrame.getComponent(Transform).position=new Vector3(A.dataTowers[this.TowerDef].Offset[0],A.dataTowers[this.TowerDef].Offset[1],A.dataTowers[this.TowerDef].Offset[2]),this.towerObjFrame.getComponent(Transform).scale=new Vector3(A.dataTowers[this.TowerDef].Scale[0],A.dataTowers[this.TowerDef].Scale[1],A.dataTowers[this.TowerDef].Scale[2]),this.triggerShape.radius=A.dataTowers[this.TowerDef].ValueAttackRange,this.rangeIndicator.getComponent(Transform).scale=new Vector3(2.22*A.dataTowers[this.TowerDef].ValueAttackRange,1,2.22*A.dataTowers[this.TowerDef].ValueAttackRange),this.SetRangeIndicator(!1),this.TowerSystem.attackAnimDamagePoint=A.dataTowers[this.TowerDef].ValueAttackIntervalDamage,this.TowerSystem.attackAnimLength=A.dataTowers[this.TowerDef].ValueAttackIntervalFull,this.TowerSystem.attackDamage=A.dataTowers[this.TowerDef].ValueAttackDamage,this.TowerSystem.attackRend=A.dataTowers[this.TowerDef].ValueAttackRend,this.TowerSystem.attackPen=A.dataTowers[this.TowerDef].ValueAttackPenetration,this.TowerSystem.attackRange=A.dataTowers[this.TowerDef].ValueAttackRange,this.TowerSystem.attackPerSecond=A.dataTowers[this.TowerDef].ValueAttackSpeed,this.TowerSystem.attackCooldown=1/this.TowerSystem.attackPerSecond,this.TowerSystem.Reset()},TowerFrame.prototype.ApplyUpgrade=function(T){switch(this.TowerUpgrades[T]++,A.dataTowers[this.TowerDef].Upgrades[T][0]){case"ValueAttackDamage":this.TowerSystem.attackDamage=A.dataTowers[this.TowerDef].ValueAttackDamage+this.TowerUpgrades[T]*+A.dataTowers[this.TowerDef].Upgrades[T][3];break;case"ValueAttackPenetration":this.TowerSystem.attackPen=A.dataTowers[this.TowerDef].ValueAttackPenetration+this.TowerUpgrades[T]*+A.dataTowers[this.TowerDef].Upgrades[T][3];break;case"ValueAttackRend":this.TowerSystem.attackRend=A.dataTowers[this.TowerDef].ValueAttackRend+this.TowerUpgrades[T]*+A.dataTowers[this.TowerDef].Upgrades[T][3];break;case"ValueAttackRange":this.TowerSystem.attackRange=A.dataTowers[this.TowerDef].ValueAttackRange+this.TowerUpgrades[T]*+A.dataTowers[this.TowerDef].Upgrades[T][3];break;case"ValueAttackSpeed":this.TowerSystem.attackPerSecond=A.dataTowers[this.TowerDef].ValueAttackSpeed+this.TowerUpgrades[T]*+A.dataTowers[this.TowerDef].Upgrades[T][3],this.TowerSystem.attackCooldown=1/this.TowerSystem.attackPerSecond,this.TowerSystem.animations[1].speed=this.TowerSystem.attackAnimLength*this.TowerSystem.attackPerSecond}},TowerFrame.prototype.EnemyEnter=function(T){this.TowerSystem.AddTarget(T)},TowerFrame.prototype.EnemyExit=function(T){this.TowerSystem.RemoveTarget(T)},TowerFrame}(Entity);S.TowerFrame=R;var V=function(){function TowerStructureSystem(T,S,M){this.TowerDef=0,this.attackDamage=0,this.attackPen=0,this.attackRend=0,this.attackRange=0,this.attackAnimLength=2,this.attackAnimDamagePoint=1,this.attackPerSecond=0,this.attackCooldown=0,this.TargetingType=0,this.isAttacking=!1,this.attackTimer=[0,0],this.hasDamaged=!1,this.targetTestUnit=void 0,this.targetTestValue=0,this.TowerTarget=void 0,this.TowerTargets=new v.List,this.TowerAnchorTransform=T,this.TowerGimbalTransform=S,this.TowerFrame=M,this.animator=this.TowerFrame.addComponent(new Animator),this.animations=[],this.animations.push(new AnimationState("anim_idle",{looping:!0,speed:.2})),this.animations.push(new AnimationState("anim_attack",{looping:!1,speed:1})),this.animator.addClip(this.animations[0]),this.animator.addClip(this.animations[1]),this.SetAnimationState(0),this.DamageEnemy=this.damageEnemy,this.ApplyEffect=this.applyEffect}return TowerStructureSystem.prototype.SetAnimationState=function(T){this.animations[0].stop(),this.animations[1].stop(),this.animations[T].play()},TowerStructureSystem.prototype.AddTarget=function(T){O.GameState.debuggingTower&&log("TOWER SYSTEM: adding target ID:"+T.toString()),this.TowerTargets.addItem(C.EnemyUnitManager.Instance.enemyDict.getItem(T.toString())),1==this.TowerTargets.size()&&(O.GameState.debuggingTower&&log("TOWER SYSTEM: no previous targets existed, reactivating system..."),this.Reset(),engine.addSystem(this)),O.GameState.debuggingTower&&log("TOWER SYSTEM: new targeting list size = "+this.TowerTargets.size())},TowerStructureSystem.prototype.RemoveTarget=function(T){C.EnemyUnitManager.Instance.enemyDict.getItem(T.toString()).IsAlive&&(O.GameState.debuggingTower&&log("TOWER SYSTEM: removing target ID:"+T.toString()),this.TowerTargets.removeItem(C.EnemyUnitManager.Instance.enemyDict.getItem(T.toString())),this.TowerTarget===C.EnemyUnitManager.Instance.enemyDict.getItem(T.toString())&&this.Reset(),O.GameState.debuggingTower&&log("TOWER SYSTEM: new targeting list size = "+this.TowerTargets.size()))},TowerStructureSystem.prototype.damageEnemy=function(T,S,v,M){log("TOWER SYSTEM: tower callback not set - damage enemy:"+T.toString())},TowerStructureSystem.prototype.applyEffect=function(T,S,v,M){log("TOWER SYSTEM: tower callback not set - apply effect:"+T.toString())},TowerStructureSystem.prototype.update=function(T){if(null!=this.TowerTarget&&(this.TowerGimbalTransform.rotation=Quaternion.LookRotation(this.TowerTarget.getComponent(Transform).position.subtract(this.TowerAnchorTransform.position))),!this.isAttacking&&this.attackTimer[1]<=0&&(this.FindTarget(),null!=this.TowerTarget&&(O.GameState.debuggingTower&&log("TOWER SYSTEM: attack beginning on target"),this.SetAnimationState(1),this.isAttacking=!0,this.hasDamaged=!1,this.attackTimer[0]=this.attackCooldown*(this.attackAnimDamagePoint/this.attackAnimLength),this.attackTimer[1]=this.attackCooldown*((this.attackAnimLength-this.attackAnimDamagePoint)/this.attackAnimLength))),this.isAttacking)if(this.hasDamaged)this.attackTimer[1]-=T,this.attackTimer[1]<=0&&(this.isAttacking=!1);else if(this.attackTimer[0]-=T,this.attackTimer[0]<=0)if(this.hasDamaged=!0,null!=this.TowerTarget){O.GameState.debuggingTower&&log("TOWER SYSTEM: attack completed, attack damage "+this.attackDamage.toString()+" dealt to target "+this.TowerTarget.Index.toString()),this.DamageEnemy(this.TowerTarget.Index,this.attackDamage,this.attackPen,this.attackRend);for(var S=0;S<A.dataTowers[this.TowerDef].Attributes.length;S++)this.ApplyEffect(this.TowerTarget.Index,A.dataTowers[this.TowerDef].Attributes[S][0],A.dataTowers[this.TowerDef].Attributes[S][1],A.dataTowers[this.TowerDef].Attributes[S][2])}else O.GameState.debuggingTower&&log("TOWER SYSTEM: attack completed, no target exists")},TowerStructureSystem.prototype.Reset=function(){O.GameState.debuggingTower&&log("TOWER SYSTEM: system has been reset"),this.TowerTarget=void 0,this.isAttacking=!1,this.hasDamaged=!1,this.attackTimer[0]=1,this.attackTimer[1]=0,this.animations[1].speed=1,this.SetAnimationState(0)},TowerStructureSystem.prototype.TargetDeathCheck=function(T){var S;(null===(S=this.TowerTarget)||void 0===S?void 0:S.Index)==T&&(O.GameState.debuggingTower&&log("TOWER SYSTEM: currently targeted enemy="+T.toString()+" has been killed, reassigning target"),this.TowerTargets.removeItem(this.TowerTarget),this.hasDamaged||this.Reset())},TowerStructureSystem.prototype.FindTarget=function(){var T,S;O.GameState.debuggingTower&&log("TOWER SYSTEM: attempting to find valid target from targeting list, size = "+this.TowerTargets.size().toString());for(var v,M=0;M<this.TowerTargets.size();)(v=this.TowerTargets.getItem(M)).IsAlive?M++:this.TowerTargets.removeItem(v);if(this.TowerTargets.size()<=0)return O.GameState.debuggingTower&&log("TOWER SYSTEM: no valid enemy target found, removing system from engine"),this.Reset(),void engine.removeSystem(this);switch(this.TargetingType){case 0:this.GetTargetDistance();break;case 1:this.GetTargetByHealthValueHighest();break;case 2:this.GetTargetByHealthValueLowest();break;case 3:this.GetTargetByHealthPercentHighest();break;case 4:this.GetTargetByHealthPercentLowest();break;case 5:this.GetTargetByArmourValueHighest();break;case 6:this.GetTargetByArmourValueLowest()}O.GameState.debuggingTower&&log("TOWER SYSTEM: found valid enemy target = "+(null===(T=this.TowerTarget)||void 0===T?void 0:T.Index.toString())+", unit has travelled = "+(null===(S=this.TowerTarget)||void 0===S?void 0:S.unitSystem.distanceTotal.toString()))},TowerStructureSystem.prototype.GetTargetDistance=function(){this.TowerTarget=this.TowerTargets.getItem(0),this.targetTestValue=this.TowerTarget.unitSystem.distanceTotal;for(var T=0;T<this.TowerTargets.size();T++)this.targetTestUnit=this.TowerTargets.getItem(T),this.targetTestValue>this.targetTestUnit.unitSystem.distanceTotal&&(this.TowerTarget=this.targetTestUnit,this.targetTestValue=this.targetTestUnit.unitSystem.distanceTotal)},TowerStructureSystem.prototype.GetTargetByHealthValueHighest=function(){this.TowerTarget=this.TowerTargets.getItem(0),this.targetTestValue=this.TowerTarget.HealthCur;for(var T=0;T<this.TowerTargets.size();T++)this.targetTestUnit=this.TowerTargets.getItem(T),this.targetTestValue<this.targetTestUnit.HealthCur&&(this.TowerTarget=this.targetTestUnit,this.targetTestValue=this.targetTestUnit.HealthCur)},TowerStructureSystem.prototype.GetTargetByHealthValueLowest=function(){this.TowerTarget=this.TowerTargets.getItem(0),this.targetTestValue=this.TowerTarget.HealthCur;for(var T=0;T<this.TowerTargets.size();T++)this.targetTestUnit=this.TowerTargets.getItem(T),this.targetTestValue>this.targetTestUnit.HealthCur&&(this.TowerTarget=this.targetTestUnit,this.targetTestValue=this.targetTestUnit.HealthCur)},TowerStructureSystem.prototype.GetTargetByHealthPercentHighest=function(){this.TowerTarget=this.TowerTargets.getItem(0),this.targetTestValue=this.TowerTarget.HealthCur/this.TowerTarget.HealthMax;for(var T=0;T<this.TowerTargets.size();T++)this.targetTestUnit=this.TowerTargets.getItem(T),this.targetTestValue<this.targetTestUnit.HealthCur/this.targetTestUnit.HealthMax&&(this.TowerTarget=this.targetTestUnit,this.targetTestValue=this.TowerTarget.HealthCur/this.TowerTarget.HealthMax)},TowerStructureSystem.prototype.GetTargetByHealthPercentLowest=function(){this.TowerTarget=this.TowerTargets.getItem(0),this.targetTestValue=this.TowerTarget.HealthCur/this.TowerTarget.HealthMax;for(var T=0;T<this.TowerTargets.size();T++)this.targetTestUnit=this.TowerTargets.getItem(T),this.targetTestValue>this.targetTestUnit.HealthCur/this.targetTestUnit.HealthMax&&(this.TowerTarget=this.targetTestUnit,this.targetTestValue=this.TowerTarget.HealthCur/this.TowerTarget.HealthMax)},TowerStructureSystem.prototype.GetTargetByArmourValueHighest=function(){this.TowerTarget=this.TowerTargets.getItem(0),this.targetTestValue=this.TowerTarget.Armour;for(var T=0;T<this.TowerTargets.size();T++)this.targetTestUnit=this.TowerTargets.getItem(T),this.targetTestValue<this.targetTestUnit.Armour&&(this.TowerTarget=this.targetTestUnit,this.targetTestValue=this.targetTestUnit.Armour)},TowerStructureSystem.prototype.GetTargetByArmourValueLowest=function(){this.TowerTarget=this.TowerTargets.getItem(0),this.targetTestValue=this.TowerTarget.Armour;for(var T=0;T<this.TowerTargets.size();T++)this.targetTestUnit=this.TowerTargets.getItem(T),this.targetTestValue>this.targetTestUnit.Armour&&(this.TowerTarget=this.targetTestUnit,this.targetTestValue=this.targetTestUnit.Armour)},TowerStructureSystem}();S.TowerStructureSystem=V})),define("td-core/enemy-entity",["require","exports","@dcl/ecs-scene-utils","td-core/data/difficulty-data","td-core/data/enemy-data","td-core/game-states","td-core/map-pathing","utilities/collections"],(function(T,S,v,M,A,E,C,O){Object.defineProperty(S,"__esModule",{value:!0}),S.EnemyUnitSystem=S.EnemyUnitObject=void 0;var j=function(T){function EnemyUnitObject(S,M,A,E,C,O,j){var V=T.call(this)||this;return V.IsAlive=!1,V.Type=0,V.HealthCur=0,V.HealthMax=0,V.Armour=0,V.addComponent(new Transform({position:new Vector3(0,0,0),scale:new Vector3(1,1,1),rotation:(new Quaternion).setEuler(0,0,0)})),V.index=S,V.healthBarCur=new Entity,V.healthBarCur.addComponent(M),V.healthBarCur.addComponent(new Transform({position:new Vector3(0,2,0),scale:new Vector3(1,1,1),rotation:(new Quaternion).setEuler(0,0,0)})),V.healthBarCur.setParent(V),V.unitAvatar=new Entity,V.unitAvatar.addComponent(new Transform({position:new Vector3(0,0,0),scale:new Vector3(1,1,1),rotation:(new Quaternion).setEuler(0,0,0)})),V.unitAvatar.setParent(V),V.unitSystem=new R(V.Index,V,V.unitAvatar,E,O,j),V.addComponent(new v.TriggerComponent(A,{layer:2})),V.OnDeath=C,V}return __extends(EnemyUnitObject,T),Object.defineProperty(EnemyUnitObject.prototype,"Index",{get:function(){return this.index},enumerable:!1,configurable:!0}),EnemyUnitObject.CalcHealth=function(T,S){return(A.EnemyData[T].ValueHealthBase+A.EnemyData[T].ValueHealthGrowth*S)*(M.DifficultyData[E.GameState.DifficultyCur].EnemyHealthPercent/100)},EnemyUnitObject.CalcArmour=function(T,S){return(A.EnemyData[T].ValueArmourBase+A.EnemyData[T].ValueArmourGrowth*S)*(M.DifficultyData[E.GameState.DifficultyCur].EnemyArmorPercent/100)},EnemyUnitObject.CalcMoveSpeed=function(T,S){return A.EnemyData[T].ValueSpeed*(M.DifficultyData[E.GameState.DifficultyCur].EnemySpeedPercent/100)},EnemyUnitObject.prototype.Initialize=function(T,S,M){return this.IsAlive=!0,this.Type=T,this.HealthMax=EnemyUnitObject.CalcHealth(T,E.GameState.WaveCur),this.HealthCur=this.HealthMax,this.Armour=EnemyUnitObject.CalcArmour(T,E.GameState.WaveCur),this.unitSystem.SetTarget(C.WaypointManager.Instance.GetSpawnPoint(),!0),this.unitSystem.unitMoveSpeedMod=1,this.unitSystem.unitMoveSpeed=EnemyUnitObject.CalcMoveSpeed(T,E.GameState.WaveCur),this.unitSystem.attackLength=A.EnemyData[T].ValueAttackIntervalFull,this.unitSystem.attackDamagePeriod=A.EnemyData[T].ValueAttackIntervalDamage,E.GameState.debuggingEnemy&&log("Enemy Unit "+this.Index.toString()+": unit initialized, health = "+this.HealthMax.toString()+", armour = "+this.Armour.toString()+", speed = "+this.unitSystem.unitMoveSpeed.toString()),this.healthBarCur.getComponent(Transform).position=new Vector3(A.EnemyData[T].HealthPos[0],A.EnemyData[T].HealthPos[1],A.EnemyData[T].HealthPos[2]),this.healthBarCur.getComponent(Transform).scale=new Vector3(A.EnemyData[T].HealthScale[0],A.EnemyData[T].HealthScale[1],A.EnemyData[T].HealthScale[2]),this.unitAvatar.hasComponent(GLTFShape)&&this.Type!=T&&this.unitAvatar.removeComponent(GLTFShape),this.unitAvatar.hasComponent(GLTFShape)||(this.unitAvatar.addComponent(M),this.unitAvatar.getComponent(Transform).position=new Vector3(A.EnemyData[T].ObjectOffset[0],A.EnemyData[T].ObjectOffset[1],A.EnemyData[T].ObjectOffset[2]),this.unitAvatar.getComponent(Transform).scale=new Vector3(A.EnemyData[T].ObjectScale[0],A.EnemyData[T].ObjectScale[1],A.EnemyData[T].ObjectScale[2])),this.hasComponent(v.Delay)&&this.removeComponent(v.Delay),this},EnemyUnitObject.prototype.ApplyDamage=function(T,S,v){return 0==this.HealthCur?(log("Enemy Unit "+this.Index.toString()+": ERROR attempting to damage already dead enemy, could be a unit clean-up desync"),!0):(this.HealthCur-=T-Math.max(0,this.Armour-S),this.HealthCur<0&&(this.HealthCur=0),this.healthBarCur.getComponent(Transform).scale=new Vector3(this.HealthCur/this.HealthMax*A.EnemyData[this.Type].ObjectScale[0],this.HealthCur/this.HealthMax*A.EnemyData[this.Type].ObjectScale[1],this.HealthCur/this.HealthMax*A.EnemyData[this.Type].ObjectScale[2]),E.GameState.debuggingEnemy&&log("Enemy Unit "+this.Index.toString()+": damage dealt to unit, health remaining = "+this.HealthCur.toString()),0==this.HealthCur?(this.KillUnit(!0),!1):(this.Armour-=v,this.Armour>=0&&(this.Armour=0),!0))},EnemyUnitObject.prototype.KillUnit=function(T){var S=this;this.unitSystem.SetAnimationState(3),this.addComponent(new v.Delay(A.EnemyData[this.Type].ValueDeathLength*(1e3/A.EnemyData[this.Type].ValueDeathLengthScale),(function(){log("Enemy Unit "+S.index.toString()+": death delay completed, unit is being reset"),S.IsAlive=!1,S.SetEngineState(!1)}))),engine.removeSystem(this.unitSystem),this.OnDeath(this.Index,T)},EnemyUnitObject.prototype.SetEngineState=function(T){this.isAddedToEngine()!=T&&(T?(engine.addEntity(this),engine.addSystem(this.unitSystem),this.unitSystem.Initialize(this.Type)):(engine.removeEntity(this),engine.removeSystem(this.unitSystem)))},EnemyUnitObject}(Entity);S.EnemyUnitObject=j;var R=function(){function EnemyUnitSystem(T,S,v,M,A,E){this.seed=-1,this.distanceTotal=0,this.arrived=!1,this.unitMoveSpeedMod=1,this.unitMoveSpeed=.55,this.unitRotSpeed=10,this.isAttacking=!1,this.hasDamaged=!1,this.attackLength=0,this.attackDamagePeriod=0,this.attackTimer=[0,0],this.animations=[],this.activeEffectTicker=0,this.activeEffects=new O.List,this.index=T,this.type=-1,this.unitObject=S,this.unitAvatar=v,this.unitObjectTransform=this.unitObject.getComponent(Transform),this.unitKill=A,this.unitDamage=E,this.onAttack=M}return EnemyUnitSystem.prototype.SetAnimationState=function(T){this.animations[0].stop(),this.animations[1].stop(),this.animations[2].stop(),this.animations[3].stop(),this.animations[T].play()},EnemyUnitSystem.prototype.Initialize=function(T){for(this.type=T,this.unitAvatar.hasComponent(Animator)&&this.unitAvatar.removeComponent(Animator),this.animator=this.unitAvatar.addComponent(new Animator),this.animations=[],this.animations.push(new AnimationState("anim_idle",{looping:!0,speed:1})),this.animations.push(new AnimationState("anim_walk",{looping:!0,speed:1})),this.animations.push(new AnimationState("anim_attack",{looping:!0,speed:1})),this.animations.push(new AnimationState("anim_death",{looping:!0,speed:A.EnemyData[this.type].ValueDeathLengthScale})),this.animator.addClip(this.animations[0]),this.animator.addClip(this.animations[1]),this.animator.addClip(this.animations[2]),this.animator.addClip(this.animations[3]);this.activeEffects.size()>0;)this.activeEffects.removeItem(this.activeEffects.getItem(0));this.activeEffectTicker=EnemyUnitSystem.activeEffectTickerLength},EnemyUnitSystem.prototype.update=function(T){if(this.activeEffects.size()>0&&this.activeEffectTicker<=0&&(this.ProcessEffects(!0,!0),this.activeEffectTicker=EnemyUnitSystem.activeEffectTickerLength),this.arrived||null==this.waypoint||null==this.waypointTransform)this.isAttacking||(this.isAttacking=!0,this.hasDamaged=!1,this.attackTimer[0]=this.attackLength-this.attackDamagePeriod,this.attackTimer[1]=this.attackDamagePeriod,this.SetAnimationState(2)),this.hasDamaged?(this.attackTimer[1]-=T,this.attackTimer[1]<=0&&(this.isAttacking=!1)):(this.attackTimer[0]-=T,this.attackTimer[0]<=0&&(E.GameState.debuggingEnemy&&log("Enemy System "+this.index.toString()+": enemy attacking player base"),this.hasDamaged=!0,3!=A.EnemyData[this.type].SpawnType?this.onAttack(1):this.onAttack(10),this.unitKill(this.index,!1)));else{var S=this.waypointTransform.position.subtract(this.unitObjectTransform.position);if(this.unitObjectTransform.rotation=Quaternion.Slerp(this.unitObjectTransform.rotation,Quaternion.LookRotation(S),T*this.unitRotSpeed),Vector3.DistanceSquared(this.unitObjectTransform.position,this.waypointTransform.position)>=.015){var v=Vector3.Forward().rotate(this.unitObjectTransform.rotation).scale(T*this.unitMoveSpeed*this.unitMoveSpeedMod);this.unitObjectTransform.translate(v),this.distanceTotal-=T*this.unitMoveSpeed}else{var M=C.WaypointManager.Instance.GetNextWaypoint(this.waypoint.Index,this.seed);null!=M?(this.SetAnimationState(1),this.SetTarget(M)):(E.GameState.debuggingEnemy&&log("Enemy System "+this.index.toString()+": enemy unit arrived at final waypoint"),this.arrived=!0)}}},EnemyUnitSystem.prototype.SetTarget=function(T,S){void 0===S&&(S=!1),E.GameState.debuggingEnemy&&log("Enemy System "+this.index.toString()+": unit is now targeting waypoint "+T.Index),this.waypoint=T,this.waypointTransform=this.waypoint.getComponent(Transform),S&&(this.unitObjectTransform.position=new Vector3(this.waypointTransform.position.x,this.waypointTransform.position.y,this.waypointTransform.position.z),this.seed=Math.floor(64*Math.random()+64),this.distanceTotal=C.WaypointManager.Instance.GetRouteDistance(this.waypoint.Index,this.seed)),this.distanceTotal=C.WaypointManager.Instance.GetRouteDistance(this.waypoint.Index,this.seed),this.arrived=!1},EnemyUnitSystem.prototype.AddEffect=function(T,S,v){for(var M=!1,A=0;A<this.activeEffects.size();A++)if(this.activeEffects.getItem(A).Type==T){this.activeEffects.getItem(A).Intialize(T,S,v),M=!0;break}M||this.activeEffects.addItem(new V(T,S,v)),this.ProcessEffects(!1,!1)},EnemyUnitSystem.prototype.ProcessEffects=function(T,S){for(var v=0;v<this.activeEffects.size();v++){switch(this.selectedEffect=this.activeEffects.getItem(v),this.selectedEffect.Type){case 0:this.unitMoveSpeedMod+=this.selectedEffect.Power;break;case 1:S&&this.unitDamage(this.index,this.selectedEffect.Power,50,0);break;case 2:S&&this.unitDamage(this.index,0,0,this.selectedEffect.Power)}T&&(this.selectedEffect.Length--,this.selectedEffect.Length<=0&&(0==this.selectedEffect.Type&&(this.unitMoveSpeedMod=100),this.activeEffects.removeItem(this.selectedEffect)))}},EnemyUnitSystem.activeEffectTickerLength=.25,EnemyUnitSystem}();S.EnemyUnitSystem=R;var V=function(){function EnemyEntityEffect(T,S,v){this.Type=T,this.Power=S,this.Length=v}return EnemyEntityEffect.prototype.Intialize=function(T,S,v){this.Type=T,this.Power=S,this.Length=v},EnemyEntityEffect}()})),define("td-core/enemy-manager",["require","exports","@dcl/ecs-scene-utils","utilities/collections","td-core/data/enemy-data","td-core/enemy-entity","td-core/game-states"],(function(T,S,v,M,A,E,C){Object.defineProperty(S,"__esModule",{value:!0}),S.EnemyUnitManager=void 0;var O=function(T){function EnemyUnitManager(){var S=T.call(this)||this;S.enemySizeMax=1,S.enemySizeCur=0,S.enemySizeRemaining=0,S.enemyList=new M.List,S.enemyDict=new M.Dictionary,S.enemyTypeDict=new M.Dictionary,S.enemyHealthBarShapeCur=new GLTFShape("models/enemy/core/healthDisplayCur.glb"),S.enemyHealthBarShapeMax=new GLTFShape("models/enemy/core/healthDisplayMax.glb"),S.enemyTriggerShape=new v.TriggerBoxShape,S.enemyModelDict=new M.Dictionary,S.iterationIndex=0,S.iterationHalt=0,S.addComponent(new Transform({position:new Vector3(0,0,0),scale:new Vector3(1,1,1),rotation:(new Quaternion).setEuler(0,0,0)}));for(var E=0;E<A.EnemyData.length;E++)S.enemyModelDict.addItem(E.toString(),new GLTFShape("models/enemy/"+A.EnemyData[E].ObjectPath+".glb"));return S.UnitAttack=S.unitAttack,S.UnitDeath=S.unitDeath,S}return __extends(EnemyUnitManager,T),Object.defineProperty(EnemyUnitManager,"Instance",{get:function(){return void 0===EnemyUnitManager.instance&&(EnemyUnitManager.instance=new EnemyUnitManager),EnemyUnitManager.instance},enumerable:!1,configurable:!0}),EnemyUnitManager.prototype.unitAttack=function(T){log("Enemy Manager: callback not set - start wave")},EnemyUnitManager.prototype.unitDeath=function(T,S){log("Enemy Manager: callback not set - unit death:"+T.toString())},EnemyUnitManager.prototype.Initialize=function(){for(C.GameState.debuggingEnemy&&log("Enemy Manager: - initializing...");this.enemyList.size()<this.enemySizeMax;)this.AddEnemyUnit();this.ClearUnits(),C.GameState.debuggingEnemy&&log("Enemy Manager: - initialized!\n\tenemy count: "+this.enemyList.size())},EnemyUnitManager.prototype.AddEnemyUnit=function(){var T=this.enemyList.size(),S=new E.EnemyUnitObject(T,this.enemyHealthBarShapeCur,this.enemyTriggerShape,this.UnitAttack,this.UnitDeath,this.callbackKillUnit,this.callbackDamageUnit);S.setParent(this),this.enemyList.addItem(S),this.enemyDict.addItem(S.Index.toString(),S)},EnemyUnitManager.prototype.GetEnemyUnit=function(){for(this.iterationHalt=this.iterationIndex,this.iterationIndex++,this.iterationIndex>=this.enemyList.size()&&(this.iterationIndex=0);;){if(!this.enemyList.getItem(this.iterationIndex).IsAlive)return this.enemyList.getItem(this.iterationIndex);if(this.iterationIndex==this.iterationHalt)return;this.iterationIndex++,this.iterationIndex>=this.enemyList.size()&&(this.iterationIndex=0)}},EnemyUnitManager.prototype.GetEnemyUnitByIndex=function(T){return this.enemyDict.containsKey(T.toString())?this.enemyDict.getItem(T.toString()):void 0},EnemyUnitManager.prototype.AssignEnemyUnit=function(T,S){C.GameState.debuggingEnemy&&log("Enemy Manager: - assigning new enemy of type: "+T.toString()+"...");var v=this.GetEnemyUnit();if(null!=v)return v.SetEngineState(!1),v.Initialize(T,S,this.enemyModelDict.getItem(T.toString())),this.enemySizeCur++,v.SetEngineState(!0),C.GameState.debuggingEnemy&&log("Enemy Manager: - assigned new enemy!"),v;C.GameState.debuggingEnemy&&log("Enemy Manager: - assignment failed: all units are used.")},EnemyUnitManager.prototype.callbackDamageUnit=function(T,S,v,M){return EnemyUnitManager.Instance.DamageUnit(T,S,v,M)},EnemyUnitManager.prototype.DamageUnit=function(T,S,v,M){return this.enemyDict.getItem(T.toString()).ApplyDamage(S,v,M)},EnemyUnitManager.prototype.callbackApplyEffect=function(T,S,v,M){EnemyUnitManager.Instance.ApplyEffect(T,S,v,M)},EnemyUnitManager.prototype.ApplyEffect=function(T,S,v,M){this.enemyDict.getItem(T.toString()).unitSystem.AddEffect(S,v,M)},EnemyUnitManager.prototype.callbackKillUnit=function(T,S){EnemyUnitManager.Instance.KillUnit(T,S)},EnemyUnitManager.prototype.KillUnit=function(T,S){return this.enemyDict.getItem(T.toString()).KillUnit(S)},EnemyUnitManager.prototype.ClearUnits=function(){for(var T=0;T<this.enemyList.size();T++)this.ClearUnit(T);this.enemySizeCur=0,this.enemySizeRemaining=0},EnemyUnitManager.prototype.ClearUnit=function(T){this.enemyDict.getItem(T.toString()).IsAlive=!1,this.enemyDict.getItem(T.toString()).SetEngineState(!1)},EnemyUnitManager}(Entity);S.EnemyUnitManager=O})),define("td-core/enemy-wave-manager",["require","exports","td-core/game-states","td-core/data/enemy-data"],(function(T,S,v,M){Object.defineProperty(S,"__esModule",{value:!0}),S.EnemyWaveUnit=S.EnemyWave=S.EnemyWaveManager=void 0;var A=function(){function EnemyWaveManager(){for(this.spawnCostBase=8,this.spawnCostGrowth=.75,this.bossInterval=5,this.enemyWaves=[],this.enemyTypes=[[],[],[],[]];this.enemyWaves.length<v.GameState.WaveMax;)this.enemyWaves.push(new EnemyWave);for(var T=0;T<M.EnemyData.length;T++)this.enemyTypes[M.EnemyData[T].SpawnType].push(T)}return Object.defineProperty(EnemyWaveManager,"Instance",{get:function(){return void 0===EnemyWaveManager.instance&&(EnemyWaveManager.instance=new EnemyWaveManager),EnemyWaveManager.instance},enumerable:!1,configurable:!0}),EnemyWaveManager.prototype.GetEnemyWave=function(T){return this.enemyWaves[T]},EnemyWaveManager.prototype.GetEnemyWaveCurrent=function(){return this.enemyWaves[v.GameState.WaveCur]},EnemyWaveManager.prototype.GetEnemyUnitType=function(T,S){return this.enemyWaves[T].enemyUnits[S].enemyIndex},EnemyWaveManager.prototype.GetEnemyUnitCount=function(T,S){return this.enemyWaves[T].enemyUnits[S].enemyCount},EnemyWaveManager.prototype.GenerateWaves=function(){v.GameState.debuggingWave&&log("generating waves for difficulty"+v.GameState.DifficultyCur.toString()+"...");for(var T=0;T<v.GameState.WaveMax;T++){v.GameState.debuggingWave&&log("generating wave "+T.toString()+"...");for(var S=this.spawnCostBase+this.spawnCostGrowth*T,A=Math.floor((this.enemyTypes.length-1)*Math.random()),E=Math.floor(this.enemyTypes[A].length*Math.random()),C=Math.floor(this.enemyTypes[A].length*Math.random());this.enemyWaves[T].enemyUnits.length<2;)this.enemyWaves[T].enemyUnits.push(new EnemyWaveUnit);if(this.enemyWaves[T].enemyUnits[0].enemyIndex=E,this.enemyWaves[T].enemyUnits[0].enemyCount=Math.floor(S/M.EnemyData[A].SpawnCost/2),this.enemyWaves[T].enemyUnits[1].enemyIndex=C,this.enemyWaves[T].enemyUnits[1].enemyCount=Math.floor(S/M.EnemyData[A].SpawnCost/2),1!=T&&(T+1)%this.bossInterval==0&&(A=3,this.enemyWaves[T].enemyUnits[0].enemyIndex=Math.floor(this.enemyTypes[A].length*Math.random()),this.enemyWaves[T].enemyUnits[0].enemyCount=Math.floor(S/M.EnemyData[A].SpawnCost/2)),0==this.enemyWaves[T].enemyUnits[0].enemyCount&&(this.enemyWaves[T].enemyUnits[0].enemyCount=1),0==this.enemyWaves[T].enemyUnits[1].enemyCount&&(this.enemyWaves[T].enemyUnits[1].enemyCount=1),v.GameState.debuggingWave){for(var O="generated wave "+T.toString()+", utility: "+S.toString()+", type: "+A.toString(),j=0;j<this.enemyWaves[T].enemyUnits.length;j++)O+="\n\tunit index: "+this.enemyWaves[T].enemyUnits[j].enemyIndex+", count "+this.enemyWaves[T].enemyUnits[j].enemyCount;log(O)}}v.GameState.debuggingWave&&log("generated waves!")},EnemyWaveManager}();S.EnemyWaveManager=A;var EnemyWave=function(){this.enemyUnits=[]};S.EnemyWave=EnemyWave;var EnemyWaveUnit=function(){this.enemyIndex=0,this.enemyCount=0};S.EnemyWaveUnit=EnemyWaveUnit})),define("td-core/tower-manager",["require","exports","utilities/collections","td-core/config/tower-config","td-core/data/tower-data","td-core/tower-entity","td-core/game-states"],(function(T,S,v,M,A,E,C){Object.defineProperty(S,"__esModule",{value:!0}),S.TowerManager=void 0;var O=function(T){function TowerManager(){var S=T.call(this)||this;S.TowerFoundationList=new v.List,S.TowerFoundationDict=new v.Dictionary,S.TowerShapeFoundation=new GLTFShape("models/tower/core/TowerFoundation.glb"),S.TowerShapeStructure=new GLTFShape("models/tower/core/TowerStructure.glb"),S.TowerShapeGimbal=new GLTFShape("models/tower/core/TowerGimbal.glb"),S.TowerShapeRange=new GLTFShape("models/tower/core/TowerRangeIndicator.glb"),S.TowerShapeFrames=[],S.index=0,S.foundationTemps=[],S.addComponent(new Transform({position:new Vector3(0,0,0),scale:new Vector3(1,1,1),rotation:(new Quaternion).setEuler(0,0,0)})),S.towerMoveMarker=new Entity,S.towerMoveMarker.addComponent(new Transform({position:new Vector3(0,0,0),scale:new Vector3(.5,.5,.5),rotation:(new Quaternion).setEuler(0,0,0)})),S.towerMoveMarker.setParent(S),S.towerMoveMarker.addComponent(new GLTFShape("models/tower/core/TowerStructureSelect.glb")),S.towerMoveMarker.getComponent(GLTFShape).isPointerBlocker=!1,S.towerMoveMarker.getComponent(GLTFShape).withCollisions=!1,engine.removeEntity(S.towerMoveMarker);for(var M=0;M<A.dataTowers.length;M++)S.TowerShapeFrames.push(new GLTFShape("models/tower/"+A.dataTowers[M].Path+".glb"));return S.GetSelectedTowerMove=S.getSelectedTowerMove,S.MoveTower=S.moveTower,S.GetSelectedTower=S.getSelectedTower,S.SelectTower=S.selectTower,S.DamageEnemy=S.damageEnemy,S.ApplyEffect=S.applyEffect,S}return __extends(TowerManager,T),Object.defineProperty(TowerManager,"Instance",{get:function(){return void 0===TowerManager.instance&&(TowerManager.instance=new TowerManager),TowerManager.instance},enumerable:!1,configurable:!0}),TowerManager.prototype.callbackGetTowerShape=function(T,S){return TowerManager.Instance.GetTowerShape(T,S)},TowerManager.prototype.GetTowerShape=function(T,S){if(0==T)switch(S){case 0:return this.TowerShapeFoundation;case 1:return this.TowerShapeStructure;case 2:return this.TowerShapeGimbal;case 3:return this.TowerShapeRange}return this.TowerShapeFrames[S]},TowerManager.prototype.getSelectedTowerMove=function(){log("tower manager callback not set - get selected tower swap")},TowerManager.prototype.moveTower=function(T){log("tower manager callback not set - select tower ("+T.toString()+")")},TowerManager.prototype.getSelectedTower=function(){log("tower manager callback not set - get selected tower")},TowerManager.prototype.selectTower=function(T){log("tower manager callback not set - select tower ("+T.toString()+")")},TowerManager.prototype.damageEnemy=function(T,S,v,M){log("tower manager callback not set - damage enemy ("+T.toString()+")")},TowerManager.prototype.applyEffect=function(T,S,v,M){log("tower manager callback not set - apply effect:"+T.toString())},TowerManager.prototype.getIndex=function(){return this.index++},TowerManager.prototype.GenerateTowerFoundations=function(){var T=this;C.GameState.debuggingTower&&log("generating tower foundation objects...");for(var S=0;S<M.configTower.length;S++)for(var v=0;v<M.configTower[S].GridSize[0];v++)for(var _loop_1=function(){var C=S,j=v,R=O,V=new E.TowerFoundation(A.getIndex(),A.getSelectedTower,A.callbackGetTowerShape,A.TowerRangeEnemyEnter,A.TowerRangeEnemyExit);V.setParent(A),V.getComponent(Transform).position=new Vector3(M.settingTower[0].foundationOffset[0]+M.configTower[C].GridLocation[0]+M.settingTower[0].foundationSpacing[0]*j,M.settingTower[0].foundationOffset[1]+M.configTower[C].GridLocation[1],M.settingTower[0].foundationOffset[2]+M.configTower[C].GridLocation[2]+M.settingTower[0].foundationSpacing[1]*R),V.getComponent(Transform).scale=new Vector3(M.settingTower[0].foundationScale[0],M.settingTower[0].foundationScale[1],M.settingTower[0].foundationScale[2]),A.TowerFoundationList.addItem(V),A.TowerFoundationDict.addItem(V.Index.toString(),V),V.addComponent(new OnPointerDown((function(S){1==S.buttonId?T.SelectTower(V.Index):2==S.buttonId&&T.MoveTower(V.Index)}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"[E] Edit Tower\n[F] Move Tower",distance:16})),V.TowerFrame.TowerSystem.DamageEnemy=A.DamageEnemy,V.TowerFrame.TowerSystem.ApplyEffect=A.ApplyEffect},A=this,O=0;O<M.configTower[S].GridSize[1];O++)_loop_1();C.GameState.debuggingTower&&log("generated tower foundation objects, count: "+this.TowerFoundationList.size())},TowerManager.prototype.SetTowerMoveMarker=function(T){var S=this.TowerFoundationDict.getItem(T.toString());null!=S?(this.towerMoveMarker.isAddedToEngine()||engine.addEntity(this.towerMoveMarker),this.towerMoveMarker.getComponent(Transform).position=new Vector3(S.getComponent(Transform).position.x,S.getComponent(Transform).position.y,S.getComponent(Transform).position.z)):this.towerMoveMarker.isAddedToEngine()&&engine.removeEntity(this.towerMoveMarker)},TowerManager.prototype.SetTowerMoveMarkerState=function(T){T?this.towerMoveMarker.isAddedToEngine()||engine.addEntity(this.towerMoveMarker):this.towerMoveMarker.isAddedToEngine()&&engine.removeEntity(this.towerMoveMarker)},TowerManager.prototype.MoveTowerObject=function(T,S){this.foundationTemps=[this.TowerFoundationDict.getItem(T.toString()),this.TowerFoundationDict.getItem(S.toString())],this.foundationSwap=this.foundationTemps[0].TowerFrame,this.foundationTemps[0].SetTowerFrame(this.foundationTemps[1].TowerFrame),this.foundationTemps[1].SetTowerFrame(this.foundationSwap)},TowerManager.prototype.BuildTower=function(T,S){C.GameState.debuggingTower&&log("Tower Manager: building tower "+S.toString()+" on foundation "+T.toString()),this.TowerFoundationDict.getItem(T.toString()).TowerFrame.SetTower(S,this.TowerShapeFrames[S])},TowerManager.prototype.ClearTowers=function(){for(var T=0;T<this.TowerFoundationList.size();T++)this.ClearTower(T)},TowerManager.prototype.ClearTower=function(T,S){void 0===S&&(S=!1),S&&(C.GameState.PlayerMoney+=A.dataTowers[this.TowerFoundationList.getItem(T).TowerFrame.TowerDef].ValueCost),this.TowerFoundationList.getItem(T).TowerFrame.Initialize()},TowerManager.prototype.TowerRangeEnemyEnter=function(T,S){TowerManager.Instance.TowerFoundationDict.getItem(T.toString()).TowerFrame.EnemyEnter(S)},TowerManager.prototype.TowerRangeEnemyExit=function(T,S){TowerManager.Instance.TowerFoundationDict.getItem(T.toString()).TowerFrame.EnemyExit(S)},TowerManager.prototype.TargetDeathCheck=function(T){for(var S=0;S<this.TowerFoundationList.size();S++)this.TowerFoundationList.getItem(S).TowerFrame.TowerSystem.TargetDeathCheck(T)},TowerManager}(Entity);S.TowerManager=O})),define("utilities/menu-group-2D",["require","exports","utilities/collections"],(function(T,S,v){Object.defineProperty(S,"__esModule",{value:!0}),S.menuTutorialText=S.MenuObject2D=S.MenuGroup2D=void 0;var M=function(){function MenuGroup2D(){this.menuToggleState=0,null==T.canvas&&(T.canvas=new UICanvas),this.groupParent=new UIContainerRect(T.canvas),this.menuList=new v.List,this.menuDict=new v.Dictionary}var T;return T=MenuGroup2D,MenuGroup2D.prototype.ToggleMenuState=function(){this.SetMenuState(!this.groupParent.visible)},MenuGroup2D.prototype.SetMenuState=function(T){this.groupParent.visible=T},MenuGroup2D.prototype.AddMenuObject=function(T,S){var v;void 0===S&&(S=""),(v=""!=S?new A(this.groupParent,T,this.menuDict.getItem(S).rect):new A(this.groupParent,T)).rect.isPointerBlocker=!0,this.menuList.addItem(v),this.menuDict.addItem(T,v)},MenuGroup2D.prototype.GetMenuObject=function(T){return this.menuDict.getItem(T)},MenuGroup2D.prototype.GetMenuObjectText=function(T,S){return this.menuDict.getItem(T).GetText(S)},MenuGroup2D.prototype.AdjustMenuObject=function(T,S,v){switch(S){case 0:this.menuDict.getItem(T).rect.positionX=v.x,this.menuDict.getItem(T).rect.positionY=v.y;break;case 1:this.menuDict.getItem(T).rect.width=v.x,this.menuDict.getItem(T).rect.height=v.y;break;case 2:switch(Math.floor(v.x)){case 0:this.menuDict.getItem(T).rect.hAlign="left";break;case 1:this.menuDict.getItem(T).rect.hAlign="center";break;case 2:this.menuDict.getItem(T).rect.hAlign="right"}switch(Math.floor(v.y)){case 0:this.menuDict.getItem(T).rect.vAlign="top";break;case 1:this.menuDict.getItem(T).rect.vAlign="center";break;case 2:this.menuDict.getItem(T).rect.vAlign="bottom"}}},MenuGroup2D.prototype.AdjustMenuColour=function(T,S){this.menuDict.getItem(T).rect.color=S},MenuGroup2D.prototype.AddMenuText=function(T,S,v){this.menuDict.getItem(T).AddText(S,v)},MenuGroup2D.prototype.SetMenuText=function(T,S,v){this.menuDict.getItem(T).ChangeText(S,v)},MenuGroup2D.prototype.AdjustTextObject=function(T,S,v,M){this.menuDict.getItem(T).AdjustText(S,v,M)},MenuGroup2D.prototype.AdjustTextDisplay=function(T,S,v,M){this.menuDict.getItem(T).AdjustTextDisplay(S,v,M)},MenuGroup2D.prototype.AddImageObject=function(T,S,v,M,A){void 0===A&&(A=!0),this.menuDict.getItem(T).AddImage(S,v,M,A)},MenuGroup2D.prototype.AdjustImageObject=function(T,S,v,M,A,E){void 0===E&&(E=!1),this.menuDict.getItem(T).AdjustImage(S,v,M,A,E)},MenuGroup2D.prototype.GetMenuImageObject=function(T,S){return this.menuDict.getItem(T).GetImage(S)},MenuGroup2D.canvas=void 0,T=__decorate([Component("MenuGroup2D")],MenuGroup2D)}();S.MenuGroup2D=M;var A=function(){function MenuObject2D(T,S,M){void 0===M&&(M=void 0),this.rect=null==M?new UIContainerRect(T):new UIContainerRect(M),this.rect.color=new Color4(.5,.5,.5,1),this.Name=S,this.textList=new v.List,this.textDict=new v.Dictionary,this.imageList=new v.List,this.imageDict=new v.Dictionary}return MenuObject2D.prototype.AddText=function(T,S){var v=new UIText(this.rect);v.isPointerBlocker=!1,v.textWrapping=!0,v.width=this.rect.width,v.height=this.rect.height,v.color=Color4.Black(),v.hAlign="center",v.vAlign="center",v.hTextAlign="center",v.vTextAlign="center",v.fontSize=24,v.value=S,this.textList.addItem(v),this.textDict.addItem(T,v)},MenuObject2D.prototype.GetText=function(T){return this.textDict.getItem(T)},MenuObject2D.prototype.AdjustText=function(T,S,v){switch(S){case 0:this.textDict.getItem(T).positionX=v.x,this.textDict.getItem(T).positionY=v.y;break;case 1:this.textDict.getItem(T).width=v.x,this.textDict.getItem(T).height=v.y;break;case 2:switch(Math.floor(v.x)){case 0:this.textDict.getItem(T).hAlign="left";break;case 1:this.textDict.getItem(T).hAlign="center";break;case 2:this.textDict.getItem(T).hAlign="right"}switch(Math.floor(v.y)){case 0:this.textDict.getItem(T).vAlign="top";break;case 1:this.textDict.getItem(T).vAlign="center";break;case 2:this.textDict.getItem(T).vAlign="bottom"}break;case 3:switch(Math.floor(v.x)){case 0:this.textDict.getItem(T).hTextAlign="left";break;case 1:this.textDict.getItem(T).hTextAlign="center";break;case 2:this.textDict.getItem(T).hTextAlign="right"}switch(Math.floor(v.y)){case 0:this.textDict.getItem(T).vTextAlign="top";break;case 1:this.textDict.getItem(T).vTextAlign="center";break;case 2:this.textDict.getItem(T).vTextAlign="bottom"}}},MenuObject2D.prototype.AdjustTextDisplay=function(T,S,v){0===S&&(this.textDict.getItem(T).fontSize=v)},MenuObject2D.prototype.ChangeText=function(T,S){this.textDict.getItem(T).value=S},MenuObject2D.prototype.AddImage=function(T,S,v,M){var A=new UIImage(this.rect,E.getImageSource(S));A.isPointerBlocker=!0,this.rect.visible=M,A.sourceLeft=E.getImageLocation(S,v,0),A.sourceTop=E.getImageLocation(S,v,1),A.sourceWidth=E.getImageSize(S,v,0),A.sourceHeight=E.getImageSize(S,v,1),A.width=E.getImageSize(S,v,0),A.height=E.getImageSize(S,v,1),A.positionX=0,A.positionY=0,A.hAlign="center",A.vAlign="center",this.imageList.addItem(A),this.imageDict.addItem(T,A)},MenuObject2D.prototype.AdjustImage=function(T,S,v,M,A){switch(v){case 0:this.imageDict.getItem(T).positionX=M.x,this.imageDict.getItem(T).positionY=M.y;break;case 1:this.imageDict.getItem(T).width=M.x,this.imageDict.getItem(T).height=M.y;break;case 2:switch(Math.floor(M.x)){case 0:this.imageDict.getItem(T).hAlign="left";break;case 1:this.imageDict.getItem(T).hAlign="center";break;case 2:this.imageDict.getItem(T).hAlign="right"}switch(Math.floor(M.y)){case 0:this.imageDict.getItem(T).vAlign="top";break;case 1:this.imageDict.getItem(T).vAlign="center";break;case 2:this.imageDict.getItem(T).vAlign="bottom"}break;case 3:this.imageDict.getItem(T).width=E.sourceSizes[S][Math.floor(M.x)][0]*M.y,this.imageDict.getItem(T).height=E.sourceSizes[S][Math.floor(M.x)][1]*M.y,A&&(this.rect.width=E.sourceSizes[S][Math.floor(M.x)][0]*M.y,this.rect.height=E.sourceSizes[S][Math.floor(M.x)][1]*M.y)}},MenuObject2D.prototype.GetImage=function(T){return this.imageDict.getItem(T)},__decorate([Component("MenuObject2D")],MenuObject2D)}();S.MenuObject2D=A;var E=function(){function menuGroup2DReference(){}return menuGroup2DReference.getImageSource=function(T){return menuGroup2DReference.imageSources[T]},menuGroup2DReference.getImageLocation=function(T,S,v){return menuGroup2DReference.sourceLocations[T][S][v]},menuGroup2DReference.getImageSize=function(T,S,v){return menuGroup2DReference.sourceSizes[T][menuGroup2DReference.sourceTypes[T][S]][v]},menuGroup2DReference.imageSources=[new Texture("images/menuDebugging.png"),new Texture("images/menuSpliceSheet.png"),new Texture("images/uiGameHeaderCore.png"),new Texture("images/uiGameHeaderEnemy.png")],menuGroup2DReference.sourceLocations=[[[0,0]],[[0,500],[0,600],[750,600],[1050,600],[1050,0],[0,0],[0,200],[0,300],[0,400],[750,200],[1050,200],[750,300],[1050,300],[750,400],[1050,400],[1050,500],[1200,500],[1200,600]],[[0,0]],[[0,0]]],menuGroup2DReference.sourceTypes=[[0],[1,2,3,4,5,0,2,2,2,3,3,3,3,3,3,4,4,4],[0],[0]],menuGroup2DReference.sourceSizes=[[[680,480]],[[1050,200],[1050,100],[750,100],[300,100],[150,100],[300,200]],[[1170,305]],[[1170,305]]],menuGroup2DReference}(),C=function(){function menuTutorialText(){}return menuTutorialText.TextHeader=["About This Module","How To Play"],menuTutorialText.TextDesc=["text unavailable","text unavailable"],menuTutorialText}();S.menuTutorialText=C})),define("utilities/menu-group-3D",["require","exports","utilities/collections"],(function(T,S,v){Object.defineProperty(S,"__esModule",{value:!0}),S.MenuObject3D=S.MenuGroup3D=void 0;var M=function(){function MenuGroup3D(){this.object_locations=["","models/utilities/Menu3D_Panel_Square.glb","models/utilities/Menu3D_Panel_Long.glb","models/utilities/Menu3D_Button_Square.glb","models/utilities/Menu3D_Button_Long.glb","models/utilities/Menu3D_Button_Narrow.glb"],this.textColour=Color3.Black(),this.groupParent=new Entity,this.groupParent.addComponent(new Transform({position:new Vector3(0,0,0),scale:new Vector3(1,1,1),rotation:(new Quaternion).setEuler(0,0,0)})),this.menuList=new v.List,this.menuDict=new v.Dictionary}return MenuGroup3D.prototype.SetMenuState=function(T){T?engine.addEntity(this.groupParent):engine.removeEntity(this.groupParent)},MenuGroup3D.prototype.AdjustMenuParent=function(T,S){switch(T){case 0:this.groupParent.getComponent(Transform).position=S;break;case 1:this.groupParent.getComponent(Transform).scale=S;break;case 2:this.groupParent.getComponent(Transform).rotation=(new Quaternion).setEuler(S.x,S.y,S.z)}},MenuGroup3D.prototype.AddMenuObject=function(T,S,v){void 0===v&&(v="");var M=new A(this.object_locations[S],T);""!=v?M.setParent(this.GetMenuObject(v)):M.setParent(this.groupParent),this.menuList.addItem(M),this.menuDict.addItem(T,M)},MenuGroup3D.prototype.GetMenuObject=function(T){return this.menuDict.getItem(T)},MenuGroup3D.prototype.GetMenuObjectText=function(T,S){return this.menuDict.getItem(T).GetTextObject(S)},MenuGroup3D.prototype.AdjustMenuObject=function(T,S,v){switch(S){case 0:this.menuDict.getItem(T).getComponent(Transform).position=v;break;case 1:this.menuDict.getItem(T).getComponent(Transform).scale=v;break;case 2:this.menuDict.getItem(T).getComponent(Transform).rotation=(new Quaternion).setEuler(v.x,v.y,v.z)}},MenuGroup3D.prototype.AddMenuText=function(T,S,v){this.menuDict.getItem(T).AddTextObject(S,v),this.menuDict.getItem(T).GetTextObject(S).getComponent(TextShape).width=0,this.menuDict.getItem(T).GetTextObject(S).getComponent(TextShape).height=0,this.menuDict.getItem(T).GetTextObject(S).getComponent(TextShape).textWrapping=!1,this.menuDict.getItem(T).GetTextObject(S).getComponent(TextShape).color=this.textColour},MenuGroup3D.prototype.SetMenuText=function(T,S,v){this.menuDict.getItem(T).ChangeText(S,v)},MenuGroup3D.prototype.AdjustTextObject=function(T,S,v,M){this.menuDict.getItem(T).AdjustTextObject(S,v,M)},MenuGroup3D.prototype.AdjustTextDisplay=function(T,S,v,M){this.menuDict.getItem(T).AdjustTextDisplay(S,v,M)},MenuGroup3D.prototype.SetColour=function(T){this.textColour=T;for(var S=0;S<this.menuList.size();S++)for(var v=0;v<this.menuList.getItem(S).textList.size();v++)this.menuList.getItem(S).textList.getItem(v).getComponent(TextShape).color=this.textColour},__decorate([Component("MenuGroup3D")],MenuGroup3D)}();S.MenuGroup3D=M;var A=function(T){function MenuObject3D(S,M){var A=T.call(this)||this;return A.addComponent(new Transform({position:new Vector3(0,0,0),scale:new Vector3(1,1,1),rotation:(new Quaternion).setEuler(0,0,0)})),""!=S&&A.addComponent(new GLTFShape(S)),A.Name=M,A.textList=new v.List,A.textDict=new v.Dictionary,A}return __extends(MenuObject3D,T),MenuObject3D.prototype.SetObjectState=function(T){T?this.isAddedToEngine()||engine.addEntity(this):this.isAddedToEngine()&&engine.removeEntity(this)},MenuObject3D.prototype.GetTextObject=function(T){return this.textDict.getItem(T)},MenuObject3D.prototype.AddTextObject=function(T,S){var v=new Entity;v.addComponent(new Transform({position:new Vector3(0,0,0),scale:new Vector3(1,1,1),rotation:(new Quaternion).setEuler(0,0,0)})),v.setParent(this),v.addComponent(new TextShape(S)),v.getComponent(TextShape).color=Color3.Black(),v.getComponent(TextShape).fontSize=9,this.textList.addItem(v),this.textDict.addItem(T,v)},MenuObject3D.prototype.AdjustTextObject=function(T,S,v){switch(S){case 0:this.textDict.getItem(T).getComponent(Transform).position=v;break;case 1:this.textDict.getItem(T).getComponent(Transform).scale=v;break;case 2:this.textDict.getItem(T).getComponent(Transform).rotation=(new Quaternion).setEuler(v.x,v.y,v.z)}},MenuObject3D.prototype.AdjustTextDisplay=function(T,S,v){switch(S){case 0:this.textDict.getItem(T).getComponent(TextShape).fontSize=v;break;case 1:switch(v){case 0:this.textDict.getItem(T).getComponent(TextShape).hTextAlign="left";break;case 1:this.textDict.getItem(T).getComponent(TextShape).hTextAlign="center";break;case 2:this.textDict.getItem(T).getComponent(TextShape).hTextAlign="right"}break;case 2:switch(v){case 0:this.textDict.getItem(T).getComponent(TextShape).vTextAlign="top";break;case 1:this.textDict.getItem(T).getComponent(TextShape).vTextAlign="center";break;case 2:this.textDict.getItem(T).getComponent(TextShape).vTextAlign="bottom"}break;case 3:this.textDict.getItem(T).getComponent(TextShape).lineSpacing=v.toString()}},MenuObject3D.prototype.ChangeText=function(T,S){this.textDict.getItem(T).getComponent(TextShape).value=S},__decorate([Component("MenuObject3D")],MenuObject3D)}(Entity);S.MenuObject3D=A})),define("td-core/game-menu",["require","exports","utilities/menu-group-2D","utilities/menu-group-3D","td-core/data/difficulty-data","td-core/enemy-wave-manager","td-core/enemy-manager","td-core/enemy-entity","td-core/data/enemy-data","td-core/data/tower-data","td-core/game-states"],(function(T,S,v,M,A,E,C,O,j,R,V){Object.defineProperty(S,"__esModule",{value:!0}),S.GameMenu=void 0;var z=function(){function GameMenu(){this.SetDifficulty=this.setDifficulty,this.GameReset=this.gameReset,this.GameStart=this.gameStart,this.WaveStart=this.waveStart,this.towerDefinitionIndex=0,this.TowerBuild=this.towerBuild,this.TowerDeconstruct=this.towerDeconstruct,this.targetTypeStrings=["FURTHEST DOWN LANE","HIGHEST HEALTH VALUE","LOWEST HEALTH VALUE","HIGHEST HEALTH %","LOWEST HEALTH %","HIGHEST ARMOUR VALUE","LOWEST ARMOUR VALUE"],this.stringsSceneNames=["TD Factory","TD Shipyard","TD Neon City"],this.stringsSceneURLs=["//","//","//"],this.stringsCreators=["Jacko","CG-KING","TheCryptoTrader69","Ottonamas","Jetrolee","DemiDesign","Emilie","Finegrapgh"],this.menuGroupHUD=new v.MenuGroup2D,this.menuHUDSetup2D(),this.menuGroupMainMenu=new M.MenuGroup3D,this.menuGroupMainMenu.SetColour(new Color3(1,0,1)),this.menuGroupMainMenu.AdjustMenuParent(0,new Vector3(44,0,32)),this.menuGroupMainMenu.AdjustMenuParent(2,new Vector3(0,90,0)),this.menuMainSetup(),this.menuGroupTower=new M.MenuGroup3D,this.menuGroupTower.SetColour(new Color3(1,0,1)),this.menuGroupTower.AdjustMenuParent(0,new Vector3(8,0,8)),this.menuTowerSetup(),this.menuGroupSceneInfo=new M.MenuGroup3D,this.menuGroupSceneInfo.SetColour(new Color3(1,0,1)),this.menuGroupSceneInfo.AdjustMenuParent(0,new Vector3(20,0,20)),this.menuGroupSceneInfo.AdjustMenuParent(2,new Vector3(0,0,0)),this.menuTutorialSetup()}return Object.defineProperty(GameMenu,"Instance",{get:function(){return void 0===GameMenu.instance&&(GameMenu.instance=new GameMenu),GameMenu.instance},enumerable:!1,configurable:!0}),GameMenu.prototype.menuHUDSetup2D=function(){this.menuGroupHUD.groupParent.width=500,this.menuGroupHUD.groupParent.height=0,this.menuGroupHUD.groupParent.positionY=73,this.menuGroupHUD.groupParent.vAlign="top",this.menuGroupHUD.groupParent.hAlign="center",this.menuGroupHUD.AddMenuObject("hudEnemy"),this.menuGroupHUD.AdjustMenuObject("hudEnemy",0,new Vector2(0,0)),this.menuGroupHUD.AdjustMenuObject("hudEnemy",1,new Vector2(500,150)),this.menuGroupHUD.AdjustMenuObject("hudEnemy",2,new Vector2(1,0)),this.menuGroupHUD.AdjustMenuColour("hudEnemy",new Color4(.2,.2,.2,0)),this.menuGroupHUD.AddImageObject("hudEnemy","imgEnemy",3,0,!0),this.menuGroupHUD.AdjustImageObject("hudEnemy","imgEnemy",2,1,new Vector2(0,0)),this.menuGroupHUD.AdjustImageObject("hudEnemy","imgEnemy",2,2,new Vector2(1,0)),this.menuGroupHUD.AdjustImageObject("hudEnemy","imgEnemy",2,3,new Vector2(0,.35),!1),this.menuGroupHUD.AddMenuText("hudEnemy","TextEnemy","####"),this.menuGroupHUD.AdjustTextDisplay("hudEnemy","TextEnemy",0,18),this.menuGroupHUD.AdjustTextObject("hudEnemy","TextEnemy",0,new Vector2(32,-81)),this.menuGroupHUD.AdjustTextObject("hudEnemy","TextEnemy",1,new Vector2(80,0)),this.menuGroupHUD.AdjustTextObject("hudEnemy","TextEnemy",2,new Vector2(1,0)),this.menuGroupHUD.AdjustTextObject("hudEnemy","TextEnemy",3,new Vector2(2,1)),this.menuGroupHUD.AddMenuObject("hudMain"),this.menuGroupHUD.AdjustMenuObject("hudMain",0,new Vector2(0,0)),this.menuGroupHUD.AdjustMenuObject("hudMain",1,new Vector2(500,150)),this.menuGroupHUD.AdjustMenuObject("hudMain",2,new Vector2(1,0)),this.menuGroupHUD.AdjustMenuColour("hudMain",new Color4(.2,.2,.2,0)),this.menuGroupHUD.AddImageObject("hudMain","imgMain",2,0,!0),this.menuGroupHUD.AdjustImageObject("hudMain","imgMain",2,1,new Vector2(0,0)),this.menuGroupHUD.AdjustImageObject("hudMain","imgMain",2,2,new Vector2(1,0)),this.menuGroupHUD.AdjustImageObject("hudMain","imgMain",2,3,new Vector2(0,.35),!1),this.menuGroupHUD.AddMenuText("hudMain","TextWaves","###"),this.menuGroupHUD.AdjustTextDisplay("hudMain","TextWaves",0,18),this.menuGroupHUD.AdjustTextObject("hudMain","TextWaves",0,new Vector2(17,-16)),this.menuGroupHUD.AdjustTextObject("hudMain","TextWaves",1,new Vector2(80,0)),this.menuGroupHUD.AdjustTextObject("hudMain","TextWaves",2,new Vector2(1,0)),this.menuGroupHUD.AdjustTextObject("hudMain","TextWaves",3,new Vector2(2,1)),this.menuGroupHUD.AddMenuText("hudMain","TextLife","####"),this.menuGroupHUD.AdjustTextDisplay("hudMain","TextLife",0,18),this.menuGroupHUD.AdjustTextObject("hudMain","TextLife",0,new Vector2(-37,-44)),this.menuGroupHUD.AdjustTextObject("hudMain","TextLife",1,new Vector2(60,0)),this.menuGroupHUD.AdjustTextObject("hudMain","TextLife",2,new Vector2(1,0)),this.menuGroupHUD.AdjustTextObject("hudMain","TextLife",3,new Vector2(2,1)),this.menuGroupHUD.AddMenuText("hudMain","TextMoney","####"),this.menuGroupHUD.AdjustTextDisplay("hudMain","TextMoney",0,18),this.menuGroupHUD.AdjustTextObject("hudMain","TextMoney",0,new Vector2(120,-44)),this.menuGroupHUD.AdjustTextObject("hudMain","TextMoney",1,new Vector2(60,0)),this.menuGroupHUD.AdjustTextObject("hudMain","TextMoney",2,new Vector2(1,0)),this.menuGroupHUD.AdjustTextObject("hudMain","TextMoney",3,new Vector2(2,1))},GameMenu.prototype.setDifficulty=function(T){log("game menu callback not set - set difficulty "+T.toString())},GameMenu.prototype.gameReset=function(){log("game menu callback not set - reset game")},GameMenu.prototype.gameStart=function(){log("game menu callback not set - start game")},GameMenu.prototype.waveStart=function(){log("game menu callback not set - start wave")},GameMenu.prototype.menuMainSetup=function(){var T=this;this.menuGroupMainMenu.AddMenuObject("menuOffset",0),this.menuGroupMainMenu.AdjustMenuObject("menuOffset",0,new Vector3(0,1.5,-1)),this.menuGroupMainMenu.AdjustMenuObject("menuOffset",1,new Vector3(1,1,1)),this.menuGroupMainMenu.AddMenuObject("menuMainFrame",2,"menuOffset"),this.menuGroupMainMenu.AdjustMenuObject("menuMainFrame",0,new Vector3(0,0,0)),this.menuGroupMainMenu.AdjustMenuObject("menuMainFrame",1,new Vector3(1,1,1)),this.menuGroupMainMenu.AddMenuObject("menuMainInfo",0,"menuOffset"),this.menuGroupMainMenu.AdjustMenuObject("menuMainInfo",0,new Vector3(0,0,.0125)),this.menuGroupMainMenu.AdjustMenuObject("menuMainInfo",1,new Vector3(1,1,1)),this.menuGroupMainMenu.AddMenuText("menuMainInfo","menuLabel","DCL TOWER DEFENCE"),this.menuGroupMainMenu.AdjustTextObject("menuMainInfo","menuLabel",0,new Vector3(0,.65,0)),this.menuGroupMainMenu.AdjustTextObject("menuMainInfo","menuLabel",1,new Vector3(.4,.4,1)),this.menuGroupMainMenu.AdjustTextDisplay("menuMainInfo","menuLabel",0,5),this.menuGroupMainMenu.AddMenuObject("gameStartContainer",0,"menuOffset"),this.menuGroupMainMenu.AdjustMenuObject("gameStartContainer",0,new Vector3(0,0,0)),this.menuGroupMainMenu.AdjustMenuObject("gameStartContainer",1,new Vector3(1,1,1)),this.menuGroupMainMenu.AddMenuText("gameStartContainer","menuLabel","SELECT GAME DIFFICULTY"),this.menuGroupMainMenu.AdjustTextObject("gameStartContainer","menuLabel",0,new Vector3(0,.3,0)),this.menuGroupMainMenu.AdjustTextObject("gameStartContainer","menuLabel",1,new Vector3(.4,.4,1)),this.menuGroupMainMenu.AdjustTextDisplay("gameStartContainer","menuLabel",0,4),this.menuGroupMainMenu.AddMenuObject("interactDifficultyDisplay",4,"gameStartContainer"),this.menuGroupMainMenu.AdjustMenuObject("interactDifficultyDisplay",0,new Vector3(0,.05,0)),this.menuGroupMainMenu.AdjustMenuObject("interactDifficultyDisplay",1,new Vector3(.2,.15,.15)),this.menuGroupMainMenu.AddMenuText("interactDifficultyDisplay","buttonLabel","DIFFICULTY"),this.menuGroupMainMenu.AdjustTextObject("interactDifficultyDisplay","buttonLabel",0,new Vector3(0,0,-.04)),this.menuGroupMainMenu.AdjustTextObject("interactDifficultyDisplay","buttonLabel",1,new Vector3(.75,1,1)),this.menuGroupMainMenu.AdjustTextDisplay("interactDifficultyDisplay","buttonLabel",0,5),this.menuGroupMainMenu.AddMenuObject("interactDifficultyDec",3,"gameStartContainer"),this.menuGroupMainMenu.AdjustMenuObject("interactDifficultyDec",0,new Vector3(-.45,.05,0)),this.menuGroupMainMenu.AdjustMenuObject("interactDifficultyDec",1,new Vector3(.15,.15,.15)),this.menuGroupMainMenu.GetMenuObject("interactDifficultyDec").addComponent(new OnPointerDown((function(S){T.SetDifficulty(V.GameState.DifficultyCur-1)}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"INCREASE DIFFICULTY",distance:16})),this.menuGroupMainMenu.AddMenuText("interactDifficultyDec","buttonLabel","PREV"),this.menuGroupMainMenu.AdjustTextObject("interactDifficultyDec","buttonLabel",0,new Vector3(0,0,-.04)),this.menuGroupMainMenu.AdjustTextObject("interactDifficultyDec","buttonLabel",1,new Vector3(1,1,1)),this.menuGroupMainMenu.AdjustTextDisplay("interactDifficultyDec","buttonLabel",0,5),this.menuGroupMainMenu.AddMenuObject("interactDifficultyInc",3,"gameStartContainer"),this.menuGroupMainMenu.AdjustMenuObject("interactDifficultyInc",0,new Vector3(.45,.05,0)),this.menuGroupMainMenu.AdjustMenuObject("interactDifficultyInc",1,new Vector3(.15,.15,.15)),this.menuGroupMainMenu.GetMenuObject("interactDifficultyInc").addComponent(new OnPointerDown((function(S){T.SetDifficulty(V.GameState.DifficultyCur+1)}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"INCREASE DIFFICULTY",distance:16})),this.menuGroupMainMenu.AddMenuText("interactDifficultyInc","buttonLabel","NEXT"),this.menuGroupMainMenu.AdjustTextObject("interactDifficultyInc","buttonLabel",0,new Vector3(0,0,-.04)),this.menuGroupMainMenu.AdjustTextObject("interactDifficultyInc","buttonLabel",1,new Vector3(1,1,1)),this.menuGroupMainMenu.AdjustTextDisplay("interactDifficultyInc","buttonLabel",0,5),this.menuGroupMainMenu.AddMenuObject("interactGameStart",4,"gameStartContainer"),this.menuGroupMainMenu.AdjustMenuObject("interactGameStart",0,new Vector3(0,-.55,0)),this.menuGroupMainMenu.AdjustMenuObject("interactGameStart",1,new Vector3(.15,.15,.15)),this.menuGroupMainMenu.GetMenuObject("interactGameStart").addComponent(new OnPointerDown((function(S){T.SetTowerMenuState(!1),T.GameStart()}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"START GAME",distance:16})),this.menuGroupMainMenu.AddMenuText("interactGameStart","buttonLabel","START"),this.menuGroupMainMenu.AdjustTextObject("interactGameStart","buttonLabel",0,new Vector3(0,0,-.04)),this.menuGroupMainMenu.AdjustTextObject("interactGameStart","buttonLabel",1,new Vector3(1,1,1)),this.menuGroupMainMenu.AdjustTextDisplay("interactGameStart","buttonLabel",0,5),this.menuGroupMainMenu.AddMenuObject("waveBreakContainer",0,"menuOffset"),this.menuGroupMainMenu.AdjustMenuObject("waveBreakContainer",0,new Vector3(0,0,0)),this.menuGroupMainMenu.AdjustMenuObject("waveBreakContainer",1,new Vector3(1,1,1)),this.menuGroupMainMenu.AddMenuText("waveBreakContainer","menuLabel","PREPARE YOUR DEFENCES!"),this.menuGroupMainMenu.AdjustTextObject("waveBreakContainer","menuLabel",0,new Vector3(0,.4,0)),this.menuGroupMainMenu.AdjustTextObject("waveBreakContainer","menuLabel",1,new Vector3(.4,.4,1)),this.menuGroupMainMenu.AdjustTextDisplay("waveBreakContainer","menuLabel",0,4),this.menuGroupMainMenu.AddMenuText("waveBreakContainer","waveLabel","WAVE: 000 / 000"),this.menuGroupMainMenu.AdjustTextObject("waveBreakContainer","waveLabel",0,new Vector3(-.6,.2,-.04)),this.menuGroupMainMenu.AdjustTextObject("waveBreakContainer","waveLabel",1,new Vector3(.75,.75,1)),this.menuGroupMainMenu.AdjustTextDisplay("waveBreakContainer","waveLabel",0,2),this.menuGroupMainMenu.AdjustTextDisplay("waveBreakContainer","waveLabel",1,0),this.menuGroupMainMenu.AddMenuText("waveBreakContainer","enemyNameLabel0","<ENEMY NAME>"),this.menuGroupMainMenu.AdjustTextObject("waveBreakContainer","enemyNameLabel0",0,new Vector3(-.7,.025,-.04)),this.menuGroupMainMenu.AdjustTextObject("waveBreakContainer","enemyNameLabel0",1,new Vector3(1,1,1)),this.menuGroupMainMenu.AdjustTextDisplay("waveBreakContainer","enemyNameLabel0",0,1),this.menuGroupMainMenu.AddMenuText("waveBreakContainer","enemyStatLabel0","COUNT: 000\nHEALTH: 000\nARMOUR: 000"),this.menuGroupMainMenu.AdjustTextObject("waveBreakContainer","enemyStatLabel0",0,new Vector3(-1,-.15,-.04)),this.menuGroupMainMenu.AdjustTextObject("waveBreakContainer","enemyStatLabel0",1,new Vector3(.65,.65,1)),this.menuGroupMainMenu.AdjustTextDisplay("waveBreakContainer","enemyStatLabel0",0,1),this.menuGroupMainMenu.AdjustTextDisplay("waveBreakContainer","enemyStatLabel0",1,0),this.menuGroupMainMenu.AddMenuText("waveBreakContainer","enemyNameLabel1","<ENEMY NAME>"),this.menuGroupMainMenu.AdjustTextObject("waveBreakContainer","enemyNameLabel1",0,new Vector3(.7,.025,-.04)),this.menuGroupMainMenu.AdjustTextObject("waveBreakContainer","enemyNameLabel1",1,new Vector3(1,1,1)),this.menuGroupMainMenu.AdjustTextDisplay("waveBreakContainer","enemyNameLabel1",0,1),this.menuGroupMainMenu.AddMenuText("waveBreakContainer","enemyStatLabel1","COUNT: 000\nHEALTH: 000\nARMOUR: 000"),this.menuGroupMainMenu.AdjustTextObject("waveBreakContainer","enemyStatLabel1",0,new Vector3(.4,-.15,-.04)),this.menuGroupMainMenu.AdjustTextObject("waveBreakContainer","enemyStatLabel1",1,new Vector3(.65,.65,1)),this.menuGroupMainMenu.AdjustTextDisplay("waveBreakContainer","enemyStatLabel1",0,1),this.menuGroupMainMenu.AdjustTextDisplay("waveBreakContainer","enemyStatLabel1",1,0),this.menuGroupMainMenu.AddMenuObject("interactWaveStart",4,"waveBreakContainer"),this.menuGroupMainMenu.AdjustMenuObject("interactWaveStart",0,new Vector3(-.25,-.55,0)),this.menuGroupMainMenu.AdjustMenuObject("interactWaveStart",1,new Vector3(.15,.15,.15)),this.menuGroupMainMenu.GetMenuObject("interactWaveStart").addComponent(new OnPointerDown((function(S){T.SetTowerMenuState(!1),T.WaveStart()}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"START WAVE",distance:16})),this.menuGroupMainMenu.AddMenuText("interactWaveStart","buttonLabel","START\nWAVE"),this.menuGroupMainMenu.AdjustTextObject("interactWaveStart","buttonLabel",0,new Vector3(0,0,-.04)),this.menuGroupMainMenu.AdjustTextObject("interactWaveStart","buttonLabel",1,new Vector3(1,1,1)),this.menuGroupMainMenu.AdjustTextDisplay("interactWaveStart","buttonLabel",0,5),this.menuGroupMainMenu.AddMenuObject("interactGameReset",4,"waveBreakContainer"),this.menuGroupMainMenu.AdjustMenuObject("interactGameReset",0,new Vector3(.25,-.55,0)),this.menuGroupMainMenu.AdjustMenuObject("interactGameReset",1,new Vector3(.15,.15,.15)),this.menuGroupMainMenu.GetMenuObject("interactGameReset").addComponent(new OnPointerDown((function(S){T.SetTowerMenuState(!1),T.GameReset()}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"RESET GAME",distance:16})),this.menuGroupMainMenu.AddMenuText("interactGameReset","buttonLabel","RESET\nGAME"),this.menuGroupMainMenu.AdjustTextObject("interactGameReset","buttonLabel",0,new Vector3(0,0,-.04)),this.menuGroupMainMenu.AdjustTextObject("interactGameReset","buttonLabel",1,new Vector3(1,1,1)),this.menuGroupMainMenu.AdjustTextDisplay("interactGameReset","buttonLabel",0,5),this.menuGroupMainMenu.AddMenuObject("waveOnGoingContainer",0,"menuOffset"),this.menuGroupMainMenu.AdjustMenuObject("waveOnGoingContainer",0,new Vector3(0,0,0)),this.menuGroupMainMenu.AdjustMenuObject("waveOnGoingContainer",1,new Vector3(1,1,1)),this.menuGroupMainMenu.AddMenuText("waveOnGoingContainer","menuLabel","DEFEND YOUR BASE!"),this.menuGroupMainMenu.AdjustTextObject("waveOnGoingContainer","menuLabel",0,new Vector3(0,.4,0)),this.menuGroupMainMenu.AdjustTextObject("waveOnGoingContainer","menuLabel",1,new Vector3(.4,.4,1)),this.menuGroupMainMenu.AdjustTextDisplay("waveOnGoingContainer","menuLabel",0,4),this.menuGroupMainMenu.AddMenuText("waveOnGoingContainer","waveLabel","WAVE: 000 / 000"),this.menuGroupMainMenu.AdjustTextObject("waveOnGoingContainer","waveLabel",0,new Vector3(-.6,.2,-.04)),this.menuGroupMainMenu.AdjustTextObject("waveOnGoingContainer","waveLabel",1,new Vector3(.75,.75,1)),this.menuGroupMainMenu.AdjustTextDisplay("waveOnGoingContainer","waveLabel",0,2),this.menuGroupMainMenu.AdjustTextDisplay("waveOnGoingContainer","waveLabel",1,0),this.menuGroupMainMenu.AddMenuText("waveOnGoingContainer","enemyCountLabel","ENEMIES: 000"),this.menuGroupMainMenu.AdjustTextObject("waveOnGoingContainer","enemyCountLabel",0,new Vector3(-.6,.025,-.04)),this.menuGroupMainMenu.AdjustTextObject("waveOnGoingContainer","enemyCountLabel",1,new Vector3(.75,.75,1)),this.menuGroupMainMenu.AdjustTextDisplay("waveOnGoingContainer","enemyCountLabel",0,2),this.menuGroupMainMenu.AdjustTextDisplay("waveOnGoingContainer","enemyCountLabel",1,0),this.menuGroupMainMenu.AddMenuObject("interactGameReset",4,"waveOnGoingContainer"),this.menuGroupMainMenu.AdjustMenuObject("interactGameReset",0,new Vector3(.25,-.55,0)),this.menuGroupMainMenu.AdjustMenuObject("interactGameReset",1,new Vector3(.15,.15,.15)),this.menuGroupMainMenu.GetMenuObject("interactGameReset").addComponent(new OnPointerDown((function(S){T.SetTowerMenuState(!1),T.GameReset()}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"RESET GAME",distance:16})),this.menuGroupMainMenu.AddMenuText("interactGameReset","buttonLabel","RESET\nGAME"),this.menuGroupMainMenu.AdjustTextObject("interactGameReset","buttonLabel",0,new Vector3(0,0,-.04)),this.menuGroupMainMenu.AdjustTextObject("interactGameReset","buttonLabel",1,new Vector3(1,1,1)),this.menuGroupMainMenu.AdjustTextDisplay("interactGameReset","buttonLabel",0,5),this.menuGroupMainMenu.AddMenuObject("gameEndContainer",0,"menuOffset"),this.menuGroupMainMenu.AdjustMenuObject("gameEndContainer",0,new Vector3(0,0,0)),this.menuGroupMainMenu.AdjustMenuObject("gameEndContainer",1,new Vector3(1,1,1)),this.menuGroupMainMenu.AddMenuText("gameEndContainer","menuLabel","GAME OVER: ######!"),this.menuGroupMainMenu.AdjustTextObject("gameEndContainer","menuLabel",0,new Vector3(0,.4,0)),this.menuGroupMainMenu.AdjustTextObject("gameEndContainer","menuLabel",1,new Vector3(.4,.4,1)),this.menuGroupMainMenu.AdjustTextDisplay("gameEndContainer","menuLabel",0,4),this.menuGroupMainMenu.AddMenuText("gameEndContainer","waveLabel","WAVES COMPLETED: 000 / 000"),this.menuGroupMainMenu.AdjustTextObject("gameEndContainer","waveLabel",0,new Vector3(-.6,.2,-.04)),this.menuGroupMainMenu.AdjustTextObject("gameEndContainer","waveLabel",1,new Vector3(.75,.75,1)),this.menuGroupMainMenu.AdjustTextDisplay("gameEndContainer","waveLabel",0,2),this.menuGroupMainMenu.AdjustTextDisplay("gameEndContainer","waveLabel",1,0),this.menuGroupMainMenu.AddMenuText("gameEndContainer","enemyCountLabel","ENEMIES SLAIN: 000"),this.menuGroupMainMenu.AdjustTextObject("gameEndContainer","enemyCountLabel",0,new Vector3(-.6,.025,-.04)),this.menuGroupMainMenu.AdjustTextObject("gameEndContainer","enemyCountLabel",1,new Vector3(.75,.75,1)),this.menuGroupMainMenu.AdjustTextDisplay("gameEndContainer","enemyCountLabel",0,2),this.menuGroupMainMenu.AdjustTextDisplay("gameEndContainer","enemyCountLabel",1,0),this.menuGroupMainMenu.AddMenuObject("interactGameReset",4,"gameEndContainer"),this.menuGroupMainMenu.AdjustMenuObject("interactGameReset",0,new Vector3(.25,-.55,0)),this.menuGroupMainMenu.AdjustMenuObject("interactGameReset",1,new Vector3(.15,.15,.15)),this.menuGroupMainMenu.GetMenuObject("interactGameReset").addComponent(new OnPointerDown((function(S){T.SetTowerMenuState(!1),T.GameReset()}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"RESET GAME",distance:16})),this.menuGroupMainMenu.AddMenuText("interactGameReset","buttonLabel","RESET\nGAME"),this.menuGroupMainMenu.AdjustTextObject("interactGameReset","buttonLabel",0,new Vector3(0,0,-.04)),this.menuGroupMainMenu.AdjustTextObject("interactGameReset","buttonLabel",1,new Vector3(1,1,1)),this.menuGroupMainMenu.AdjustTextDisplay("interactGameReset","buttonLabel",0,5),this.menuGroupMainMenu.SetMenuState(!0)},GameMenu.prototype.updateDifficulty=function(){this.menuGroupMainMenu.SetMenuText("interactDifficultyDisplay","buttonLabel",A.DifficultyData[V.GameState.DifficultyCur].DisplayName)},GameMenu.prototype.updateLifeCount=function(){this.menuGroupHUD.SetMenuText("hudMain","TextLife",V.GameState.PlayerHealth.toString())},GameMenu.prototype.updateMoneyCount=function(){this.menuGroupHUD.SetMenuText("hudMain","TextMoney",V.GameState.PlayerMoney.toString())},GameMenu.prototype.UpdateWaveCount=function(){this.menuGroupHUD.SetMenuText("hudMain","TextWaves",V.GameState.WaveCur.toString()),this.menuGroupMainMenu.SetMenuText("waveOnGoingContainer","waveLabel","WAVE: "+V.GameState.WaveCur.toString()+" / "+V.GameState.WaveMax.toString())},GameMenu.prototype.UpdateEnemyCount=function(){this.menuGroupHUD.SetMenuText("hudEnemy","TextEnemy",C.EnemyUnitManager.Instance.enemySizeCur.toString()),this.menuGroupMainMenu.SetMenuText("waveOnGoingContainer","enemyCountLabel","ENEMIES: "+C.EnemyUnitManager.Instance.enemySizeCur)},GameMenu.prototype.UpdateEnemyTypes=function(){E.EnemyWaveManager.Instance.GetEnemyUnitType(V.GameState.WaveCur,0)==E.EnemyWaveManager.Instance.GetEnemyUnitType(V.GameState.WaveCur,1)?(this.menuGroupMainMenu.SetMenuText("waveBreakContainer","enemyNameLabel0",j.EnemyData[E.EnemyWaveManager.Instance.GetEnemyUnitType(V.GameState.WaveCur,0)].DisplayName),this.menuGroupMainMenu.SetMenuText("waveBreakContainer","enemyStatLabel0","COUNT: "+(E.EnemyWaveManager.Instance.GetEnemyUnitCount(V.GameState.WaveCur,0)+E.EnemyWaveManager.Instance.GetEnemyUnitCount(V.GameState.WaveCur,1))+"\nHEALTH: "+O.EnemyUnitObject.CalcHealth(E.EnemyWaveManager.Instance.GetEnemyUnitType(V.GameState.WaveCur,0),V.GameState.WaveCur)+"\nARMOUR: "+O.EnemyUnitObject.CalcArmour(E.EnemyWaveManager.Instance.GetEnemyUnitType(V.GameState.WaveCur,0),V.GameState.WaveCur)),this.menuGroupMainMenu.SetMenuText("waveBreakContainer","enemyNameLabel1",""),this.menuGroupMainMenu.SetMenuText("waveBreakContainer","enemyStatLabel1","")):(this.menuGroupMainMenu.SetMenuText("waveBreakContainer","enemyNameLabel0",j.EnemyData[E.EnemyWaveManager.Instance.GetEnemyUnitType(V.GameState.WaveCur,0)].DisplayName),this.menuGroupMainMenu.SetMenuText("waveBreakContainer","enemyStatLabel0","COUNT: "+E.EnemyWaveManager.Instance.GetEnemyUnitCount(V.GameState.WaveCur,0)+"\nHEALTH: "+O.EnemyUnitObject.CalcHealth(E.EnemyWaveManager.Instance.GetEnemyUnitType(V.GameState.WaveCur,0),V.GameState.WaveCur)+"\nARMOUR: "+O.EnemyUnitObject.CalcArmour(E.EnemyWaveManager.Instance.GetEnemyUnitType(V.GameState.WaveCur,0),V.GameState.WaveCur)),this.menuGroupMainMenu.SetMenuText("waveBreakContainer","enemyNameLabel1",j.EnemyData[E.EnemyWaveManager.Instance.GetEnemyUnitType(V.GameState.WaveCur,1)].DisplayName),this.menuGroupMainMenu.SetMenuText("waveBreakContainer","enemyStatLabel1","COUNT: "+E.EnemyWaveManager.Instance.GetEnemyUnitCount(V.GameState.WaveCur,1)+"\nHEALTH: "+O.EnemyUnitObject.CalcHealth(E.EnemyWaveManager.Instance.GetEnemyUnitType(V.GameState.WaveCur,1),V.GameState.WaveCur)+"\nARMOUR: "+O.EnemyUnitObject.CalcArmour(E.EnemyWaveManager.Instance.GetEnemyUnitType(V.GameState.WaveCur,1),V.GameState.WaveCur)))},GameMenu.prototype.UpdateMainMenuState=function(T,S){switch(void 0===S&&(S=!0),this.menuGroupHUD.GetMenuObject("hudEnemy").rect.visible=!1,this.menuGroupMainMenu.GetMenuObject("gameStartContainer").SetObjectState(!1),this.menuGroupMainMenu.GetMenuObject("waveBreakContainer").SetObjectState(!1),this.menuGroupMainMenu.GetMenuObject("waveOnGoingContainer").SetObjectState(!1),this.menuGroupMainMenu.GetMenuObject("gameEndContainer").SetObjectState(!1),T){case 0:this.menuGroupMainMenu.GetMenuObject("gameStartContainer").SetObjectState(!0);break;case 1:this.menuGroupMainMenu.SetMenuText("waveBreakContainer","waveLabel","WAVE: "+(V.GameState.WaveCur+1)+" / "+V.GameState.WaveMax.toString()),this.UpdateEnemyTypes(),this.menuGroupMainMenu.GetMenuObject("waveBreakContainer").SetObjectState(!0);break;case 2:this.menuGroupMainMenu.SetMenuText("waveOnGoingContainer","waveLabel","WAVE: "+(V.GameState.WaveCur+1)+" / "+V.GameState.WaveMax.toString()),GameMenu.Instance.UpdateEnemyCount(),this.menuGroupHUD.GetMenuObject("hudEnemy").rect.visible=!0,this.menuGroupMainMenu.GetMenuObject("waveOnGoingContainer").SetObjectState(!0);break;case 3:this.menuGroupMainMenu.GetMenuObject("gameEndContainer").SetObjectState(!0),S?this.menuGroupMainMenu.SetMenuText("gameEndContainer","menuLabel","GAME OVER: VICTORY!"):this.menuGroupMainMenu.SetMenuText("gameEndContainer","menuLabel","GAME OVER: DEFEAT!")}},GameMenu.prototype.towerBuild=function(){log("game menu callback not set - build tower")},GameMenu.prototype.towerDeconstruct=function(){log("game menu callback not set - deconstruct tower")},GameMenu.prototype.menuTowerSetup=function(){var T=this;this.menuGroupTower.AddMenuObject("menuOffset",0),this.menuGroupTower.AdjustMenuObject("menuOffset",0,new Vector3(0,1.5,-1)),this.menuGroupTower.AdjustMenuObject("menuOffset",1,new Vector3(1,1,1)),this.menuGroupTower.AddMenuObject("selectionInfoFrame",2,"menuOffset"),this.menuGroupTower.AdjustMenuObject("selectionInfoFrame",0,new Vector3(0,0,0)),this.menuGroupTower.AdjustMenuObject("selectionInfoFrame",1,new Vector3(1,1,1)),this.menuGroupTower.AddMenuObject("selectionInfo",0,"menuOffset"),this.menuGroupTower.AdjustMenuObject("selectionInfo",0,new Vector3(0,0,.0125)),this.menuGroupTower.AdjustMenuObject("selectionInfo",1,new Vector3(1,1,1)),this.menuGroupTower.AddMenuText("selectionInfo","menuLabel","MENU LABEL"),this.menuGroupTower.AdjustTextObject("selectionInfo","menuLabel",0,new Vector3(0,.65,0)),this.menuGroupTower.AdjustTextObject("selectionInfo","menuLabel",1,new Vector3(.4,.4,1)),this.menuGroupTower.AdjustTextDisplay("selectionInfo","menuLabel",0,4),this.menuGroupTower.AddMenuObject("interactDeconstruct",5,"selectionInfo"),this.menuGroupTower.AdjustMenuObject("interactDeconstruct",0,new Vector3(-1,.65,0)),this.menuGroupTower.AdjustMenuObject("interactDeconstruct",1,new Vector3(.15,.15,.15)),this.menuGroupTower.GetMenuObject("interactDeconstruct").addComponent(new OnPointerDown((function(S){T.TowerDeconstruct()}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"Deconstruct Tower",distance:16})),this.menuGroupTower.AddMenuText("interactDeconstruct","buttonLabel","REFUND"),this.menuGroupTower.AdjustTextObject("interactDeconstruct","buttonLabel",0,new Vector3(0,0,-.04)),this.menuGroupTower.AdjustTextObject("interactDeconstruct","buttonLabel",1,new Vector3(1,1,1)),this.menuGroupTower.AdjustTextDisplay("interactDeconstruct","buttonLabel",0,5),this.menuGroupTower.AddMenuObject("interactToggleRange",5,"selectionInfo"),this.menuGroupTower.AdjustMenuObject("interactToggleRange",0,new Vector3(1,.5,0)),this.menuGroupTower.AdjustMenuObject("interactToggleRange",1,new Vector3(.15,.15,.15)),this.menuGroupTower.GetMenuObject("interactToggleRange").addComponent(new OnPointerDown((function(S){null!=T.selectedTowerFoundation&&-1!=T.selectedTowerFoundation.TowerFrame.TowerDef&&T.selectedTowerFoundation.TowerFrame.ToggleRangeIndicator()}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"Toggle Range Visibility",distance:16})),this.menuGroupTower.AddMenuText("interactToggleRange","buttonLabel","RANGE"),this.menuGroupTower.AdjustTextObject("interactToggleRange","buttonLabel",0,new Vector3(0,0,-.04)),this.menuGroupTower.AdjustTextObject("interactToggleRange","buttonLabel",1,new Vector3(1,1,1)),this.menuGroupTower.AdjustTextDisplay("interactToggleRange","buttonLabel",0,5),this.menuGroupTower.AddMenuObject("interactClose",5,"selectionInfo"),this.menuGroupTower.AdjustMenuObject("interactClose",0,new Vector3(1,.65,0)),this.menuGroupTower.AdjustMenuObject("interactClose",1,new Vector3(.15,.15,.15)),this.menuGroupTower.GetMenuObject("interactClose").addComponent(new OnPointerDown((function(S){T.SetTowerMenuState(!1)}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"Close Menu",distance:16})),this.menuGroupTower.AddMenuText("interactClose","buttonLabel","CLOSE"),this.menuGroupTower.AdjustTextObject("interactClose","buttonLabel",0,new Vector3(0,0,-.04)),this.menuGroupTower.AdjustTextObject("interactClose","buttonLabel",1,new Vector3(1,1,1)),this.menuGroupTower.AdjustTextDisplay("interactClose","buttonLabel",0,5),this.menuGroupTower.AddMenuText("selectionInfo","towerNameText","TOWER_NAME"),this.menuGroupTower.AdjustTextObject("selectionInfo","towerNameText",0,new Vector3(0,.4,0)),this.menuGroupTower.AdjustTextObject("selectionInfo","towerNameText",1,new Vector3(.25,.25,.25)),this.menuGroupTower.AdjustTextDisplay("selectionInfo","towerNameText",0,6),this.menuGroupTower.AddMenuText("selectionInfo","descText","TOWER_DESC"),this.menuGroupTower.AdjustTextObject("selectionInfo","descText",0,new Vector3(0,.3,0)),this.menuGroupTower.AdjustTextObject("selectionInfo","descText",1,new Vector3(.25,.25,.25)),this.menuGroupTower.AdjustTextDisplay("selectionInfo","descText",0,4),this.menuGroupTower.AdjustTextDisplay("selectionInfo","descText",2,0),this.menuGroupTower.GetMenuObjectText("selectionInfo","descText").getComponent(TextShape).width=10,this.menuGroupTower.GetMenuObjectText("selectionInfo","descText").getComponent(TextShape).textWrapping=!0,this.menuGroupTower.AddMenuText("selectionInfo","dmgLabel","DAMAGE:"),this.menuGroupTower.AdjustTextObject("selectionInfo","dmgLabel",0,new Vector3(-.85,-.25,0)),this.menuGroupTower.AdjustTextObject("selectionInfo","dmgLabel",1,new Vector3(.25,.25,.25)),this.menuGroupTower.AdjustTextDisplay("selectionInfo","dmgLabel",0,3),this.menuGroupTower.AdjustTextDisplay("selectionInfo","dmgLabel",1,0),this.menuGroupTower.AddMenuText("selectionInfo","dmgValue","###"),this.menuGroupTower.AdjustTextObject("selectionInfo","dmgValue",0,new Vector3(-.5,-.25,0)),this.menuGroupTower.AdjustTextObject("selectionInfo","dmgValue",1,new Vector3(.25,.25,.25)),this.menuGroupTower.AdjustTextDisplay("selectionInfo","dmgValue",0,3),this.menuGroupTower.AdjustTextDisplay("selectionInfo","dmgValue",1,0),this.menuGroupTower.AddMenuText("selectionInfo","rofLabel","RoF:"),this.menuGroupTower.AdjustTextObject("selectionInfo","rofLabel",0,new Vector3(-.85,-.35,0)),this.menuGroupTower.AdjustTextObject("selectionInfo","rofLabel",1,new Vector3(.25,.25,.25)),this.menuGroupTower.AdjustTextDisplay("selectionInfo","rofLabel",0,3),this.menuGroupTower.AdjustTextDisplay("selectionInfo","rofLabel",1,0),this.menuGroupTower.AddMenuText("selectionInfo","rofValue","###"),this.menuGroupTower.AdjustTextObject("selectionInfo","rofValue",0,new Vector3(-.68,-.35,0)),this.menuGroupTower.AdjustTextObject("selectionInfo","rofValue",1,new Vector3(.25,.25,.25)),this.menuGroupTower.AdjustTextDisplay("selectionInfo","rofValue",0,3),this.menuGroupTower.AdjustTextDisplay("selectionInfo","rofValue",1,0),this.menuGroupTower.AddMenuText("selectionInfo","rendLabel","REND:"),this.menuGroupTower.AdjustTextObject("selectionInfo","rendLabel",0,new Vector3(-.15,-.25,0)),this.menuGroupTower.AdjustTextObject("selectionInfo","rendLabel",1,new Vector3(.25,.25,.25)),this.menuGroupTower.AdjustTextDisplay("selectionInfo","rendLabel",0,3),this.menuGroupTower.AdjustTextDisplay("selectionInfo","rendLabel",1,0),this.menuGroupTower.AddMenuText("selectionInfo","rendValue","###"),this.menuGroupTower.AdjustTextObject("selectionInfo","rendValue",0,new Vector3(.1,-.25,0)),this.menuGroupTower.AdjustTextObject("selectionInfo","rendValue",1,new Vector3(.25,.25,.25)),this.menuGroupTower.AdjustTextDisplay("selectionInfo","rendValue",0,3),this.menuGroupTower.AdjustTextDisplay("selectionInfo","rendValue",1,0),this.menuGroupTower.AddMenuText("selectionInfo","penLabel","PEN:"),this.menuGroupTower.AdjustTextObject("selectionInfo","penLabel",0,new Vector3(-.15,-.35,0)),this.menuGroupTower.AdjustTextObject("selectionInfo","penLabel",1,new Vector3(.25,.25,.25)),this.menuGroupTower.AdjustTextDisplay("selectionInfo","penLabel",0,3),this.menuGroupTower.AdjustTextDisplay("selectionInfo","penLabel",1,0),this.menuGroupTower.AddMenuText("selectionInfo","penValue","###"),this.menuGroupTower.AdjustTextObject("selectionInfo","penValue",0,new Vector3(.05,-.35,0)),this.menuGroupTower.AdjustTextObject("selectionInfo","penValue",1,new Vector3(.25,.25,.25)),this.menuGroupTower.AdjustTextDisplay("selectionInfo","penValue",0,3),this.menuGroupTower.AdjustTextDisplay("selectionInfo","penValue",1,0),this.menuGroupTower.AddMenuText("selectionInfo","rangeLabel","RANGE:"),this.menuGroupTower.AdjustTextObject("selectionInfo","rangeLabel",0,new Vector3(.45,-.25,0)),this.menuGroupTower.AdjustTextObject("selectionInfo","rangeLabel",1,new Vector3(.25,.25,.25)),this.menuGroupTower.AdjustTextDisplay("selectionInfo","rangeLabel",0,3),this.menuGroupTower.AdjustTextDisplay("selectionInfo","rangeLabel",1,0),this.menuGroupTower.AddMenuText("selectionInfo","rangeValue","###"),this.menuGroupTower.AdjustTextObject("selectionInfo","rangeValue",0,new Vector3(.75,-.25,0)),this.menuGroupTower.AdjustTextObject("selectionInfo","rangeValue",1,new Vector3(.25,.25,.25)),this.menuGroupTower.AdjustTextDisplay("selectionInfo","rangeValue",0,3),this.menuGroupTower.AdjustTextDisplay("selectionInfo","rangeValue",1,0),this.menuGroupTower.AddMenuText("selectionInfo","effectLabel","Effects:"),this.menuGroupTower.AdjustTextObject("selectionInfo","effectLabel",0,new Vector3(.45,-.35,0)),this.menuGroupTower.AdjustTextObject("selectionInfo","effectLabel",1,new Vector3(.25,.25,.25)),this.menuGroupTower.AdjustTextDisplay("selectionInfo","effectLabel",0,3),this.menuGroupTower.AdjustTextDisplay("selectionInfo","effectLabel",1,0),this.menuGroupTower.AddMenuText("selectionInfo","effectValue","[NULL]"),this.menuGroupTower.AdjustTextObject("selectionInfo","effectValue",0,new Vector3(.73,-.35,0)),this.menuGroupTower.AdjustTextObject("selectionInfo","effectValue",1,new Vector3(.25,.25,.25)),this.menuGroupTower.AdjustTextDisplay("selectionInfo","effectValue",0,3),this.menuGroupTower.AdjustTextDisplay("selectionInfo","effectValue",1,0),this.menuGroupTower.AddMenuText("selectionInfo","targetLabel","TARGETING:"),this.menuGroupTower.AdjustTextObject("selectionInfo","targetLabel",0,new Vector3(-.21,-.55,0)),this.menuGroupTower.AdjustTextObject("selectionInfo","targetLabel",1,new Vector3(.25,.25,.25)),this.menuGroupTower.AdjustTextDisplay("selectionInfo","targetLabel",0,3),this.menuGroupTower.AdjustTextDisplay("selectionInfo","targetLabel",1,2),this.menuGroupTower.AddMenuText("selectionInfo","targetValue","[TARGETING TYPE]"),this.menuGroupTower.AdjustTextObject("selectionInfo","targetValue",0,new Vector3(-.19,-.55,0)),this.menuGroupTower.AdjustTextObject("selectionInfo","targetValue",1,new Vector3(.25,.25,.25)),this.menuGroupTower.AdjustTextDisplay("selectionInfo","targetValue",0,3),this.menuGroupTower.AdjustTextDisplay("selectionInfo","targetValue",1,0),this.menuGroupTower.AddMenuObject("interactionPanelBuild",0,"menuOffset"),this.menuGroupTower.AdjustMenuObject("interactionPanelBuild",0,new Vector3(0,-.65)),this.menuGroupTower.AdjustMenuObject("interactionPanelBuild",1,new Vector3(.5,.5,.5)),this.menuGroupTower.AddMenuObject("interactionBuild",4,"interactionPanelBuild"),this.menuGroupTower.AdjustMenuObject("interactionBuild",0,new Vector3(0,0,0)),this.menuGroupTower.AdjustMenuObject("interactionBuild",1,new Vector3(.3,.3,.3)),this.menuGroupTower.GetMenuObject("interactionBuild").addComponent(new OnPointerDown((function(S){null!=T.selectedTowerFoundation?-1==T.selectedTowerFoundation.TowerFrame.TowerDef?T.TowerBuild():log("Game Menu - ERROR: attempting to build tower on tower foundation that already has a constructed tower"):log("Game Menu - ERROR: attempting to build tower on undefined tower foundation")}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"Build Tower",distance:16})),this.menuGroupTower.AddMenuText("interactionBuild","buttonLabel","BUILD"),this.menuGroupTower.AdjustTextObject("interactionBuild","buttonLabel",0,new Vector3(0,0,-.04)),this.menuGroupTower.AdjustTextObject("interactionBuild","buttonLabel",1,new Vector3(1,1,1)),this.menuGroupTower.AdjustTextDisplay("interactionBuild","buttonLabel",0,6),this.menuGroupTower.AddMenuObject("interactionDisplayNext",4,"interactionPanelBuild"),this.menuGroupTower.AdjustMenuObject("interactionDisplayNext",0,new Vector3(.85,0,0)),this.menuGroupTower.AdjustMenuObject("interactionDisplayNext",1,new Vector3(.3,.3,.3)),this.menuGroupTower.GetMenuObject("interactionDisplayNext").addComponent(new OnPointerDown((function(S){T.UpdateTowerBuilderDisplay(T.towerDefinitionIndex+1)}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"Next Tower Type",distance:16})),this.menuGroupTower.AddMenuText("interactionDisplayNext","buttonLabel","NEXT"),this.menuGroupTower.AdjustTextObject("interactionDisplayNext","buttonLabel",0,new Vector3(0,0,-.04)),this.menuGroupTower.AdjustTextObject("interactionDisplayNext","buttonLabel",1,new Vector3(1,1,1)),this.menuGroupTower.AdjustTextDisplay("interactionDisplayNext","buttonLabel",0,6),this.menuGroupTower.AddMenuObject("interactionDisplayPrev",4,"interactionPanelBuild"),this.menuGroupTower.AdjustMenuObject("interactionDisplayPrev",0,new Vector3(-.85,0,0)),this.menuGroupTower.AdjustMenuObject("interactionDisplayPrev",1,new Vector3(.3,.3,.3)),this.menuGroupTower.GetMenuObject("interactionDisplayPrev").addComponent(new OnPointerDown((function(S){T.UpdateTowerBuilderDisplay(T.towerDefinitionIndex-1)}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"Previous Tower Type",distance:16})),this.menuGroupTower.AddMenuText("interactionDisplayPrev","buttonLabel","PREV"),this.menuGroupTower.AdjustTextObject("interactionDisplayPrev","buttonLabel",0,new Vector3(0,0,-.04)),this.menuGroupTower.AdjustTextObject("interactionDisplayPrev","buttonLabel",1,new Vector3(1,1,1)),this.menuGroupTower.AdjustTextDisplay("interactionDisplayPrev","buttonLabel",0,6),this.menuGroupTower.AddMenuObject("interactionPanelUpgrade",0,"menuOffset"),this.menuGroupTower.AdjustMenuObject("interactionPanelUpgrade",0,new Vector3(-1.67,0,-.37)),this.menuGroupTower.AdjustMenuObject("interactionPanelUpgrade",1,new Vector3(.5,.5,.5)),this.menuGroupTower.AdjustMenuObject("interactionPanelUpgrade",2,new Vector3(0,-45,0)),this.menuGroupTower.AddMenuObject("menuBackground",2,"interactionPanelUpgrade"),this.menuGroupTower.AdjustMenuObject("menuBackground",0,new Vector3(0,0,0)),this.menuGroupTower.AdjustMenuObject("menuBackground",1,new Vector3(1,1,1)),this.menuGroupTower.AdjustMenuObject("menuBackground",2,new Vector3(0,0,90)),this.menuGroupTower.AddMenuText("interactionPanelUpgrade","menuLabel","UPGRADES"),this.menuGroupTower.AdjustTextObject("interactionPanelUpgrade","menuLabel",0,new Vector3(0,1.05,0)),this.menuGroupTower.AdjustTextObject("interactionPanelUpgrade","menuLabel",1,new Vector3(.4,.4,1)),this.menuGroupTower.AdjustTextDisplay("interactionPanelUpgrade","menuLabel",0,6),this.menuGroupTower.AddMenuObject("upgradeButton0",5,"interactionPanelUpgrade"),this.menuGroupTower.AdjustMenuObject("upgradeButton0",0,new Vector3(0,.65,0)),this.menuGroupTower.AdjustMenuObject("upgradeButton0",1,new Vector3(.55,.45,.45)),this.menuGroupTower.GetMenuObject("upgradeButton0").addComponent(new OnPointerDown((function(S){T.PurchaseTowerUpgrade(0)}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"Buy Upgrade",distance:16})),this.menuGroupTower.AddMenuText("upgradeButton0","upgradeLabel","PURCHASED:           COST:"),this.menuGroupTower.AdjustTextObject("upgradeButton0","upgradeLabel",0,new Vector3(0,0,-.04)),this.menuGroupTower.AdjustTextObject("upgradeButton0","upgradeLabel",1,new Vector3(.818,1,1)),this.menuGroupTower.AdjustTextDisplay("upgradeButton0","upgradeLabel",0,2),this.menuGroupTower.AddMenuObject("upgradeButton1",5,"interactionPanelUpgrade"),this.menuGroupTower.AdjustMenuObject("upgradeButton1",0,new Vector3(0,.1,0)),this.menuGroupTower.AdjustMenuObject("upgradeButton1",1,new Vector3(.55,.45,.45)),this.menuGroupTower.GetMenuObject("upgradeButton1").addComponent(new OnPointerDown((function(S){T.PurchaseTowerUpgrade(1)}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"Buy Upgrade",distance:16})),this.menuGroupTower.AddMenuText("upgradeButton1","upgradeLabel","PURCHASED:           COST:"),this.menuGroupTower.AdjustTextObject("upgradeButton1","upgradeLabel",0,new Vector3(0,0,-.04)),this.menuGroupTower.AdjustTextObject("upgradeButton1","upgradeLabel",1,new Vector3(.818,1,1)),this.menuGroupTower.AdjustTextDisplay("upgradeButton1","upgradeLabel",0,2),this.menuGroupTower.AddMenuObject("upgradeButton2",5,"interactionPanelUpgrade"),this.menuGroupTower.AdjustMenuObject("upgradeButton2",0,new Vector3(0,-.45,0)),this.menuGroupTower.AdjustMenuObject("upgradeButton2",1,new Vector3(.55,.45,.45)),this.menuGroupTower.GetMenuObject("upgradeButton2").addComponent(new OnPointerDown((function(S){T.PurchaseTowerUpgrade(2)}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"Buy Upgrade",distance:16})),this.menuGroupTower.AddMenuText("upgradeButton2","upgradeLabel","PURCHASED:           COST:"),this.menuGroupTower.AdjustTextObject("upgradeButton2","upgradeLabel",0,new Vector3(0,0,-.04)),this.menuGroupTower.AdjustTextObject("upgradeButton2","upgradeLabel",1,new Vector3(.818,1,1)),this.menuGroupTower.AdjustTextDisplay("upgradeButton2","upgradeLabel",0,2),this.menuGroupTower.AddMenuObject("upgradeButton3",5,"interactionPanelUpgrade"),this.menuGroupTower.AdjustMenuObject("upgradeButton3",0,new Vector3(0,-1,0)),this.menuGroupTower.AdjustMenuObject("upgradeButton3",1,new Vector3(.55,.45,.45)),this.menuGroupTower.GetMenuObject("upgradeButton3").addComponent(new OnPointerDown((function(S){T.PurchaseTowerUpgrade(3)}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"Buy Upgrade",distance:16})),this.menuGroupTower.AddMenuText("upgradeButton3","upgradeLabel","PURCHASED:           COST:"),this.menuGroupTower.AdjustTextObject("upgradeButton3","upgradeLabel",0,new Vector3(0,0,-.04)),this.menuGroupTower.AdjustTextObject("upgradeButton3","upgradeLabel",1,new Vector3(.818,1,1)),this.menuGroupTower.AdjustTextDisplay("upgradeButton3","upgradeLabel",0,2),this.menuGroupTower.AddMenuObject("interactionPanelTarget",0,"menuOffset"),this.menuGroupTower.AdjustMenuObject("interactionPanelTarget",0,new Vector3(1.67,0,-.37)),this.menuGroupTower.AdjustMenuObject("interactionPanelTarget",1,new Vector3(.5,.5,.5)),this.menuGroupTower.AdjustMenuObject("interactionPanelTarget",2,new Vector3(0,45,0)),this.menuGroupTower.AddMenuObject("menuBackground",2,"interactionPanelTarget"),this.menuGroupTower.AdjustMenuObject("menuBackground",0,new Vector3(0,0,0)),this.menuGroupTower.AdjustMenuObject("menuBackground",1,new Vector3(1,1,1)),this.menuGroupTower.AdjustMenuObject("menuBackground",2,new Vector3(0,0,90)),this.menuGroupTower.AddMenuText("interactionPanelTarget","menuLabel","TARGETING"),this.menuGroupTower.AdjustTextObject("interactionPanelTarget","menuLabel",0,new Vector3(0,1.05,0)),this.menuGroupTower.AdjustTextObject("interactionPanelTarget","menuLabel",1,new Vector3(.4,.4,1)),this.menuGroupTower.AdjustTextDisplay("interactionPanelTarget","menuLabel",0,6),this.menuGroupTower.AddMenuObject("tarButtonLaneFurthest",5,"interactionPanelTarget"),this.menuGroupTower.AdjustMenuObject("tarButtonLaneFurthest",0,new Vector3(0,.7,0)),this.menuGroupTower.AdjustMenuObject("tarButtonLaneFurthest",1,new Vector3(.55,.25,.45)),this.menuGroupTower.GetMenuObject("tarButtonLaneFurthest").addComponent(new OnPointerDown((function(S){T.SetTargetingType(0)}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"Target Furthest Down Lane",distance:16})),this.menuGroupTower.AddMenuText("tarButtonLaneFurthest","targetLabel","FURTHEST DOWN LANE"),this.menuGroupTower.AdjustTextObject("tarButtonLaneFurthest","targetLabel",0,new Vector3(0,0,-.04)),this.menuGroupTower.AdjustTextObject("tarButtonLaneFurthest","targetLabel",1,new Vector3(.818,2,1)),this.menuGroupTower.AdjustTextDisplay("tarButtonLaneFurthest","targetLabel",0,2),this.menuGroupTower.AddMenuObject("tarButtonHealthValueHigh",5,"interactionPanelTarget"),this.menuGroupTower.AdjustMenuObject("tarButtonHealthValueHigh",0,new Vector3(0,.4,0)),this.menuGroupTower.AdjustMenuObject("tarButtonHealthValueHigh",1,new Vector3(.55,.25,.45)),this.menuGroupTower.GetMenuObject("tarButtonHealthValueHigh").addComponent(new OnPointerDown((function(S){T.SetTargetingType(1)}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"Target Highest Health Value",distance:16})),this.menuGroupTower.AddMenuText("tarButtonHealthValueHigh","targetLabel","HIGHEST HEALTH VALUE"),this.menuGroupTower.AdjustTextObject("tarButtonHealthValueHigh","targetLabel",0,new Vector3(0,0,-.04)),this.menuGroupTower.AdjustTextObject("tarButtonHealthValueHigh","targetLabel",1,new Vector3(.818,2,1)),this.menuGroupTower.AdjustTextDisplay("tarButtonHealthValueHigh","targetLabel",0,2),this.menuGroupTower.AddMenuObject("tarButtonHealthValueLowest",5,"interactionPanelTarget"),this.menuGroupTower.AdjustMenuObject("tarButtonHealthValueLowest",0,new Vector3(0,.1,0)),this.menuGroupTower.AdjustMenuObject("tarButtonHealthValueLowest",1,new Vector3(.55,.25,.45)),this.menuGroupTower.GetMenuObject("tarButtonHealthValueLowest").addComponent(new OnPointerDown((function(S){T.SetTargetingType(2)}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"Target Lowest Health Value",distance:16})),this.menuGroupTower.AddMenuText("tarButtonHealthValueLowest","targetLabel","LOWEST HEALTH VALUE"),this.menuGroupTower.AdjustTextObject("tarButtonHealthValueLowest","targetLabel",0,new Vector3(0,0,-.04)),this.menuGroupTower.AdjustTextObject("tarButtonHealthValueLowest","targetLabel",1,new Vector3(.818,2,1)),this.menuGroupTower.AdjustTextDisplay("tarButtonHealthValueLowest","targetLabel",0,2),this.menuGroupTower.AddMenuObject("tarButtonHealthPercentHigh",5,"interactionPanelTarget"),this.menuGroupTower.AdjustMenuObject("tarButtonHealthPercentHigh",0,new Vector3(0,-.2,0)),this.menuGroupTower.AdjustMenuObject("tarButtonHealthPercentHigh",1,new Vector3(.55,.25,.45)),this.menuGroupTower.GetMenuObject("tarButtonHealthPercentHigh").addComponent(new OnPointerDown((function(S){T.SetTargetingType(3)}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"Target Highest Health %",distance:16})),this.menuGroupTower.AddMenuText("tarButtonHealthPercentHigh","targetLabel","HIGHEST HEALTH %"),this.menuGroupTower.AdjustTextObject("tarButtonHealthPercentHigh","targetLabel",0,new Vector3(0,0,-.04)),this.menuGroupTower.AdjustTextObject("tarButtonHealthPercentHigh","targetLabel",1,new Vector3(.818,2,1)),this.menuGroupTower.AdjustTextDisplay("tarButtonHealthPercentHigh","targetLabel",0,2),this.menuGroupTower.AddMenuObject("tarButtonHealthPercentLow",5,"interactionPanelTarget"),this.menuGroupTower.AdjustMenuObject("tarButtonHealthPercentLow",0,new Vector3(0,-.5,0)),this.menuGroupTower.AdjustMenuObject("tarButtonHealthPercentLow",1,new Vector3(.55,.25,.45)),this.menuGroupTower.GetMenuObject("tarButtonHealthPercentLow").addComponent(new OnPointerDown((function(S){T.SetTargetingType(4)}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"Target Lowest Health %",distance:16})),this.menuGroupTower.AddMenuText("tarButtonHealthPercentLow","targetLabel","LOWEST HEALTH %"),this.menuGroupTower.AdjustTextObject("tarButtonHealthPercentLow","targetLabel",0,new Vector3(0,0,-.04)),this.menuGroupTower.AdjustTextObject("tarButtonHealthPercentLow","targetLabel",1,new Vector3(.818,2,1)),this.menuGroupTower.AdjustTextDisplay("tarButtonHealthPercentLow","targetLabel",0,2),this.menuGroupTower.AddMenuObject("tarButtonArmourHigh",5,"interactionPanelTarget"),this.menuGroupTower.AdjustMenuObject("tarButtonArmourHigh",0,new Vector3(0,-.8,0)),this.menuGroupTower.AdjustMenuObject("tarButtonArmourHigh",1,new Vector3(.55,.25,.45)),this.menuGroupTower.GetMenuObject("tarButtonArmourHigh").addComponent(new OnPointerDown((function(S){T.SetTargetingType(5)}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"Target Highest Armour",distance:16})),this.menuGroupTower.AddMenuText("tarButtonArmourHigh","targetLabel","HIGHEST ARMOUR VALUE"),this.menuGroupTower.AdjustTextObject("tarButtonArmourHigh","targetLabel",0,new Vector3(0,0,-.04)),this.menuGroupTower.AdjustTextObject("tarButtonArmourHigh","targetLabel",1,new Vector3(.818,2,1)),this.menuGroupTower.AdjustTextDisplay("tarButtonArmourHigh","targetLabel",0,2),this.menuGroupTower.AddMenuObject("tarButtonArmourLow",5,"interactionPanelTarget"),this.menuGroupTower.AdjustMenuObject("tarButtonArmourLow",0,new Vector3(0,-1.1,0)),this.menuGroupTower.AdjustMenuObject("tarButtonArmourLow",1,new Vector3(.55,.25,.45)),this.menuGroupTower.GetMenuObject("tarButtonArmourLow").addComponent(new OnPointerDown((function(S){T.SetTargetingType(6)}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"Target Lowest Armour",distance:16})),this.menuGroupTower.AddMenuText("tarButtonArmourLow","targetLabel","LOWEST ARMOUR VALUE"),this.menuGroupTower.AdjustTextObject("tarButtonArmourLow","targetLabel",0,new Vector3(0,0,-.04)),this.menuGroupTower.AdjustTextObject("tarButtonArmourLow","targetLabel",1,new Vector3(.818,2,1)),this.menuGroupTower.AdjustTextDisplay("tarButtonArmourLow","targetLabel",0,2),this.SetTowerMenuState(!1)},GameMenu.prototype.SetTowerMenuState=function(T){this.menuGroupTower.SetMenuState(T)},GameMenu.prototype.SetTowerMenuDisplayType=function(T){switch(T){case 0:this.menuGroupTower.SetMenuText("selectionInfo","menuLabel","BUILD TOWER"),this.menuGroupTower.GetMenuObject("interactDeconstruct").SetObjectState(!1),this.menuGroupTower.GetMenuObject("interactToggleRange").SetObjectState(!1),this.menuGroupTower.GetMenuObject("interactionPanelBuild").SetObjectState(!0),this.menuGroupTower.GetMenuObject("interactionPanelUpgrade").SetObjectState(!1),this.menuGroupTower.GetMenuObject("interactionPanelTarget").SetObjectState(!1);break;case 1:this.menuGroupTower.SetMenuText("selectionInfo","menuLabel","UPGRADE TOWER"),this.menuGroupTower.GetMenuObject("interactDeconstruct").SetObjectState(!0),this.menuGroupTower.GetMenuObject("interactToggleRange").SetObjectState(!0),this.menuGroupTower.GetMenuObject("interactionPanelBuild").SetObjectState(!1),this.menuGroupTower.GetMenuObject("interactionPanelUpgrade").SetObjectState(!0),this.menuGroupTower.GetMenuObject("interactionPanelTarget").SetObjectState(!0)}},GameMenu.prototype.DisplayTowerFoundation=function(T){this.selectedTowerFoundation=T,this.SetTowerMenuState(!0),-1==this.selectedTowerFoundation.TowerFrame.TowerDef?(log("Game Menu: displaying tower="+this.selectedTowerFoundation.Index+" details, constructed tower=none"),this.SetTowerMenuDisplayType(0),this.UpdateTowerBuilderDisplay(0)):(log("Game Menu: displaying tower="+this.selectedTowerFoundation.Index+" details, constructed tower="+this.selectedTowerFoundation.TowerFrame.TowerDef.toString()),this.SetTowerMenuDisplayType(1),this.UpdateTowerUpgraderState())},GameMenu.prototype.UpdateTowerBuilderDisplay=function(T){T<0?this.towerDefinitionIndex=R.dataTowers.length-1:T>=R.dataTowers.length?this.towerDefinitionIndex=0:this.towerDefinitionIndex=T,V.GameState.debuggingTower&&log("displaying def "+this.towerDefinitionIndex.toString()+" in build menu"),this.menuGroupTower.SetMenuText("selectionInfo","towerNameText",R.dataTowers[this.towerDefinitionIndex].DisplayName),this.menuGroupTower.SetMenuText("selectionInfo","descText","COST: "+R.dataTowers[this.towerDefinitionIndex].ValueCost.toString()+"\n\n"+R.dataTowers[this.towerDefinitionIndex].DisplayDesc),this.menuGroupTower.SetMenuText("selectionInfo","dmgValue",R.dataTowers[this.towerDefinitionIndex].ValueAttackDamage.toString()),this.menuGroupTower.SetMenuText("selectionInfo","penValue",R.dataTowers[this.towerDefinitionIndex].ValueAttackPenetration.toString()),this.menuGroupTower.SetMenuText("selectionInfo","rendValue",R.dataTowers[this.towerDefinitionIndex].ValueAttackRend.toString()),this.menuGroupTower.SetMenuText("selectionInfo","rangeValue",R.dataTowers[this.towerDefinitionIndex].ValueAttackRange.toString()),this.menuGroupTower.SetMenuText("selectionInfo","rofValue",R.dataTowers[this.towerDefinitionIndex].ValueAttackSpeed.toString()),this.menuGroupTower.SetMenuText("selectionInfo","targetLabel",""),this.menuGroupTower.SetMenuText("selectionInfo","targetValue",""),log("Game Menu: tower builder menu has been redrawn")},GameMenu.prototype.UpdateTowerUpgraderState=function(){if(null!=this.selectedTowerFoundation){V.GameState.debuggingTower&&log("displaying def "+this.selectedTowerFoundation.TowerFrame.TowerDef.toString()+" in upgrade menu"),this.menuGroupTower.SetMenuText("selectionInfo","towerNameText",R.dataTowers[this.selectedTowerFoundation.TowerFrame.TowerDef].DisplayName),this.menuGroupTower.SetMenuText("selectionInfo","descText","\n\n"+R.dataTowers[this.selectedTowerFoundation.TowerFrame.TowerDef].DisplayDesc),this.menuGroupTower.SetMenuText("selectionInfo","dmgValue",this.selectedTowerFoundation.TowerFrame.TowerSystem.attackDamage.toString()),this.menuGroupTower.SetMenuText("selectionInfo","penValue",this.selectedTowerFoundation.TowerFrame.TowerSystem.attackPen.toString()),this.menuGroupTower.SetMenuText("selectionInfo","rendValue",this.selectedTowerFoundation.TowerFrame.TowerSystem.attackRend.toString()),this.menuGroupTower.SetMenuText("selectionInfo","rangeValue",this.selectedTowerFoundation.TowerFrame.TowerSystem.attackRange.toString()),this.menuGroupTower.SetMenuText("selectionInfo","rofValue",this.selectedTowerFoundation.TowerFrame.TowerSystem.attackPerSecond.toString()),this.menuGroupTower.SetMenuText("selectionInfo","targetLabel","TARGETING:"),this.menuGroupTower.SetMenuText("selectionInfo","targetValue",this.targetTypeStrings[this.selectedTowerFoundation.TowerFrame.TowerSystem.TargetingType]);for(var T=0;T<4;T++)this.menuGroupTower.GetMenuObject("upgradeButton"+T.toString()).SetObjectState(!1);for(T=0;T<R.dataTowers[this.selectedTowerFoundation.TowerFrame.TowerDef].Upgrades.length;T++)this.menuGroupTower.GetMenuObject("upgradeButton"+T.toString()).SetObjectState(!0),this.menuGroupTower.GetMenuObjectText("upgradeButton"+T.toString(),"upgradeLabel").getComponent(TextShape).value="COUNT: "+this.selectedTowerFoundation.TowerFrame.TowerUpgrades[T]+" / "+R.dataTowers[this.selectedTowerFoundation.TowerFrame.TowerDef].Upgrades[T][2]+"\tCOST: "+R.dataTowers[this.selectedTowerFoundation.TowerFrame.TowerDef].Upgrades[T][1]+"\n"+R.dataTowers[this.selectedTowerFoundation.TowerFrame.TowerDef].Upgrades[T][3]+" "+R.dataTowers[this.selectedTowerFoundation.TowerFrame.TowerDef].Upgrades[T][0]}log("Game Menu: redrew tower upgrader menu")},GameMenu.prototype.PurchaseTowerUpgrade=function(T){if(null!=this.selectedTowerFoundation){if(this.selectedTowerFoundation.TowerFrame.TowerUpgrades[T]>=+R.dataTowers[this.selectedTowerFoundation.TowerFrame.TowerDef].Upgrades[T][2]||+R.dataTowers[this.selectedTowerFoundation.TowerFrame.TowerDef].Upgrades[T][1]>V.GameState.PlayerMoney)return void log("Game Menu: tower upgrade purchase failed, not enough money");log("Game Menu: tower foundation="+this.selectedTowerFoundation.Index.toString()+" purchased tower upgrade="+T.toString()),V.GameState.PlayerMoney-=+R.dataTowers[this.selectedTowerFoundation.TowerFrame.TowerDef].Upgrades[T][1],this.updateMoneyCount(),this.selectedTowerFoundation.TowerFrame.ApplyUpgrade(T),this.UpdateTowerUpgraderState()}},GameMenu.prototype.SetTargetingType=function(T){null!=this.selectedTowerFoundation&&(this.selectedTowerFoundation.TowerFrame.TowerSystem.TargetingType=T,this.menuGroupTower.SetMenuText("selectionInfo","targetValue",this.targetTypeStrings[this.selectedTowerFoundation.TowerFrame.TowerSystem.TargetingType]))},GameMenu.prototype.menuTutorialSetup=function(){this.menuGroupSceneInfo.AddMenuObject("h2pFrame",2),this.menuGroupSceneInfo.AdjustMenuObject("h2pFrame",0,new Vector3(2.4,1.9,-2.9)),this.menuGroupSceneInfo.AdjustMenuObject("h2pFrame",1,new Vector3(1.4,1.4,1.4)),this.menuGroupSceneInfo.AdjustMenuObject("h2pFrame",2,new Vector3(0,180,0)),this.menuGroupSceneInfo.AddMenuObject("h2pContent",0,"h2pFrame"),this.menuGroupSceneInfo.AdjustMenuObject("h2pContent",0,new Vector3(0,0,.0125)),this.menuGroupSceneInfo.AdjustMenuObject("h2pContent",1,new Vector3(1,1,1)),this.menuGroupSceneInfo.AddMenuText("h2pContent","infoHeader","HOW TO PLAY"),this.menuGroupSceneInfo.AdjustTextObject("h2pContent","infoHeader",0,new Vector3(0,.6,0)),this.menuGroupSceneInfo.AdjustTextObject("h2pContent","infoHeader",1,new Vector3(.35,.35,.035)),this.menuGroupSceneInfo.AdjustTextDisplay("h2pContent","infoHeader",0,6),this.menuGroupSceneInfo.AddMenuText("h2pContent","infoText","1 - Defeat enemies and clear waves to earn money\n2 - Spend money on constructing new towers or upgrading existing towers (you can move towers between waves or sell them to get some of their value back)\n3 - Enemies grow stronger with every wave you defeat, every 5th wave is a special boss wave\n4 - Each enemy that reaches your base will damage your health (1HP per standard unit, 10HP per boss unit) and then self destruct. If you reach 0 HP you lose the game!\n"),this.menuGroupSceneInfo.AdjustTextObject("h2pContent","infoText",0,new Vector3(0,.45,0)),this.menuGroupSceneInfo.AdjustTextObject("h2pContent","infoText",1,new Vector3(.35,.35,.035)),this.menuGroupSceneInfo.GetMenuObjectText("h2pContent","infoText").getComponent(TextShape).width=6,this.menuGroupSceneInfo.GetMenuObjectText("h2pContent","infoText").getComponent(TextShape).textWrapping=!0,this.menuGroupSceneInfo.AdjustTextDisplay("h2pContent","infoText",0,2),this.menuGroupSceneInfo.AdjustTextDisplay("h2pContent","infoText",1,0),this.menuGroupSceneInfo.AdjustTextDisplay("h2pContent","infoText",2,0),this.menuGroupSceneInfo.AddMenuText("h2pContent","infoText2","Can you clear all 30 waves?"),this.menuGroupSceneInfo.AdjustTextObject("h2pContent","infoText2",0,new Vector3(0,-.65,0)),this.menuGroupSceneInfo.AdjustTextObject("h2pContent","infoText2",1,new Vector3(.35,.35,.035)),this.menuGroupSceneInfo.GetMenuObjectText("h2pContent","infoText2").getComponent(TextShape).width=6,this.menuGroupSceneInfo.GetMenuObjectText("h2pContent","infoText2").getComponent(TextShape).textWrapping=!0,this.menuGroupSceneInfo.AdjustTextDisplay("h2pContent","infoText2",0,4),this.menuGroupSceneInfo.AdjustTextDisplay("h2pContent","infoText2",1,1),this.menuGroupSceneInfo.AdjustTextDisplay("h2pContent","infoText2",2,1),this.menuGroupSceneInfo.AddMenuObject("infoFrame",2),this.menuGroupSceneInfo.AdjustMenuObject("infoFrame",0,new Vector3(-1.35,1.9,-1.35)),this.menuGroupSceneInfo.AdjustMenuObject("infoFrame",1,new Vector3(1.4,1.4,1.4)),this.menuGroupSceneInfo.AdjustMenuObject("infoFrame",2,new Vector3(0,225,0)),this.menuGroupSceneInfo.AddMenuObject("infoContent",0,"infoFrame"),this.menuGroupSceneInfo.AdjustMenuObject("infoContent",0,new Vector3(0,0,.0125)),this.menuGroupSceneInfo.AdjustMenuObject("infoContent",1,new Vector3(1,1,1)),this.menuGroupSceneInfo.AddMenuText("infoContent","infoHeader","SCENE INFO"),this.menuGroupSceneInfo.AdjustTextObject("infoContent","infoHeader",0,new Vector3(0,.6,0)),this.menuGroupSceneInfo.AdjustTextObject("infoContent","infoHeader",1,new Vector3(.35,.35,.035)),this.menuGroupSceneInfo.AdjustTextDisplay("infoContent","infoHeader",0,6),this.menuGroupSceneInfo.AddMenuText("infoContent","infoHeader","This scene is an example implementation of how the Decentraland Tower Defence Module can be deployed on Decentraland Worlds.\n\nSeveral other scenes have also been developed using this kit! You can check them out here:\n\n\n\nThis module's development was funded through the Community Grants Program and the entire Tower Defence Creation Kit is completely open-source and free to use. You can check out the repository for the source and a quick guide on how to get started!"),this.menuGroupSceneInfo.AdjustTextObject("infoContent","infoHeader",0,new Vector3(0,.45,0)),this.menuGroupSceneInfo.AdjustTextObject("infoContent","infoHeader",1,new Vector3(.35,.35,.035)),this.menuGroupSceneInfo.GetMenuObjectText("infoContent","infoHeader").getComponent(TextShape).width=6,this.menuGroupSceneInfo.GetMenuObjectText("infoContent","infoHeader").getComponent(TextShape).textWrapping=!0,this.menuGroupSceneInfo.AdjustTextDisplay("infoContent","infoHeader",0,2),this.menuGroupSceneInfo.AdjustTextDisplay("infoContent","infoHeader",1,0),this.menuGroupSceneInfo.AdjustTextDisplay("infoContent","infoHeader",2,0);for(var T=0;T<this.stringsSceneNames.length;T++){var S=new Vector3(.66*(T%3-1),-.075,0);this.menuGroupSceneInfo.AddMenuObject("buttonScene"+T,5,"infoFrame"),this.menuGroupSceneInfo.AdjustMenuObject("buttonScene"+T,0,S),this.menuGroupSceneInfo.AdjustMenuObject("buttonScene"+T,1,new Vector3(.22,.18,.2)),this.menuGroupSceneInfo.AddMenuText("buttonScene"+T,"buttonText",this.stringsSceneNames[T]),this.menuGroupSceneInfo.AdjustTextObject("buttonScene"+T,"buttonText",0,new Vector3(0,0,-.031)),this.menuGroupSceneInfo.AdjustTextObject("buttonScene"+T,"buttonText",1,new Vector3(.34,.42,.03))}for(this.menuGroupSceneInfo.AddMenuObject("buttonRepo",5,"infoFrame"),this.menuGroupSceneInfo.AdjustMenuObject("buttonRepo",0,new Vector3(-.4,-.65,0)),this.menuGroupSceneInfo.AdjustMenuObject("buttonRepo",1,new Vector3(.2,.2,.2)),this.menuGroupSceneInfo.GetMenuObject("buttonRepo").addComponent(new OnPointerDown((function(T){openExternalURL("https://github.com/TheCryptoTrader69/Decentraland-Tower-Defence-Creation-Kit")}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"[E] Public Repository",distance:8})),this.menuGroupSceneInfo.AddMenuText("buttonRepo","buttonText","REPOSITORY"),this.menuGroupSceneInfo.AdjustTextObject("buttonRepo","buttonText",0,new Vector3(0,0,-.031)),this.menuGroupSceneInfo.AdjustTextObject("buttonRepo","buttonText",1,new Vector3(.4,.4,.03)),this.menuGroupSceneInfo.AddMenuObject("buttonRepo",5,"infoFrame"),this.menuGroupSceneInfo.AdjustMenuObject("buttonRepo",0,new Vector3(.4,-.65,0)),this.menuGroupSceneInfo.AdjustMenuObject("buttonRepo",1,new Vector3(.2,.2,.2)),this.menuGroupSceneInfo.GetMenuObject("buttonRepo").addComponent(new OnPointerDown((function(T){openExternalURL("https://governance.decentraland.org/proposal/?id=f92e37a0-5ee9-11ed-9128-d95e3b6d7912")}),{button:ActionButton.ANY,showFeedback:!0,hoverText:"[E] DAO Proposal",distance:8})),this.menuGroupSceneInfo.AddMenuText("buttonRepo","buttonText","PROPOSAL"),this.menuGroupSceneInfo.AdjustTextObject("buttonRepo","buttonText",0,new Vector3(0,0,-.031)),this.menuGroupSceneInfo.AdjustTextObject("buttonRepo","buttonText",1,new Vector3(.4,.4,.03)),this.menuGroupSceneInfo.AddMenuObject("creditFrame",2),this.menuGroupSceneInfo.AdjustMenuObject("creditFrame",0,new Vector3(-2.9,1.9,2.4)),this.menuGroupSceneInfo.AdjustMenuObject("creditFrame",1,new Vector3(1.4,1.4,1.4)),this.menuGroupSceneInfo.AdjustMenuObject("creditFrame",2,new Vector3(0,270,0)),this.menuGroupSceneInfo.AddMenuObject("creditContent",0,"creditFrame"),this.menuGroupSceneInfo.AdjustMenuObject("creditContent",0,new Vector3(0,0,.0125)),this.menuGroupSceneInfo.AdjustMenuObject("creditContent",1,new Vector3(1,1,1)),this.menuGroupSceneInfo.AddMenuText("creditContent","infoHeader","SCENE CREDITS"),this.menuGroupSceneInfo.AdjustTextObject("creditContent","infoHeader",0,new Vector3(0,.6,0)),this.menuGroupSceneInfo.AdjustTextObject("creditContent","infoHeader",1,new Vector3(.35,.35,.035)),this.menuGroupSceneInfo.AdjustTextDisplay("creditContent","infoHeader",0,6),this.menuGroupSceneInfo.AddMenuText("creditContent","infoHeader","This project included a large number of creators from the Decentraland community! Though this specific scene may not include assets from every creator, I feel it is important to still include every person who helped make this project a reality!\n\n\n\n\t\t   Music: Karl Casey @ White Bat Audio"),this.menuGroupSceneInfo.AdjustTextObject("creditContent","infoHeader",0,new Vector3(0,.45,0)),this.menuGroupSceneInfo.AdjustTextObject("creditContent","infoHeader",1,new Vector3(.35,.35,.035)),this.menuGroupSceneInfo.GetMenuObjectText("creditContent","infoHeader").getComponent(TextShape).width=6,this.menuGroupSceneInfo.GetMenuObjectText("creditContent","infoHeader").getComponent(TextShape).textWrapping=!0,this.menuGroupSceneInfo.AdjustTextDisplay("creditContent","infoHeader",0,2),this.menuGroupSceneInfo.AdjustTextDisplay("creditContent","infoHeader",1,0),this.menuGroupSceneInfo.AdjustTextDisplay("creditContent","infoHeader",2,0),T=0;T<this.stringsCreators.length;T++)S=new Vector3(.61*(T%4-1.5),-.38-.235*Math.round(T/8),0),this.menuGroupSceneInfo.AddMenuObject("buttonCreator"+T,5,"creditFrame"),this.menuGroupSceneInfo.AdjustMenuObject("buttonCreator"+T,0,S),this.menuGroupSceneInfo.AdjustMenuObject("buttonCreator"+T,1,new Vector3(.22,.2,.2)),this.menuGroupSceneInfo.AddMenuText("buttonCreator"+T,"buttonText",this.stringsCreators[T]),this.menuGroupSceneInfo.AdjustTextObject("buttonCreator"+T,"buttonText",0,new Vector3(0,0,-.031)),this.menuGroupSceneInfo.AdjustTextObject("buttonCreator"+T,"buttonText",1,new Vector3(.3,.3,.03));this.menuGroupSceneInfo.SetMenuState(!0)},GameMenu}();S.GameMenu=z})),define("utilities/audio-manager",["require","exports"],(function(T,S){Object.defineProperty(S,"__esModule",{value:!0}),S.AudioManager=void 0;var v=function(T){function AudioManager(){var S=T.call(this)||this;return S.addComponent(new Transform({position:new Vector3(32,20,32),scale:new Vector3(1,1,1),rotation:(new Quaternion).setEuler(0,0,0)})),S.musicLobbyObj=new Entity,S.musicLobbyObj.setParent(S),S.musicLobbySource=new AudioSource(new AudioClip("audio/WhiteBatAudio_VHS_Memory.mp3")),S.musicLobbySource.playing=!1,S.musicLobbySource.loop=!0,S.musicLobbyObj.addComponent(S.musicLobbySource),S.musicBattleObj=new Entity,S.musicBattleObj.setParent(S),S.musicBattleSource=new AudioSource(new AudioClip("audio/WhiteBatAudio_Soma.mp3")),S.musicBattleSource.playing=!1,S.musicBattleSource.loop=!0,S.musicBattleObj.addComponent(S.musicBattleSource),engine.addEntity(S),S}return __extends(AudioManager,T),Object.defineProperty(AudioManager,"Instance",{get:function(){return void 0===AudioManager.instance&&(AudioManager.instance=new AudioManager),AudioManager.instance},enumerable:!1,configurable:!0}),AudioManager.prototype.SetMusicState=function(T){switch(this.musicLobbySource.playing=!1,this.musicBattleSource.playing=!1,T){case 1:this.musicLobbySource.playing=!0;break;case 2:this.musicBattleSource.playing=!0}},AudioManager}(Entity);S.AudioManager=v})),define("td-core/game-manager",["require","exports","td-core/data/difficulty-data","td-core/data/tower-data","td-core/enemy-manager","td-core/enemy-wave-manager","td-core/map-pathing","td-core/tower-manager","td-core/game-states","td-core/game-menu","td-core/data/enemy-data","utilities/audio-manager"],(function(T,S,v,M,A,E,C,O,j,R,V,z){Object.defineProperty(S,"__esModule",{value:!0}),S.GameManager=void 0;var B=function(T){function GameManager(){var S=T.call(this)||this;return S.unitLength=0,S.unitIndex=0,S.unitIndexTest=0,S.addComponent(new Transform({position:new Vector3(0,0,0),scale:new Vector3(1,1,1),rotation:(new Quaternion).setEuler(0,0,0)})),R.GameMenu.Instance.SetDifficulty=S.callbackSetDifficulty,R.GameMenu.Instance.GameStart=S.callbackGameStart,R.GameMenu.Instance.GameReset=S.callbackGameReset,R.GameMenu.Instance.WaveStart=S.callbackWaveStart,R.GameMenu.Instance.TowerBuild=S.callbackTowerBuild,R.GameMenu.Instance.TowerDeconstruct=S.callbackTowerDeconstruct,R.GameMenu.Instance.menuGroupTower.AdjustMenuParent(0,new Vector3(4,24,4)),R.GameMenu.Instance.menuGroupTower.groupParent.getComponent(Transform).lookAt(Camera.instance.position),R.GameMenu.Instance.menuGroupTower.groupParent.getComponent(Transform).rotation=Quaternion.Euler(0,R.GameMenu.Instance.menuGroupTower.groupParent.getComponent(Transform).eulerAngles.y+180,0),S.gameTimerSystem=new H,S.gameTimerSystem.SpawnEnemy=S.callbackEnemyUnitSpawn,S.gameTimerSystem.StartWave=S.callbackWaveStart,engine.addSystem(S.gameTimerSystem),C.WaypointManager.Instance.GenerateWaypoints(),C.WaypointManager.Instance.setParent(S),O.TowerManager.Instance.GetSelectedTowerMove=S.getSelectedTowerMove,O.TowerManager.Instance.MoveTower=S.callbackTowerMove,O.TowerManager.Instance.GetSelectedTower=S.getSelectedTower,O.TowerManager.Instance.SelectTower=S.callbackTowerSelect,O.TowerManager.Instance.DamageEnemy=S.callbackEnemyUnitDamage,O.TowerManager.Instance.ApplyEffect=A.EnemyUnitManager.Instance.callbackApplyEffect,O.TowerManager.Instance.GenerateTowerFoundations(),O.TowerManager.Instance.setParent(S),A.EnemyUnitManager.Instance.UnitAttack=S.callbackPlayerBaseDamage,A.EnemyUnitManager.Instance.UnitDeath=S.callbackEnemyUnitDeath,A.EnemyUnitManager.Instance.setParent(S),A.EnemyUnitManager.Instance.Initialize(),engine.addEntity(S),S.SetDifficulty(2),S}return __extends(GameManager,T),Object.defineProperty(GameManager,"Instance",{get:function(){return void 0===GameManager.instance&&(GameManager.instance=new GameManager),GameManager.instance},enumerable:!1,configurable:!0}),GameManager.prototype.callbackSetDifficulty=function(T){GameManager.Instance.SetDifficulty(T)},GameManager.prototype.SetDifficulty=function(T){T>=v.DifficultyData.length?j.GameState.DifficultyCur=0:j.GameState.DifficultyCur=T<0?v.DifficultyData.length-1:T,R.GameMenu.Instance.updateDifficulty()},GameManager.prototype.callbackGameReset=function(){GameManager.Instance.GameReset()},GameManager.prototype.GameReset=function(){j.GameState.debuggingManager&&log("TD MANAGER: game resetting..."),j.GameState.stateCur=0,this.gameTimerSystem.halted=!0,A.EnemyUnitManager.Instance.ClearUnits(),O.TowerManager.Instance.ClearTowers(),this.selectedFoundationMove=void 0,O.TowerManager.Instance.SetTowerMoveMarkerState(!1),R.GameMenu.Instance.UpdateMainMenuState(0),R.GameMenu.Instance.UpdateWaveCount(),R.GameMenu.Instance.updateLifeCount(),R.GameMenu.Instance.updateMoneyCount(),z.AudioManager.Instance.SetMusicState(1),j.GameState.debuggingManager&&log("TD MANAGER: game reset!")},GameManager.prototype.callbackGameStart=function(){GameManager.Instance.GameStart()},GameManager.prototype.GameStart=function(){j.GameState.debuggingManager&&log("TD MANAGER: game starting..."),j.GameState.stateCur=1,j.GameState.WaveCur=0,j.GameState.PlayerHealth=v.DifficultyData[j.GameState.DifficultyCur].PlayerHealth,j.GameState.PlayerMoney=j.GameState.moneyStart,C.WaypointManager.Instance.ResetSpawner(),C.WaypointManager.Instance.ParseSpawnerConfig(),A.EnemyUnitManager.Instance.ClearUnits(),E.EnemyWaveManager.Instance.GenerateWaves(),O.TowerManager.Instance.ClearTowers(),R.GameMenu.Instance.UpdateMainMenuState(1),R.GameMenu.Instance.UpdateWaveCount(),R.GameMenu.Instance.updateLifeCount(),R.GameMenu.Instance.updateMoneyCount(),this.gameTimerSystem.Initialize(),z.AudioManager.Instance.SetMusicState(1),j.GameState.debuggingManager&&log("TD MANAGER: game started!")},GameManager.prototype.callbackGameEnd=function(T){GameManager.Instance.GameEnd(T)},GameManager.prototype.GameEnd=function(T){j.GameState.debuggingManager&&log("TD MANAGER: game ending ("+T+")..."),j.GameState.stateCur=3,this.selectedFoundationMove=void 0,O.TowerManager.Instance.SetTowerMoveMarkerState(!1),A.EnemyUnitManager.Instance.ClearUnits(),z.AudioManager.Instance.SetMusicState(1),j.GameState.debuggingManager&&log("TD MANAGER: game ended ("+T+")!")},GameManager.prototype.callbackWaveStart=function(){GameManager.Instance.WaveStart()},GameManager.prototype.WaveStart=function(){if(j.GameState.debuggingWave&&log("TD MANAGER: starting wave "+j.GameState.WaveCur+"..."),1==j.GameState.stateCur){j.GameState.stateCur=2,this.selectedFoundationMove=void 0,O.TowerManager.Instance.SetTowerMoveMarkerState(!1),this.unitLength=E.EnemyWaveManager.Instance.GetEnemyWaveCurrent().enemyUnits.length,A.EnemyUnitManager.Instance.enemySizeRemaining=0;for(var T=0;T<this.unitLength;T++)A.EnemyUnitManager.Instance.enemySizeRemaining+=E.EnemyWaveManager.Instance.GetEnemyWaveCurrent().enemyUnits[T].enemyCount;this.gameTimerSystem.Initialize(),this.gameTimerSystem.halted=!1,R.GameMenu.Instance.UpdateMainMenuState(2),z.AudioManager.Instance.SetMusicState(2),j.GameState.debuggingWave&&log("TD MANAGER: started wave "+j.GameState.WaveCur+" with "+A.EnemyUnitManager.Instance.enemySizeRemaining+" enemies!")}else j.GameState.debuggingWave&&log("TD MANAGER: failed, incorrect state ("+j.GameState.stateCur.toString()+")")},GameManager.prototype.WaveEnd=function(){if(j.GameState.debuggingWave&&log("TD MANAGER: wave "+j.GameState.WaveCur+" ending..."),j.GameState.WaveCur>=j.GameState.WaveMax-1)return j.GameState.debuggingWave&&log("TD MANAGER: game ended on wave "+j.GameState.WaveCur+"!"),void this.GameEnd(!0);j.GameState.stateCur=1,j.GameState.PlayerMoney+=j.GameState.MoneyRewardWave,R.GameMenu.Instance.updateMoneyCount(),j.GameState.WaveCur++,C.WaypointManager.Instance.ParseSpawnerConfig(),R.GameMenu.Instance.UpdateMainMenuState(1),z.AudioManager.Instance.SetMusicState(1),j.GameState.debuggingWave&&log("TD MANAGER: wave "+j.GameState.WaveCur+" ended!")},GameManager.prototype.getSelectedTowerMove=function(){return GameManager.Instance.selectedFoundationMove},GameManager.prototype.callbackTowerMove=function(T){GameManager.Instance.TowerMove(T)},GameManager.prototype.TowerMove=function(T){j.GameState.debuggingTower&&log("TD MANAGER: foundation "+T.toString()+" selected for move"),R.GameMenu.Instance.SetTowerMenuState(!1),1==j.GameState.stateCur?null==this.selectedFoundationMove?(j.GameState.debuggingTower&&log("TD MANAGER: move foundation was undefined, set to: "+T.toString()),this.selectedFoundationMove=O.TowerManager.Instance.TowerFoundationDict.getItem(T.toString()),null!=this.selectedFoundationMove&&O.TowerManager.Instance.SetTowerMoveMarker(T)):(this.selectedFoundationMove.Index!=T?(j.GameState.debuggingTower&&log("TD MANAGER: move foundation was defined as "+this.selectedFoundationMove.Index.toString()+", swapping with "+T.toString()),O.TowerManager.Instance.MoveTowerObject(this.selectedFoundationMove.Index,T)):j.GameState.debuggingTower&&log("TD MANAGER: move foundation was defined as "+this.selectedFoundationMove.Index.toString()+", selected same foundation (cleared)"),this.selectedFoundationMove=void 0,O.TowerManager.Instance.SetTowerMoveMarkerState(!1)):j.GameState.debuggingTower&&log("TD MANAGER (ERROR): tower move failed, wrong game state")},GameManager.prototype.getSelectedTower=function(){return GameManager.Instance.selectedFoundation},GameManager.prototype.callbackTowerSelect=function(T){GameManager.Instance.TowerSelect(T)},GameManager.prototype.TowerSelect=function(T){j.GameState.debuggingTower&&log("TD MANAGER: selecting tower foundation "+T.toString()+"..."),0!=j.GameState.stateCur?(this.selectedFoundationMove=void 0,O.TowerManager.Instance.SetTowerMoveMarkerState(!1),this.selectedFoundation=O.TowerManager.Instance.TowerFoundationDict.getItem(T.toString()),null!=this.selectedFoundation?(R.GameMenu.Instance.menuGroupTower.AdjustMenuParent(0,this.selectedFoundation.getComponent(Transform).position),R.GameMenu.Instance.menuGroupTower.groupParent.getComponent(Transform).lookAt(Camera.instance.position),R.GameMenu.Instance.menuGroupTower.groupParent.getComponent(Transform).rotation=Quaternion.Euler(0,R.GameMenu.Instance.menuGroupTower.groupParent.getComponent(Transform).eulerAngles.y+180,0),R.GameMenu.Instance.DisplayTowerFoundation(this.selectedFoundation),j.GameState.debuggingTower&&log("TD MANAGER: selected tower foundation "+T.toString()+"!")):j.GameState.debuggingTower&&log("TD MANAGER (ERROR): attempting to select non-existant tower foundation (index = "+T.toString()+")")):j.GameState.debuggingTower&&log("TD MANAGER (ERROR): tower move failed, wrong game state")},GameManager.prototype.callbackTowerBuild=function(){GameManager.Instance.TowerBuild()},GameManager.prototype.TowerBuild=function(){0!=j.GameState.stateCur&&3!=j.GameState.stateCur?null!=this.selectedFoundation?j.GameState.PlayerMoney<M.dataTowers[R.GameMenu.Instance.towerDefinitionIndex].ValueCost&&!j.GameState.debuggingTower?j.GameState.debuggingTower&&log("TD MANAGER (ERROR): tower build failed, not enough player funding"):(j.GameState.debuggingTower&&log("TD MANAGER: constructing tower (type="+R.GameMenu.Instance.towerDefinitionIndex.toString()+") on foundation (index="+this.selectedFoundation.Index.toString()+")..."),j.GameState.PlayerMoney-=M.dataTowers[R.GameMenu.Instance.towerDefinitionIndex].ValueCost,R.GameMenu.Instance.updateMoneyCount(),O.TowerManager.Instance.BuildTower(this.selectedFoundation.Index,R.GameMenu.Instance.towerDefinitionIndex),R.GameMenu.Instance.DisplayTowerFoundation(this.selectedFoundation),j.GameState.debuggingTower&&log("TD MANAGER: constructed tower frame (type="+this.selectedFoundation.TowerFrame.TowerDef.toString()+") foundation (index="+this.selectedFoundation.Index.toString()+")!")):j.GameState.debuggingTower&&log("TD MANAGER (ERROR): tower build failed, no tower foundation selected"):j.GameState.debuggingTower&&log("TD MANAGER (ERROR): tower build failed, wrong game state")},GameManager.prototype.callbackTowerDeconstruct=function(){GameManager.Instance.TowerDeconstruct()},GameManager.prototype.TowerDeconstruct=function(){0!=j.GameState.stateCur&&3!=j.GameState.stateCur?null!=this.selectedFoundation?-1!=this.selectedFoundation.TowerFrame.TowerDef?(j.GameState.debuggingTower&&log("TD MANAGER: deconstructing tower on foundation (index="+this.selectedFoundation.Index.toString()+")..."),O.TowerManager.Instance.ClearTower(this.selectedFoundation.Index,!0),R.GameMenu.Instance.DisplayTowerFoundation(this.selectedFoundation),j.GameState.debuggingTower&&log("TD MANAGER: deconstructed tower on foundation (index="+this.selectedFoundation.Index.toString()+")!")):j.GameState.debuggingTower&&log("TD MANAGER (ERROR): tower deconstruct failed, no tower frame selected"):j.GameState.debuggingTower&&log("TD MANAGER (ERROR): tower deconstruct failed, no tower foundation selected"):j.GameState.debuggingTower&&log("TD MANAGER (ERROR): tower deconstruct failed, wrong game state")},GameManager.prototype.callbackEnemyUnitSpawn=function(){GameManager.Instance.EnemyUnitSpawn()},GameManager.prototype.EnemyUnitSpawn=function(){j.GameState.debuggingEnemy&&log("TD MANAGER: spawning enemy unit...");for(var T=0;T<C.WaypointManager.Instance.SpawnPoints.size();T++)if(1==C.WaypointManager.Instance.SpawnPoints.getItem(T).State){this.unitLength=E.EnemyWaveManager.Instance.GetEnemyWaveCurrent().enemyUnits.length,this.unitIndexTest=Math.floor(Math.random()*this.unitLength);for(var S=0;S<this.unitLength;S++){if(0!=E.EnemyWaveManager.Instance.GetEnemyWaveCurrent().enemyUnits[this.unitIndexTest].enemyCount){this.unitIndex=this.unitIndexTest;break}this.unitIndexTest++,this.unitIndexTest>=this.unitLength&&(this.unitIndexTest=0)}if(0==E.EnemyWaveManager.Instance.GetEnemyWaveCurrent().enemyUnits[this.unitIndex].enemyCount)return this.gameTimerSystem.spawningFinished=!0,1!=S&&(S+1)%E.EnemyWaveManager.Instance.bossInterval==0?this.gameTimerSystem.halted=!0:this.gameTimerSystem.waveWaiting=!0,void log("TD MANAGER (ERROR): attempted to create enemy unit for an empty wave");var v=A.EnemyUnitManager.Instance.AssignEnemyUnit(E.EnemyWaveManager.Instance.GetEnemyWaveCurrent().enemyUnits[this.unitIndex].enemyIndex,T);if(null==v)return void(j.GameState.debuggingEnemy&&log("TD MANAGER: failed to spawn enemy unit, all units are reserved"));E.EnemyWaveManager.Instance.GetEnemyWaveCurrent().enemyUnits[this.unitIndex].enemyCount--;var M=!0;for(S=0;S<E.EnemyWaveManager.Instance.GetEnemyWaveCurrent().enemyUnits.length;S++)E.EnemyWaveManager.Instance.GetEnemyWaveCurrent().enemyUnits[S].enemyCount>0&&(M=!1);M&&(this.gameTimerSystem.spawningFinished=!1),R.GameMenu.Instance.UpdateEnemyCount(),j.GameState.debuggingEnemy&&log("TD MANAGER: spawned enemy unit, ID:"+v.Index.toString())}},GameManager.prototype.callbackEnemyUnitDamage=function(T,S,v,M){GameManager.Instance.EnemyUnitDamage(T,S,v,M)},GameManager.prototype.EnemyUnitDamage=function(T,S,v,M){A.EnemyUnitManager.Instance.DamageUnit(T,S,v,M)},GameManager.prototype.callbackEnemyUnitDeath=function(T,S){GameManager.Instance.EnemyUnitDeath(T,S)},GameManager.prototype.EnemyUnitDeath=function(T,S){this.enemyUnit=A.EnemyUnitManager.Instance.GetEnemyUnitByIndex(T),null!=this.enemyUnit?this.enemyUnit.IsAlive?(j.GameState.debuggingEnemy&&log("TD MANAGER: enemy unit "+T.toString()+" has been killed, processing EnemyUnitDeath"),S&&(j.GameState.PlayerMoney+=V.EnemyData[this.enemyUnit.Type].ValueRewards,R.GameMenu.Instance.updateMoneyCount()),O.TowerManager.Instance.TargetDeathCheck(T),A.EnemyUnitManager.Instance.enemySizeCur--,A.EnemyUnitManager.Instance.enemySizeRemaining--,R.GameMenu.Instance.UpdateEnemyCount(),A.EnemyUnitManager.Instance.enemySizeRemaining<=0&&this.WaveEnd()):log("TD MANAGER (ERROR): attempting to kill dead enemy="+T.toString()):log("TD MANAGER (ERROR): attempting to kill nonexistant enemy="+T.toString())},GameManager.prototype.callbackPlayerBaseDamage=function(T){GameManager.Instance.PlayerBaseDamage(T)},GameManager.prototype.PlayerBaseDamage=function(T){j.GameState.debuggingManager&&log("TD MANAGER: player base dealt "+T.toString()+" damage"),j.GameState.PlayerHealth-=T,j.GameState.PlayerHealth<=0&&(j.GameState.debuggingManager&&log("TD MANAGER: player base has been destroyed, ending game..."),this.GameEnd(!1)),R.GameMenu.Instance.updateLifeCount()},GameManager}(Entity);S.GameManager=B;var H=function(){function GameTimerSystem(){this.autoStart=!1,this.halted=!0,this.waveWaiting=!1,this.delayWaveLength=20,this.delayWaveTimeStamp=0,this.spawningFinished=!1,this.delaySpawnLength=1.25,this.delaySpawnTimeStamp=0,this.StartWave=this.startWave,this.SpawnEnemy=this.spawnEnemy}return GameTimerSystem.prototype.startWave=function(){log("timer system callback not set - start wave")},GameTimerSystem.prototype.spawnEnemy=function(){log("timer system callback not set - spawn enemy")},GameTimerSystem.prototype.Initialize=function(){this.waveWaiting=!1,this.delayWaveTimeStamp=0,this.spawningFinished=!1,this.delaySpawnTimeStamp=0,this.halted=!0},GameTimerSystem.prototype.update=function(T){this.halted||(this.spawningFinished||(this.delaySpawnTimeStamp-=T,this.delaySpawnTimeStamp<=0&&(this.SpawnEnemy(),this.delaySpawnTimeStamp=this.delaySpawnLength)),this.waveWaiting&&this.autoStart&&(this.delayWaveTimeStamp-=T,this.delayWaveTimeStamp<=0&&(this.delayWaveTimeStamp=this.delayWaveLength,this.StartWave())))},GameTimerSystem}()})),define("game",["require","exports","td-core/game-manager"],(function(T,S,v){Object.defineProperty(S,"__esModule",{value:!0}),v.GameManager.Instance.GameReset();var M=new Entity;M.addComponent(new GLTFShape("models/environment/envLowPoly.glb")),M.addComponent(new Transform({position:new Vector3(0,0,0),scale:new Vector3(1,1,1),rotation:(new Quaternion).setEuler(0,0,0)})),engine.addEntity(M)})),define("td-core/enemy-wave-display",["require","exports"],(function(T,S){Object.defineProperty(S,"__esModule",{value:!0}),S.EnemyWaveDisplay=void 0;var v=function(T){function EnemyWaveDisplay(){var S=T.call(this)||this;S.addComponent(new Transform({position:new Vector3(0,0,0),scale:new Vector3(1,1,1),rotation:(new Quaternion).setEuler(0,0,0)})),S.displayStands=[new Entity,new Entity];for(var v=0;v<S.displayStands.length;v++)S.displayStands[v].setParent(S),S.displayStands[v].addComponent(new BoxShape);for(S.displayStands[0].addComponent(new Transform({position:new Vector3(-2,0,0),scale:new Vector3(1,1,1),rotation:(new Quaternion).setEuler(0,0,0)})),S.displayStands[1].addComponent(new Transform({position:new Vector3(2,0,0),scale:new Vector3(1,1,1),rotation:(new Quaternion).setEuler(0,0,0)})),S.displayObject=[new Entity,new Entity],v=0;v<S.displayObject.length;v++)S.displayObject[v].setParent(S),S.displayObject[v].addComponent(new BoxShape);return S.displayObject[0].addComponent(new Transform({position:new Vector3(-2,2,0),scale:new Vector3(1,1,1),rotation:(new Quaternion).setEuler(0,0,0)})),S.displayObject[1].addComponent(new Transform({position:new Vector3(2,2,0),scale:new Vector3(1,1,1),rotation:(new Quaternion).setEuler(0,0,0)})),S}return __extends(EnemyWaveDisplay,T),EnemyWaveDisplay}(Entity);S.EnemyWaveDisplay=v})),define("td-core/config/difficulty-config",["require","exports"],(function(T,S){Object.defineProperty(S,"__esModule",{value:!0}),S.dataMap=void 0,S.dataMap=[{DisplayName:"Debugger",DisplayDesc:"Realm for debugging the game",MonsterTypes:"0_1_2",WaveCount:10,DifficultyWaveAdd:2}]}));